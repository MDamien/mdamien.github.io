<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>git-word-blame</title></head><body><style>
body {
    background-color: #2d363a;
    color: #94a3a5;
}

#content > a:hover, #content > a.hovered {
    background: #94a3a5;
    color: #2d363a;
}
</style><style>
body {
    margin: 0;
    padding: 10px;
    max-width: 800px;
    margin: auto;
    margin-top: 20px;
}
#content > a {
    color: inherit;
    text-decoration: none;
}
#content {
    white-space: pre-wrap;
    word-wrap: anywhere;
    margin-top: 0;
} 
#content > a:hover, #content > a.hovered {
    cursor: pointer;
}
</style><pre id="content"><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">#include "</a><a data-author="Linus Torvalds" data-commit="70827b15bfb11f7aea52c6995956be9d149233e1" data-file="git.c" href="https://github.com/git/git/commit/70827b15bfb11f7aea52c6995956be9d149233e1" target="blank" title="Split up builtin commands into separate files from git.c

Right now it split it into "builtin-log.c" for log-related commands
("log", "show" and "whatchanged"), and "builtin-help.c" for the
informational commands (usage printing and "help" and "version").

This just makes things easier to read, I find.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">builtin</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">.h"</a><a data-author="Brandon Williams" data-commit="b2141fc1d20e659810245ec6ca1c143c60e033ec" data-file="git.c" href="https://github.com/git/git/commit/b2141fc1d20e659810245ec6ca1c143c60e033ec" target="blank" title="config: don't include config.h by default

Stop including config.h by default in cache.h.  Instead only include
config.h in those files which require use of the config system.

Signed-off-by: Brandon Williams &lt;bmwill@google.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Brandon Williams">
#include "config.h"</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">
#include "exec</a><a data-author="Stefan Beller" data-commit="d807c4a01db2b06db047fc6d5d18ac25c8f05bd7" data-file="git.c" href="https://github.com/git/git/commit/d807c4a01db2b06db047fc6d5d18ac25c8f05bd7" target="blank" title="exec_cmd: rename to use dash in file name

This is more consistent with the project style. The majority of Git's
source files use dashes in preference to underscores in their file names.

Signed-off-by: Stefan Beller &lt;sbeller@google.com&gt;

 - Stefan Beller">-</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">cmd.h"</a><a data-author="Thiago Farina" data-commit="fd5c363da4635d81f29193ae19d8fa7b5657ab39" data-file="git.c" href="https://github.com/git/git/commit/fd5c363da4635d81f29193ae19d8fa7b5657ab39" target="blank" title="builtin.h: Move two functions definitions to help.h.

The two functions defined here are implemented in help.c, so makes more sense
to put the definition of those in help.h instead of in builtin.h.

Signed-off-by: Thiago Farina &lt;tfransosi@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thiago Farina">
#include "help.h"</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">
#include "run-command.h"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="65b5f9483eafea0ccdea59884da4e00e0cfeee1f" data-file="git.c" href="https://github.com/git/git/commit/65b5f9483eafea0ccdea59884da4e00e0cfeee1f" target="blank" title="Move declaration for alias.c to alias.h

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
#include "alias.h"</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">

#define</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP		(</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">1</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">&lt;&lt;0)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy">
#define RUN_SETUP_GENTLY</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">	(1&lt;&lt;1)</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
#define USE_PAGER</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">		(1&lt;&lt;2)
/*
 * require working tree to be present -- anything uses this needs
 * RUN_SETUP for reading from the configuration file.
 */
#define</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer"> NEED</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy">		(1&lt;&lt;3)</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
#define SUPPORT_SUPER_PREFIX</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">	(1&lt;&lt;4)</a><a data-author="Martin Ågren" data-commit="c409824cc2abac46e06091fcb29639b048d23b5d" data-file="git.c" href="https://github.com/git/git/commit/c409824cc2abac46e06091fcb29639b048d23b5d" target="blank" title="git.c: let builtins opt for handling `pager.foo` themselves

Before launching a builtin git foo and unless mechanisms with precedence
are in use, we check for and handle the `pager.foo` config. This is done
without considering exactly how git foo is being used, and indeed, git.c
cannot (and should not) know what the arguments to git foo are supposed
to achieve.

In practice this means that, e.g., `git -c pager.tag tag -a new-tag`
results in errors such as "Vim: Warning: Output is not to a terminal"
and a garbled terminal. Someone who makes use of both `git tag -a` and
`git tag -l` will probabl
 - Martin Ågren">
#define DELAY_PAGER_CONFIG	(1&lt;&lt;5)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
#define NO_PARSEOPT		(1&lt;&lt;6) /* parse-options is not used */</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">

struct cmd</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">_</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">struct {</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	const char *cmd;
	int (*fn)(int,</a><a data-author="Junio C Hamano" data-commit="9201c707426b3dc0c894775416f576c25c008d46" data-file="git.c" href="https://github.com/git/git/commit/9201c707426b3dc0c894775416f576c25c008d46" target="blank" title="Const tightening.

Mark Wooding noticed there was a type mismatch warning in git.c; this
patch does things slightly differently (mostly tightening const) and
was what I was holding onto, waiting for the setup-revisions change
to be merged into the master branch.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> const</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> char **,</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> const</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> char *);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	unsigned</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> int</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> option</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
};</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">

const char git</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">_usage</a><a data-author="Junio C Hamano" data-commit="4050c0df8ec7043315e2192695de432875239775" data-file="git.c" href="https://github.com/git/git/commit/4050c0df8ec7043315e2192695de432875239775" target="blank" title="Clean up compatibility definitions.

This attempts to clean up the way various compatibility
functions are defined and used.

 - A new header file, git-compat-util.h, is introduced.  This
   looks at various NO_XXX and does necessary function name
   replacements, equivalent of -Dstrcasestr=gitstrcasestr in the
   Makefile.

 - Those function name replacements are removed from the Makefile.

 - Common features such as usage(), die(), xmalloc() are moved
   from cache.h to git-compat-util.h; cache.h includes
   git-compat-util.h itself.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">string[] =</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">
	N_(</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">"git [--version]</a><a data-author="Kevin Bracey" data-commit="03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" data-file="git.c" href="https://github.com/git/git/commit/03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" target="blank" title="git.c: make usage match manual page

Reorder option list in command-line usage to match the manual page.
Also make it less than 80-characters wide.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey"> [--help] [-C</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy"> &lt;path&gt;] [-c</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> &lt;</a><a data-author="Kevin Bracey" data-commit="03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" data-file="git.c" href="https://github.com/git/git/commit/03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" target="blank" title="git.c: make usage match manual page

Reorder option list in command-line usage to match the manual page.
Also make it less than 80-characters wide.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey">name</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">&gt;</a><a data-author="Kevin Bracey" data-commit="03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" data-file="git.c" href="https://github.com/git/git/commit/03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" target="blank" title="git.c: make usage match manual page

Reorder option list in command-line usage to match the manual page.
Also make it less than 80-characters wide.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey">=</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">&lt;</a><a data-author="Kevin Bracey" data-commit="03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" data-file="git.c" href="https://github.com/git/git/commit/03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" target="blank" title="git.c: make usage match manual page

Reorder option list in command-line usage to match the manual page.
Also make it less than 80-characters wide.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey">value</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">&gt;</a><a data-author="Kevin Bracey" data-commit="03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" data-file="git.c" href="https://github.com/git/git/commit/03a0fb0ccf48c831060c2243f830b6a12cd8fdf3" target="blank" title="git.c: make usage match manual page

Reorder option list in command-line usage to match the manual page.
Also make it less than 80-characters wide.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey">]\n"
	   "</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">           [--exec-path[=</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&lt;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">path</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&gt;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">]]</a><a data-author="Markus Heidelberg" data-commit="89a56bfbd3fd855cb0c2a381520e6255de41a55e" data-file="git.c" href="https://github.com/git/git/commit/89a56bfbd3fd855cb0c2a381520e6255de41a55e" target="blank" title="add --html-path to get the location of installed HTML docs

This can be used in GUIs to open installed HTML documentation in the
browser.

Signed-off-by: Markus Heidelberg &lt;markus.heidelberg@web.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Markus Heidelberg"> [--html-path]</a><a data-author="Jon Seymour" data-commit="f2dd8c3799ddbd7df63a89a9043916f8545a70a3" data-file="git.c" href="https://github.com/git/git/commit/f2dd8c3799ddbd7df63a89a9043916f8545a70a3" target="blank" title="git: add --info-path and --man-path options

Similar to the way the --html-path option lets UI programs learn where git
has its HTML documentation pages, expose the other two paths used to store
the documentation pages of these two types.

Signed-off-by: Jon Seymour &lt;jon.seymour@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jon Seymour"> [--man-path] [--info-path]</a><a data-author="Matthieu Moy" data-commit="511a3fc116799df5e3b2262f8f6e501ca73ba2fe" data-file="git.c" href="https://github.com/git/git/commit/511a3fc116799df5e3b2262f8f6e501ca73ba2fe" target="blank" title="wrap git's main usage string.

It's now similar wrapped the same way as in Documentation/git.txt, and
fits in a 67 characters wide terminal.

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">\n"
	   "</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">           [-</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">p | --paginate</a><a data-author="Johannes Sixt" data-commit="7213c288187bd9ef1e32e4f86c20c55436f1ae90" data-file="git.c" href="https://github.com/git/git/commit/7213c288187bd9ef1e32e4f86c20c55436f1ae90" target="blank" title="git: add -P as a short option for --no-pager

It is possible to configure 'less', the pager, to use an alternate
screen to show the content, for example, by setting LESS=RS in the
environment. When it is closed in this configuration, it switches
back to the original screen, and all content is gone.

It is not uncommon to request that the output remains visible in
the terminal. For this, the option --no-pager can be used. But
it is a bit cumbersome to type, even when command completion is
available. Provide a short option, -P, to make the option more
easily accessible.

Signed-off-by: Johannes 
 - Johannes Sixt"> | -P</a><a data-author="Matthieu Moy" data-commit="463a849d004b2a3f3c8254b1e7985d4e986b9f1a" data-file="git.c" href="https://github.com/git/git/commit/463a849d004b2a3f3c8254b1e7985d4e986b9f1a" target="blank" title="Add and document a global --no-pager option for git.

To keep the change small, this is done by setting GIT_PAGER to "cat".

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Acked-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Acked-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy"> | --no-pager</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">]</a><a data-author="Christian Couder" data-commit="b0fa7ab51b29d34579d8f6bb4443dfbcb8278c7a" data-file="git.c" href="https://github.com/git/git/commit/b0fa7ab51b29d34579d8f6bb4443dfbcb8278c7a" target="blank" title="git: add --no-replace-objects option to disable replacing

Commit dae556b (environment: add global variable to disable replacement)
adds a variable to enable/disable replacement, and it is enabled by
default for most commands.

So there is no way to disable it for some commands, which is annoying
when we want to get information about a commit that has been replaced.

For example:

$ git cat-file -p N

would output information about the replacement commit if commit N is
replaced.

With the "--no-replace-objects" option that this patch adds it is
possible to get information about the original co
 - Christian Couder"> [--no-replace-objects]</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett"> [--bare]</a><a data-author="Matthieu Moy" data-commit="511a3fc116799df5e3b2262f8f6e501ca73ba2fe" data-file="git.c" href="https://github.com/git/git/commit/511a3fc116799df5e3b2262f8f6e501ca73ba2fe" target="blank" title="wrap git's main usage string.

It's now similar wrapped the same way as in Documentation/git.txt, and
fits in a 67 characters wide terminal.

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">\n"
	   "</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">           [--git-dir=</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&lt;path&gt;</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">] [-</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">-</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">work-tree=</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&lt;path&gt;</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">]</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett"> [--namespace=&lt;name&gt;]</a><a data-author="Matthieu Moy" data-commit="511a3fc116799df5e3b2262f8f6e501ca73ba2fe" data-file="git.c" href="https://github.com/git/git/commit/511a3fc116799df5e3b2262f8f6e501ca73ba2fe" target="blank" title="wrap git's main usage string.

It's now similar wrapped the same way as in Documentation/git.txt, and
fits in a 67 characters wide terminal.

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">\n"</a><a data-author="Thomas Rast" data-commit="293b07f114796d39c5571d5fe4808e898e5af0c8" data-file="git.c" href="https://github.com/git/git/commit/293b07f114796d39c5571d5fe4808e898e5af0c8" target="blank" title="Fix 'git' wrapper usage string

8b1fa77 (Allow passing of configuration parameters in the command
line, 2010-03-26) forgot the closing ']' for the -c option.

While we're there, also rewrap.  Instead of folding the last two lines
together, try to highlight that COMMAND is required by starting a line
with it.

Signed-off-by: Thomas Rast &lt;trast@student.ethz.ch&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thomas Rast">
	   "</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">           &lt;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">command</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&gt;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones"> [</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&lt;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">args</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&gt;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">]</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">"</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">;</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">

const char git_more_info_string[] =</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="9665627d8cc6f0263f0019e92c67a38223804b57" data-file="git.c" href="https://github.com/git/git/commit/9665627d8cc6f0263f0019e92c67a38223804b57" target="blank" title="i18n: help: mark strings for translation

This patch also marks most common commands' synopsis for translation
so that "git help" gives a friendly listing.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	N_(</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">"</a><a data-author="Philip Oakley" data-commit="73903d0bcb00518e508f412a1d5c482b5094587e" data-file="git.c" href="https://github.com/git/git/commit/73903d0bcb00518e508f412a1d5c482b5094587e" target="blank" title="help: mention -a and -g option, and 'git help &lt;concept&gt;' usage.

Reword the overall help given at the end of "git help -a/-g" to
mention how to get help on individual commands and concepts.

Signed-off-by: Philip Oakley &lt;philipoakley@iee.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Philip Oakley">'git help -a' and 'git help -g'</a><a data-author="Alex Henrie" data-commit="ad5fe3771b50f3862130d150b5cc8bb316ef6f1c" data-file="git.c" href="https://github.com/git/git/commit/ad5fe3771b50f3862130d150b5cc8bb316ef6f1c" target="blank" title="grammofix in user-facing messages

Signed-off-by: Alex Henrie &lt;alexhenrie24@gmail.com&gt;
Acked-by: Johan Herland &lt;johan@herland.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Henrie"> list</a><a data-author="Philip Oakley" data-commit="73903d0bcb00518e508f412a1d5c482b5094587e" data-file="git.c" href="https://github.com/git/git/commit/73903d0bcb00518e508f412a1d5c482b5094587e" target="blank" title="help: mention -a and -g option, and 'git help &lt;concept&gt;' usage.

Reword the overall help given at the end of "git help -a/-g" to
mention how to get help on individual commands and concepts.

Signed-off-by: Philip Oakley &lt;philipoakley@iee.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Philip Oakley"> available subcommands and some\n"
	   "concept guides.</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen"> See 'git help</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec"> &lt;</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">command</a><a data-author="Štěpán Němec" data-commit="62b4698e551c29b3d2539a764ad0e93cfff53c03" data-file="git.c" href="https://github.com/git/git/commit/62b4698e551c29b3d2539a764ad0e93cfff53c03" target="blank" title="Use angles for placeholders consistently

Signed-off-by: Štěpán Němec &lt;stepnem@gmail.com&gt;
Acked-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Štěpán Němec">&gt;</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">'</a><a data-author="Philip Oakley" data-commit="73903d0bcb00518e508f412a1d5c482b5094587e" data-file="git.c" href="https://github.com/git/git/commit/73903d0bcb00518e508f412a1d5c482b5094587e" target="blank" title="help: mention -a and -g option, and 'git help &lt;concept&gt;' usage.

Reword the overall help given at the end of "git help -a/-g" to
mention how to get help on individual commands and concepts.

Signed-off-by: Philip Oakley &lt;philipoakley@iee.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Philip Oakley"> or 'git help &lt;concept&gt;'\n"
	   "to read about</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen"> a specific</a><a data-author="Philip Oakley" data-commit="73903d0bcb00518e508f412a1d5c482b5094587e" data-file="git.c" href="https://github.com/git/git/commit/73903d0bcb00518e508f412a1d5c482b5094587e" target="blank" title="help: mention -a and -g option, and 'git help &lt;concept&gt;' usage.

Reword the overall help given at the end of "git help -a/-g" to
mention how to get help on individual commands and concepts.

Signed-off-by: Philip Oakley &lt;philipoakley@iee.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Philip Oakley"> subcommand or concept</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">."</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="9665627d8cc6f0263f0019e92c67a38223804b57" data-file="git.c" href="https://github.com/git/git/commit/9665627d8cc6f0263f0019e92c67a38223804b57" target="blank" title="i18n: help: mark strings for translation

This patch also marks most common commands' synopsis for translation
so that "git help" gives a friendly listing.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">;</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">

static int use_pager = -1;</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">

static void list_builtins(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">struct string_list *list,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> unsigned int exclude_option</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e11dca10cfb3ef1e561c3e789b346a9719f0344a" data-file="git.c" href="https://github.com/git/git/commit/e11dca10cfb3ef1e561c3e789b346a9719f0344a" target="blank" title="completion: add and use --list-cmds=nohelpers

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

static void exclude_helpers_from_list(struct string_list *list)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
{</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e11dca10cfb3ef1e561c3e789b346a9719f0344a" data-file="git.c" href="https://github.com/git/git/commit/e11dca10cfb3ef1e561c3e789b346a9719f0344a" target="blank" title="completion: add and use --list-cmds=nohelpers

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	int i = 0;

	while (i &lt; list-&gt;nr) {
		if (strstr(list-&gt;items[i].string, "--"))
			unsorted_string_list_delete_item(list, i, 0);</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		else</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e11dca10cfb3ef1e561c3e789b346a9719f0344a" data-file="git.c" href="https://github.com/git/git/commit/e11dca10cfb3ef1e561c3e789b346a9719f0344a" target="blank" title="completion: add and use --list-cmds=nohelpers

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
			i++;</a><a data-author="Junio C Hamano" data-commit="f0853837d6ee69dccfa59222a0e869de94bdddc6" data-file="git.c" href="https://github.com/git/git/commit/f0853837d6ee69dccfa59222a0e869de94bdddc6" target="blank" title="git-log: match rev-list --abbrev and --abbrev-commit

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	}</a><a data-author="Junio C Hamano" data-commit="52b70d56bd23811003a72866cc23a0a44b9da1b7" data-file="git.c" href="https://github.com/git/git/commit/52b70d56bd23811003a72866cc23a0a44b9da1b7" target="blank" title="git log [diff-tree options]...

And this makes "git log" to take common diff-tree options, so
that it can be used as "git whatchanged".

The recent revision walker updates by Linus to make path
limiting low-latency helps this quite a bit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
}</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

static int match</a><a data-author="Stefan Beller" data-commit="6a2df51c848c86e5620dcdf1a0ee2de637937b77" data-file="git.c" href="https://github.com/git/git/commit/6a2df51c848c86e5620dcdf1a0ee2de637937b77" target="blank" title="shallow: add repository argument to set_alternate_shallow_file

Add a repository argument to allow callers of set_alternate_shallow_file
to be more specific about which repository to handle. This is a small
mechanical change; it doesn't change the implementation to handle
repositories other than the_repository yet.

As with the previous commits, use a macro to catch callers passing a
repository other than the_repository at compile time.

Signed-off-by: Stefan Beller &lt;sbeller@google.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Stefan Beller">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">token(const char *spec</a><a data-author="Stefan Beller" data-commit="6a2df51c848c86e5620dcdf1a0ee2de637937b77" data-file="git.c" href="https://github.com/git/git/commit/6a2df51c848c86e5620dcdf1a0ee2de637937b77" target="blank" title="shallow: add repository argument to set_alternate_shallow_file

Add a repository argument to allow callers of set_alternate_shallow_file
to be more specific about which repository to handle. This is a small
mechanical change; it doesn't change the implementation to handle
repositories other than the_repository yet.

As with the previous commits, use a macro to catch callers passing a
repository other than the_repository at compile time.

Signed-off-by: Stefan Beller &lt;sbeller@google.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Stefan Beller">,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> int len, const char *token)</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
{</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	int token_len = strlen(token);

	return len == token_len &amp;&amp; !strncmp(spec, token, token_len);</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">
}</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

static int list_cmds(const char *spec)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
{</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	struct string_list list = STRING_LIST_INIT_DUP</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">;
	int i;</a><a data-author="Jeff King" data-commit="83b0ecf333e518867935f6b12c18294a8a7f5017" data-file="git.c" href="https://github.com/git/git/commit/83b0ecf333e518867935f6b12c18294a8a7f5017" target="blank" title="git: read local config in --list-cmds

Normally code that is checking config before we've decided to do
setup_git_directory() would use read_early_config(), which uses
discover_git_directory() to tentatively see if we're in a repo,
and if so to add it to the config sequence.

But list_cmds() uses the caching configset mechanism which
rightly does not use read_early_config(), because it has no
idea if it's being called early.

Call setup_git_directory_gently() so we can pick up repo-level
config (like completion.commands).

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano 
 - Jeff King">
	int nongit;

	/*
	* Set up the repository so we can pick up any repo-level config (like
	* completion.commands).
	*/
	setup_git_directory_</a><a data-author="Johannes Schindelin" data-commit="20de316e33446f37200e51aa333ba7d824dfd478" data-file="git.c" href="https://github.com/git/git/commit/20de316e33446f37200e51aa333ba7d824dfd478" target="blank" title="difftool: allow running outside Git worktrees with --no-index

As far as this developer can tell, the conversion from a Perl script to
a built-in caused the regression in the difftool that it no longer runs
outside of a Git worktree (with `--no-index`, of course).

It is a bit embarrassing that it took over two years after retiring the
Perl version to discover this regression, but at least we now know, and
can do something, about it.

This fixes https://github.com/git-for-windows/git/issues/2123

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;git
 - Johannes Schindelin">gently</a><a data-author="Jeff King" data-commit="83b0ecf333e518867935f6b12c18294a8a7f5017" data-file="git.c" href="https://github.com/git/git/commit/83b0ecf333e518867935f6b12c18294a8a7f5017" target="blank" title="git: read local config in --list-cmds

Normally code that is checking config before we've decided to do
setup_git_directory() would use read_early_config(), which uses
discover_git_directory() to tentatively see if we're in a repo,
and if so to add it to the config sequence.

But list_cmds() uses the caching configset mechanism which
rightly does not use read_early_config(), because it has no
idea if it's being called early.

Call setup_git_directory_gently() so we can pick up repo-level
config (like completion.commands).

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano 
 - Jeff King">(&amp;nongit);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

	while (*spec) {
		const char *sep = strchrnul(spec, ',');
		int len = sep - spec;

		if (match_token(spec, len, "builtins"))</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
			list_builtins(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">&amp;list,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> 0</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6bb2dc0b9472a84c7d17ee93bda28a7c1c97d415" data-file="git.c" href="https://github.com/git/git/commit/6bb2dc0b9472a84c7d17ee93bda28a7c1c97d415" target="blank" title="completion: implement and use --list-cmds=main,others

This is part of the effort to break down and provide commands by
category in machine-readable form. This could be helpful later on when
completion script switches to use --list-cmds for selecting
completable commands. It would be much easier for the user to choose
to complete _all_ commands instead of the default selection by passing
different values to --list-cmds in git-completino.bash.

While at there, replace "git help -a" in git-completion.bash with
--list-cmds since it's better suited for this task.

Signed-off-by: Nguyễn Thái Ngọc D
 - Nguyễn Thái Ngọc Duy">
		else if (match_token(spec, len, "main"))
			list_all_main_cmds(&amp;list);
		else if (match_token(spec, len, "others"))
			list_all_other_cmds(&amp;list);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e11dca10cfb3ef1e561c3e789b346a9719f0344a" data-file="git.c" href="https://github.com/git/git/commit/e11dca10cfb3ef1e561c3e789b346a9719f0344a" target="blank" title="completion: add and use --list-cmds=nohelpers

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		else if (match_token(spec, len, "nohelpers"))
			exclude_helpers_from_list(&amp;list);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="3301d36b29467a05107340e4d9688ebf74335021" data-file="git.c" href="https://github.com/git/git/commit/3301d36b29467a05107340e4d9688ebf74335021" target="blank" title="completion: add and use --list-cmds=alias

By providing aliases via --list-cmds=, we could simplify command
collection code in the script. We only issue one git command. Before
this patch that is "git config", after it's "git --list-cmds=". In
"git help" completion case we actually reduce one "git" process (for
getting guides) but that call was added in this series so it does not
really count.

A couple of bash functions are removed because they are not needed
anymore. __git_compute_all_commands() and $__git_all_commands stay
because they are still needed for completing pager.* config and
with
 - Nguyễn Thái Ngọc Duy">
		else if (match_token(spec, len, "alias"))
			list_aliases(&amp;list);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6532f3740b1c228c0a2a03a4126f4f7e4f2d73e7" data-file="git.c" href="https://github.com/git/git/commit/6532f3740b1c228c0a2a03a4126f4f7e4f2d73e7" target="blank" title="completion: allow to customize the completable command list

By default we show porcelain, external commands and a couple others
that are also popular. If you are not happy with this list, you can
now customize it a new config variable.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		else if (match_token(spec, len, "config"))
			list_cmds_by_config(&amp;list);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="3c7777672bf9bc9ac2ddb422633b39af4faa1682" data-file="git.c" href="https://github.com/git/git/commit/3c7777672bf9bc9ac2ddb422633b39af4faa1682" target="blank" title="git: support --list-cmds=list-&lt;category&gt;

This allows us to select any group of commands by a category defined
in command-list.txt. This is an internal/hidden option so we don't
have to be picky about the category name or worried about exposing too
much.

This will be used later by git-completion.bash to retrieve certain
command groups.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		else if (len &gt; 5 &amp;&amp; !strncmp(spec, "list-", 5)) {</a><a data-author="Michael J Gruber" data-commit="7cf16a14f5c070f7b14cf28023769450133172ae" data-file="git.c" href="https://github.com/git/git/commit/7cf16a14f5c070f7b14cf28023769450133172ae" target="blank" title="handle_alias: provide GIT_PREFIX to !alias

Provide an environment variable GIT_PREFIX which contains the subdirectory
from which a !alias was called (i.e. 'git rev-parse --show-prefix') since
these cd to the to level directory before they are executed.

Signed-off-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Michael J Gruber">
			struct strbuf sb = STRBUF_INIT;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="3c7777672bf9bc9ac2ddb422633b39af4faa1682" data-file="git.c" href="https://github.com/git/git/commit/3c7777672bf9bc9ac2ddb422633b39af4faa1682" target="blank" title="git: support --list-cmds=list-&lt;category&gt;

This allows us to select any group of commands by a category defined
in command-list.txt. This is an internal/hidden option so we don't
have to be picky about the category name or worried about exposing too
much.

This will be used later by git-completion.bash to retrieve certain
command groups.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

			strbuf_add(&amp;sb, spec + 5, len - 5);
			list_cmds_by_category(&amp;list, sb.buf);</a><a data-author="Junio C Hamano" data-commit="606ee4be54b5ef3c8593a71b4b1bd6b4ee2d323d" data-file="git.c" href="https://github.com/git/git/commit/606ee4be54b5ef3c8593a71b4b1bd6b4ee2d323d" target="blank" title="Merge branch 'js/info-man-path'

* js/info-man-path:
  Documentation: clarify meaning of --html-path, --man-path, and --info-path
  git: add --info-path and --man-path options

Conflicts:
	Makefile

 - Junio C Hamano">
			strbuf_release(&amp;sb);</a><a data-author="Linus Torvalds" data-commit="ea77e675e564211513ebedb4f5bdcda482d7fd30" data-file="git.c" href="https://github.com/git/git/commit/ea77e675e564211513ebedb4f5bdcda482d7fd30" target="blank" title="Make "git help" react to window size correctly

Currently the git "show commands" function will react to the environment
variable COLUMNS, or just default to a width of 80 characters.

That's just soo eighties. Nobody sane sets COLUMNS any more, unless they
need to support some stone-age software from before the age of steam
engines, SIGWINCH and TIOCGWINSZ.

So get with the new century, and use TIOCGWINSZ to get the terminal size.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
		}</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
		else</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
			die(_("unsupported command listing type '%s'"), spec);
		spec += len;
		if (*spec == ',')
			spec++;</a><a data-author="Linus Torvalds" data-commit="ea77e675e564211513ebedb4f5bdcda482d7fd30" data-file="git.c" href="https://github.com/git/git/commit/ea77e675e564211513ebedb4f5bdcda482d7fd30" target="blank" title="Make "git help" react to window size correctly

Currently the git "show commands" function will react to the environment
variable COLUMNS, or just default to a width of 80 characters.

That's just soo eighties. Nobody sane sets COLUMNS any more, unless they
need to support some stone-age software from before the age of steam
engines, SIGWINCH and TIOCGWINSZ.

So get with the new century, and use TIOCGWINSZ to get the terminal size.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	}</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
	for (i = 0;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> i &lt; list.nr;</a><a data-author="Johannes Schindelin" data-commit="a2f8028d3d661b314d5a784764f2f5f9e4c2dde0" data-file="git.c" href="https://github.com/git/git/commit/a2f8028d3d661b314d5a784764f2f5f9e4c2dde0" target="blank" title="Make '!' aliases more useful

When an alias starts with an exclamation mark, the rest is interpreted
as a shell command. However, all arguments passed to git used to be
ignored.

Now you can have an alias like

	$ git config alias.e '!echo'

and

	$ git e Hello World

does what you expect it to do.

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Johannes Schindelin"> i++)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		puts(list.items[i].string);
	string_list_clear(&amp;list</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> 0</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	return 0;</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
}</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">

static void commit_pager_choice(void)</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
{</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	switch (use_pager) {
	case 0:</a><a data-author="Matthieu Moy" data-commit="463a849d004b2a3f3c8254b1e7985d4e986b9f1a" data-file="git.c" href="https://github.com/git/git/commit/463a849d004b2a3f3c8254b1e7985d4e986b9f1a" target="blank" title="Add and document a global --no-pager option for git.

To keep the change small, this is done by setting GIT_PAGER to "cat".

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Acked-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Acked-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">
		setenv("GIT_PAGER", "cat", 1);</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
		break;</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	case 1:</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
		setup_pager();</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
		break;</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	default:
		break;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	}</a><a data-author="Andreas Ericsson" data-commit="97fc6c5fbacc2181319bbd7e2faa8ac04476f862" data-file="git.c" href="https://github.com/git/git/commit/97fc6c5fbacc2181319bbd7e2faa8ac04476f862" target="blank" title="git --help COMMAND brings up the git-COMMAND man-page.

It's by design a bit stupid (matching ^git rather than ^git-), so as
to work with 'gitk' and 'git' as well.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
}</a><a data-author="Martin Ågren" data-commit="033fe3d92ca16c36fb45ed7cb58d42344088e7bd" data-file="git.c" href="https://github.com/git/git/commit/033fe3d92ca16c36fb45ed7cb58d42344088e7bd" target="blank" title="git.c: provide setup_auto_pager()

The previous patch introduced a way for builtins to declare that they
will take responsibility for handling the `pager.foo`-config item. (See
the commit message of that patch for why that could be useful.)

Provide setup_auto_pager(), which builtins can call in order to handle
`pager.&lt;cmd&gt;`, including possibly starting the pager. Make this function
don't do anything if a pager has already been started, as indicated by
use_pager or pager_in_use().

Whenever this function is called from a builtin, git.c will already have
called commit_pager_choice(). Since comm
 - Martin Ågren">

void setup_auto_pager(const char *cmd, int def)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Martin Ågren" data-commit="033fe3d92ca16c36fb45ed7cb58d42344088e7bd" data-file="git.c" href="https://github.com/git/git/commit/033fe3d92ca16c36fb45ed7cb58d42344088e7bd" target="blank" title="git.c: provide setup_auto_pager()

The previous patch introduced a way for builtins to declare that they
will take responsibility for handling the `pager.foo`-config item. (See
the commit message of that patch for why that could be useful.)

Provide setup_auto_pager(), which builtins can call in order to handle
`pager.&lt;cmd&gt;`, including possibly starting the pager. Make this function
don't do anything if a pager has already been started, as indicated by
use_pager or pager_in_use().

Whenever this function is called from a builtin, git.c will already have
called commit_pager_choice(). Since comm
 - Martin Ågren">
	if (use_pager != -1 || pager_in_use())</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">
		return;</a><a data-author="Martin Ågren" data-commit="033fe3d92ca16c36fb45ed7cb58d42344088e7bd" data-file="git.c" href="https://github.com/git/git/commit/033fe3d92ca16c36fb45ed7cb58d42344088e7bd" target="blank" title="git.c: provide setup_auto_pager()

The previous patch introduced a way for builtins to declare that they
will take responsibility for handling the `pager.foo`-config item. (See
the commit message of that patch for why that could be useful.)

Provide setup_auto_pager(), which builtins can call in order to handle
`pager.&lt;cmd&gt;`, including possibly starting the pager. Make this function
don't do anything if a pager has already been started, as indicated by
use_pager or pager_in_use().

Whenever this function is called from a builtin, git.c will already have
called commit_pager_choice(). Since comm
 - Martin Ågren">
	use_pager = check_pager_config(cmd);
	if (use_pager == -1)
		use_pager = def;
	commit_pager_choice();</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

static int handle_options(const char ***argv, int *argc</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">, int *envchanged</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">
	const char **</a><a data-author="Junio C Hamano" data-commit="73546c085d49694c5e54b421f80bde6bc25006fb" data-file="git.c" href="https://github.com/git/git/commit/73546c085d49694c5e54b421f80bde6bc25006fb" target="blank" title="handle_options(): do not miscount how many arguments were used

The handle_options() function advances the base of the argument array and
returns the number of arguments it used. The caller in handle_alias()
wants to reallocate the argv array it passes to this function, and
attempts to do so by subtracting the returned value to compensate for the
change handle_options() makes to the new_argv.

But handle_options() did not correctly count when "-c &lt;config=value&gt;" is
given, causing a wrong pointer to be passed to realloc().

Fix it by saving the original argv at the beginning of handle_options()
 - Junio C Hamano">orig</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">_argv =</a><a data-author="Junio C Hamano" data-commit="73546c085d49694c5e54b421f80bde6bc25006fb" data-file="git.c" href="https://github.com/git/git/commit/73546c085d49694c5e54b421f80bde6bc25006fb" target="blank" title="handle_options(): do not miscount how many arguments were used

The handle_options() function advances the base of the argument array and
returns the number of arguments it used. The caller in handle_alias()
wants to reallocate the argv array it passes to this function, and
attempts to do so by subtracting the returned value to compensate for the
change handle_options() makes to the new_argv.

But handle_options() did not correctly count when "-c &lt;config=value&gt;" is
given, causing a wrong pointer to be passed to realloc().

Fix it by saving the original argv at the beginning of handle_options()
 - Junio C Hamano"> *</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">argv;</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

	while (*argc &gt; 0) {
		const char *cmd = (*argv)[0];
		if (cmd[0] != '-')
			break;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

		/*
		 * For legacy reasons, the "version" and "help"
		 * commands can be written with "--" prepended
		 * to make them look like flags.
		 */</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">
		if (</a><a data-author="Junio C Hamano" data-commit="85fb65ed6e41e93760a91b33b512d3d9dc67ac66" data-file="git.c" href="https://github.com/git/git/commit/85fb65ed6e41e93760a91b33b512d3d9dc67ac66" target="blank" title=""git -p cmd" to page anywhere

This allows you to say:

	git -p diff v2.6.16-rc5..

and the command pipes the output of any git command to your pager.

[jc: this resurrects a month old RFC patch with improvement
 suggested by Linus to call it --paginate instead of --less.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">!strcmp</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">(</a><a data-author="Junio C Hamano" data-commit="85fb65ed6e41e93760a91b33b512d3d9dc67ac66" data-file="git.c" href="https://github.com/git/git/commit/85fb65ed6e41e93760a91b33b512d3d9dc67ac66" target="blank" title=""git -p cmd" to page anywhere

This allows you to say:

	git -p diff v2.6.16-rc5..

and the command pipes the output of any git command to your pager.

[jc: this resurrects a month old RFC patch with improvement
 suggested by Linus to call it --paginate instead of --less.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">cmd,</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano"> "</a><a data-author="Junio C Hamano" data-commit="85fb65ed6e41e93760a91b33b512d3d9dc67ac66" data-file="git.c" href="https://github.com/git/git/commit/85fb65ed6e41e93760a91b33b512d3d9dc67ac66" target="blank" title=""git -p cmd" to page anywhere

This allows you to say:

	git -p diff v2.6.16-rc5..

and the command pipes the output of any git command to your pager.

[jc: this resurrects a month old RFC patch with improvement
 suggested by Linus to call it --paginate instead of --less.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">-</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">-help</a><a data-author="Junio C Hamano" data-commit="85fb65ed6e41e93760a91b33b512d3d9dc67ac66" data-file="git.c" href="https://github.com/git/git/commit/85fb65ed6e41e93760a91b33b512d3d9dc67ac66" target="blank" title=""git -p cmd" to page anywhere

This allows you to say:

	git -p diff v2.6.16-rc5..

and the command pipes the output of any git command to your pager.

[jc: this resurrects a month old RFC patch with improvement
 suggested by Linus to call it --paginate instead of --less.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">") || !strcmp(cmd, "--</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">version"))</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			break;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

		/*</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		 * Check remaining flags.</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
		 */</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		if (</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">prefix</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">(cmd, "--exec-path"</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">, &amp;cmd</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">)) {
			if (*cmd == '=')</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
				git_set_exec_path(cmd</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson"> + 1</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			else {</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">
				puts</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">(git</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">exec_</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">path</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">()</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">;</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
				trace2_cmd_name("_query_");</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
				exit(0);</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
			}</a><a data-author="Markus Heidelberg" data-commit="89a56bfbd3fd855cb0c2a381520e6255de41a55e" data-file="git.c" href="https://github.com/git/git/commit/89a56bfbd3fd855cb0c2a381520e6255de41a55e" target="blank" title="add --html-path to get the location of installed HTML docs

This can be used in GUIs to open installed HTML documentation in the
browser.

Signed-off-by: Markus Heidelberg &lt;markus.heidelberg@web.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Markus Heidelberg">
		} else if (!strcmp(cmd, "--html-path")) {
			puts(system_path(GIT_HTML_PATH));</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			trace2_cmd_name("_query_");</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			exit(0);</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">
		} else if (!strcmp(cmd, "--man-path")) {
			puts(system_path(GIT_MAN_PATH));</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			trace2_cmd_name("_query_");</a><a data-author="Jon Seymour" data-commit="f2dd8c3799ddbd7df63a89a9043916f8545a70a3" data-file="git.c" href="https://github.com/git/git/commit/f2dd8c3799ddbd7df63a89a9043916f8545a70a3" target="blank" title="git: add --info-path and --man-path options

Similar to the way the --html-path option lets UI programs learn where git
has its HTML documentation pages, expose the other two paths used to store
the documentation pages of these two types.

Signed-off-by: Jon Seymour &lt;jon.seymour@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jon Seymour">
			exit(0);</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">
		} else if (!strcmp(cmd, "--info-path")) {
			puts(system_path(GIT_INFO_PATH));</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			trace2_cmd_name("_query_");</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">
			exit(</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">0</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">)</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		} else if (!strcmp(cmd, "-p") || !strcmp(cmd, "--</a><a data-author="Junio C Hamano" data-commit="85fb65ed6e41e93760a91b33b512d3d9dc67ac66" data-file="git.c" href="https://github.com/git/git/commit/85fb65ed6e41e93760a91b33b512d3d9dc67ac66" target="blank" title=""git -p cmd" to page anywhere

This allows you to say:

	git -p diff v2.6.16-rc5..

and the command pipes the output of any git command to your pager.

[jc: this resurrects a month old RFC patch with improvement
 suggested by Linus to call it --paginate instead of --less.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">paginate</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">")) {</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
			use_pager = 1;</a><a data-author="Matthieu Moy" data-commit="463a849d004b2a3f3c8254b1e7985d4e986b9f1a" data-file="git.c" href="https://github.com/git/git/commit/463a849d004b2a3f3c8254b1e7985d4e986b9f1a" target="blank" title="Add and document a global --no-pager option for git.

To keep the change small, this is done by setting GIT_PAGER to "cat".

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Acked-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Acked-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">
		} else if (</a><a data-author="Johannes Sixt" data-commit="7213c288187bd9ef1e32e4f86c20c55436f1ae90" data-file="git.c" href="https://github.com/git/git/commit/7213c288187bd9ef1e32e4f86c20c55436f1ae90" target="blank" title="git: add -P as a short option for --no-pager

It is possible to configure 'less', the pager, to use an alternate
screen to show the content, for example, by setting LESS=RS in the
environment. When it is closed in this configuration, it switches
back to the original screen, and all content is gone.

It is not uncommon to request that the output remains visible in
the terminal. For this, the option --no-pager can be used. But
it is a bit cumbersome to type, even when command completion is
available. Provide a short option, -P, to make the option more
easily accessible.

Signed-off-by: Johannes 
 - Johannes Sixt">!strcmp(cmd, "-P") ||</a><a data-author="Matthieu Moy" data-commit="463a849d004b2a3f3c8254b1e7985d4e986b9f1a" data-file="git.c" href="https://github.com/git/git/commit/463a849d004b2a3f3c8254b1e7985d4e986b9f1a" target="blank" title="Add and document a global --no-pager option for git.

To keep the change small, this is done by setting GIT_PAGER to "cat".

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Acked-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Acked-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy"> !strcmp(cmd, "--no-pager")) {</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
			use_pager = 0;</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Christian Couder" data-commit="b0fa7ab51b29d34579d8f6bb4443dfbcb8278c7a" data-file="git.c" href="https://github.com/git/git/commit/b0fa7ab51b29d34579d8f6bb4443dfbcb8278c7a" target="blank" title="git: add --no-replace-objects option to disable replacing

Commit dae556b (environment: add global variable to disable replacement)
adds a variable to enable/disable replacement, and it is enabled by
default for most commands.

So there is no way to disable it for some commands, which is annoying
when we want to get information about a commit that has been replaced.

For example:

$ git cat-file -p N

would output information about the replacement commit if commit N is
replaced.

With the "--no-replace-objects" option that this patch adds it is
possible to get information about the original co
 - Christian Couder">
		} else if (!strcmp(cmd, "--no-replace-objects")) {
			read_replace_refs = 0;</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">
			setenv</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">(</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">NO_REPLACE_OBJECTS_ENVIRONMENT</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">, "</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">1</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">"</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">, 1</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">)</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">;</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		} else</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> if</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> (</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">!strcmp(cmd, "--git-dir")) {
			if (*argc &lt;</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt"> 2</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">)</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt"> {
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt">"no directory given for</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> -</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt">-git-dir\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">
				usage(</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">git</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones">_usage_string);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			}</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			setenv(GIT_DIR</a><a data-author="Shawn O. Pearce" data-commit="45b097947d6297a4b3f1016b05c66cdc15b411c2" data-file="git.c" href="https://github.com/git/git/commit/45b097947d6297a4b3f1016b05c66cdc15b411c2" target="blank" title="Replace "GIT_DIR" with GIT_DIR_ENVIRONMENT.

We tend to use the nice constant GIT_DIR_ENVIRONMENT when we
are referring to the "GIT_DIR" constant, but git.c didn't do
so.  Now it does.

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_ENVIRONMENT</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, (*argv)[1], 1);</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			(*argv)++;
			(*argc)--;
		} else if (</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">prefix</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">(cmd, "--git-dir="</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">, &amp;cmd</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">)) {
			setenv(GIT_DIR</a><a data-author="Shawn O. Pearce" data-commit="45b097947d6297a4b3f1016b05c66cdc15b411c2" data-file="git.c" href="https://github.com/git/git/commit/45b097947d6297a4b3f1016b05c66cdc15b411c2" target="blank" title="Replace "GIT_DIR" with GIT_DIR_ENVIRONMENT.

We tend to use the nice constant GIT_DIR_ENVIRONMENT when we
are referring to the "GIT_DIR" constant, but git.c didn't do
so.  Now it does.

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_ENVIRONMENT</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, cmd, 1);</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
		} else if (!strcmp(cmd, "--namespace")) {</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
			if (*argc &lt; 2) {</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">"no namespace given for --namespace\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">;</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt">
				usage(git</a><a data-author="Junio C Hamano" data-commit="4264dc15e198bf9e9a2bb4ee897dd8e3eaabca47" data-file="git.c" href="https://github.com/git/git/commit/4264dc15e198bf9e9a2bb4ee897dd8e3eaabca47" target="blank" title="git reflog expire

This prepares a place to collect reflog management subcommands,
and implements "expire" action.

	$ git reflog expire --dry-run \
		--expire=4.weeks \
		--expire-unreachable=1.week \
		refs/heads/master

The expiration uses two timestamps: --expire and --expire-unreachable.
Entries older than expire time (defaults to 90 days), and entries older
than expire-unreachable time (defaults to 30 days) and records a commit
that has been rewound and made unreachable from the current tip of the
ref are removed from the reflog.

The parameter handling is still rough, but I think the
co
 - Junio C Hamano">_</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt">usage</a><a data-author="Junio C Hamano" data-commit="4264dc15e198bf9e9a2bb4ee897dd8e3eaabca47" data-file="git.c" href="https://github.com/git/git/commit/4264dc15e198bf9e9a2bb4ee897dd8e3eaabca47" target="blank" title="git reflog expire

This prepares a place to collect reflog management subcommands,
and implements "expire" action.

	$ git reflog expire --dry-run \
		--expire=4.weeks \
		--expire-unreachable=1.week \
		refs/heads/master

The expiration uses two timestamps: --expire and --expire-unreachable.
Entries older than expire time (defaults to 90 days), and entries older
than expire-unreachable time (defaults to 30 days) and records a commit
that has been rewound and made unreachable from the current tip of the
ref are removed from the reflog.

The parameter handling is still rough, but I think the
co
 - Junio C Hamano">_</a><a data-author="Brian Gernhardt" data-commit="c321f00d09f56dcf2f149757a2a337f3732f3097" data-file="git.c" href="https://github.com/git/git/commit/c321f00d09f56dcf2f149757a2a337f3732f3097" target="blank" title="Keep "git --git-dir" from causing a bus error.

The option checking code for --git-dir had an off by 1 error that
would cause it to access uninitialized memory if it was the last
argument.  This causes it to display an error and display the usage
string instead.

Signed-off-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Brian Gernhardt">string);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			}</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">
			setenv(GIT_NAMESPACE_ENVIRONMENT, (*argv)[1</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">]</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">, 1);</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
			(*argv)++;
			(*argc)--;</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">
		} else if (</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">prefix</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">(cmd, "</a><a data-author="Alan Chandler" data-commit="281e67d6fa8e523147792c17fbe6db03f13f72e1" data-file="git.c" href="https://github.com/git/git/commit/281e67d6fa8e523147792c17fbe6db03f13f72e1" target="blank" title="Fix usage string to match that given in the man page

Still not managed to understand git-send-mail sufficiently well to  not
accidently miss of this list when I sending it to Junio

Signed-off-by: Alan Chandler &lt;alan@chandlerfamily.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alan Chandler">--</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">namespace="</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">, &amp;cmd</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">)) {</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
			setenv(GIT_NAMESPACE_ENVIRONMENT, cmd, 1);</a><a data-author="Matthieu Moy" data-commit="463a849d004b2a3f3c8254b1e7985d4e986b9f1a" data-file="git.c" href="https://github.com/git/git/commit/463a849d004b2a3f3c8254b1e7985d4e986b9f1a" target="blank" title="Add and document a global --no-pager option for git.

To keep the change small, this is done by setting GIT_PAGER to "cat".

Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@imag.fr&gt;
Acked-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Acked-by: Brian Gernhardt &lt;benji@silverinsanity.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthieu Moy">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
		} else if (!strcmp(cmd, "--work-tree")) {</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
			if (*argc &lt; 2) {</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">"no directory given for --work-tree\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">;
				usage(git_usage_string);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			}</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
			setenv(GIT_WORK_TREE_ENVIRONMENT, (*argv)[1], 1);</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">
			if (</a><a data-author="Christian Couder" data-commit="6476b38b1f3d258006566c3c9c6c80cc07fda354" data-file="git.c" href="https://github.com/git/git/commit/6476b38b1f3d258006566c3c9c6c80cc07fda354" target="blank" title="replace: use a GIT_NO_REPLACE_OBJECTS env variable

This has the same effect as --no-replace-objects option; git ignores the
replace refs.  When --no-replace-objects option is passed to git, this
environment variable is set to "1" and exported to subprocesses in order
to propagate the same setting.

It is useful for example for scripts, as the git commands used in them can
now be aware that they must not read replace refs.

Tested-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">envchanged)
				*envchanged = 1;</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
			(*argv)++;
			(*argc)--;</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">
		} else if (</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">prefix</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">(cmd, "--work-tree="</a><a data-author="Jeff King" data-commit="ae021d87911da4328157273df24779892cb51277" data-file="git.c" href="https://github.com/git/git/commit/ae021d87911da4328157273df24779892cb51277" target="blank" title="use skip_prefix to avoid magic numbers

It's a common idiom to match a prefix and then skip past it
with a magic number, like:

  if (starts_with(foo, "bar"))
	  foo += 3;

This is easy to get wrong, since you have to count the
prefix string yourself, and there's no compiler check if the
string changes.  We can use skip_prefix to avoid the magic
numbers here.

Note that some of these conversions could be much shorter.
For example:

  if (starts_with(arg, "--foo=")) {
	  bar = arg + 6;
	  continue;
  }

could become:

  if (skip_prefix(arg, "--foo=", &amp;bar))
	  continue;

However, I have left it
 - Jeff King">, &amp;cmd</a><a data-author="Matthias Lederhofer" data-commit="892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" data-file="git.c" href="https://github.com/git/git/commit/892c41b98ae2e6baf3aa13901cb10db9ac67d2f3" target="blank" title="introduce GIT_WORK_TREE to specify the work tree

setup_gdg is used as abbreviation for setup_git_directory_gently.

The work tree can be specified using the environment variable
GIT_WORK_TREE and the config option core.worktree (the environment
variable has precendence over the config option).  Additionally
there is a command line option --work-tree which sets the
environment variable.

setup_gdg does the following now:

GIT_DIR unspecified
repository in .git directory
    parent directory of the .git directory is used as work tree,
    GIT_WORK_TREE is ignored

GIT_DIR unspecified
repository
 - Matthias Lederhofer">)) {
			setenv(GIT_WORK_TREE_ENVIRONMENT, cmd, 1);</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
		} else if (!strcmp(cmd</a><a data-author="Jeff King" data-commit="4a73aaaf18099ec1897330dd6c4a09f10ea2f573" data-file="git.c" href="https://github.com/git/git/commit/4a73aaaf18099ec1897330dd6c4a09f10ea2f573" target="blank" title="patch-id: use RUN_SETUP_GENTLY

Patch-id does not require a repository because it is just
processing the incoming diff on stdin, but it may look at
git config for keys like patchid.stable.

Even though we do not setup_git_directory(), this works from
the top-level of a repository because we blindly look at
".git/config" in this case. But as the included test
demonstrates, it does not work from a subdirectory.

We can fix it by using RUN_SETUP_GENTLY. We do not take any
filenames from the user on the command line, so there's no
need to adjust them via prefix_filename().

Signed-off-by: Jeff Kin
 - Jeff King">,</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams"> "--super-prefix")) {</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
			if (*argc &lt; 2) {</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">"no prefix given for --super-prefix\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">;</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
				usage(git_usage_string);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
			}</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			setenv(GIT</a><a data-author="Jeff King" data-commit="4a73aaaf18099ec1897330dd6c4a09f10ea2f573" data-file="git.c" href="https://github.com/git/git/commit/4a73aaaf18099ec1897330dd6c4a09f10ea2f573" target="blank" title="patch-id: use RUN_SETUP_GENTLY

Patch-id does not require a repository because it is just
processing the incoming diff on stdin, but it may look at
git config for keys like patchid.stable.

Even though we do not setup_git_directory(), this works from
the top-level of a repository because we blindly look at
".git/config" in this case. But as the included test
demonstrates, it does not work from a subdirectory.

We can fix it by using RUN_SETUP_GENTLY. We do not take any
filenames from the user on the command line, so there's no
need to adjust them via prefix_filename().

Signed-off-by: Jeff Kin
 - Jeff King">_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">SUPER</a><a data-author="Jeff King" data-commit="4a73aaaf18099ec1897330dd6c4a09f10ea2f573" data-file="git.c" href="https://github.com/git/git/commit/4a73aaaf18099ec1897330dd6c4a09f10ea2f573" target="blank" title="patch-id: use RUN_SETUP_GENTLY

Patch-id does not require a repository because it is just
processing the incoming diff on stdin, but it may look at
git config for keys like patchid.stable.

Even though we do not setup_git_directory(), this works from
the top-level of a repository because we blindly look at
".git/config" in this case. But as the included test
demonstrates, it does not work from a subdirectory.

We can fix it by using RUN_SETUP_GENTLY. We do not take any
filenames from the user on the command line, so there's no
need to adjust them via prefix_filename().

Signed-off-by: Jeff Kin
 - Jeff King">_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">PREFIX</a><a data-author="Jeff King" data-commit="4a73aaaf18099ec1897330dd6c4a09f10ea2f573" data-file="git.c" href="https://github.com/git/git/commit/4a73aaaf18099ec1897330dd6c4a09f10ea2f573" target="blank" title="patch-id: use RUN_SETUP_GENTLY

Patch-id does not require a repository because it is just
processing the incoming diff on stdin, but it may look at
git config for keys like patchid.stable.

Even though we do not setup_git_directory(), this works from
the top-level of a repository because we blindly look at
".git/config" in this case. But as the included test
demonstrates, it does not work from a subdirectory.

We can fix it by using RUN_SETUP_GENTLY. We do not take any
filenames from the user on the command line, so there's no
need to adjust them via prefix_filename().

Signed-off-by: Jeff Kin
 - Jeff King">_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">ENVIRONMENT, (*argv)[1], 1);</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Junio C Hamano" data-commit="6ed547b53b90bebd2371b086b83b416b22b243b2" data-file="git.c" href="https://github.com/git/git/commit/6ed547b53b90bebd2371b086b83b416b22b243b2" target="blank" title="Merge branch 'js/ref-namespaces'

* js/ref-namespaces:
  ref namespaces: tests
  ref namespaces: documentation
  ref namespaces: Support remote repositories via upload-pack and receive-pack
  ref namespaces: infrastructure
  Fix prefix handling in ref iteration functions

 - Junio C Hamano">
			(*argv)++;
			(*argc)--;</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
		} else if (skip</a><a data-author="Jeff King" data-commit="4a73aaaf18099ec1897330dd6c4a09f10ea2f573" data-file="git.c" href="https://github.com/git/git/commit/4a73aaaf18099ec1897330dd6c4a09f10ea2f573" target="blank" title="patch-id: use RUN_SETUP_GENTLY

Patch-id does not require a repository because it is just
processing the incoming diff on stdin, but it may look at
git config for keys like patchid.stable.

Even though we do not setup_git_directory(), this works from
the top-level of a repository because we blindly look at
".git/config" in this case. But as the included test
demonstrates, it does not work from a subdirectory.

We can fix it by using RUN_SETUP_GENTLY. We do not take any
filenames from the user on the command line, so there's no
need to adjust them via prefix_filename().

Signed-off-by: Jeff Kin
 - Jeff King">_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">prefix(cmd, "--super-prefix=", &amp;cmd)) {
			setenv(GIT_SUPER_PREFIX_ENVIRONMENT, cmd, 1);</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		} else if (!strcmp(cmd, "--bare")) {
			char</a><a data-author="Junio C Hamano" data-commit="f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" data-file="git.c" href="https://github.com/git/git/commit/f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" target="blank" title="Merge branch 'rs/strbuf-getcwd'

Reduce the use of fixed sized buffer passed to getcwd() calls
by introducing xgetcwd() helper.

* rs/strbuf-getcwd:
  use strbuf_add_absolute_path() to add absolute paths
  abspath: convert absolute_path() to strbuf
  use xgetcwd() to set $GIT_DIR
  use xgetcwd() to get the current directory or die
  wrapper: add xgetcwd()
  abspath: convert real_path_internal() to strbuf
  abspath: use strbuf_getcwd() to remember original working directory
  setup: convert setup_git_directory_gently_1 et al. to strbuf
  unix-sockets: use strbuf_getcwd()
  strbuf: add strbuf_ge
 - Junio C Hamano"> *cwd = xgetcwd()</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Junio C Hamano" data-commit="6adcca3fe84e6859fc62df6c4ab916192ca02795" data-file="git.c" href="https://github.com/git/git/commit/6adcca3fe84e6859fc62df6c4ab916192ca02795" target="blank" title="Fix initialization of a bare repository

Here is my attempt to fix this with a minimally intrusive patch.

 * As "git --bare init" cannot tell if it was called with --bare or
   just "GIT_DIR=. git init", I added an explicit assignment of
   is_bare_repository_cfg on the codepath for "git --bare".

 * GIT_WORK_TREE alone without GIT_DIR does not make any sense,
   nor GIT_WORK_TREE with an explicit "git --bare".  Catch that
   mistake.  It might make sense to move this check to "git.c"
   side as well, but I tried to shoot for the minimum change for
   now.

 * Some scripts, especially from th
 - Junio C Hamano">
			is_bare_repository_cfg = 1;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			setenv(GIT_DIR</a><a data-author="Shawn O. Pearce" data-commit="45b097947d6297a4b3f1016b05c66cdc15b411c2" data-file="git.c" href="https://github.com/git/git/commit/45b097947d6297a4b3f1016b05c66cdc15b411c2" target="blank" title="Replace "GIT_DIR" with GIT_DIR_ENVIRONMENT.

We tend to use the nice constant GIT_DIR_ENVIRONMENT when we
are referring to the "GIT_DIR" constant, but git.c didn't do
so.  Now it does.

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_ENVIRONMENT</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">,</a><a data-author="René Scharfe" data-commit="4d3ab44d26c47d100cec39d0ef9ed9746eb7e454" data-file="git.c" href="https://github.com/git/git/commit/4d3ab44d26c47d100cec39d0ef9ed9746eb7e454" target="blank" title="use xgetcwd() to set $GIT_DIR

Instead of dying of a segmentation fault if getcwd() returns NULL, use
xgetcwd() to make sure to write a useful error message and then exit
in an orderly fashion.

Suggested-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Rene Scharfe &lt;l.s.r@web.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe"> cwd</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">,</a><a data-author="Junio C Hamano" data-commit="9277d60233a1829742aa2d9d20ddbfc3b2b7acde" data-file="git.c" href="https://github.com/git/git/commit/9277d60233a1829742aa2d9d20ddbfc3b2b7acde" target="blank" title="git --bare cmd: do not unconditionally nuke GIT_DIR

"GIT_DIR=some.where git --bare cmd" and worse yet
"git --git-dir=some.where --bare cmd" were very confusing.  They
both ignored git-dir specified, and instead made $cwd as GIT_DIR.

This changes --bare not to override existing GIT_DIR.

This has been like this for a long time.  Let's hope nobody sane
relied on this insane behaviour.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> 0</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">);</a><a data-author="Junio C Hamano" data-commit="f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" data-file="git.c" href="https://github.com/git/git/commit/f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" target="blank" title="Merge branch 'rs/strbuf-getcwd'

Reduce the use of fixed sized buffer passed to getcwd() calls
by introducing xgetcwd() helper.

* rs/strbuf-getcwd:
  use strbuf_add_absolute_path() to add absolute paths
  abspath: convert absolute_path() to strbuf
  use xgetcwd() to set $GIT_DIR
  use xgetcwd() to get the current directory or die
  wrapper: add xgetcwd()
  abspath: convert real_path_internal() to strbuf
  abspath: use strbuf_getcwd() to remember original working directory
  setup: convert setup_git_directory_gently_1 et al. to strbuf
  unix-sockets: use strbuf_getcwd()
  strbuf: add strbuf_ge
 - Junio C Hamano">
			free</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">(</a><a data-author="Junio C Hamano" data-commit="f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" data-file="git.c" href="https://github.com/git/git/commit/f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" target="blank" title="Merge branch 'rs/strbuf-getcwd'

Reduce the use of fixed sized buffer passed to getcwd() calls
by introducing xgetcwd() helper.

* rs/strbuf-getcwd:
  use strbuf_add_absolute_path() to add absolute paths
  abspath: convert absolute_path() to strbuf
  use xgetcwd() to set $GIT_DIR
  use xgetcwd() to get the current directory or die
  wrapper: add xgetcwd()
  abspath: convert real_path_internal() to strbuf
  abspath: use strbuf_getcwd() to remember original working directory
  setup: convert setup_git_directory_gently_1 et al. to strbuf
  unix-sockets: use strbuf_getcwd()
  strbuf: add strbuf_ge
 - Junio C Hamano">cwd</a><a data-author="Shawn O. Pearce" data-commit="ef5ddb2fe0cdb3bd09acb7229512b6ae9193423f" data-file="git.c" href="https://github.com/git/git/commit/ef5ddb2fe0cdb3bd09acb7229512b6ae9193423f" target="blank" title="Use PATH_MAX constant for --bare.

For easier portability we prefer PATH_MAX over seemingly random
constants like 1024.  Make it so.

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">)</a><a data-author="Junio C Hamano" data-commit="f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" data-file="git.c" href="https://github.com/git/git/commit/f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" target="blank" title="Merge branch 'rs/strbuf-getcwd'

Reduce the use of fixed sized buffer passed to getcwd() calls
by introducing xgetcwd() helper.

* rs/strbuf-getcwd:
  use strbuf_add_absolute_path() to add absolute paths
  abspath: convert absolute_path() to strbuf
  use xgetcwd() to set $GIT_DIR
  use xgetcwd() to get the current directory or die
  wrapper: add xgetcwd()
  abspath: convert real_path_internal() to strbuf
  abspath: use strbuf_getcwd() to remember original working directory
  setup: convert setup_git_directory_gently_1 et al. to strbuf
  unix-sockets: use strbuf_getcwd()
  strbuf: add strbuf_ge
 - Junio C Hamano">;</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">
			setenv(GIT_</a><a data-author="Jeff King" data-commit="2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" data-file="git.c" href="https://github.com/git/git/commit/2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" target="blank" title="setup: suppress implicit "." work-tree for bare repos

If an explicit GIT_DIR is given without a working tree, we
implicitly assume that the current working directory should
be used as the working tree. E.g.,:

  GIT_DIR=/some/repo.git git status

would compare against the cwd.

Unfortunately, we fool this rule for sub-invocations of git
by setting GIT_DIR internally ourselves. For example:

  git init foo
  cd foo/.git
  git status ;# fails, as we expect
  git config alias.st status
  git status ;# does not fail, but should

What happens is that we run setup_git_directory when doing
alias loo
 - Jeff King">IMPLICIT</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">_</a><a data-author="Jeff King" data-commit="2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" data-file="git.c" href="https://github.com/git/git/commit/2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" target="blank" title="setup: suppress implicit "." work-tree for bare repos

If an explicit GIT_DIR is given without a working tree, we
implicitly assume that the current working directory should
be used as the working tree. E.g.,:

  GIT_DIR=/some/repo.git git status

would compare against the cwd.

Unfortunately, we fool this rule for sub-invocations of git
by setting GIT_DIR internally ourselves. For example:

  git init foo
  cd foo/.git
  git status ;# fails, as we expect
  git config alias.st status
  git status ;# does not fail, but should

What happens is that we run setup_git_directory when doing
alias loo
 - Jeff King">WORK</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">_</a><a data-author="Jeff King" data-commit="2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" data-file="git.c" href="https://github.com/git/git/commit/2cd83d10bb6bcf768129e1c4e5a4dee4b6bcd27f" target="blank" title="setup: suppress implicit "." work-tree for bare repos

If an explicit GIT_DIR is given without a working tree, we
implicitly assume that the current working directory should
be used as the working tree. E.g.,:

  GIT_DIR=/some/repo.git git status

would compare against the cwd.

Unfortunately, we fool this rule for sub-invocations of git
by setting GIT_DIR internally ourselves. For example:

  git init foo
  cd foo/.git
  git status ;# fails, as we expect
  git config alias.st status
  git status ;# does not fail, but should

What happens is that we run setup_git_directory when doing
alias loo
 - Jeff King">TREE</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">_ENVIRONMENT, "0", 1);
			if (envchanged)
				*envchanged = 1;</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
		} else if (!strcmp(cmd, "-c")) {</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">
			if (*argc &lt; 2) {</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">"-c expects a configuration string\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">;</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
				usage(git_usage_string);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
			}</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">
			git_config_</a><a data-author="Jeff King" data-commit="2b64fc894dada0916558fd0bfd19c50631f978cb" data-file="git.c" href="https://github.com/git/git/commit/2b64fc894dada0916558fd0bfd19c50631f978cb" target="blank" title="pass "git -c foo=bar" params through environment

Git uses the "-c foo=bar" parameters to set a config
variable for a single git invocation. We currently do this
by making a list in the current process and consulting that
list in git_config.

This works fine for built-ins, but the config changes are
silently ignored by subprocesses, including dashed externals
and invocations to "git config" from shell scripts.

This patch instead puts them in an environment variable
which we consult when looking at config (both internally and
via calls "git config").

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
S
 - Jeff King">push</a><a data-author="Alex Riesen" data-commit="8b1fa778676ae94f7a6d4113fa90947b548154dd" data-file="git.c" href="https://github.com/git/git/commit/8b1fa778676ae94f7a6d4113fa90947b548154dd" target="blank" title="Allow passing of configuration parameters in the command line

The values passed this way will override whatever is defined
in the config files.

Signed-off-by: Alex Riesen &lt;raa.lkml@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alex Riesen">_parameter((*argv)[1]);</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">
			(*argv)++;
			(*argc)--;</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">
		} else if (!strcmp(cmd, "--literal-pathspecs")) {</a><a data-author="Junio C Hamano" data-commit="fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" data-file="git.c" href="https://github.com/git/git/commit/fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" target="blank" title="Merge branch 'jk/alias-in-bare'

An aliased command spawned from a bare repository that does not say
it is bare with "core.bare = yes" is treated as non-bare by mistake.

* jk/alias-in-bare:
  setup: suppress implicit "." work-tree for bare repos
  environment: add GIT_PREFIX to local_repo_env
  cache.h: drop LOCAL_REPO_ENV_SIZE

 - Junio C Hamano">
			setenv(GIT_</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">LITERAL</a><a data-author="Junio C Hamano" data-commit="fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" data-file="git.c" href="https://github.com/git/git/commit/fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" target="blank" title="Merge branch 'jk/alias-in-bare'

An aliased command spawned from a bare repository that does not say
it is bare with "core.bare = yes" is treated as non-bare by mistake.

* jk/alias-in-bare:
  setup: suppress implicit "." work-tree for bare repos
  environment: add GIT_PREFIX to local_repo_env
  cache.h: drop LOCAL_REPO_ENV_SIZE

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">PATHSPECS</a><a data-author="Junio C Hamano" data-commit="fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" data-file="git.c" href="https://github.com/git/git/commit/fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" target="blank" title="Merge branch 'jk/alias-in-bare'

An aliased command spawned from a bare repository that does not say
it is bare with "core.bare = yes" is treated as non-bare by mistake.

* jk/alias-in-bare:
  setup: suppress implicit "." work-tree for bare repos
  environment: add GIT_PREFIX to local_repo_env
  cache.h: drop LOCAL_REPO_ENV_SIZE

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">ENVIRONMENT, "1", 1);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">
			if (envchanged)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="bd30c2e48432c692f9e77d3529c9cf25117066bb" data-file="git.c" href="https://github.com/git/git/commit/bd30c2e48432c692f9e77d3529c9cf25117066bb" target="blank" title="pathspec: support :(glob) syntax

:(glob)path differs from plain pathspec that it uses wildmatch with
WM_PATHNAME while the other uses fnmatch without FNM_PATHNAME. The
difference lies in how '*' (and '**') is processed.

With the introduction of :(glob) and :(literal) and their global
options --[no]glob-pathspecs, the user can:

 - make everything literal by default via --noglob-pathspecs
   --literal-pathspecs cannot be used for this purpose as it
   disables _all_ pathspec magic.

 - individually turn on globbing with :(glob)

 - make everything globbing by default via --glob-pathspecs

 - 
 - Nguyễn Thái Ngọc Duy">
				*envchanged = 1;</a><a data-author="Jeff King" data-commit="823ab40fd4adc5bf5b5c66b6d189deae34d2a138" data-file="git.c" href="https://github.com/git/git/commit/823ab40fd4adc5bf5b5c66b6d189deae34d2a138" target="blank" title="add global --literal-pathspecs option

Git takes pathspec arguments in many places to limit the
scope of an operation. These pathspecs are treated not as
literal paths, but as glob patterns that can be fed to
fnmatch. When a user is giving a specific pattern, this is a
nice feature.

However, when programatically providing pathspecs, it can be
a nuisance. For example, to find the latest revision which
modified "$foo", one can use "git rev-list -- $foo". But if
"$foo" contains glob characters (e.g., "f*"), it will
erroneously match more entries than desired. The caller
needs to quote the charac
 - Jeff King">
		} else if (!strcmp(cmd, "--no-literal-pathspecs")) {
			setenv(GIT_LITERAL_PATHSPECS</a><a data-author="Junio C Hamano" data-commit="fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" data-file="git.c" href="https://github.com/git/git/commit/fb3b7b1f95ce3c39f1116ebabf0bbcbfd3bb8796" target="blank" title="Merge branch 'jk/alias-in-bare'

An aliased command spawned from a bare repository that does not say
it is bare with "core.bare = yes" is treated as non-bare by mistake.

* jk/alias-in-bare:
  setup: suppress implicit "." work-tree for bare repos
  environment: add GIT_PREFIX to local_repo_env
  cache.h: drop LOCAL_REPO_ENV_SIZE

 - Junio C Hamano">_ENVIRONMENT, "0", 1);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="bd30c2e48432c692f9e77d3529c9cf25117066bb" data-file="git.c" href="https://github.com/git/git/commit/bd30c2e48432c692f9e77d3529c9cf25117066bb" target="blank" title="pathspec: support :(glob) syntax

:(glob)path differs from plain pathspec that it uses wildmatch with
WM_PATHNAME while the other uses fnmatch without FNM_PATHNAME. The
difference lies in how '*' (and '**') is processed.

With the introduction of :(glob) and :(literal) and their global
options --[no]glob-pathspecs, the user can:

 - make everything literal by default via --noglob-pathspecs
   --literal-pathspecs cannot be used for this purpose as it
   disables _all_ pathspec magic.

 - individually turn on globbing with :(glob)

 - make everything globbing by default via --glob-pathspecs

 - 
 - Nguyễn Thái Ngọc Duy">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">
		} else if (!strcmp(cmd, "--glob-pathspecs"))</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano"> {</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">
			setenv(GIT_GLOB_PATHSPECS_ENVIRONMENT, "1</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">",</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano"> 1);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="bd30c2e48432c692f9e77d3529c9cf25117066bb" data-file="git.c" href="https://github.com/git/git/commit/bd30c2e48432c692f9e77d3529c9cf25117066bb" target="blank" title="pathspec: support :(glob) syntax

:(glob)path differs from plain pathspec that it uses wildmatch with
WM_PATHNAME while the other uses fnmatch without FNM_PATHNAME. The
difference lies in how '*' (and '**') is processed.

With the introduction of :(glob) and :(literal) and their global
options --[no]glob-pathspecs, the user can:

 - make everything literal by default via --noglob-pathspecs
   --literal-pathspecs cannot be used for this purpose as it
   disables _all_ pathspec magic.

 - individually turn on globbing with :(glob)

 - make everything globbing by default via --glob-pathspecs

 - 
 - Nguyễn Thái Ngọc Duy">
			if (envchanged)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="93d935371654faf2956a4c37c1ca46f3195ee832" data-file="git.c" href="https://github.com/git/git/commit/93d935371654faf2956a4c37c1ca46f3195ee832" target="blank" title="parse_pathspec: accept :(icase)path syntax

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
				*envchanged = 1;</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">
		} else if (!strcmp(</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">cmd</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">, "--noglob-pathspecs")) {
			setenv(GIT</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">NOGLOB</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">PATHSPECS_ENVIRONMENT</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">,</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano"> "1"</a><a data-author="Junio C Hamano" data-commit="b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" data-file="git.c" href="https://github.com/git/git/commit/b02f5aeda6f66ac3be9b2e35f9b237d4f1f80d73" target="blank" title="Merge branch 'jl/submodule-mv'

"git mv A B" when moving a submodule A does "the right thing",
inclusing relocating its working tree and adjusting the paths in
the .gitmodules file.

* jl/submodule-mv: (53 commits)
  rm: delete .gitmodules entry of submodules removed from the work tree
  mv: update the path entry in .gitmodules for moved submodules
  submodule.c: add .gitmodules staging helper functions
  mv: move submodules using a gitfile
  mv: move submodules together with their work trees
  rm: do not set a variable twice without intermediate reading.
  t6131 - skip tests if on case-insens
 - Junio C Hamano">,</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano"> 1);</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="93d935371654faf2956a4c37c1ca46f3195ee832" data-file="git.c" href="https://github.com/git/git/commit/93d935371654faf2956a4c37c1ca46f3195ee832" target="blank" title="parse_pathspec: accept :(icase)path syntax

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
			if (envchanged)</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">
				*envchanged = 1;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="93d935371654faf2956a4c37c1ca46f3195ee832" data-file="git.c" href="https://github.com/git/git/commit/93d935371654faf2956a4c37c1ca46f3195ee832" target="blank" title="parse_pathspec: accept :(icase)path syntax

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		} else if (!strcmp(cmd, "--icase-pathspecs")) {
			setenv(GIT_ICASE_PATHSPECS_ENVIRONMENT, "1", 1);</a><a data-author="Junio C Hamano" data-commit="087350398e8b2c5d4b39f051b23a2e533f4d830b" data-file="git.c" href="https://github.com/git/git/commit/087350398e8b2c5d4b39f051b23a2e533f4d830b" target="blank" title="Merge branch 'nr/git-cd-to-a-directory'

Just like "make -C &lt;directory&gt;", make "git -C &lt;directory&gt; ..." to
go there before doing anything else.

* nr/git-cd-to-a-directory:
  t0056: "git -C" test updates
  git: run in a directory given with -C option

 - Junio C Hamano">
			if (envchanged)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">
				*envchanged</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak"> =</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy"> 1</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak">;</a><a data-author="Junio C Hamano" data-commit="43885c2a557871aedcbb1a412fc18e98c3dd1dc4" data-file="git.c" href="https://github.com/git/git/commit/43885c2a557871aedcbb1a412fc18e98c3dd1dc4" target="blank" title="rename internal format-patch wip

Otherwise "git format-patch" would invoke unfinished internal one that
does only --stdout

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		}</a><a data-author="Jeff King" data-commit="27344d6a6c8056664966e11acf674e5da6dd7ee3" data-file="git.c" href="https://github.com/git/git/commit/27344d6a6c8056664966e11acf674e5da6dd7ee3" target="blank" title="git: add --no-optional-locks option

Some tools like IDEs or fancy editors may periodically run
commands like "git status" in the background to keep track
of the state of the repository. Some of these commands may
refresh the index and write out the result in an
opportunistic way: if they can get the index lock, then they
update the on-disk index with any updates they find. And if
not, then their in-core refresh is lost and just has to be
recomputed by the next caller.

But taking the index lock may conflict with other operations
in the repository. Especially ones that the user is doing
themse
 - Jeff King"> else if (!strcmp(cmd</a><a data-author="Junio C Hamano" data-commit="43885c2a557871aedcbb1a412fc18e98c3dd1dc4" data-file="git.c" href="https://github.com/git/git/commit/43885c2a557871aedcbb1a412fc18e98c3dd1dc4" target="blank" title="rename internal format-patch wip

Otherwise "git format-patch" would invoke unfinished internal one that
does only --stdout

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">,</a><a data-author="Jeff King" data-commit="27344d6a6c8056664966e11acf674e5da6dd7ee3" data-file="git.c" href="https://github.com/git/git/commit/27344d6a6c8056664966e11acf674e5da6dd7ee3" target="blank" title="git: add --no-optional-locks option

Some tools like IDEs or fancy editors may periodically run
commands like "git status" in the background to keep track
of the state of the repository. Some of these commands may
refresh the index and write out the result in an
opportunistic way: if they can get the index lock, then they
update the on-disk index with any updates they find. And if
not, then their in-core refresh is lost and just has to be
recomputed by the next caller.

But taking the index lock may conflict with other operations
in the repository. Especially ones that the user is doing
themse
 - Jeff King"> "--no-optional-locks")) {
			setenv(GIT_OPTIONAL_LOCKS_ENVIRONMENT, "0", 1);</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">
		} else if (!strcmp(cmd, "--shallow-file")) {
			(</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak">*</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">argv)++;
			(</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak">*</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">argc</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak">)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">--;
			set_alternate_shallow_file(</a><a data-author="Junio C Hamano" data-commit="00624d608cc69bd62801c93e74d1ea7a7ddd6598" data-file="git.c" href="https://github.com/git/git/commit/00624d608cc69bd62801c93e74d1ea7a7ddd6598" target="blank" title="Merge branch 'sb/object-store-grafts'

The conversion to pass "the_repository" and then "a_repository"
throughout the object access API continues.

* sb/object-store-grafts:
  commit: allow lookup_commit_graft to handle arbitrary repositories
  commit: allow prepare_commit_graft to handle arbitrary repositories
  shallow: migrate shallow information into the object parser
  path.c: migrate global git_path_* to take a repository argument
  cache: convert get_graft_file to handle arbitrary repositories
  commit: convert read_graft_file to handle arbitrary repositories
  commit: convert register_
 - Junio C Hamano">the_repository,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy"> (*argv)[0]</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="069c053222bfc62a6522430a137e9b2c7ff36e4c" data-file="git.c" href="https://github.com/git/git/commit/069c053222bfc62a6522430a137e9b2c7ff36e4c" target="blank" title="add GIT_SHALLOW_FILE to propagate --shallow-file to subprocesses

This may be needed when a hook is run after a new shallow pack is
received, but .git/shallow is not settled yet. A temporary shallow
file to plug all loose ends should be used instead. GIT_SHALLOW_FILE
is overriden by --shallow-file.

--shallow-file does not work in this case because the hook may spawn
many git subprocesses and the launch commands do not have
--shallow-file as it's a recent addition.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, 1</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="6035d6aad8ca11954c0d7821f6f3e7c047039c8f" data-file="git.c" href="https://github.com/git/git/commit/6035d6aad8ca11954c0d7821f6f3e7c047039c8f" target="blank" title="fetch-pack: prepare updated shallow file before fetching the pack

index-pack --strict looks up and follows parent commits. If shallow
information is not ready by the time index-pack is run, index-pack may
be led to non-existent objects. Make fetch-pack save shallow file to
disk before invoking index-pack.

git learns new global option --shallow-file to pass on the alternate
shallow file path. Undocumented (and not even support --shallow-file=
syntax) because it's unlikely to be used again elsewhere.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitste
 - Nguyễn Thái Ngọc Duy">);</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			if (envchanged)
				*envchanged = 1;</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">
		} else if (!strcmp(cmd, "-C")) {</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			if (*argc &lt; 2) {</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">
				fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">"no directory given for -C\n" )</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">;
				usage(git_usage_string);</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
			}</a><a data-author="Karthik Nayak" data-commit="6a536e2076f02a98e0d6403ff68f3acf717fa1c4" data-file="git.c" href="https://github.com/git/git/commit/6a536e2076f02a98e0d6403ff68f3acf717fa1c4" target="blank" title="git: treat "git -C '&lt;path&gt;'" as a no-op when &lt;path&gt; is empty

'git -C ""' unhelpfully dies with error "Cannot change to ''",
whereas the shell treats `cd ""' as a no-op.  Taking the shell's
behavior as a precedent, teach git to treat `-C ""' as a no-op, as
well.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Helped-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Karthik Nayak &lt;karthik.188@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Karthik Nayak">
			if ((*argv)[1][0]) {</a><a data-author="Nazri Ramliy" data-commit="44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" data-file="git.c" href="https://github.com/git/git/commit/44e1e4d67d5148c245db362cc48c3cc6c2ec82ca" target="blank" title="git: run in a directory given with -C option

This is similar in spirit to "make -C dir ..." and "tar -C dir ...".

It takes more keypresses to invoke git command in a different
directory without leaving the current directory:

    1. (cd ~/foo &amp;&amp; git status)
       git --git-dir=~/foo/.git --work-dir=~/foo status
       GIT_DIR=~/foo/.git GIT_WORK_TREE=~/foo git status
    2. (cd ../..; git grep foo)
    3. for d in d1 d2 d3; do (cd $d &amp;&amp; git svn rebase); done

The methods shown above are acceptable for scripting but are too
cumbersome for quick command line invocations.

With this new option
 - Nazri Ramliy">
				if (chdir((*argv)[1]))
					die_errno("cannot change to '%s'", (*argv)[1]);</a><a data-author="Jeff King" data-commit="27344d6a6c8056664966e11acf674e5da6dd7ee3" data-file="git.c" href="https://github.com/git/git/commit/27344d6a6c8056664966e11acf674e5da6dd7ee3" target="blank" title="git: add --no-optional-locks option

Some tools like IDEs or fancy editors may periodically run
commands like "git status" in the background to keep track
of the state of the repository. Some of these commands may
refresh the index and write out the result in an
opportunistic way: if they can get the index lock, then they
update the on-disk index with any updates they find. And if
not, then their in-core refresh is lost and just has to be
recomputed by the next caller.

But taking the index lock may conflict with other operations
in the repository. Especially ones that the user is doing
themse
 - Jeff King">
				if (envchanged)
					*envchanged = 1;</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
			}</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			(*argv)++;
			(*argc)--;</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
		} else</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> if (skip_prefix(cmd, "--list-cmds=", &amp;cmd)) {</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			trace2_cmd_name("_query_");</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
			if (!strcmp(cmd, "</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">parseopt")) {</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
				struct string_list list = STRING_LIST_INIT_DUP</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">;</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">
				int i;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">

				list_builtins(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">&amp;list,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> NO_PARSEOPT</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
				for (i = 0;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> i &lt; list.nr; i++)
					printf("%s "</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> list.items[i].string);
				string_list_clear(&amp;list, 0</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">);</a><a data-author="Jon Seymour" data-commit="f2dd8c3799ddbd7df63a89a9043916f8545a70a3" data-file="git.c" href="https://github.com/git/git/commit/f2dd8c3799ddbd7df63a89a9043916f8545a70a3" target="blank" title="git: add --info-path and --man-path options

Similar to the way the --html-path option lets UI programs learn where git
has its HTML documentation pages, expose the other two paths used to store
the documentation pages of these two types.

Signed-off-by: Jon Seymour &lt;jon.seymour@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jon Seymour">
				exit(</a><a data-author="Michael J Gruber" data-commit="7cf16a14f5c070f7b14cf28023769450133172ae" data-file="git.c" href="https://github.com/git/git/commit/7cf16a14f5c070f7b14cf28023769450133172ae" target="blank" title="handle_alias: provide GIT_PREFIX to !alias

Provide an environment variable GIT_PREFIX which contains the subdirectory
from which a !alias was called (i.e. 'git rev-parse --show-prefix') since
these cd to the to level directory before they are executed.

Signed-off-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Michael J Gruber">0);</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			} else {</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">
				exit(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">list_cmds(cmd)</a><a data-author="Josh Triplett" data-commit="a1bea2c1fc5e5243e873919248940dd5fff593a4" data-file="git.c" href="https://github.com/git/git/commit/a1bea2c1fc5e5243e873919248940dd5fff593a4" target="blank" title="ref namespaces: infrastructure

Add support for dividing the refs of a single repository into multiple
namespaces, each of which can have its own branches, tags, and HEAD.
Git can expose each namespace as an independent repository to pull from
and push to, while sharing the object store, and exposing all the refs
to operations such as git-gc.

Storing multiple repositories as namespaces of a single repository
avoids storing duplicate copies of the same objects, such as when
storing multiple branches of the same source.  The alternates mechanism
provides similar support for avoiding duplicates,
 - Josh Triplett">);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
			}</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="0089521cacd99db8018b7a31e205dad0bf0738c7" data-file="git.c" href="https://github.com/git/git/commit/0089521cacd99db8018b7a31e205dad0bf0738c7" target="blank" title="git.c: convert --list-* to --list-cmds=*

Even if these are hidden options, let's make them a bit more generic
since we're introducing more listing types shortly. The code is
structured to allow combining multiple listing types together because
we will soon add more types the 'builtins'.

'parseopt' remains separate because it has separate (SPC) to match
git-completion.bash needs and will not combine with others.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		} else {</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">"unknown option: %s</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">\n</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">"</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, cmd);</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">
			usage(git_usage_string);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
		}</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

		(*argv)++;
		(*argc)--;</a><a data-author="Andreas Ericsson" data-commit="da6bf70ebf7d485e3643ba3569962a4c08e37906" data-file="git.c" href="https://github.com/git/git/commit/da6bf70ebf7d485e3643ba3569962a4c08e37906" target="blank" title="git: grok 'help' to mean '--help'.

Most other scm's understand it, most users expect it and it's an easy fix.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
	}</a><a data-author="Junio C Hamano" data-commit="73546c085d49694c5e54b421f80bde6bc25006fb" data-file="git.c" href="https://github.com/git/git/commit/73546c085d49694c5e54b421f80bde6bc25006fb" target="blank" title="handle_options(): do not miscount how many arguments were used

The handle_options() function advances the base of the argument array and
returns the number of arguments it used. The caller in handle_alias()
wants to reallocate the argv array it passes to this function, and
attempts to do so by subtracting the returned value to compensate for the
change handle_options() makes to the new_argv.

But handle_options() did not correctly count when "-c &lt;config=value&gt;" is
given, causing a wrong pointer to be passed to realloc().

Fix it by saving the original argv at the beginning of handle_options()
 - Junio C Hamano">
	return</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund"> (*argv)</a><a data-author="Junio C Hamano" data-commit="73546c085d49694c5e54b421f80bde6bc25006fb" data-file="git.c" href="https://github.com/git/git/commit/73546c085d49694c5e54b421f80bde6bc25006fb" target="blank" title="handle_options(): do not miscount how many arguments were used

The handle_options() function advances the base of the argument array and
returns the number of arguments it used. The caller in handle_alias()
wants to reallocate the argv array it passes to this function, and
attempts to do so by subtracting the returned value to compensate for the
change handle_options() makes to the new_argv.

But handle_options() did not correctly count when "-c &lt;config=value&gt;" is
given, causing a wrong pointer to be passed to realloc().

Fix it by saving the original argv at the beginning of handle_options()
 - Junio C Hamano"> - orig</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">_argv;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

static int handle_alias(int *argcp, const char ***argv)</a><a data-author="Andreas Ericsson" data-commit="97fc6c5fbacc2181319bbd7e2faa8ac04476f862" data-file="git.c" href="https://github.com/git/git/commit/97fc6c5fbacc2181319bbd7e2faa8ac04476f862" target="blank" title="git --help COMMAND brings up the git-COMMAND man-page.

It's by design a bit stupid (matching ^git rather than ^git-), so as
to work with 'gitk' and 'git' as well.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
{</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	int</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer"> envchanged</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> = 0, ret = 0</a><a data-author="Johannes Schindelin" data-commit="47e5c0ca2cabb406518dda5c09432dc996f7ef2b" data-file="git.c" href="https://github.com/git/git/commit/47e5c0ca2cabb406518dda5c09432dc996f7ef2b" target="blank" title="Save errno in handle_alias()

git.c:main() relies on the value of errno being set by the last attempt to
execute the command. However, if something goes awry in handle_alias(),
that assumption is wrong. So restore errno before returning from
handle_alias().

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, saved_errno = errno</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;
	int count</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, option_count;</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	const char **new_argv;
	const char *alias_command;
	char *alias_string;

	alias_command = (*argv)[0];
	alias_</a><a data-author="Jeff King" data-commit="94351118c0a820002b093598e7fac5bdf3c0291f" data-file="git.c" href="https://github.com/git/git/commit/94351118c0a820002b093598e7fac5bdf3c0291f" target="blank" title="make alias lookup a public, procedural function

This converts git_config_alias to the public alias_lookup
function. Because of the nature of our config parser, we
still have to rely on setting static data. However, that
interface is wrapped so that you can just say

  value = alias_lookup(key);

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">string = alias_lookup</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">(alias_command);
	if (alias_string) {</a><a data-author="Rasmus Villemoes" data-commit="a9a60b94ccda5ff25faf51f39faeac11cac68346" data-file="git.c" href="https://github.com/git/git/commit/a9a60b94ccda5ff25faf51f39faeac11cac68346" target="blank" title="git.c: handle_alias: prepend alias info when first argument is -h

Most git commands respond to -h anywhere in the command line, or at
least as a first and lone argument, by printing the usage
information. For aliases, we can provide a little more information that
might be useful in interpreting/understanding the following output by
prepending a line telling that the command is an alias, and for what.

When one invokes a simple alias, such as "cp = cherry-pick"
with -h, this results in

$ git cp -h
'cp' is aliased to 'cherry-pick'
usage: git cherry-pick [&lt;options&gt;] &lt;commit-ish&gt;...
...

When th
 - Rasmus Villemoes">
		if (*argcp &gt; 1 &amp;&amp; !strcmp((*argv)[1], "</a><a data-author="Alban Gruin" data-commit="53bbcfbde7c29611f16722c3fbcdb2b78718f633" data-file="git.c" href="https://github.com/git/git/commit/53bbcfbde7c29611f16722c3fbcdb2b78718f633" target="blank" title="rebase -i: implement the main part of interactive rebase as a builtin

This rewrites the part of interactive rebase which initializes the
basic state, make the script and complete the action, as a buitin, named
git-rebase--interactive2 for now.  Others modes (`--continue`,
`--edit-todo`, etc.) will be rewritten in the next commit.

git-rebase--interactive.sh is modified to call git-rebase--interactive2
instead of git-rebase--helper.

Signed-off-by: Alban Gruin &lt;alban.gruin@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alban Gruin">-</a><a data-author="Rasmus Villemoes" data-commit="a9a60b94ccda5ff25faf51f39faeac11cac68346" data-file="git.c" href="https://github.com/git/git/commit/a9a60b94ccda5ff25faf51f39faeac11cac68346" target="blank" title="git.c: handle_alias: prepend alias info when first argument is -h

Most git commands respond to -h anywhere in the command line, or at
least as a first and lone argument, by printing the usage
information. For aliases, we can provide a little more information that
might be useful in interpreting/understanding the following output by
prepending a line telling that the command is an alias, and for what.

When one invokes a simple alias, such as "cp = cherry-pick"
with -h, this results in

$ git cp -h
'cp' is aliased to 'cherry-pick'
usage: git cherry-pick [&lt;options&gt;] &lt;commit-ish&gt;...
...

When th
 - Rasmus Villemoes">h"))
			fprintf</a><a data-author="Alban Gruin" data-commit="53bbcfbde7c29611f16722c3fbcdb2b78718f633" data-file="git.c" href="https://github.com/git/git/commit/53bbcfbde7c29611f16722c3fbcdb2b78718f633" target="blank" title="rebase -i: implement the main part of interactive rebase as a builtin

This rewrites the part of interactive rebase which initializes the
basic state, make the script and complete the action, as a buitin, named
git-rebase--interactive2 for now.  Others modes (`--continue`,
`--edit-todo`, etc.) will be rewritten in the next commit.

git-rebase--interactive.sh is modified to call git-rebase--interactive2
instead of git-rebase--helper.

Signed-off-by: Alban Gruin &lt;alban.gruin@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alban Gruin">_</a><a data-author="Rasmus Villemoes" data-commit="a9a60b94ccda5ff25faf51f39faeac11cac68346" data-file="git.c" href="https://github.com/git/git/commit/a9a60b94ccda5ff25faf51f39faeac11cac68346" target="blank" title="git.c: handle_alias: prepend alias info when first argument is -h

Most git commands respond to -h anywhere in the command line, or at
least as a first and lone argument, by printing the usage
information. For aliases, we can provide a little more information that
might be useful in interpreting/understanding the following output by
prepending a line telling that the command is an alias, and for what.

When one invokes a simple alias, such as "cp = cherry-pick"
with -h, this results in

$ git cp -h
'cp' is aliased to 'cherry-pick'
usage: git cherry-pick [&lt;options&gt;] &lt;commit-ish&gt;...
...

When th
 - Rasmus Villemoes">ln(stderr,</a><a data-author="Alban Gruin" data-commit="53bbcfbde7c29611f16722c3fbcdb2b78718f633" data-file="git.c" href="https://github.com/git/git/commit/53bbcfbde7c29611f16722c3fbcdb2b78718f633" target="blank" title="rebase -i: implement the main part of interactive rebase as a builtin

This rewrites the part of interactive rebase which initializes the
basic state, make the script and complete the action, as a buitin, named
git-rebase--interactive2 for now.  Others modes (`--continue`,
`--edit-todo`, etc.) will be rewritten in the next commit.

git-rebase--interactive.sh is modified to call git-rebase--interactive2
instead of git-rebase--helper.

Signed-off-by: Alban Gruin &lt;alban.gruin@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alban Gruin"> _</a><a data-author="Rasmus Villemoes" data-commit="a9a60b94ccda5ff25faf51f39faeac11cac68346" data-file="git.c" href="https://github.com/git/git/commit/a9a60b94ccda5ff25faf51f39faeac11cac68346" target="blank" title="git.c: handle_alias: prepend alias info when first argument is -h

Most git commands respond to -h anywhere in the command line, or at
least as a first and lone argument, by printing the usage
information. For aliases, we can provide a little more information that
might be useful in interpreting/understanding the following output by
prepending a line telling that the command is an alias, and for what.

When one invokes a simple alias, such as "cp = cherry-pick"
with -h, this results in

$ git cp -h
'cp' is aliased to 'cherry-pick'
usage: git cherry-pick [&lt;options&gt;] &lt;commit-ish&gt;...
...

When th
 - Rasmus Villemoes">("'%s' is aliased to '%s'"),
				   alias_command, alias_string);</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">
		if (alias_string[0] == '!') {</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">
			struct child</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">_</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">process child = CHILD_PROCESS_INIT;</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin">
			int nongit_ok;

			/</a><a data-author="Junio C Hamano" data-commit="f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" data-file="git.c" href="https://github.com/git/git/commit/f655651e09b9fa7bf8ff13f1b4a5b16c7956e4cf" target="blank" title="Merge branch 'rs/strbuf-getcwd'

Reduce the use of fixed sized buffer passed to getcwd() calls
by introducing xgetcwd() helper.

* rs/strbuf-getcwd:
  use strbuf_add_absolute_path() to add absolute paths
  abspath: convert absolute_path() to strbuf
  use xgetcwd() to set $GIT_DIR
  use xgetcwd() to get the current directory or die
  wrapper: add xgetcwd()
  abspath: convert real_path_internal() to strbuf
  abspath: use strbuf_getcwd() to remember original working directory
  setup: convert setup_git_directory_gently_1 et al. to strbuf
  unix-sockets: use strbuf_getcwd()
  strbuf: add strbuf_ge
 - Junio C Hamano">*</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin"> Aliases expect GIT</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">_</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin">PREFIX,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy"> GIT_DIR</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin"> etc to be set</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy"> *</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin">/</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
			setup_git_directory_gently(</a><a data-author="Junio C Hamano" data-commit="e85dc0a3c7a3f4f8d5aade83fd340b8df73471cd" data-file="git.c" href="https://github.com/git/git/commit/e85dc0a3c7a3f4f8d5aade83fd340b8df73471cd" target="blank" title="Accept git aliases outside a git repository

af05d67 (Always set *nongit_ok in setup_git_directory_gently(),
2008-03-25) had a change from the patch originally submitted that resulted
in disabling aliases outside a git repository.

It turns out that some people used "alias.fubar = diff --color-words" in
$HOME/.gitconfig to use non-index diff (or any command that do not need
git repository) outside git repositories, and this change broke them,
so this resurrects the support for such usage.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">&amp;</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin">nongit</a><a data-author="Junio C Hamano" data-commit="e85dc0a3c7a3f4f8d5aade83fd340b8df73471cd" data-file="git.c" href="https://github.com/git/git/commit/e85dc0a3c7a3f4f8d5aade83fd340b8df73471cd" target="blank" title="Accept git aliases outside a git repository

af05d67 (Always set *nongit_ok in setup_git_directory_gently(),
2008-03-25) had a change from the patch originally submitted that resulted
in disabling aliases outside a git repository.

It turns out that some people used "alias.fubar = diff --color-words" in
$HOME/.gitconfig to use non-index diff (or any command that do not need
git repository) outside git repositories, and this change broke them,
so this resurrects the support for such usage.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">_</a><a data-author="Johannes Schindelin" data-commit="a9bcf6586d1a4888aea91553d73cda20494b8335" data-file="git.c" href="https://github.com/git/git/commit/a9bcf6586d1a4888aea91553d73cda20494b8335" target="blank" title="alias: use the early config machinery to expand aliases

Instead of discovering the .git/ directory, reading the config and then
trying to painstakingly reset all the global state if we did not find a
matching alias, let's use the early config machinery instead.

It may look like unnecessary work to discover the .git/ directory in the
early config machinery and then call setup_git_directory_gently() in the
case of a shell alias, repeating the very same discovery *again*.
However, we have to do this as the early config machinery takes pains
*not* to touch any global state, while shell aliases e
 - Johannes Schindelin">ok</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">);</a><a data-author="Jonathan Nieder" data-commit="030149a4dcd584f6b47221f5b087d081e582d790" data-file="git.c" href="https://github.com/git/git/commit/030149a4dcd584f6b47221f5b087d081e582d790" target="blank" title="git --paginate: paginate external commands again

73e25e7c (git --paginate: do not commit pager choice too early,
2010-06-26) failed to take some cases into account.

1b. Builtins that do not use RUN_SETUP (like git config) do
    not find GIT_DIR set correctly when the pager is launched
    from run_builtin().  So the core.pager configuration is
    not honored from subdirectories of the toplevel for them.

4a. External git commands (like git request-pull) relied on the
    early pager launch to take care of handling the -p option.
    Ever since 73e25e7c, they do not honor the -p option at a
 - Jonathan Nieder">

			commit_pager_choice();</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">

			child.use_shell = 1;</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			child.trace2_child_class = "shell_alias";</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">
			argv</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">_array_push(&amp;child.args</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">,</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o"> alias_string + 1</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">)</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">;</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">
			argv_array_pushv</a><a data-author="Johannes Schindelin" data-commit="a2f8028d3d661b314d5a784764f2f5f9e4c2dde0" data-file="git.c" href="https://github.com/git/git/commit/a2f8028d3d661b314d5a784764f2f5f9e4c2dde0" target="blank" title="Make '!' aliases more useful

When an alias starts with an exclamation mark, the rest is interpreted
as a shell command. However, all arguments passed to git used to be
ignored.

Now you can have an alias like

	$ git config alias.e '!echo'

and

	$ git e Hello World

does what you expect it to do.

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Johannes Schindelin">(</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">&amp;child.args,</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano"> (*argv)</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King"> + 1)</a><a data-author="Junio C Hamano" data-commit="1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" data-file="git.c" href="https://github.com/git/git/commit/1f9a980636d39c08c1cf1c13a6e6584d9d039e0e" target="blank" title="Merge branch 'jk/maint-config-alias-fix'

* jk/maint-config-alias-fix:
  handle_options(): do not miscount how many arguments were used
  config: always parse GIT_CONFIG_PARAMETERS during git_config
  git_config: don't peek at global config_parameters
  config: make environment parsing routines static

Conflicts:
	config.c

 - Junio C Hamano">;</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">

			trace2_cmd_alias(alias_command, child.args.argv);
			trace2_cmd_list_config();
			trace2_cmd_name("_run_shell_alias_");</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">

			ret = run_command(</a><a data-author="Jeff King" data-commit="850d2fec53ee188bab9e458f77906041ac7f1904" data-file="git.c" href="https://github.com/git/git/commit/850d2fec53ee188bab9e458f77906041ac7f1904" target="blank" title="convert manual allocations to argv_array

There are many manual argv allocations that predate the
argv_array API. Switching to that API brings a few
advantages:

  1. We no longer have to manually compute the correct final
     array size (so it's one less thing we can screw up).

  2. In many cases we had to make a separate pass to count,
     then allocate, then fill in the array. Now we can do it
     in one pass, making the code shorter and easier to
     follow.

  3. argv_array handles memory ownership for us, making it
     more obvious when things should be free()d and and when
     no
 - Jeff King">&amp;child</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">);
			if (ret &gt;= 0</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">)   /* normal exit */
				exit</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">(ret);

			die</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">_errno</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">("</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">while</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o"> expanding alias '%s'</a><a data-author="Erik Faye-Lund" data-commit="7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" data-file="git.c" href="https://github.com/git/git/commit/7f51f8bc2b9d0556f2fbe20056e8fc8839766c99" target="blank" title="alias: use run_command api to execute aliases

On Windows, system() executes with cmd.exe instead of /bin/sh. This
means that aliases currently has to be batch-scripts instead of
bourne-scripts. On top of that, cmd.exe does not handle single quotes,
which is what the code-path currently uses to handle arguments with
spaces.

To solve both problems in one go, use run_command_v_opt() to execute
the alias. It already does the right thing prepend "sh -c " to the
alias.

Signed-off-by: Erik Faye-Lund &lt;kusmabite@gmail.com&gt;
Reviewed-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hama
 - Erik Faye-Lund">: '%s'</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Theodore Ts'o" data-commit="dfd42a3c6281275b518f10938dcd858558cd82e3" data-file="git.c" href="https://github.com/git/git/commit/dfd42a3c6281275b518f10938dcd858558cd82e3" target="blank" title="Allow aliases to expand to shell commands

If the alias expansion is prefixed with an exclamation point, treat
it as a shell command which is run using system(3).

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">,
				  alias_command, alias_string + 1);</a><a data-author="Andreas Ericsson" data-commit="97fc6c5fbacc2181319bbd7e2faa8ac04476f862" data-file="git.c" href="https://github.com/git/git/commit/97fc6c5fbacc2181319bbd7e2faa8ac04476f862" target="blank" title="git --help COMMAND brings up the git-COMMAND man-page.

It's by design a bit stupid (matching ^git rather than ^git-), so as
to work with 'gitk' and 'git' as well.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
		}</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		count = split_cmdline(alias_string, &amp;new_argv);</a><a data-author="Deskin Miller" data-commit="dc4179f9a76473176eb473f6f568b0006c823fba" data-file="git.c" href="https://github.com/git/git/commit/dc4179f9a76473176eb473f6f568b0006c823fba" target="blank" title="maint: check return of split_cmdline to avoid bad config strings

As the testcase demonstrates, it's possible for split_cmdline to return -1 and
deallocate any memory it's allocated, if the config string is missing an end
quote.  In both the cases below, which are the only calling sites, the return
isn't checked, and using the pointer causes a pretty immediate segfault.

Signed-off-by: Deskin Miller &lt;deskinm@umich.edu&gt;
Acked-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Deskin Miller">
		if (count &lt;</a><a data-author="Alexander Potashev" data-commit="d75307084da5f89329de190bb9b4a3196cec1d0e" data-file="git.c" href="https://github.com/git/git/commit/d75307084da5f89329de190bb9b4a3196cec1d0e" target="blank" title="remove trailing LF in die() messages

LF at the end of format strings given to die() is redundant because
die already adds one on its own.

Signed-off-by: Alexander Potashev &lt;aspotashev@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Potashev"> 0</a><a data-author="Deskin Miller" data-commit="dc4179f9a76473176eb473f6f568b0006c823fba" data-file="git.c" href="https://github.com/git/git/commit/dc4179f9a76473176eb473f6f568b0006c823fba" target="blank" title="maint: check return of split_cmdline to avoid bad config strings

As the testcase demonstrates, it's possible for split_cmdline to return -1 and
deallocate any memory it's allocated, if the config string is missing an end
quote.  In both the cases below, which are the only calling sites, the return
isn't checked, and using the pointer causes a pretty immediate segfault.

Signed-off-by: Deskin Miller &lt;deskinm@umich.edu&gt;
Acked-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Deskin Miller">)
			die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Deskin Miller" data-commit="dc4179f9a76473176eb473f6f568b0006c823fba" data-file="git.c" href="https://github.com/git/git/commit/dc4179f9a76473176eb473f6f568b0006c823fba" target="blank" title="maint: check return of split_cmdline to avoid bad config strings

As the testcase demonstrates, it's possible for split_cmdline to return -1 and
deallocate any memory it's allocated, if the config string is missing an end
quote.  In both the cases below, which are the only calling sites, the return
isn't checked, and using the pointer causes a pretty immediate segfault.

Signed-off-by: Deskin Miller &lt;deskinm@umich.edu&gt;
Acked-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Deskin Miller">("bad alias.%s string</a><a data-author="Greg Brockman" data-commit="ad9ac6db5d58de08d0497b9184e86926377c20dd" data-file="git.c" href="https://github.com/git/git/commit/ad9ac6db5d58de08d0497b9184e86926377c20dd" target="blank" title="split_cmdline: Allow caller to access error string

This allows the caller to add its own error message to that returned
by split_cmdline.  Thus error output following a failed split_cmdline
can be of the form

fatal: Bad alias.test string: cmdline ends with \

rather than

error: cmdline ends with \
fatal: Bad alias.test string

Signed-off-by: Greg Brockman &lt;gdb@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Greg Brockman">: %s</a><a data-author="Deskin Miller" data-commit="dc4179f9a76473176eb473f6f568b0006c823fba" data-file="git.c" href="https://github.com/git/git/commit/dc4179f9a76473176eb473f6f568b0006c823fba" target="blank" title="maint: check return of split_cmdline to avoid bad config strings

As the testcase demonstrates, it's possible for split_cmdline to return -1 and
deallocate any memory it's allocated, if the config string is missing an end
quote.  In both the cases below, which are the only calling sites, the return
isn't checked, and using the pointer causes a pretty immediate segfault.

Signed-off-by: Deskin Miller &lt;deskinm@umich.edu&gt;
Acked-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Deskin Miller">"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Deskin Miller" data-commit="dc4179f9a76473176eb473f6f568b0006c823fba" data-file="git.c" href="https://github.com/git/git/commit/dc4179f9a76473176eb473f6f568b0006c823fba" target="blank" title="maint: check return of split_cmdline to avoid bad config strings

As the testcase demonstrates, it's possible for split_cmdline to return -1 and
deallocate any memory it's allocated, if the config string is missing an end
quote.  In both the cases below, which are the only calling sites, the return
isn't checked, and using the pointer causes a pretty immediate segfault.

Signed-off-by: Deskin Miller &lt;deskinm@umich.edu&gt;
Acked-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Deskin Miller">, alias</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">_</a><a data-author="Alexander Potashev" data-commit="d75307084da5f89329de190bb9b4a3196cec1d0e" data-file="git.c" href="https://github.com/git/git/commit/d75307084da5f89329de190bb9b4a3196cec1d0e" target="blank" title="remove trailing LF in die() messages

LF at the end of format strings given to die() is redundant because
die already adds one on its own.

Signed-off-by: Alexander Potashev &lt;aspotashev@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Potashev">command</a><a data-author="Greg Brockman" data-commit="ad9ac6db5d58de08d0497b9184e86926377c20dd" data-file="git.c" href="https://github.com/git/git/commit/ad9ac6db5d58de08d0497b9184e86926377c20dd" target="blank" title="split_cmdline: Allow caller to access error string

This allows the caller to add its own error message to that returned
by split_cmdline.  Thus error output following a failed split_cmdline
can be of the form

fatal: Bad alias.test string: cmdline ends with \

rather than

error: cmdline ends with \
fatal: Bad alias.test string

Signed-off-by: Greg Brockman &lt;gdb@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Greg Brockman">,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="a7412ae1342b09f16d659d75da5d25f137800a60" data-file="git.c" href="https://github.com/git/git/commit/a7412ae1342b09f16d659d75da5d25f137800a60" target="blank" title="alias.c: mark split_cmdline_strerror() strings for translation

This function can be part of translated messages. To make sure we
don't have a sentence with mixed languages, mark the strings for
translation, but only use translated strings in places we know we will
output translated strings.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
			    _(</a><a data-author="Greg Brockman" data-commit="ad9ac6db5d58de08d0497b9184e86926377c20dd" data-file="git.c" href="https://github.com/git/git/commit/ad9ac6db5d58de08d0497b9184e86926377c20dd" target="blank" title="split_cmdline: Allow caller to access error string

This allows the caller to add its own error message to that returned
by split_cmdline.  Thus error output following a failed split_cmdline
can be of the form

fatal: Bad alias.test string: cmdline ends with \

rather than

error: cmdline ends with \
fatal: Bad alias.test string

Signed-off-by: Greg Brockman &lt;gdb@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Greg Brockman">split_cmdline_strerror(count)</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">)</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="a7412ae1342b09f16d659d75da5d25f137800a60" data-file="git.c" href="https://github.com/git/git/commit/a7412ae1342b09f16d659d75da5d25f137800a60" target="blank" title="alias.c: mark split_cmdline_strerror() strings for translation

This function can be part of translated messages. To make sure we
don't have a sentence with mixed languages, mark the strings for
translation, but only use translated strings in places we know we will
output translated strings.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">;</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
		option_count = handle_options(&amp;new_argv, &amp;count</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">, &amp;envchanged);
		if (envchanged)
			die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">("alias '%s' changes environment variables</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">.</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">\n"
			      "You can use '!git' in the alias to do this"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">,
			    alias_command</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">);
		memmove(new_argv - option_count, new_argv,
				count * sizeof(char *));
		new_argv -= option_count;</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

		if (count &lt; 1)
			die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">("empty alias for %s"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, alias_command);

		if (!strcmp(alias_command, new_argv[0]))
			die(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">_(</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">"recursive alias: %s"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, alias_command);</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">

		trace_argv_printf</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">(</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">new</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">_</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">argv,</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
				  "</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">trace: alias expansion: %s =&gt;</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">",</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">
				  alias</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">command);</a><a data-author="René Scharfe" data-commit="2756ca4347cbda05b16954cd7f445c216b935e76" data-file="git.c" href="https://github.com/git/git/commit/2756ca4347cbda05b16954cd7f445c216b935e76" target="blank" title="use REALLOC_ARRAY for changing the allocation size of arrays

Signed-off-by: Rene Scharfe &lt;l.s.r@web.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe">

		REALLOC</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">_</a><a data-author="René Scharfe" data-commit="2756ca4347cbda05b16954cd7f445c216b935e76" data-file="git.c" href="https://github.com/git/git/commit/2756ca4347cbda05b16954cd7f445c216b935e76" target="blank" title="use REALLOC_ARRAY for changing the allocation size of arrays

Signed-off-by: Rene Scharfe &lt;l.s.r@web.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe">ARRAY</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">(new_argv, count + *argcp);
		/* insert after command name */
		memcpy(new_argv + count, *argv</a><a data-author="Junio C Hamano" data-commit="d8498500ba5cf348577202e0bb7810cbd68fa120" data-file="git.c" href="https://github.com/git/git/commit/d8498500ba5cf348577202e0bb7810cbd68fa120" target="blank" title="fix git alias

When extra command line arguments are given to a command that
was alias-expanded, the code generated a wrong argument list,
leaving the original alias in the result, and forgetting to
terminate the new argv list.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> + 1</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">, sizeof(char *) * *argcp);</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">

		trace2_cmd_alias(alias_command, new_argv);
		trace2_cmd_list_config();</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

		*argv = new_argv;
		*argcp += count - 1;

		ret = 1;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	}</a><a data-author="Johannes Schindelin" data-commit="47e5c0ca2cabb406518dda5c09432dc996f7ef2b" data-file="git.c" href="https://github.com/git/git/commit/47e5c0ca2cabb406518dda5c09432dc996f7ef2b" target="blank" title="Save errno in handle_alias()

git.c:main() relies on the value of errno being set by the last attempt to
execute the command. However, if something goes awry in handle_alias(),
that assumption is wrong. So restore errno before returning from
handle_alias().

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

	errno = saved_errno;</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">

	return ret;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">

static int run</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="f172f334fde49ce29d0afa21749bf85463a2db9a" data-file="git.c" href="https://github.com/git/git/commit/f172f334fde49ce29d0afa21749bf85463a2db9a" target="blank" title="git: s/run_command/run_builtin/

There is a static function called run_command which
conflicts with the library function in run-command.c; this
isn't a problem currently, but prevents including
run-command.h in git.c.

This patch just renames the static function to something
more specific and non-conflicting.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">builtin</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">(struct cmd_struct *p</a><a data-author="Junio C Hamano" data-commit="96c48153c9a2905fb2f1d588c11e36272635cb79" data-file="git.c" href="https://github.com/git/git/commit/96c48153c9a2905fb2f1d588c11e36272635cb79" target="blank" title="Merge branch 'ml/worktree'

* ml/worktree:
  make git barf when an alias changes environment variables

 - Junio C Hamano">, int</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> argc, const char *</a><a data-author="Junio C Hamano" data-commit="96c48153c9a2905fb2f1d588c11e36272635cb79" data-file="git.c" href="https://github.com/git/git/commit/96c48153c9a2905fb2f1d588c11e36272635cb79" target="blank" title="Merge branch 'ml/worktree'

* ml/worktree:
  make git barf when an alias changes environment variables

 - Junio C Hamano">*</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">argv)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	int status</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">, help;</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	struct stat st;</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	const char *prefix;

	prefix = NULL;</a><a data-author="Junio C Hamano" data-commit="783cfafb91538c178d78a9f6c7b609e4f06582f8" data-file="git.c" href="https://github.com/git/git/commit/783cfafb91538c178d78a9f6c7b609e4f06582f8" target="blank" title="Merge branch 'cc/replace'

* cc/replace:
  Documentation: talk a little bit about GIT_NO_REPLACE_OBJECTS
  Documentation: fix typos and spelling in replace documentation
  replace: use a GIT_NO_REPLACE_OBJECTS env variable

 - Junio C Hamano">
	help = argc == 2 &amp;&amp; !strcmp(argv[1], "-h")</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">;</a><a data-author="Junio C Hamano" data-commit="96c48153c9a2905fb2f1d588c11e36272635cb79" data-file="git.c" href="https://github.com/git/git/commit/96c48153c9a2905fb2f1d588c11e36272635cb79" target="blank" title="Merge branch 'ml/worktree'

* ml/worktree:
  make git barf when an alias changes environment variables

 - Junio C Hamano">
	if</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano"> (</a><a data-author="Jonathan Nieder" data-commit="99caeed05d3e89176d352104a2b70a77aa7e5d81" data-file="git.c" href="https://github.com/git/git/commit/99caeed05d3e89176d352104a2b70a77aa7e5d81" target="blank" title="Let 'git &lt;command&gt; -h' show usage without a git dir

There is no need for "git &lt;command&gt; -h" to depend on being inside
a repository.

Reported by Gerfried Fuchs through http://bugs.debian.org/462557

Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jonathan Nieder">!help) {</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
		if (p-&gt;</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">option &amp;</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">)
			prefix = setup_git_directory();</a><a data-author="Luis R. Rodriguez" data-commit="27bd38d4e5a44da233a9e7d01c6a518aba355297" data-file="git.c" href="https://github.com/git/git/commit/27bd38d4e5a44da233a9e7d01c6a518aba355297" target="blank" title="git.c: treat RUN_SETUP_GENTLY and RUN_SETUP as mutually exclusive

This saves us a few branches when RUN_SETUP is set up.

Signed-off-by: Luis R. Rodriguez &lt;mcgrof@suse.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Luis R. Rodriguez">
		else</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy"> if (p-&gt;option &amp; RUN_SETUP_GENTLY) {
			int nongit_ok;
			prefix = setup_git_directory_gently(&amp;nongit_ok);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
		}</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">

		if (use_pager == -1 &amp;&amp;</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> p-&gt;option &amp;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy"> (</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">RUN</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy"> | RUN_SETUP_GENTLY</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">)</a><a data-author="Martin Ågren" data-commit="c409824cc2abac46e06091fcb29639b048d23b5d" data-file="git.c" href="https://github.com/git/git/commit/c409824cc2abac46e06091fcb29639b048d23b5d" target="blank" title="git.c: let builtins opt for handling `pager.foo` themselves

Before launching a builtin git foo and unless mechanisms with precedence
are in use, we check for and handle the `pager.foo` config. This is done
without considering exactly how git foo is being used, and indeed, git.c
cannot (and should not) know what the arguments to git foo are supposed
to achieve.

In practice this means that, e.g., `git -c pager.tag tag -a new-tag`
results in errors such as "Vim: Warning: Output is not to a terminal"
and a garbled terminal. Someone who makes use of both `git tag -a` and
`git tag -l` will probabl
 - Martin Ågren"> &amp;&amp;
		    !(p-&gt;option &amp; DELAY_PAGER_CONFIG</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" data-file="git.c" href="https://github.com/git/git/commit/ee38dfb89ef88a3e4e6818b7cfe31d122a1c640d" target="blank" title="git wrapper: allow setup_git_directory_gently() be called earlier

In the spirit of v1.4.2-rc3~34^2^2 (Call setup_git_directory() much
earlier, 2006-07-28), let run_builtin() take care of searching for a
repository for built-ins that want to make use of one if present.

So now you can mark your command with RUN_SETUP_GENTLY and use

	nongit = !startup_info-&gt;have_repository;

in place of

	prefix = setup_git_directory_gently(&amp;nongit);

and everything will be the same, except the repository is
discovered a little sooner.

As v1.7.2~16^2 (2010-07-14) explains, this should allow more commands
to r
 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Martin Ågren" data-commit="c409824cc2abac46e06091fcb29639b048d23b5d" data-file="git.c" href="https://github.com/git/git/commit/c409824cc2abac46e06091fcb29639b048d23b5d" target="blank" title="git.c: let builtins opt for handling `pager.foo` themselves

Before launching a builtin git foo and unless mechanisms with precedence
are in use, we check for and handle the `pager.foo` config. This is done
without considering exactly how git foo is being used, and indeed, git.c
cannot (and should not) know what the arguments to git foo are supposed
to achieve.

In practice this means that, e.g., `git -c pager.tag tag -a new-tag`
results in errors such as "Vim: Warning: Output is not to a terminal"
and a garbled terminal. Someone who makes use of both `git tag -a` and
`git tag -l` will probabl
 - Martin Ågren">)</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
			use</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_pager</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King"> = check_pager_config(p-&gt;cmd);
		if (use_pager == -1 &amp;&amp; p-&gt;option &amp; USE_PAGER)
			use_pager = 1;</a><a data-author="Junio C Hamano" data-commit="f3bb8b4b8452f1b7add220e787ef56c737ceff6a" data-file="git.c" href="https://github.com/git/git/commit/f3bb8b4b8452f1b7add220e787ef56c737ceff6a" target="blank" title="Merge branch 'nd/setup'

* nd/setup: (47 commits)
  setup_work_tree: adjust relative $GIT_WORK_TREE after moving cwd
  git.txt: correct where --work-tree path is relative to
  Revert "Documentation: always respect core.worktree if set"
  t0001: test git init when run via an alias
  Remove all logic from get_git_work_tree()
  setup: rework setup_explicit_git_dir()
  setup: clean up setup_discovered_git_dir()
  t1020-subdirectory: test alias expansion in a subdirectory
  setup: clean up setup_bare_git_dir()
  setup: limit get_git_work_tree()'s to explicit setup case only
  Use git_config_early()
 - Junio C Hamano">

		if ((p-&gt;option &amp; (RUN_SETUP | RUN_SETUP_GENTLY)) &amp;&amp;
		    startup_info-&gt;have_repository) /* get_git_dir() may set up repo, avoid that */
			trace_repo_setup(prefix);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	}</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	commit_pager_choice();</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">

	if (!help &amp;&amp; get_super_prefix()) {
		if (!(p-&gt;option &amp; SUPPORT_SUPER_PREFIX))
			die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">("%s doesn't support --super-prefix"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">, p-&gt;cmd);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
	}</a><a data-author="Junio C Hamano" data-commit="783cfafb91538c178d78a9f6c7b609e4f06582f8" data-file="git.c" href="https://github.com/git/git/commit/783cfafb91538c178d78a9f6c7b609e4f06582f8" target="blank" title="Merge branch 'cc/replace'

* cc/replace:
  Documentation: talk a little bit about GIT_NO_REPLACE_OBJECTS
  Documentation: fix typos and spelling in replace documentation
  replace: use a GIT_NO_REPLACE_OBJECTS env variable

 - Junio C Hamano">

	if (!help &amp;&amp;</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> p</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">-</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">&gt;option &amp;</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano"> NEED</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">WORK</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">TREE</a><a data-author="Junio C Hamano" data-commit="96c48153c9a2905fb2f1d588c11e36272635cb79" data-file="git.c" href="https://github.com/git/git/commit/96c48153c9a2905fb2f1d588c11e36272635cb79" target="blank" title="Merge branch 'ml/worktree'

* ml/worktree:
  make git barf when an alias changes environment variables

 - Junio C Hamano">)</a><a data-author="Mike Hommey" data-commit="59f0f2f33a420e9a14bb8cef20d38f508f0d098e" data-file="git.c" href="https://github.com/git/git/commit/59f0f2f33a420e9a14bb8cef20d38f508f0d098e" target="blank" title="Refactor working tree setup

Create a setup_work_tree() that can be used from any command requiring
a working tree conditionally.

Signed-off-by: Mike Hommey &lt;mh@glandium.org&gt;
Acked-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Mike Hommey">
		setup</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">work_tree</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">()</a><a data-author="Johannes Schindelin" data-commit="e90fdc39b6903502192b2dd11e5503cea721a1ad" data-file="git.c" href="https://github.com/git/git/commit/e90fdc39b6903502192b2dd11e5503cea721a1ad" target="blank" title="Clean up work-tree handling

The old version of work-tree support was an unholy mess, barely readable,
and not to the point.

For example, why do you have to provide a worktree, when it is not used?
As in "git status".  Now it works.

Another riddle was: if you can have work trees inside the git dir, why
are some programs complaining that they need a work tree?

IOW it is allowed to call

	$ git --git-dir=../ --work-tree=. bla

when you really want to.  In this case, you are both in the git directory
and in the working tree.  So, programs have to actually test for the right
thing, namely if th
 - Johannes Schindelin">;</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">

	trace</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">_argv</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">_printf</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">(</a><a data-author="Christian Couder" data-commit="6ce4e61f1be690681f6494eb5ca26540c2316f81" data-file="git.c" href="https://github.com/git/git/commit/6ce4e61f1be690681f6494eb5ca26540c2316f81" target="blank" title="Trace into a file or an open fd and refactor tracing code.

If GIT_TRACE is set to an absolute path (starting with a
'/' character), we interpret this as a file path and we
trace into it.

Also if GIT_TRACE is set to an integer value greater than
1 and lower than 10, we interpret this as an open fd value
and we trace into it.

Note that this behavior is not compatible with the
previous one.

We also trace whole messages using one write(2) call to
make sure messages from processes do net get mixed up in
the middle.

This patch makes it possible to get trace information when
running "make test".
 - Christian Couder">argv</a><a data-author="Matthias Lederhofer" data-commit="575ba9d69d5dfd07d95343fe946a5991c4cb27d6" data-file="git.c" href="https://github.com/git/git/commit/575ba9d69d5dfd07d95343fe946a5991c4cb27d6" target="blank" title="GIT_TRACE: show which built-in/external commands are executed

With the environment variable GIT_TRACE set git will show
 - alias expansion
 - built-in command execution
 - external command execution
on stderr.

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Lederhofer">, "trace: built-in: git");</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
	trace2_cmd_name(p-&gt;cmd);
	trace2_cmd_list_config();</a><a data-author="Jameson Miller" data-commit="8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" data-file="git.c" href="https://github.com/git/git/commit/8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" target="blank" title="block alloc: add validations around cache_entry lifecyle

Add an option (controlled by an environment variable) perform extra
validations on mem_pool allocated cache entries. When set:

  1) Invalidate cache_entry memory when discarding cache_entry.

  2) When discarding index_state struct, verify that all cache_entries
     were allocated from expected mem_pool.

  3) When discarding mem_pools, invalidate mem_pool memory.

This should provide extra checks that mem_pools and their allocated
cache_entries are being used as expected.

Signed-off-by: Jameson Miller &lt;jamill@microsoft.com&gt;
Signed-o
 - Jameson Miller">

	validate</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano">_</a><a data-author="Jameson Miller" data-commit="8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" data-file="git.c" href="https://github.com/git/git/commit/8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" target="blank" title="block alloc: add validations around cache_entry lifecyle

Add an option (controlled by an environment variable) perform extra
validations on mem_pool allocated cache entries. When set:

  1) Invalidate cache_entry memory when discarding cache_entry.

  2) When discarding index_state struct, verify that all cache_entries
     were allocated from expected mem_pool.

  3) When discarding mem_pools, invalidate mem_pool memory.

This should provide extra checks that mem_pools and their allocated
cache_entries are being used as expected.

Signed-off-by: Jameson Miller &lt;jamill@microsoft.com&gt;
Signed-o
 - Jameson Miller">cache_entries(the</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="f8adbec9feaa7a1ab9814db1115826e87033712e" data-file="git.c" href="https://github.com/git/git/commit/f8adbec9feaa7a1ab9814db1115826e87033712e" target="blank" title="cache.h: flip NO_THE_INDEX_COMPATIBILITY_MACROS switch

By default, index compat macros are off from now on, because they
could hide the_index dependency.

Only those in builtin can use it.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">repository-&gt;</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano">index</a><a data-author="Jameson Miller" data-commit="8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" data-file="git.c" href="https://github.com/git/git/commit/8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" target="blank" title="block alloc: add validations around cache_entry lifecyle

Add an option (controlled by an environment variable) perform extra
validations on mem_pool allocated cache entries. When set:

  1) Invalidate cache_entry memory when discarding cache_entry.

  2) When discarding index_state struct, verify that all cache_entries
     were allocated from expected mem_pool.

  3) When discarding mem_pools, invalidate mem_pool memory.

This should provide extra checks that mem_pools and their allocated
cache_entries are being used as expected.

Signed-off-by: Jameson Miller &lt;jamill@microsoft.com&gt;
Signed-o
 - Jameson Miller">);</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	status =</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> p-&gt;fn(argc, argv, prefix);</a><a data-author="Jameson Miller" data-commit="8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" data-file="git.c" href="https://github.com/git/git/commit/8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" target="blank" title="block alloc: add validations around cache_entry lifecyle

Add an option (controlled by an environment variable) perform extra
validations on mem_pool allocated cache entries. When set:

  1) Invalidate cache_entry memory when discarding cache_entry.

  2) When discarding index_state struct, verify that all cache_entries
     were allocated from expected mem_pool.

  3) When discarding mem_pools, invalidate mem_pool memory.

This should provide extra checks that mem_pools and their allocated
cache_entries are being used as expected.

Signed-off-by: Jameson Miller &lt;jamill@microsoft.com&gt;
Signed-o
 - Jameson Miller">
	validate_cache_entries(the_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="f8adbec9feaa7a1ab9814db1115826e87033712e" data-file="git.c" href="https://github.com/git/git/commit/f8adbec9feaa7a1ab9814db1115826e87033712e" target="blank" title="cache.h: flip NO_THE_INDEX_COMPATIBILITY_MACROS switch

By default, index compat macros are off from now on, because they
could hide the_index dependency.

Only those in builtin can use it.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">repository-&gt;</a><a data-author="Jameson Miller" data-commit="8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" data-file="git.c" href="https://github.com/git/git/commit/8616a2d0cb57865540f1c00ac2e5385a6cc5d84e" target="blank" title="block alloc: add validations around cache_entry lifecyle

Add an option (controlled by an environment variable) perform extra
validations on mem_pool allocated cache entries. When set:

  1) Invalidate cache_entry memory when discarding cache_entry.

  2) When discarding index_state struct, verify that all cache_entries
     were allocated from expected mem_pool.

  3) When discarding mem_pools, invalidate mem_pool memory.

This should provide extra checks that mem_pools and their allocated
cache_entries are being used as expected.

Signed-off-by: Jameson Miller &lt;jamill@microsoft.com&gt;
Signed-o
 - Jameson Miller">index);</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">

	if (status)
		return status;

	/* Somebody closed stdout? */
	if (fstat(fileno(stdout), &amp;st))</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
		return 0;</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	/* Ignore write errors for pipes and sockets.. */
	if (S_ISFIFO(st.st_mode) || S_ISSOCK(st.st_mode))</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
		return 0;</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">

	/* Check for ENOSPC and EIO errors.. */</a><a data-author="Linus Torvalds" data-commit="0227f9887bcc158dcd22ac4f60e5e428b259dd2d" data-file="git.c" href="https://github.com/git/git/commit/0227f9887bcc158dcd22ac4f60e5e428b259dd2d" target="blank" title="git: Try a bit harder not to lose errno in stdio

This switches the checks around upon the exit codepath of the
git wrapper, so that we may recover at least non-transient errors.

It's still not perfect. As I've been harping on, stdio simply isn't very
good for error reporting. For example, if an IO error happened, you'd want
to see EIO, wouldn't you? And yes, that's what the kernel would return.
However, with buffered stdio (and flushing outside of our control), what
would likely happen is that some intermediate error return _does_ return
EIO, but then the kernel might decide to re-mount the 
 - Linus Torvalds">
	if (fflush(stdout))</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
		die</a><a data-author="Thomas Rast" data-commit="d824cbba02a4061400a0e382f9bd241fbbff34f0" data-file="git.c" href="https://github.com/git/git/commit/d824cbba02a4061400a0e382f9bd241fbbff34f0" target="blank" title="Convert existing die(..., strerror(errno)) to die_errno()

Change calls to die(..., strerror(errno)) to use the new die_errno().

In the process, also make slight style adjustments: at least state
_something_ about the function that failed (instead of just printing
the pathname), and put paths in single quotes.

Signed-off-by: Thomas Rast &lt;trast@student.ethz.ch&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thomas Rast">_errno</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">("write failure on standard output")</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">;
	if (ferror(stdout))
		die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">("</a><a data-author="Linus Torvalds" data-commit="0227f9887bcc158dcd22ac4f60e5e428b259dd2d" data-file="git.c" href="https://github.com/git/git/commit/0227f9887bcc158dcd22ac4f60e5e428b259dd2d" target="blank" title="git: Try a bit harder not to lose errno in stdio

This switches the checks around upon the exit codepath of the
git wrapper, so that we may recover at least non-transient errors.

It's still not perfect. As I've been harping on, stdio simply isn't very
good for error reporting. For example, if an IO error happened, you'd want
to see EIO, wouldn't you? And yes, that's what the kernel would return.
However, with buffered stdio (and flushing outside of our control), what
would likely happen is that some intermediate error return _does_ return
EIO, but then the kernel might decide to re-mount the 
 - Linus Torvalds">unknown</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> write failure on standard output")</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Linus Torvalds" data-commit="0f157315a1020fce76fe2c5a703e40684b9b1699" data-file="git.c" href="https://github.com/git/git/commit/0f157315a1020fce76fe2c5a703e40684b9b1699" target="blank" title="Check for IO errors after running a command

This is trying to implement the strict IO error checks that Jim Meyering
suggested, but explicitly limits it to just regular files. If a pipe gets
closed on us, we shouldn't complain about it.

If the subcommand already returned an error, that takes precedence (and we
assume that the subcommand already printed out any relevant messages
relating to it)

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">;
	if (fclose(stdout))</a><a data-author="Linus Torvalds" data-commit="0227f9887bcc158dcd22ac4f60e5e428b259dd2d" data-file="git.c" href="https://github.com/git/git/commit/0227f9887bcc158dcd22ac4f60e5e428b259dd2d" target="blank" title="git: Try a bit harder not to lose errno in stdio

This switches the checks around upon the exit codepath of the
git wrapper, so that we may recover at least non-transient errors.

It's still not perfect. As I've been harping on, stdio simply isn't very
good for error reporting. For example, if an IO error happened, you'd want
to see EIO, wouldn't you? And yes, that's what the kernel would return.
However, with buffered stdio (and flushing outside of our control), what
would likely happen is that some intermediate error return _does_ return
EIO, but then the kernel might decide to re-mount the 
 - Linus Torvalds">
		die</a><a data-author="Thomas Rast" data-commit="d824cbba02a4061400a0e382f9bd241fbbff34f0" data-file="git.c" href="https://github.com/git/git/commit/d824cbba02a4061400a0e382f9bd241fbbff34f0" target="blank" title="Convert existing die(..., strerror(errno)) to die_errno()

Change calls to die(..., strerror(errno)) to use the new die_errno().

In the process, also make slight style adjustments: at least state
_something_ about the function that failed (instead of just printing
the pathname), and put paths in single quotes.

Signed-off-by: Thomas Rast &lt;trast@student.ethz.ch&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thomas Rast">_errno</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Linus Torvalds" data-commit="0227f9887bcc158dcd22ac4f60e5e428b259dd2d" data-file="git.c" href="https://github.com/git/git/commit/0227f9887bcc158dcd22ac4f60e5e428b259dd2d" target="blank" title="git: Try a bit harder not to lose errno in stdio

This switches the checks around upon the exit codepath of the
git wrapper, so that we may recover at least non-transient errors.

It's still not perfect. As I've been harping on, stdio simply isn't very
good for error reporting. For example, if an IO error happened, you'd want
to see EIO, wouldn't you? And yes, that's what the kernel would return.
However, with buffered stdio (and flushing outside of our control), what
would likely happen is that some intermediate error return _does_ return
EIO, but then the kernel might decide to re-mount the 
 - Linus Torvalds">("close failed on standard output")</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Linus Torvalds" data-commit="0227f9887bcc158dcd22ac4f60e5e428b259dd2d" data-file="git.c" href="https://github.com/git/git/commit/0227f9887bcc158dcd22ac4f60e5e428b259dd2d" target="blank" title="git: Try a bit harder not to lose errno in stdio

This switches the checks around upon the exit codepath of the
git wrapper, so that we may recover at least non-transient errors.

It's still not perfect. As I've been harping on, stdio simply isn't very
good for error reporting. For example, if an IO error happened, you'd want
to see EIO, wouldn't you? And yes, that's what the kernel would return.
However, with buffered stdio (and flushing outside of our control), what
would likely happen is that some intermediate error return _does_ return
EIO, but then the kernel might decide to re-mount the 
 - Linus Torvalds">;</a><a data-author="Junio C Hamano" data-commit="3eefc189172b88dece6fb6d479b3ed13cc483dbc" data-file="git.c" href="https://github.com/git/git/commit/3eefc189172b88dece6fb6d479b3ed13cc483dbc" target="blank" title="Tentative built-in format-patch.

This only does --stdout right now.  To write into separate files
with pretty-printed filenames like the real thing does, it needs
a bit mroe work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	return 0;</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
}</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

static struct cmd_struct commands[] = {</a><a data-author="Linus Torvalds" data-commit="0d78153952e70c21e94dc6b7eefcb2ac5337a902" data-file="git.c" href="https://github.com/git/git/commit/0d78153952e70c21e94dc6b7eefcb2ac5337a902" target="blank" title="Do "git add" as a builtin

First try. Let's see how well this works.

In many ways, the hard parts of "git commit" are not so different from
this, and a builtin commit would share a lot of the code, I think.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	{ "add", cmd_add</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce"> |</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano"> NEED</a><a data-author="Junio C Hamano" data-commit="71dfbf224ff980f4085f75868dc409118418731e" data-file="git.c" href="https://github.com/git/git/commit/71dfbf224ff980f4085f75868dc409118418731e" target="blank" title="Make merge-base a built-in.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="0305b636542c8c137ed7c82fee90db8d3621118c" data-file="git.c" href="https://github.com/git/git/commit/0305b636542c8c137ed7c82fee90db8d3621118c" target="blank" title="Merge branch 'ei/worktree+filter'

* ei/worktree+filter:
  filter-branch: always export GIT_DIR if it is set
  setup_git_directory: fix segfault if repository is found in cwd
  test GIT_WORK_TREE
  extend rev-parse test for --is-inside-work-tree
  Use new semantics of is_bare/inside_git_dir/inside_work_tree
  introduce GIT_WORK_TREE to specify the work tree
  test git rev-parse
  rev-parse: introduce --is-bare-repository
  rev-parse: document --is-inside-git-dir

 - Junio C Hamano">WORK_TREE</a><a data-author="Junio C Hamano" data-commit="71dfbf224ff980f4085f75868dc409118418731e" data-file="git.c" href="https://github.com/git/git/commit/71dfbf224ff980f4085f75868dc409118418731e" target="blank" title="Make merge-base a built-in.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="5135d1c3d2a2c8c6c9701bd0cbcf57ce587f750d" data-file="git.c" href="https://github.com/git/git/commit/5135d1c3d2a2c8c6c9701bd0cbcf57ce587f750d" target="blank" title="Merge branch 'nd/clear-gitenv-upon-use-of-alias'

d95138e6 (setup: set env $GIT_WORK_TREE when work tree is set, like
$GIT_DIR, 2015-06-26) attempted to work around a glitch in alias
handling by overwriting GIT_WORK_TREE environment variable to
affect subprocesses when set_git_work_tree() gets called, which
resulted in a rather unpleasant regression to "clone" and "init".
Try to address the same issue by always restoring the environment
and respawning the real underlying command when handling alias.

* nd/clear-gitenv-upon-use-of-alias:
  run-command: don't warn on SIGPIPE deaths
  git.c: make
 - Junio C Hamano">
	{ "am", cmd_am, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Ryan Anderson" data-commit="f789e347465dded7fcec3a605473fa3f549792d8" data-file="git.c" href="https://github.com/git/git/commit/f789e347465dded7fcec3a605473fa3f549792d8" target="blank" title="Remove git-annotate.perl and create a builtin-alias for git-blame

Signed-off-by: Ryan Anderson &lt;ryan@michonline.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Ryan Anderson">
	{ "annotate", cmd_annotate,</a><a data-author="Junio C Hamano" data-commit="5b6dedd6a0b7566f7e8466b6aefe8f019c52f5d3" data-file="git.c" href="https://github.com/git/git/commit/5b6dedd6a0b7566f7e8466b6aefe8f019c52f5d3" target="blank" title="annotate: make it work from subdirectories.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Ryan Anderson" data-commit="f789e347465dded7fcec3a605473fa3f549792d8" data-file="git.c" href="https://github.com/git/git/commit/f789e347465dded7fcec3a605473fa3f549792d8" target="blank" title="Remove git-annotate.perl and create a builtin-alias for git-blame

Signed-off-by: Ryan Anderson &lt;ryan@michonline.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Ryan Anderson"> },</a><a data-author="Peter Eriksen" data-commit="ac6245e31a359200b65bfdd910bba9a0fbe90c11" data-file="git.c" href="https://github.com/git/git/commit/ac6245e31a359200b65bfdd910bba9a0fbe90c11" target="blank" title="Builtin git-apply.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "apply", cmd_apply</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="d1ea896290629185dc0bf4efa3469b410bd41313" data-file="git.c" href="https://github.com/git/git/commit/d1ea896290629185dc0bf4efa3469b410bd41313" target="blank" title="apply: run setup_git_directory_gently() sooner

As v1.7.2~16^2 (2010-07-14) explains, without this change,
“git --paginate apply” can ignore the repository-local
“[core] pager” configuration.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Peter Eriksen" data-commit="ac6245e31a359200b65bfdd910bba9a0fbe90c11" data-file="git.c" href="https://github.com/git/git/commit/ac6245e31a359200b65bfdd910bba9a0fbe90c11" target="blank" title="Builtin git-apply.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="51ce34b9923d9b119ac53414584f80e05520abea" data-file="git.c" href="https://github.com/git/git/commit/51ce34b9923d9b119ac53414584f80e05520abea" target="blank" title="Builtin git-show-branch.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Jeff King" data-commit="c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" data-file="git.c" href="https://github.com/git/git/commit/c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" target="blank" title="git-commit.sh: convert run_status to a C builtin

This creates a new git-runstatus which should do roughly the same thing
as the run_status function from git-commit.sh. Except for color support,
the main focus has been to keep the output identical, so that it can be
verified as correct and then used as a C platform for other improvements to
the status printing code.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Jeff King">
	{ "</a><a data-author="Franck Bui-Huu" data-commit="4df096a5ca24f2f39042c51cf51b8a2bec66a2b5" data-file="git.c" href="https://github.com/git/git/commit/4df096a5ca24f2f39042c51cf51b8a2bec66a2b5" target="blank" title="Add git-archive

git-archive is a command to make TAR and ZIP archives of a git tree.
It helps prevent a proliferation of git-{format}-tree commands.

Instead of directly calling git-{tar,zip}-tree command, it defines
a very simple API, that archiver should implement and register in
"git-archive.c". This API is made up by 2 functions whose prototype
is defined in "archive.h" file.

 - The first one is used to parse 'extra' parameters which have
   signification only for the specific archiver. That would allow
   different archive backends to have different kind of options.

 - The second one i
 - Franck Bui-Huu">archive</a><a data-author="Jeff King" data-commit="c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" data-file="git.c" href="https://github.com/git/git/commit/c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" target="blank" title="git-commit.sh: convert run_status to a C builtin

This creates a new git-runstatus which should do roughly the same thing
as the run_status function from git-commit.sh. Except for color support,
the main focus has been to keep the output identical, so that it can be
verified as correct and then used as a C platform for other improvements to
the status printing code.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Jeff King">", cmd_</a><a data-author="Franck Bui-Huu" data-commit="4df096a5ca24f2f39042c51cf51b8a2bec66a2b5" data-file="git.c" href="https://github.com/git/git/commit/4df096a5ca24f2f39042c51cf51b8a2bec66a2b5" target="blank" title="Add git-archive

git-archive is a command to make TAR and ZIP archives of a git tree.
It helps prevent a proliferation of git-{format}-tree commands.

Instead of directly calling git-{tar,zip}-tree command, it defines
a very simple API, that archiver should implement and register in
"git-archive.c". This API is made up by 2 functions whose prototype
is defined in "archive.h" file.

 - The first one is used to parse 'extra' parameters which have
   signification only for the specific archiver. That would allow
   different archive backends to have different kind of options.

 - The second one i
 - Franck Bui-Huu">archive</a><a data-author="Junio C Hamano" data-commit="eb0224c617ba6b4299f2a9f85d6c4b3b5e10abc0" data-file="git.c" href="https://github.com/git/git/commit/eb0224c617ba6b4299f2a9f85d6c4b3b5e10abc0" target="blank" title="archive: read local configuration

Since b9605bc4f2 ("config: only read .git/config from configured
repos", 2016-09-12), we do not read from ".git/config" unless we
know we are in a repository.  "git archive" however didn't do the
repository discovery and instead relied on the old behaviour.

Teach the command to run a "gentle" version of repository discovery
so that local configuration variables are honoured.

[jc: stole tests from peff]
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">, RUN_SETUP_GENTLY</a><a data-author="Jeff King" data-commit="c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" data-file="git.c" href="https://github.com/git/git/commit/c91f0d92efb36d7b349f586cafafaf0e6ac3f5b2" target="blank" title="git-commit.sh: convert run_status to a C builtin

This creates a new git-runstatus which should do roughly the same thing
as the run_status function from git-commit.sh. Except for color support,
the main focus has been to keep the output identical, so that it can be
verified as correct and then used as a C platform for other improvements to
the status printing code.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Jeff King"> },</a><a data-author="Christian Couder" data-commit="1bf072e3661eeef8d9721079a332e804b5678c7e" data-file="git.c" href="https://github.com/git/git/commit/1bf072e3661eeef8d9721079a332e804b5678c7e" target="blank" title="bisect--helper: implement "git bisect--helper"

This patch implements a new "git bisect--helper" builtin plumbing
command that will be used to migrate "git-bisect.sh" to C.

We start by implementing only the "--next-vars" option that will
read bisect refs from "refs/bisect/", and then compute the next
bisect step, and output shell variables ready to be eval'ed by
the shell.

At this step, "git bisect--helper" ignores the paths that may
have been put in "$GIT_DIR/BISECT_NAMES". This will be fixed in a
later patch.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C
 - Christian Couder">
	{ "bisect</a><a data-author="Junio C Hamano" data-commit="6e353a5e5de9da021c7c6c0bc2dc5f95a39900a1" data-file="git.c" href="https://github.com/git/git/commit/6e353a5e5de9da021c7c6c0bc2dc5f95a39900a1" target="blank" title="Merge branch 'cc/bisect-filter'

* cc/bisect-filter: (21 commits)
  rev-list: add "int bisect_show_flags" in "struct rev_list_info"
  rev-list: remove last static vars used in "show_commit"
  list-objects: add "void *data" parameter to show functions
  bisect--helper: string output variables together with "&amp;&amp;"
  rev-list: pass "int flags" as last argument of "show_bisect_vars"
  t6030: test bisecting with paths
  bisect: use "bisect--helper" and remove "filter_skipped" function
  bisect: implement "read_bisect_paths" to read paths in "$GIT_DIR/BISECT_NAMES"
  bisect--helper: implement "git bis
 - Junio C Hamano">--</a><a data-author="Christian Couder" data-commit="1bf072e3661eeef8d9721079a332e804b5678c7e" data-file="git.c" href="https://github.com/git/git/commit/1bf072e3661eeef8d9721079a332e804b5678c7e" target="blank" title="bisect--helper: implement "git bisect--helper"

This patch implements a new "git bisect--helper" builtin plumbing
command that will be used to migrate "git-bisect.sh" to C.

We start by implementing only the "--next-vars" option that will
read bisect refs from "refs/bisect/", and then compute the next
bisect step, and output shell variables ready to be eval'ed by
the shell.

At this step, "git bisect--helper" ignores the paths that may
have been put in "$GIT_DIR/BISECT_NAMES". This will be fixed in a
later patch.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C
 - Christian Couder">helper", cmd_bisect__helper, RUN_SETUP</a><a data-author="Junio C Hamano" data-commit="6e353a5e5de9da021c7c6c0bc2dc5f95a39900a1" data-file="git.c" href="https://github.com/git/git/commit/6e353a5e5de9da021c7c6c0bc2dc5f95a39900a1" target="blank" title="Merge branch 'cc/bisect-filter'

* cc/bisect-filter: (21 commits)
  rev-list: add "int bisect_show_flags" in "struct rev_list_info"
  rev-list: remove last static vars used in "show_commit"
  list-objects: add "void *data" parameter to show functions
  bisect--helper: string output variables together with "&amp;&amp;"
  rev-list: pass "int flags" as last argument of "show_bisect_vars"
  t6030: test bisecting with paths
  bisect: use "bisect--helper" and remove "filter_skipped" function
  bisect: implement "read_bisect_paths" to read paths in "$GIT_DIR/BISECT_NAMES"
  bisect--helper: implement "git bis
 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="24ad8e0ce23d08d28a5d664ab6164b10125146ce" data-file="git.c" href="https://github.com/git/git/commit/24ad8e0ce23d08d28a5d664ab6164b10125146ce" target="blank" title="Merge branch 'jc/pickaxe'

 - Junio C Hamano">
	{ "</a><a data-author="Junio C Hamano" data-commit="acca687fa9db8eaa380b65d63c3f0d4364892acf" data-file="git.c" href="https://github.com/git/git/commit/acca687fa9db8eaa380b65d63c3f0d4364892acf" target="blank" title="git-pickaxe: retire pickaxe

Just make it take over blame's place.  Documentation and command
have all stopped mentioning "git-pickaxe".  The built-in synonym
is left in the command table, so you can still say "git pickaxe",
but it probably is a good idea to retire it as well.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">blame</a><a data-author="Junio C Hamano" data-commit="24ad8e0ce23d08d28a5d664ab6164b10125146ce" data-file="git.c" href="https://github.com/git/git/commit/24ad8e0ce23d08d28a5d664ab6164b10125146ce" target="blank" title="Merge branch 'jc/pickaxe'

 - Junio C Hamano">", cmd_</a><a data-author="Junio C Hamano" data-commit="acca687fa9db8eaa380b65d63c3f0d4364892acf" data-file="git.c" href="https://github.com/git/git/commit/acca687fa9db8eaa380b65d63c3f0d4364892acf" target="blank" title="git-pickaxe: retire pickaxe

Just make it take over blame's place.  Documentation and command
have all stopped mentioning "git-pickaxe".  The built-in synonym
is left in the command table, so you can still say "git pickaxe",
but it probably is a good idea to retire it as well.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">blame</a><a data-author="Junio C Hamano" data-commit="24ad8e0ce23d08d28a5d664ab6164b10125146ce" data-file="git.c" href="https://github.com/git/git/commit/24ad8e0ce23d08d28a5d664ab6164b10125146ce" target="blank" title="Merge branch 'jc/pickaxe'

 - Junio C Hamano">, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="cee7f245dcaef6dade28464f59420095a9949aac" data-file="git.c" href="https://github.com/git/git/commit/cee7f245dcaef6dade28464f59420095a9949aac" target="blank" title="git-pickaxe: blame rewritten.

Currently it does what git-blame does, but only faster.

More importantly, its internal structure is designed to support
content movement (aka cut-and-paste) more easily by allowing
more than one paths to be taken from the same commit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "</a><a data-author="Lars Hjemli" data-commit="c31820c26b8f164433e67d28c403ca0df0316055" data-file="git.c" href="https://github.com/git/git/commit/c31820c26b8f164433e67d28c403ca0df0316055" target="blank" title="Make git-branch a builtin

This replaces git-branch.sh with builtin-branch.c

The changes is basically a patch from Kristian H�gsberg, updated
to apply onto current 'next'

Signed-off-by: Lars Hjemli &lt;hjemli@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lars Hjemli">branch</a><a data-author="Junio C Hamano" data-commit="cee7f245dcaef6dade28464f59420095a9949aac" data-file="git.c" href="https://github.com/git/git/commit/cee7f245dcaef6dade28464f59420095a9949aac" target="blank" title="git-pickaxe: blame rewritten.

Currently it does what git-blame does, but only faster.

More importantly, its internal structure is designed to support
content movement (aka cut-and-paste) more easily by allowing
more than one paths to be taken from the same commit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">", cmd_</a><a data-author="Lars Hjemli" data-commit="c31820c26b8f164433e67d28c403ca0df0316055" data-file="git.c" href="https://github.com/git/git/commit/c31820c26b8f164433e67d28c403ca0df0316055" target="blank" title="Make git-branch a builtin

This replaces git-branch.sh with builtin-branch.c

The changes is basically a patch from Kristian H�gsberg, updated
to apply onto current 'next'

Signed-off-by: Lars Hjemli &lt;hjemli@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lars Hjemli">branch</a><a data-author="Junio C Hamano" data-commit="1da1b3a3e06fdcbbd0b154a6930fc0261a5ee866" data-file="git.c" href="https://github.com/git/git/commit/1da1b3a3e06fdcbbd0b154a6930fc0261a5ee866" target="blank" title="branch: work in subdirectories.

Noticed by Andy Whitcroft

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">, RUN_SETUP</a><a data-author="Martin Ågren" data-commit="d74b541e0b40be0bf35e836bd8c6cbf653283d4b" data-file="git.c" href="https://github.com/git/git/commit/d74b541e0b40be0bf35e836bd8c6cbf653283d4b" target="blank" title="branch: respect `pager.branch` in list-mode only

Similar to de121ffe5 (tag: respect `pager.tag` in list-mode only,
2017-08-02), use the DELAY_PAGER_CONFIG-mechanism to only respect
`pager.branch` when we are listing branches.

We have two possibilities of generalizing what that earlier commit made
to `git tag`. One is to interpret, e.g., --set-upstream-to as "it does
not use an editor, so we should page". Another, the one taken by this
commit, is to say "it does not list, so let's not page". That is in line
with the approach of the series on `pager.tag` and in particular the
wording in Docume
 - Martin Ågren"> | DELAY_PAGER_CONFIG</a><a data-author="Junio C Hamano" data-commit="cee7f245dcaef6dade28464f59420095a9949aac" data-file="git.c" href="https://github.com/git/git/commit/cee7f245dcaef6dade28464f59420095a9949aac" target="blank" title="git-pickaxe: blame rewritten.

Currently it does what git-blame does, but only faster.

More importantly, its internal structure is designed to support
content movement (aka cut-and-paste) more easily by allowing
more than one paths to be taken from the same commit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="4a164d48df6bb1b4a771741c63d4437fd2dca0bb" data-file="git.c" href="https://github.com/git/git/commit/4a164d48df6bb1b4a771741c63d4437fd2dca0bb" target="blank" title="Merge branch 'jc/merge-base' (early part)

This contains an evil merge to fast-import, in order to
resolve in_merge_bases() update.

 - Junio C Hamano">
	{ "</a><a data-author="Johannes Schindelin" data-commit="2e0afafebd8c5a1a8cdddb0714073461229ecfef" data-file="git.c" href="https://github.com/git/git/commit/2e0afafebd8c5a1a8cdddb0714073461229ecfef" target="blank" title="Add git-bundle: move objects and references by archive

Some workflows require use of repositories on machines that cannot be
connected, preventing use of git-fetch / git-push to transport objects and
references between the repositories.

git-bundle provides an alternate transport mechanism, effectively allowing
git-fetch and git-pull to operate using sneakernet transport. `git-bundle
create` allows the user to create a bundle containing one or more branches
or tags, but with specified basis assumed to exist on the target
repository. At the receiving end, git-bundle acts like git-fetch-pack,
a
 - Johannes Schindelin">bundle</a><a data-author="Junio C Hamano" data-commit="4a164d48df6bb1b4a771741c63d4437fd2dca0bb" data-file="git.c" href="https://github.com/git/git/commit/4a164d48df6bb1b4a771741c63d4437fd2dca0bb" target="blank" title="Merge branch 'jc/merge-base' (early part)

This contains an evil merge to fast-import, in order to
resolve in_merge_bases() update.

 - Junio C Hamano">", cmd_</a><a data-author="Johannes Schindelin" data-commit="2e0afafebd8c5a1a8cdddb0714073461229ecfef" data-file="git.c" href="https://github.com/git/git/commit/2e0afafebd8c5a1a8cdddb0714073461229ecfef" target="blank" title="Add git-bundle: move objects and references by archive

Some workflows require use of repositories on machines that cannot be
connected, preventing use of git-fetch / git-push to transport objects and
references between the repositories.

git-bundle provides an alternate transport mechanism, effectively allowing
git-fetch and git-pull to operate using sneakernet transport. `git-bundle
create` allows the user to create a bundle containing one or more branches
or tags, but with specified basis assumed to exist on the target
repository. At the receiving end, git-bundle acts like git-fetch-pack,
a
 - Johannes Schindelin">bundle</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="2cb60093e6c6b53cfc8ffe75f697386a1adab778" data-file="git.c" href="https://github.com/git/git/commit/2cb60093e6c6b53cfc8ffe75f697386a1adab778" target="blank" title="bundle: run setup_git_directory_gently() sooner

Without this change, “git -p bundle” does not always
respect the repository-local “[core] pager” setting.

It is hard to notice because subcommands other than
“git bundle unbundle” do not produce much output.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="4a164d48df6bb1b4a771741c63d4437fd2dca0bb" data-file="git.c" href="https://github.com/git/git/commit/4a164d48df6bb1b4a771741c63d4437fd2dca0bb" target="blank" title="Merge branch 'jc/merge-base' (early part)

This contains an evil merge to fast-import, in order to
resolve in_merge_bases() update.

 - Junio C Hamano"> },</a><a data-author="Timo Hirvonen" data-commit="f81daefe56b3c97b93a851e1ada14eeca0dea47a" data-file="git.c" href="https://github.com/git/git/commit/f81daefe56b3c97b93a851e1ada14eeca0dea47a" target="blank" title="Builtin git-cat-file

Signed-off-by: Timo Hirvonen &lt;tihirvon@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Timo Hirvonen">
	{ "cat-file", cmd_cat_file</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Timo Hirvonen" data-commit="f81daefe56b3c97b93a851e1ada14eeca0dea47a" data-file="git.c" href="https://github.com/git/git/commit/f81daefe56b3c97b93a851e1ada14eeca0dea47a" target="blank" title="Builtin git-cat-file

Signed-off-by: Timo Hirvonen &lt;tihirvon@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Timo Hirvonen"> }</a><a data-author="Christian Couder" data-commit="895f10c3b596ef955c7f252717e5b4668530c569" data-file="git.c" href="https://github.com/git/git/commit/895f10c3b596ef955c7f252717e5b4668530c569" target="blank" title="Builtin git-rev-parse.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Christian Couder">,</a><a data-author="Junio C Hamano" data-commit="d0bfd026a8241d544c339944976927b388d61a5e" data-file="git.c" href="https://github.com/git/git/commit/d0bfd026a8241d544c339944976927b388d61a5e" target="blank" title="Add basic infrastructure to assign attributes to paths

This adds the basic infrastructure to assign attributes to
paths, in a way similar to what the exclusion mechanism does
based on $GIT_DIR/info/exclude and .gitignore files.

An attribute is just a simple string that does not contain any
whitespace.  They can be specified in $GIT_DIR/info/attributes
file, and .gitattributes file in each directory.

Each line in these files defines a pattern matching rule.
Similar to the exclusion mechanism, a later match overrides an
earlier match in the same file, and entries from .gitattributes
file in t
 - Junio C Hamano">
	{ "check-attr", cmd_check_attr, RUN_SETUP },</a><a data-author="Javier Roucher Iglesias" data-commit="e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" data-file="git.c" href="https://github.com/git/git/commit/e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" target="blank" title="add 'git credential' plumbing command

The credential API is in C, and not available to scripting languages.
Expose the functionalities of the API by wrapping them into a new
plumbing command "git credentials".

In other words, replace the internal "test-credential" by an official Git
command.

Most documentation writen by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Pavel Volek &lt;Pavel.Volek@ensimag.imag.fr&gt;
Signed-off-by: Kim Thuat Nguyen &lt;Kim-Thuat.Nguyen@ensimag.imag.fr&gt;
Signed-off-by: Javier Roucher Iglesias &lt;Javier.Roucher-Iglesias@ensimag.imag.fr&gt;
Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@i
 - Javier Roucher Iglesias">
	{ "</a><a data-author="Adam Spiers" data-commit="368aa52952deb631b38a89837c4abbb00c5261c1" data-file="git.c" href="https://github.com/git/git/commit/368aa52952deb631b38a89837c4abbb00c5261c1" target="blank" title="add git-check-ignore sub-command

This works in a similar manner to git-check-attr.

Thanks to Jeff King and Junio C Hamano for the idea:
http://thread.gmane.org/gmane.comp.version-control.git/108671/focus=108815

Signed-off-by: Adam Spiers &lt;git@adamspiers.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Adam Spiers">check-ignore</a><a data-author="Javier Roucher Iglesias" data-commit="e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" data-file="git.c" href="https://github.com/git/git/commit/e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" target="blank" title="add 'git credential' plumbing command

The credential API is in C, and not available to scripting languages.
Expose the functionalities of the API by wrapping them into a new
plumbing command "git credentials".

In other words, replace the internal "test-credential" by an official Git
command.

Most documentation writen by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Pavel Volek &lt;Pavel.Volek@ensimag.imag.fr&gt;
Signed-off-by: Kim Thuat Nguyen &lt;Kim-Thuat.Nguyen@ensimag.imag.fr&gt;
Signed-off-by: Javier Roucher Iglesias &lt;Javier.Roucher-Iglesias@ensimag.imag.fr&gt;
Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@i
 - Javier Roucher Iglesias">", cmd_</a><a data-author="Adam Spiers" data-commit="368aa52952deb631b38a89837c4abbb00c5261c1" data-file="git.c" href="https://github.com/git/git/commit/368aa52952deb631b38a89837c4abbb00c5261c1" target="blank" title="add git-check-ignore sub-command

This works in a similar manner to git-check-attr.

Thanks to Jeff King and Junio C Hamano for the idea:
http://thread.gmane.org/gmane.comp.version-control.git/108671/focus=108815

Signed-off-by: Adam Spiers &lt;git@adamspiers.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Adam Spiers">check_ignore</a><a data-author="Javier Roucher Iglesias" data-commit="e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" data-file="git.c" href="https://github.com/git/git/commit/e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" target="blank" title="add 'git credential' plumbing command

The credential API is in C, and not available to scripting languages.
Expose the functionalities of the API by wrapping them into a new
plumbing command "git credentials".

In other words, replace the internal "test-credential" by an official Git
command.

Most documentation writen by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Pavel Volek &lt;Pavel.Volek@ensimag.imag.fr&gt;
Signed-off-by: Kim Thuat Nguyen &lt;Kim-Thuat.Nguyen@ensimag.imag.fr&gt;
Signed-off-by: Javier Roucher Iglesias &lt;Javier.Roucher-Iglesias@ensimag.imag.fr&gt;
Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@i
 - Javier Roucher Iglesias">, RUN_SETUP</a><a data-author="Adam Spiers" data-commit="368aa52952deb631b38a89837c4abbb00c5261c1" data-file="git.c" href="https://github.com/git/git/commit/368aa52952deb631b38a89837c4abbb00c5261c1" target="blank" title="add git-check-ignore sub-command

This works in a similar manner to git-check-attr.

Thanks to Jeff King and Junio C Hamano for the idea:
http://thread.gmane.org/gmane.comp.version-control.git/108671/focus=108815

Signed-off-by: Adam Spiers &lt;git@adamspiers.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Adam Spiers"> | NEED</a><a data-author="Javier Roucher Iglesias" data-commit="e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" data-file="git.c" href="https://github.com/git/git/commit/e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" target="blank" title="add 'git credential' plumbing command

The credential API is in C, and not available to scripting languages.
Expose the functionalities of the API by wrapping them into a new
plumbing command "git credentials".

In other words, replace the internal "test-credential" by an official Git
command.

Most documentation writen by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Pavel Volek &lt;Pavel.Volek@ensimag.imag.fr&gt;
Signed-off-by: Kim Thuat Nguyen &lt;Kim-Thuat.Nguyen@ensimag.imag.fr&gt;
Signed-off-by: Javier Roucher Iglesias &lt;Javier.Roucher-Iglesias@ensimag.imag.fr&gt;
Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@i
 - Javier Roucher Iglesias">_</a><a data-author="Adam Spiers" data-commit="368aa52952deb631b38a89837c4abbb00c5261c1" data-file="git.c" href="https://github.com/git/git/commit/368aa52952deb631b38a89837c4abbb00c5261c1" target="blank" title="add git-check-ignore sub-command

This works in a similar manner to git-check-attr.

Thanks to Jeff King and Junio C Hamano for the idea:
http://thread.gmane.org/gmane.comp.version-control.git/108671/focus=108815

Signed-off-by: Adam Spiers &lt;git@adamspiers.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Adam Spiers">WORK_TREE</a><a data-author="Javier Roucher Iglesias" data-commit="e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" data-file="git.c" href="https://github.com/git/git/commit/e30b2feb1b50c2d14d32dc3e6e41f7b20a677ff2" target="blank" title="add 'git credential' plumbing command

The credential API is in C, and not available to scripting languages.
Expose the functionalities of the API by wrapping them into a new
plumbing command "git credentials".

In other words, replace the internal "test-credential" by an official Git
command.

Most documentation writen by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Pavel Volek &lt;Pavel.Volek@ensimag.imag.fr&gt;
Signed-off-by: Kim Thuat Nguyen &lt;Kim-Thuat.Nguyen@ensimag.imag.fr&gt;
Signed-off-by: Javier Roucher Iglesias &lt;Javier.Roucher-Iglesias@ensimag.imag.fr&gt;
Signed-off-by: Matthieu Moy &lt;Matthieu.Moy@i
 - Javier Roucher Iglesias"> },</a><a data-author="Eric Sunshine" data-commit="226ad3482ac506af0eadd04e732dda556fda80e4" data-file="git.c" href="https://github.com/git/git/commit/226ad3482ac506af0eadd04e732dda556fda80e4" target="blank" title="builtin: add git-check-mailmap command

Introduce command check-mailmap, similar to check-attr and check-ignore,
which allows direct testing of .mailmap configuration.

As plumbing accessible to scripts and other porcelain, check-mailmap
publishes the stable, well-tested .mailmap functionality employed by
built-in Git commands.  Consequently, script authors need not
re-implement .mailmap functionality manually, thus avoiding potential
quirks and behavioral differences.

Signed-off-by: Eric Sunshine &lt;sunshine@sunshineco.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Eric Sunshine">
	{ "check-mailmap", cmd_check_mailmap, RUN_SETUP },</a><a data-author="Lukas Sandström" data-commit="9370bae2cef351617272aa142fbe4ce039833d13" data-file="git.c" href="https://github.com/git/git/commit/9370bae2cef351617272aa142fbe4ce039833d13" target="blank" title="Make git-check-format-ref a builtin.

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "check-ref-format", cmd_check_ref_format</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Lukas Sandström" data-commit="9370bae2cef351617272aa142fbe4ce039833d13" data-file="git.c" href="https://github.com/git/git/commit/9370bae2cef351617272aa142fbe4ce039833d13" target="blank" title="Make git-check-format-ref a builtin.

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">  }</a><a data-author="Peter Eriksen" data-commit="0864f26421b3c599b462bc867de948d14b268d76" data-file="git.c" href="https://github.com/git/git/commit/0864f26421b3c599b462bc867de948d14b268d76" target="blank" title="Builtin git-ls-files.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Daniel Barkalow" data-commit="782c2d65c24066a5d83453efb52763bc34c10f81" data-file="git.c" href="https://github.com/git/git/commit/782c2d65c24066a5d83453efb52763bc34c10f81" target="blank" title="Build in checkout

The only differences in behavior should be:

 - git checkout -m with non-trivial merging won't print out
   merge-recursive messages (see the change in t7201-co.sh)

 - git checkout -- paths... will give a sensible error message if
   HEAD is invalid as a commit.

 - some intermediate states which were written to disk in the shell
   version (in particular, index states) are only kept in memory in
   this version, and therefore these can no longer be revealed by
   later write operations becoming impossible.

 - when we change branches, we discard MERGE_MSG, SQUASH_MSG, and

 - Daniel Barkalow">
	{ "checkout", cmd_checkout, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Junio C Hamano" data-commit="e414156ab6e7869b29622ee3439e3c91361f5b0e" data-file="git.c" href="https://github.com/git/git/commit/e414156ab6e7869b29622ee3439e3c91361f5b0e" target="blank" title="Make git-checkout-index a builtin

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "checkout-index", cmd_checkout_index,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		RUN</a><a data-author="Junio C Hamano" data-commit="e414156ab6e7869b29622ee3439e3c91361f5b0e" data-file="git.c" href="https://github.com/git/git/commit/e414156ab6e7869b29622ee3439e3c91361f5b0e" target="blank" title="Make git-checkout-index a builtin

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Johannes Schindelin" data-commit="4465f410d6a8fa7abc5436aac6f58196f2b618d8" data-file="git.c" href="https://github.com/git/git/commit/4465f410d6a8fa7abc5436aac6f58196f2b618d8" target="blank" title="checkout-index needs a working tree

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Johannes Schindelin"> | NEED_WORK_TREE</a><a data-author="Junio C Hamano" data-commit="e414156ab6e7869b29622ee3439e3c91361f5b0e" data-file="git.c" href="https://github.com/git/git/commit/e414156ab6e7869b29622ee3439e3c91361f5b0e" target="blank" title="Make git-checkout-index a builtin

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">},</a><a data-author="Junio C Hamano" data-commit="56532fa147d56057ad4121f5ccea8e254748afdd" data-file="git.c" href="https://github.com/git/git/commit/56532fa147d56057ad4121f5ccea8e254748afdd" target="blank" title="Merge branch 'rs/cherry'

* rs/cherry:
  Make git-cherry handle root trees
  Built-in cherry

 - Junio C Hamano">
	{ "cherry", cmd_cherry, RUN_SETUP },</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	{ "cherry-pick", cmd_cherry_pick, RUN_SETUP |</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer"> NEED</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">WORK_TREE</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> },</a><a data-author="Shawn Bohrer" data-commit="113f10f22f4b3b599e44e192e241e0bace9cc39e" data-file="git.c" href="https://github.com/git/git/commit/113f10f22f4b3b599e44e192e241e0bace9cc39e" target="blank" title="Make git-clean a builtin

This replaces git-clean.sh with builtin-clean.c, and moves
git-clean.sh to the examples.

This also introduces a change in behavior when removing directories
explicitly specified as a path.  For example currently:

1. When dir has only untracked files, these two behave differently:

    $ git clean -n dir
    $ git clean -n dir/

the former says "Would not remove dir/", while the latter would say
"Would remove dir/untracked" for all paths under it, but not the
directory itself.

With -d, the former would stop refusing, however since the user
explicitly asked to remove
 - Shawn Bohrer">
	{ "clean", cmd_clean, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Daniel Barkalow" data-commit="8434c2f1afedb936e0ea8c07ce25733013c2f743" data-file="git.c" href="https://github.com/git/git/commit/8434c2f1afedb936e0ea8c07ce25733013c2f743" target="blank" title="Build in clone

Thanks to Johannes Schindelin for various comments and improvements,
including supporting cloning full bundles.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow">
	{ "clone", cmd_clone },</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="7e29b8254f08af820b2f0c3770836638ffe517ab" data-file="git.c" href="https://github.com/git/git/commit/7e29b8254f08af820b2f0c3770836638ffe517ab" target="blank" title="Add column layout skeleton and git-column

A column option string consists of many token separated by either
a space or a  comma. A token belongs to one of three groups:

 - enabling: always, never and auto
 - layout mode: currently plain (which does not layout at all)
 - other future tuning flags

git-column can be used to pipe output to from a command that wants
column layout, but not to mess with its own output code. Simpler output
code can be changed to use column layout code directly.

Thanks-to: Ramsay Jones &lt;ramsay@ramsay1.demon.co.uk&gt;
Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.
 - Nguyễn Thái Ngọc Duy">
	{ "column", cmd</a><a data-author="Junio C Hamano" data-commit="f4ed0af6e2762bc43de474d1fcaa2863b00268eb" data-file="git.c" href="https://github.com/git/git/commit/f4ed0af6e2762bc43de474d1fcaa2863b00268eb" target="blank" title="Merge branch 'nd/columns'

A couple of commands learn --column option to produce columnar output.

By Nguyễn Thái Ngọc Duy (9) and Zbigniew Jędrzejewski-Szmek (1)
* nd/columns:
  tag: add --column
  column: support piping stdout to external git-column process
  status: add --column
  branch: add --column
  help: reuse print_columns() for help -a
  column: add dense layout support
  t9002: work around shells that are unable to set COLUMNS to 1
  column: add columnar layout
  Stop starting pager recursively
  Add column layout skeleton and git-column

 - Junio C Hamano">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="7e29b8254f08af820b2f0c3770836638ffe517ab" data-file="git.c" href="https://github.com/git/git/commit/7e29b8254f08af820b2f0c3770836638ffe517ab" target="blank" title="Add column layout skeleton and git-column

A column option string consists of many token separated by either
a space or a  comma. A token belongs to one of three groups:

 - enabling: always, never and auto
 - layout mode: currently plain (which does not layout at all)
 - other future tuning flags

git-column can be used to pipe output to from a command that wants
column layout, but not to mess with its own output code. Simpler output
code can be changed to use column layout code directly.

Thanks-to: Ramsay Jones &lt;ramsay@ramsay1.demon.co.uk&gt;
Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.
 - Nguyễn Thái Ngọc Duy">column, RUN_SETUP_GENTLY },</a><a data-author="Junio C Hamano" data-commit="b467fb0b909883f28c4653361ccfa530ccf1a03e" data-file="git.c" href="https://github.com/git/git/commit/b467fb0b909883f28c4653361ccfa530ccf1a03e" target="blank" title="Merge branch 'jk/diff'

* jk/diff:
  wt-status: remove extraneous newline from 'deleted:' output
  git-status: document colorization config options
  Teach runstatus about --untracked
  git-commit.sh: convert run_status to a C builtin
  Move color option parsing out of diff.c and into color.[ch]
  diff: support custom callbacks for output

 - Junio C Hamano">
	{ "</a><a data-author="Kristian Høgsberg" data-commit="f5bbc3225c4b073a7ff3218164a0c820299bc9c6" data-file="git.c" href="https://github.com/git/git/commit/f5bbc3225c4b073a7ff3218164a0c820299bc9c6" target="blank" title="Port git commit to C.

This makes git commit a builtin and moves git-commit.sh to
contrib/examples.  This also removes the git-runstatus
helper, which was mostly just a git-status.sh implementation detail.

Signed-off-by: Kristian Høgsberg &lt;krh@redhat.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kristian Høgsberg">commit</a><a data-author="Junio C Hamano" data-commit="b467fb0b909883f28c4653361ccfa530ccf1a03e" data-file="git.c" href="https://github.com/git/git/commit/b467fb0b909883f28c4653361ccfa530ccf1a03e" target="blank" title="Merge branch 'jk/diff'

* jk/diff:
  wt-status: remove extraneous newline from 'deleted:' output
  git-status: document colorization config options
  Teach runstatus about --untracked
  git-commit.sh: convert run_status to a C builtin
  Move color option parsing out of diff.c and into color.[ch]
  diff: support custom callbacks for output

 - Junio C Hamano">", cmd_</a><a data-author="Kristian Høgsberg" data-commit="f5bbc3225c4b073a7ff3218164a0c820299bc9c6" data-file="git.c" href="https://github.com/git/git/commit/f5bbc3225c4b073a7ff3218164a0c820299bc9c6" target="blank" title="Port git commit to C.

This makes git commit a builtin and moves git-commit.sh to
contrib/examples.  This also removes the git-runstatus
helper, which was mostly just a git-status.sh implementation detail.

Signed-off-by: Kristian Høgsberg &lt;krh@redhat.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kristian Høgsberg">commit</a><a data-author="Junio C Hamano" data-commit="b467fb0b909883f28c4653361ccfa530ccf1a03e" data-file="git.c" href="https://github.com/git/git/commit/b467fb0b909883f28c4653361ccfa530ccf1a03e" target="blank" title="Merge branch 'jk/diff'

* jk/diff:
  wt-status: remove extraneous newline from 'deleted:' output
  git-status: document colorization config options
  Teach runstatus about --untracked
  git-commit.sh: convert run_status to a C builtin
  Move color option parsing out of diff.c and into color.[ch]
  diff: support custom callbacks for output

 - Junio C Hamano">, RUN_SETUP</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce"> |</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer"> NEED</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">WORK_TREE</a><a data-author="Junio C Hamano" data-commit="b467fb0b909883f28c4653361ccfa530ccf1a03e" data-file="git.c" href="https://github.com/git/git/commit/b467fb0b909883f28c4653361ccfa530ccf1a03e" target="blank" title="Merge branch 'jk/diff'

* jk/diff:
  wt-status: remove extraneous newline from 'deleted:' output
  git-status: document colorization config options
  Teach runstatus about --untracked
  git-commit.sh: convert run_status to a C builtin
  Move color option parsing out of diff.c and into color.[ch]
  diff: support custom callbacks for output

 - Junio C Hamano"> },</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
	{ "</a><a data-author="Derrick Stolee" data-commit="4ce58ee38de3ab0955b94946bfc339f387227223" data-file="git.c" href="https://github.com/git/git/commit/4ce58ee38de3ab0955b94946bfc339f387227223" target="blank" title="commit-graph: create git-commit-graph builtin

Teach git the 'commit-graph' builtin that will be used for writing and
reading packed graph files. The current implementation is mostly
empty, except for an '--object-dir' option.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">commit</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">-</a><a data-author="Derrick Stolee" data-commit="4ce58ee38de3ab0955b94946bfc339f387227223" data-file="git.c" href="https://github.com/git/git/commit/4ce58ee38de3ab0955b94946bfc339f387227223" target="blank" title="commit-graph: create git-commit-graph builtin

Teach git the 'commit-graph' builtin that will be used for writing and
reading packed graph files. The current implementation is mostly
empty, except for an '--object-dir' option.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">graph</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">", cmd_</a><a data-author="Derrick Stolee" data-commit="4ce58ee38de3ab0955b94946bfc339f387227223" data-file="git.c" href="https://github.com/git/git/commit/4ce58ee38de3ab0955b94946bfc339f387227223" target="blank" title="commit-graph: create git-commit-graph builtin

Teach git the 'commit-graph' builtin that will be used for writing and
reading packed graph files. The current implementation is mostly
empty, except for an '--object-dir' option.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">commit_graph</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_</a><a data-author="Derrick Stolee" data-commit="4ce58ee38de3ab0955b94946bfc339f387227223" data-file="git.c" href="https://github.com/git/git/commit/4ce58ee38de3ab0955b94946bfc339f387227223" target="blank" title="commit-graph: create git-commit-graph builtin

Teach git the 'commit-graph' builtin that will be used for writing and
reading packed graph files. The current implementation is mostly
empty, except for an '--object-dir' option.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">SETUP }</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">,</a><a data-author="Peter Eriksen" data-commit="6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" data-file="git.c" href="https://github.com/git/git/commit/6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" target="blank" title="Builtin git-commit-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "commit-tree", cmd_commit_tree</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Peter Eriksen" data-commit="6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" data-file="git.c" href="https://github.com/git/git/commit/6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" target="blank" title="Builtin git-commit-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="ac6245e31a359200b65bfdd910bba9a0fbe90c11" data-file="git.c" href="https://github.com/git/git/commit/ac6245e31a359200b65bfdd910bba9a0fbe90c11" target="blank" title="Builtin git-apply.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Tom Prince" data-commit="e0d10e1c63bc52b37bbec99b07deee794058d9b4" data-file="git.c" href="https://github.com/git/git/commit/e0d10e1c63bc52b37bbec99b07deee794058d9b4" target="blank" title="[PATCH] Rename git-repo-config to git-config.

Signed-off-by: Tom Prince &lt;tom.prince@ualberta.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Tom Prince">
	{ "config", cmd_config</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="3ba7e6e29afd67e69ff5963d8ed76728824959a0" data-file="git.c" href="https://github.com/git/git/commit/3ba7e6e29afd67e69ff5963d8ed76728824959a0" target="blank" title="config: run setup_git_directory_gently() sooner

For the pager choice (and the choice to paginate) to reflect the
current repository configuration, the repository needs to be
located first.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Martin Ågren" data-commit="32888b8fd56175f52f3139915d931f78d8c4ef89" data-file="git.c" href="https://github.com/git/git/commit/32888b8fd56175f52f3139915d931f78d8c4ef89" target="blank" title="config: respect `pager.config` in list/get-mode only

Similar to de121ffe5 (tag: respect `pager.tag` in list-mode only,
2017-08-02), use the DELAY_PAGER_CONFIG-mechanism to only respect
`pager.config` when we are listing or "get"ing config.

We have several getters and some are guaranteed to give at most one line
of output. Paging all getters including those could be convenient from a
documentation point-of-view. The downside would be that a misconfigured
or not so modern pager might wait for user interaction before
terminating. Let's instead respect the config for precisely those
getters whic
 - Martin Ågren"> | DELAY_PAGER_CONFIG</a><a data-author="Tom Prince" data-commit="e0d10e1c63bc52b37bbec99b07deee794058d9b4" data-file="git.c" href="https://github.com/git/git/commit/e0d10e1c63bc52b37bbec99b07deee794058d9b4" target="blank" title="[PATCH] Rename git-repo-config to git-config.

Signed-off-by: Tom Prince &lt;tom.prince@ualberta.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Tom Prince"> },</a><a data-author="Junio C Hamano" data-commit="d820f918711446a74cc74577f6f2535a78752708" data-file="git.c" href="https://github.com/git/git/commit/d820f918711446a74cc74577f6f2535a78752708" target="blank" title="Merge branch 'jc/count'

* jc/count:
  builtin-count-objects: open packs when running -v
  builtin-count-objects: make it official.
  built-in count-objects.

 - Junio C Hamano">
	{ "count-objects", cmd_count_objects</a><a data-author="Dmitry V. Levin" data-commit="8112894d82637c199294702942cac477b756b678" data-file="git.c" href="https://github.com/git/git/commit/8112894d82637c199294702942cac477b756b678" target="blank" title="Make count-objects, describe and merge-tree work in subdirectory

Call setup_git_directory() to make these commands work in subdirectory.

Signed-off-by: Dmitry V. Levin &lt;ldv@altlinux.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Dmitry V. Levin">, RUN_SETUP</a><a data-author="Junio C Hamano" data-commit="d820f918711446a74cc74577f6f2535a78752708" data-file="git.c" href="https://github.com/git/git/commit/d820f918711446a74cc74577f6f2535a78752708" target="blank" title="Merge branch 'jc/count'

* jc/count:
  builtin-count-objects: open packs when running -v
  builtin-count-objects: make it official.
  built-in count-objects.

 - Junio C Hamano"> },</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	{ "</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano">credential</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">",</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano"> cmd_credential</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">,</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano"> RUN</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">_</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano">SETUP</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">_</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano">GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="a39b15b4f6a3f08b67b17d968935d177821e680f" data-file="git.c" href="https://github.com/git/git/commit/a39b15b4f6a3f08b67b17d968935d177821e680f" target="blank" title="Merge branch 'as/check-ignore'

Add a new command "git check-ignore" for debugging .gitignore
files.

The variable names may want to get cleaned up but that can be done
in-tree.

* as/check-ignore:
  clean.c, ls-files.c: respect encapsulation of exclude_list_groups
  t0008: avoid brace expansion
  add git-check-ignore sub-command
  setup.c: document get_pathspec()
  add.c: extract new die_if_path_beyond_symlink() for reuse
  add.c: extract check_path_for_gitlink() from treat_gitlinks() for reuse
  pathspec.c: rename newly public functions for clarity
  add.c: move pathspec matchers into new pa
 - Junio C Hamano"> }</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">,</a><a data-author="Junio C Hamano" data-commit="e861ce1692fa9809f3e7b898804f8ddaf7cd8975" data-file="git.c" href="https://github.com/git/git/commit/e861ce1692fa9809f3e7b898804f8ddaf7cd8975" target="blank" title="Merge branch 'jc/bare'

* jc/bare:
  Disallow working directory commands in a bare repository.
  git-fetch: allow updating the current branch in a bare repository.
  Introduce is_bare_repository() and core.bare configuration variable
  Move initialization of log_all_ref_updates

 - Junio C Hamano">
	{ "describe", cmd_describe, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="c74320872b445104fe5c265e60785d9d26d94cc5" data-file="git.c" href="https://github.com/git/git/commit/c74320872b445104fe5c265e60785d9d26d94cc5" target="blank" title="built-in count-objects.

Also it learned to do -v (verbose) to report:

	- number of loose objects
	- disk occupied by loose objects
	- number of objects in local packs
	- number of loose objects that are also in pack
	- unrecognised garbage in .git/objects/??/.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "</a><a data-author="Junio C Hamano" data-commit="8ab99476ec2298a43e94949e0bb7aa5125793a28" data-file="git.c" href="https://github.com/git/git/commit/8ab99476ec2298a43e94949e0bb7aa5125793a28" target="blank" title="builtin-diff: call it "git-diff", really.

Call it "git diff" not "git diffn", remove the shell script
version, and hardlink the git binary to it.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">diff</a><a data-author="Junio C Hamano" data-commit="c74320872b445104fe5c265e60785d9d26d94cc5" data-file="git.c" href="https://github.com/git/git/commit/c74320872b445104fe5c265e60785d9d26d94cc5" target="blank" title="built-in count-objects.

Also it learned to do -v (verbose) to report:

	- number of loose objects
	- disk occupied by loose objects
	- number of objects in local packs
	- number of loose objects that are also in pack
	- unrecognised garbage in .git/objects/??/.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">", cmd_</a><a data-author="Junio C Hamano" data-commit="8ab99476ec2298a43e94949e0bb7aa5125793a28" data-file="git.c" href="https://github.com/git/git/commit/8ab99476ec2298a43e94949e0bb7aa5125793a28" target="blank" title="builtin-diff: call it "git-diff", really.

Call it "git diff" not "git diffn", remove the shell script
version, and hardlink the git binary to it.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">diff</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="c74320872b445104fe5c265e60785d9d26d94cc5" data-file="git.c" href="https://github.com/git/git/commit/c74320872b445104fe5c265e60785d9d26d94cc5" target="blank" title="built-in count-objects.

Also it learned to do -v (verbose) to report:

	- number of loose objects
	- disk occupied by loose objects
	- number of objects in local packs
	- number of loose objects that are also in pack
	- unrecognised garbage in .git/objects/??/.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> },</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "diff-files", cmd_diff_files</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="4f38f6b5bafb1f7f85c7b54d0bb0a0e977cd947c" data-file="git.c" href="https://github.com/git/git/commit/4f38f6b5bafb1f7f85c7b54d0bb0a0e977cd947c" target="blank" title="diff*: fix worktree setup

This fixes "git diff", "git diff-files" and "git diff-index" to work
correctly under worktree setup. Because diff* family works in many modes
and not all of them require worktree, Junio made a nice summary
(with a little modification from me):

 * diff-files is about comparing with work tree, so it obviously needs a
  work tree;

 * diff-index also does, except "diff-index --cached" or "diff --cached TREE"

 * no-index is about random files outside git context, so it obviously
   doesn't need any work tree;

 * comparing two (or more) trees doesn't;

 * comparing two
 - Nguyễn Thái Ngọc Duy"> | NEED_WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> },
	{ "diff-index", cmd_diff_index</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> },</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	{ "</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">diff</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">-</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">tree</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">", cmd_diff_tree,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Timo Hirvonen" data-commit="f81daefe56b3c97b93a851e1ada14eeca0dea47a" data-file="git.c" href="https://github.com/git/git/commit/f81daefe56b3c97b93a851e1ada14eeca0dea47a" target="blank" title="Builtin git-cat-file

Signed-off-by: Timo Hirvonen &lt;tihirvon@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Timo Hirvonen">,</a><a data-author="Junio C Hamano" data-commit="b7786bb4b09463641f3e39eca18aefc630ee4f38" data-file="git.c" href="https://github.com/git/git/commit/b7786bb4b09463641f3e39eca18aefc630ee4f38" target="blank" title="Merge branch 'js/difftool-builtin'

Rewrite a scripted porcelain "git difftool" in C.

* js/difftool-builtin:
  difftool: hack around -Wzero-length-format warning
  difftool: retire the scripted version
  difftool: implement the functionality in the builtin
  difftool: add a skeleton for the upcoming builtin

 - Junio C Hamano">
	{ "difftool", cmd_difftool, RUN_SETUP_</a><a data-author="Junio C Hamano" data-commit="b72e90712eb0e802b232ad4c88460d04279c7111" data-file="git.c" href="https://github.com/git/git/commit/b72e90712eb0e802b232ad4c88460d04279c7111" target="blank" title="Merge branch 'js/difftool-no-index'

"git difftool" can now run outside a repository.

* js/difftool-no-index:
  difftool: allow running outside Git worktrees with --no-index
  parse-options: make OPT_ARGUMENT() more useful
  difftool: remove obsolete (and misleading) comment

 - Junio C Hamano">GENTLY</a><a data-author="Junio C Hamano" data-commit="b7786bb4b09463641f3e39eca18aefc630ee4f38" data-file="git.c" href="https://github.com/git/git/commit/b7786bb4b09463641f3e39eca18aefc630ee4f38" target="blank" title="Merge branch 'js/difftool-builtin'

Rewrite a scripted porcelain "git difftool" in C.

* js/difftool-builtin:
  difftool: hack around -Wzero-length-format warning
  difftool: retire the scripted version
  difftool: implement the functionality in the builtin
  difftool: add a skeleton for the upcoming builtin

 - Junio C Hamano"> },</a><a data-author="Johannes Schindelin" data-commit="f2dc849e9c5fe363ad089f6c3f2b7b3d79fd6a6f" data-file="git.c" href="https://github.com/git/git/commit/f2dc849e9c5fe363ad089f6c3f2b7b3d79fd6a6f" target="blank" title="Add 'git fast-export', the sister of 'git fast-import'

This program dumps (parts of) a git repository in the format that
fast-import understands.

For clarity's sake, it does not use the 'inline' method of specifying
blobs in the commits, but builds the blobs before building the commits.

Since signed tags' signatures will not necessarily be valid (think
transformations after the export, or excluding revisions, changing
the history), there are 4 modes to handle them: abort (default),
ignore, warn and strip.  The latter just turns the tags into
unsigned ones.

Signed-off-by: Johannes Schindeli
 - Johannes Schindelin">
	{ "fast-export", cmd_fast_export, RUN_SETUP },</a><a data-author="Daniel Barkalow" data-commit="b888d61c8308027433df9c243fa551f42db1c76a" data-file="git.c" href="https://github.com/git/git/commit/b888d61c8308027433df9c243fa551f42db1c76a" target="blank" title="Make fetch a builtin

Thanks to Johannes Schindelin for review and fixes, and Julian
Phillips for the original C translation.

This changes a few small bits of behavior:

branch.&lt;name&gt;.merge is parsed as if it were the lhs of a fetch
refspec, and does not have to exactly match the actual lhs of a
refspec, so long as it is a valid abbreviation for the same ref.

branch.&lt;name&gt;.merge is no longer ignored if the remote is configured
with a branches/* file. Neither behavior is useful, because there can
only be one ref that gets fetched, but this is more consistant.

Also, fetch prints different inf
 - Daniel Barkalow">
	{ "fetch", cmd_fetch, RUN_SETUP },</a><a data-author="Daniel Barkalow" data-commit="2d4177c01c238071777db5b1fbd8a14efb62ce02" data-file="git.c" href="https://github.com/git/git/commit/2d4177c01c238071777db5b1fbd8a14efb62ce02" target="blank" title="Make fetch-pack a builtin with an internal API

Signed-off-by: Daniel Barkalow &lt;barkalow@iabervon.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow">
	{ "fetch-pack", cmd_fetch_pack, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Daniel Barkalow" data-commit="2d4177c01c238071777db5b1fbd8a14efb62ce02" data-file="git.c" href="https://github.com/git/git/commit/2d4177c01c238071777db5b1fbd8a14efb62ce02" target="blank" title="Make fetch-pack a builtin with an internal API

Signed-off-by: Daniel Barkalow &lt;barkalow@iabervon.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow"> },</a><a data-author="Johannes Schindelin" data-commit="00449f992b629f7f7884fb2cf46ff411a2a4f381" data-file="git.c" href="https://github.com/git/git/commit/00449f992b629f7f7884fb2cf46ff411a2a4f381" target="blank" title="Make git-fmt-merge-msg a builtin

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	{ "fmt-merge-msg", cmd_fmt_merge_msg</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Johannes Schindelin" data-commit="00449f992b629f7f7884fb2cf46ff411a2a4f381" data-file="git.c" href="https://github.com/git/git/commit/00449f992b629f7f7884fb2cf46ff411a2a4f381" target="blank" title="Make git-fmt-merge-msg a builtin

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> }</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">,</a><a data-author="Linus Torvalds" data-commit="358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" data-file="git.c" href="https://github.com/git/git/commit/358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" target="blank" title="Add "git show-ref" builtin command

It's kind of like "git peek-remote", but works only locally (and thus
avoids the whole overhead of git_connect()) and has some extra
verification features.

For example, it allows you to filter the results, and to choose whether
you want the tag dereferencing or not. You can also use it to just test
whether a particular ref exists.

For example:

	git show-ref master

will show all references called "master", whether tags or heads or
anything else, and regardless of how deep in the reference naming
hierarchy they are (so it would show "refs/heads/master" but
 - Linus Torvalds">
	{ "</a><a data-author="Junio C Hamano" data-commit="9f613ddd21cbd05bfc139d9b1551b5780aa171f6" data-file="git.c" href="https://github.com/git/git/commit/9f613ddd21cbd05bfc139d9b1551b5780aa171f6" target="blank" title="Add git-for-each-ref: helper for language bindings

This adds a new command, git-for-each-ref.  You can have it iterate
over refs and have it output various aspects of the objects they
refer to.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">for-each</a><a data-author="Linus Torvalds" data-commit="358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" data-file="git.c" href="https://github.com/git/git/commit/358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" target="blank" title="Add "git show-ref" builtin command

It's kind of like "git peek-remote", but works only locally (and thus
avoids the whole overhead of git_connect()) and has some extra
verification features.

For example, it allows you to filter the results, and to choose whether
you want the tag dereferencing or not. You can also use it to just test
whether a particular ref exists.

For example:

	git show-ref master

will show all references called "master", whether tags or heads or
anything else, and regardless of how deep in the reference naming
hierarchy they are (so it would show "refs/heads/master" but
 - Linus Torvalds">-ref", cmd_</a><a data-author="Junio C Hamano" data-commit="9f613ddd21cbd05bfc139d9b1551b5780aa171f6" data-file="git.c" href="https://github.com/git/git/commit/9f613ddd21cbd05bfc139d9b1551b5780aa171f6" target="blank" title="Add git-for-each-ref: helper for language bindings

This adds a new command, git-for-each-ref.  You can have it iterate
over refs and have it output various aspects of the objects they
refer to.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">for_each</a><a data-author="Linus Torvalds" data-commit="358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" data-file="git.c" href="https://github.com/git/git/commit/358ddb62cfd03bba1ca2f1ae8e81b9510f42ea9a" target="blank" title="Add "git show-ref" builtin command

It's kind of like "git peek-remote", but works only locally (and thus
avoids the whole overhead of git_connect()) and has some extra
verification features.

For example, it allows you to filter the results, and to choose whether
you want the tag dereferencing or not. You can also use it to just test
whether a particular ref exists.

For example:

	git show-ref master

will show all references called "master", whether tags or heads or
anything else, and regardless of how deep in the reference naming
hierarchy they are (so it would show "refs/heads/master" but
 - Linus Torvalds">_ref, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="3eefc189172b88dece6fb6d479b3ed13cc483dbc" data-file="git.c" href="https://github.com/git/git/commit/3eefc189172b88dece6fb6d479b3ed13cc483dbc" target="blank" title="Tentative built-in format-patch.

This only does --stdout right now.  To write into separate files
with pretty-printed filenames like the real thing does, it needs
a bit mroe work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "format-patch", cmd_format_patch,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Junio C Hamano" data-commit="230f544e877641666f8c3718ac4563294c2b305e" data-file="git.c" href="https://github.com/git/git/commit/230f544e877641666f8c3718ac4563294c2b305e" target="blank" title="Merge branch 'jc/diff'

* jc/diff:
  builtin-diff: call it "git-diff", really.
  builtin-diff.c: die() formatting type fix.
  built-in diff: assorted updates.
  built-in diff.

 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> },</a><a data-author="Mark Wooding" data-commit="b4dfefe00f7035140b7a10e855a665c1347cacd6" data-file="git.c" href="https://github.com/git/git/commit/b4dfefe00f7035140b7a10e855a665c1347cacd6" target="blank" title="Make fsck and fsck-objects be builtins.

The earlier change df391b192 to rename fsck-objects to fsck broke
fsck-objects.  This should fix it again.

Signed-off-by: Mark Wooding &lt;mdw@distorted.org.uk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Mark Wooding">
	{ "fsck", cmd_fsck, RUN_SETUP },
	{ "fsck-objects", cmd_fsck, RUN_SETUP },</a><a data-author="James Bowes" data-commit="6757ada403bf0eb0fb1fddcffbbeb74d91cbbb51" data-file="git.c" href="https://github.com/git/git/commit/6757ada403bf0eb0fb1fddcffbbeb74d91cbbb51" target="blank" title="Make gc a builtin.

Signed-off-by: James Bowes &lt;jbowes@dangerouslyinc.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - James Bowes">
	{ "gc", cmd_gc, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="f2054be4c4816d8c363dc867f462bc0af9031c02" data-file="git.c" href="https://github.com/git/git/commit/f2054be4c4816d8c363dc867f462bc0af9031c02" target="blank" title="Merge branch 'jc/builtin-n-tar-tree'

This pulls in "make many commands built-in" branches.

* jc/builtin-n-tar-tree:
  built-in tar-tree and remote tar-tree
  Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.
  Builtin git-show-branch.
  Builtin git-apply.
  Builtin git-commit-tree.
  Builtin git-read-tree.
  Builtin git-tar-tree.
  Builtin git-ls-tree.
  Builtin git-ls-files.

 - Junio C Hamano">
	{ "</a><a data-author="Rene Scharfe" data-commit="52ba03cbb1c718093946f5254187082bd7b32845" data-file="git.c" href="https://github.com/git/git/commit/52ba03cbb1c718093946f5254187082bd7b32845" target="blank" title="Built-in git-get-tar-commit-id

By being an internal command git-get-commit-id can make use of
struct ustar_header and other stuff and stops wasting precious
disk space.

Note: I recycled one of the two "tar-tree" entries instead of
splitting that cleanup into a separate patch.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Rene Scharfe">get-</a><a data-author="Junio C Hamano" data-commit="f2054be4c4816d8c363dc867f462bc0af9031c02" data-file="git.c" href="https://github.com/git/git/commit/f2054be4c4816d8c363dc867f462bc0af9031c02" target="blank" title="Merge branch 'jc/builtin-n-tar-tree'

This pulls in "make many commands built-in" branches.

* jc/builtin-n-tar-tree:
  built-in tar-tree and remote tar-tree
  Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.
  Builtin git-show-branch.
  Builtin git-apply.
  Builtin git-commit-tree.
  Builtin git-read-tree.
  Builtin git-tar-tree.
  Builtin git-ls-tree.
  Builtin git-ls-files.

 - Junio C Hamano">tar-</a><a data-author="Rene Scharfe" data-commit="52ba03cbb1c718093946f5254187082bd7b32845" data-file="git.c" href="https://github.com/git/git/commit/52ba03cbb1c718093946f5254187082bd7b32845" target="blank" title="Built-in git-get-tar-commit-id

By being an internal command git-get-commit-id can make use of
struct ustar_header and other stuff and stops wasting precious
disk space.

Note: I recycled one of the two "tar-tree" entries instead of
splitting that cleanup into a separate patch.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Rene Scharfe">commit-id</a><a data-author="Junio C Hamano" data-commit="f2054be4c4816d8c363dc867f462bc0af9031c02" data-file="git.c" href="https://github.com/git/git/commit/f2054be4c4816d8c363dc867f462bc0af9031c02" target="blank" title="Merge branch 'jc/builtin-n-tar-tree'

This pulls in "make many commands built-in" branches.

* jc/builtin-n-tar-tree:
  built-in tar-tree and remote tar-tree
  Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.
  Builtin git-show-branch.
  Builtin git-apply.
  Builtin git-commit-tree.
  Builtin git-read-tree.
  Builtin git-tar-tree.
  Builtin git-ls-tree.
  Builtin git-ls-files.

 - Junio C Hamano">", cmd_</a><a data-author="Rene Scharfe" data-commit="52ba03cbb1c718093946f5254187082bd7b32845" data-file="git.c" href="https://github.com/git/git/commit/52ba03cbb1c718093946f5254187082bd7b32845" target="blank" title="Built-in git-get-tar-commit-id

By being an internal command git-get-commit-id can make use of
struct ustar_header and other stuff and stops wasting precious
disk space.

Note: I recycled one of the two "tar-tree" entries instead of
splitting that cleanup into a separate patch.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Rene Scharfe">get_</a><a data-author="Junio C Hamano" data-commit="f2054be4c4816d8c363dc867f462bc0af9031c02" data-file="git.c" href="https://github.com/git/git/commit/f2054be4c4816d8c363dc867f462bc0af9031c02" target="blank" title="Merge branch 'jc/builtin-n-tar-tree'

This pulls in "make many commands built-in" branches.

* jc/builtin-n-tar-tree:
  built-in tar-tree and remote tar-tree
  Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.
  Builtin git-show-branch.
  Builtin git-apply.
  Builtin git-commit-tree.
  Builtin git-read-tree.
  Builtin git-tar-tree.
  Builtin git-ls-tree.
  Builtin git-ls-files.

 - Junio C Hamano">tar_</a><a data-author="Rene Scharfe" data-commit="52ba03cbb1c718093946f5254187082bd7b32845" data-file="git.c" href="https://github.com/git/git/commit/52ba03cbb1c718093946f5254187082bd7b32845" target="blank" title="Built-in git-get-tar-commit-id

By being an internal command git-get-commit-id can make use of
struct ustar_header and other stuff and stops wasting precious
disk space.

Note: I recycled one of the two "tar-tree" entries instead of
splitting that cleanup into a separate patch.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Rene Scharfe">commit_id</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="f2054be4c4816d8c363dc867f462bc0af9031c02" data-file="git.c" href="https://github.com/git/git/commit/f2054be4c4816d8c363dc867f462bc0af9031c02" target="blank" title="Merge branch 'jc/builtin-n-tar-tree'

This pulls in "make many commands built-in" branches.

* jc/builtin-n-tar-tree:
  built-in tar-tree and remote tar-tree
  Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.
  Builtin git-show-branch.
  Builtin git-apply.
  Builtin git-commit-tree.
  Builtin git-read-tree.
  Builtin git-tar-tree.
  Builtin git-ls-tree.
  Builtin git-ls-files.

 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="43885c2a557871aedcbb1a412fc18e98c3dd1dc4" data-file="git.c" href="https://github.com/git/git/commit/43885c2a557871aedcbb1a412fc18e98c3dd1dc4" target="blank" title="rename internal format-patch wip

Otherwise "git format-patch" would invoke unfinished internal one that
does only --stdout

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "</a><a data-author="Junio C Hamano" data-commit="efca578eec57869994da0982e05dcf1dee0bc213" data-file="git.c" href="https://github.com/git/git/commit/efca578eec57869994da0982e05dcf1dee0bc213" target="blank" title="Merge branch 'jc/grep'

* jc/grep: (22 commits)
  Fix silly typo in new builtin grep
  builtin-grep: unparse more command line options.
  builtin-grep: use external grep when we can take advantage of it
  builtin-grep: -F (--fixed-strings)
  builtin-grep: -w fix
  builtin-grep: typofix
  builtin-grep: tighten argument parsing.
  builtin-grep: documentation
  Teach -f &lt;file&gt; option to builtin-grep.
  builtin-grep: -L (--files-without-match).
  builtin-grep: binary files -a and -I
  builtin-grep: terminate correctly at EOF
  builtin-grep: tighten path wildcard vs tree traversal.
  builtin-grep: 
 - Junio C Hamano">grep</a><a data-author="Junio C Hamano" data-commit="43885c2a557871aedcbb1a412fc18e98c3dd1dc4" data-file="git.c" href="https://github.com/git/git/commit/43885c2a557871aedcbb1a412fc18e98c3dd1dc4" target="blank" title="rename internal format-patch wip

Otherwise "git format-patch" would invoke unfinished internal one that
does only --stdout

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">", cmd_</a><a data-author="Junio C Hamano" data-commit="efca578eec57869994da0982e05dcf1dee0bc213" data-file="git.c" href="https://github.com/git/git/commit/efca578eec57869994da0982e05dcf1dee0bc213" target="blank" title="Merge branch 'jc/grep'

* jc/grep: (22 commits)
  Fix silly typo in new builtin grep
  builtin-grep: unparse more command line options.
  builtin-grep: use external grep when we can take advantage of it
  builtin-grep: -F (--fixed-strings)
  builtin-grep: -w fix
  builtin-grep: typofix
  builtin-grep: tighten argument parsing.
  builtin-grep: documentation
  Teach -f &lt;file&gt; option to builtin-grep.
  builtin-grep: -L (--files-without-match).
  builtin-grep: binary files -a and -I
  builtin-grep: terminate correctly at EOF
  builtin-grep: tighten path wildcard vs tree traversal.
  builtin-grep: 
 - Junio C Hamano">grep</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="ff38d1a9953b3bce7741f8f962c5e067fda2d9ea" data-file="git.c" href="https://github.com/git/git/commit/ff38d1a9953b3bce7741f8f962c5e067fda2d9ea" target="blank" title="grep: run setup_git_directory_gently() sooner

git grep already runs a repository search unconditionally,
even when the --no-index option is supplied; running such a
search earlier is not very risky.

Just like with shortlog, without this change, the
“[pager] grep” configuration is not respected at all.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Junio C Hamano" data-commit="b7786bb4b09463641f3e39eca18aefc630ee4f38" data-file="git.c" href="https://github.com/git/git/commit/b7786bb4b09463641f3e39eca18aefc630ee4f38" target="blank" title="Merge branch 'js/difftool-builtin'

Rewrite a scripted porcelain "git difftool" in C.

* js/difftool-builtin:
  difftool: hack around -Wzero-length-format warning
  difftool: retire the scripted version
  difftool: implement the functionality in the builtin
  difftool: add a skeleton for the upcoming builtin

 - Junio C Hamano"> }</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">,</a><a data-author="Linus Torvalds" data-commit="b28a1ce04cdafbd3b470ec43c0f562054bd45d4d" data-file="git.c" href="https://github.com/git/git/commit/b28a1ce04cdafbd3b470ec43c0f562054bd45d4d" target="blank" title="make "git hash-object" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "hash-object", cmd_hash_object },</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	{ "help", cmd_help },</a><a data-author="Linus Torvalds" data-commit="3bb7256281bb1d291bb705a57dc3f30b26b7c127" data-file="git.c" href="https://github.com/git/git/commit/3bb7256281bb1d291bb705a57dc3f30b26b7c127" target="blank" title="make "index-pack" a built-in

This required some fairly trivial packfile function 'const' cleanup,
since the builtin commands get a const char *argv[] array.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "index-pack", cmd_index_pack</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e0fce074fc4fdf2d2175ff97f1cc3db918ea87e9" data-file="git.c" href="https://github.com/git/git/commit/e0fce074fc4fdf2d2175ff97f1cc3db918ea87e9" target="blank" title="index-pack: run setup_git_directory_gently() sooner

index-pack already runs a repository search unconditionally; running
such a search earlier is not risky and ensures GIT_DIR will be set
correctly if the configuration needs to be accessed from
run_builtin().

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="3bb7256281bb1d291bb705a57dc3f30b26b7c127" data-file="git.c" href="https://github.com/git/git/commit/3bb7256281bb1d291bb705a57dc3f30b26b7c127" target="blank" title="make "index-pack" a built-in

This required some fairly trivial packfile function 'const' cleanup,
since the builtin commands get a const char *argv[] array.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Nicolas Pitre" data-commit="515377ea9ec6192f82a2fa5c5b5b7651d9d6cf6c" data-file="git.c" href="https://github.com/git/git/commit/515377ea9ec6192f82a2fa5c5b5b7651d9d6cf6c" target="blank" title=""init-db" can really be just "init"

Make "init" the equivalent of "init-db". This should make first GIT
impression a little more friendly.

Signed-off-by: Nicolas Pitre &lt;nico@cam.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Nicolas Pitre">
	{ "init", cmd_init_db },</a><a data-author="Timo Hirvonen" data-commit="c3c8835fbb182d971d71939b9a3ec7c8b86d6caf" data-file="git.c" href="https://github.com/git/git/commit/c3c8835fbb182d971d71939b9a3ec7c8b86d6caf" target="blank" title="Builtin git-init-db

Basically this just renames init-db.c to builtin-init-db.c and makes
some strings const.

Signed-off-by: Timo Hirvonen &lt;tihirvon@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Timo Hirvonen">
	{ "init-db", cmd_init_db },</a><a data-author="Dennis Kaarsemaker" data-commit="3473ad0cf6c90917813aba978dada6c10352baaa" data-file="git.c" href="https://github.com/git/git/commit/3473ad0cf6c90917813aba978dada6c10352baaa" target="blank" title="checkout: don't require a work tree when checking out into a new one

For normal use cases, it does not make sense for 'checkout' to work on
a bare repository, without a worktree. But "checkout --to" is an
exception because it _creates_ a new worktree. Allow this option to
run on bare repositories.

People who check out from a bare repository should remember that
core.logallrefupdates is off by default and it should be turned back
on. `--to` cannot do this automatically behind the user's back because
some user may deliberately want no reflog.

For people interested in repository setup/discover
 - Dennis Kaarsemaker">
	{ "interpret-trailers",</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek"> cmd_</a><a data-author="Dennis Kaarsemaker" data-commit="3473ad0cf6c90917813aba978dada6c10352baaa" data-file="git.c" href="https://github.com/git/git/commit/3473ad0cf6c90917813aba978dada6c10352baaa" target="blank" title="checkout: don't require a work tree when checking out into a new one

For normal use cases, it does not make sense for 'checkout' to work on
a bare repository, without a worktree. But "checkout --to" is an
exception because it _creates_ a new worktree. Allow this option to
run on bare repositories.

People who check out from a bare repository should remember that
core.logallrefupdates is off by default and it should be turned back
on. `--to` cannot do this automatically behind the user's back because
some user may deliberately want no reflog.

For people interested in repository setup/discover
 - Dennis Kaarsemaker">interpret</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">_</a><a data-author="Dennis Kaarsemaker" data-commit="3473ad0cf6c90917813aba978dada6c10352baaa" data-file="git.c" href="https://github.com/git/git/commit/3473ad0cf6c90917813aba978dada6c10352baaa" target="blank" title="checkout: don't require a work tree when checking out into a new one

For normal use cases, it does not make sense for 'checkout' to work on
a bare repository, without a worktree. But "checkout --to" is an
exception because it _creates_ a new worktree. Allow this option to
run on bare repositories.

People who check out from a bare repository should remember that
core.logallrefupdates is off by default and it should be turned back
on. `--to` cannot do this automatically behind the user's back because
some user may deliberately want no reflog.

For people interested in repository setup/discover
 - Dennis Kaarsemaker">trailers, RUN_SETUP</a><a data-author="John Keeping" data-commit="cbd9fc2366abd6bd4bd3a544e2fe438b53ca0d2f" data-file="git.c" href="https://github.com/git/git/commit/cbd9fc2366abd6bd4bd3a544e2fe438b53ca0d2f" target="blank" title="interpret-trailers: allow running outside a repository

It may be useful to run git-interpret-trailers without needing to be in
a repository.

Signed-off-by: John Keeping &lt;john@keeping.me.uk&gt;
Acked-by: Christian Couder &lt;christian.couder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - John Keeping">_GENTLY</a><a data-author="Dennis Kaarsemaker" data-commit="3473ad0cf6c90917813aba978dada6c10352baaa" data-file="git.c" href="https://github.com/git/git/commit/3473ad0cf6c90917813aba978dada6c10352baaa" target="blank" title="checkout: don't require a work tree when checking out into a new one

For normal use cases, it does not make sense for 'checkout' to work on
a bare repository, without a worktree. But "checkout --to" is an
exception because it _creates_ a new worktree. Allow this option to
run on bare repositories.

People who check out from a bare repository should remember that
core.logallrefupdates is off by default and it should be turned back
on. `--to` cannot do this automatically behind the user's back because
some user may deliberately want no reflog.

For people interested in repository setup/discover
 - Dennis Kaarsemaker"> },</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	{ "log", cmd_log</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> },</a><a data-author="Peter Eriksen" data-commit="0864f26421b3c599b462bc867de948d14b268d76" data-file="git.c" href="https://github.com/git/git/commit/0864f26421b3c599b462bc867de948d14b268d76" target="blank" title="Builtin git-ls-files.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "ls-files", cmd_ls_files</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Peter Eriksen" data-commit="0864f26421b3c599b462bc867de948d14b268d76" data-file="git.c" href="https://github.com/git/git/commit/0864f26421b3c599b462bc867de948d14b268d76" target="blank" title="Builtin git-ls-files.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" data-file="git.c" href="https://github.com/git/git/commit/aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" target="blank" title="Builtin git-ls-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Daniel Barkalow" data-commit="8951d7c1f1ae38f34617b6c2490bf65e73e371f7" data-file="git.c" href="https://github.com/git/git/commit/8951d7c1f1ae38f34617b6c2490bf65e73e371f7" target="blank" title="Build in ls-remote

This actually replaces peek-remote with ls-remote, since peek-remote
now handles everything. peek-remote remains an a second name for
ls-remote, although its help message now gives the "ls-remote" name.

Signed-off-by: Daniel Barkalow &lt;barkalow@iabervon.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow">
	{ "ls-remote", cmd_ls_remote</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="f0ef6a6eff15a3df8dc9ec61d93e3f7e540ed0ac" data-file="git.c" href="https://github.com/git/git/commit/f0ef6a6eff15a3df8dc9ec61d93e3f7e540ed0ac" target="blank" title="ls-remote: run setup_git_directory_gently() sooner

ls-remote already runs a repository search unconditionally to learn
about remote nicknames and "[url] insteadof" shortcuts.  Run that
search a little sooner, and now one can try

	[pager]
		ls-remote

to automatically paginate ls-remote output, or use repository-local

	[core]
		pager = whatever

with "git --paginate ls-remote &lt;url&gt;".

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Daniel Barkalow" data-commit="8951d7c1f1ae38f34617b6c2490bf65e73e371f7" data-file="git.c" href="https://github.com/git/git/commit/8951d7c1f1ae38f34617b6c2490bf65e73e371f7" target="blank" title="Build in ls-remote

This actually replaces peek-remote with ls-remote, since peek-remote
now handles everything. peek-remote remains an a second name for
ls-remote, although its help message now gives the "ls-remote" name.

Signed-off-by: Daniel Barkalow &lt;barkalow@iabervon.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow"> },</a><a data-author="Peter Eriksen" data-commit="aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" data-file="git.c" href="https://github.com/git/git/commit/aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" target="blank" title="Builtin git-ls-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "ls-tree", cmd_ls_tree</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Peter Eriksen" data-commit="aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" data-file="git.c" href="https://github.com/git/git/commit/aae01bda7f6d3224cf6b2ce0aa9aa668ce35d0b7" target="blank" title="Builtin git-ls-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="56d1398ad305498faf57d6e433f97ad393d7909e" data-file="git.c" href="https://github.com/git/git/commit/56d1398ad305498faf57d6e433f97ad393d7909e" target="blank" title="Builtin git-tar-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Lukas Sandström" data-commit="34488e3c375d159506d5d98e012f3b36e7cd9fe7" data-file="git.c" href="https://github.com/git/git/commit/34488e3c375d159506d5d98e012f3b36e7cd9fe7" target="blank" title="Make git-mailinfo a builtin

[jc: with a bit of constness tightening]

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "mailinfo", cmd_mailinfo</a><a data-author="Junio C Hamano" data-commit="3f0ec0687d95e0f53c899f964d769ca1846874da" data-file="git.c" href="https://github.com/git/git/commit/3f0ec0687d95e0f53c899f964d769ca1846874da" target="blank" title="mailinfo: read local configuration

Since b9605bc4f2 ("config: only read .git/config from configured
repos", 2016-09-12), we do not read from ".git/config" unless we
know we are in a repository.  "git mailinfo" however didn't do the
repository discovery and instead relied on the old behaviour.  This
was mostly OK because it was merely run as a helper program by other
porcelain scripts that first chdir's up to the root of the working
tree.

Teach the command to run a "gentle" version of repository discovery
so that local configuration variables like mailinfo.scissors are
honoured.

Signed-off-b
 - Junio C Hamano">, RUN_SETUP_GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Lukas Sandström" data-commit="34488e3c375d159506d5d98e012f3b36e7cd9fe7" data-file="git.c" href="https://github.com/git/git/commit/34488e3c375d159506d5d98e012f3b36e7cd9fe7" target="blank" title="Make git-mailinfo a builtin

[jc: with a bit of constness tightening]

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström"> }</a><a data-author="Lukas Sandström" data-commit="7499c996156ea99702fe13e203b97ae60d8868ad" data-file="git.c" href="https://github.com/git/git/commit/7499c996156ea99702fe13e203b97ae60d8868ad" target="blank" title="Make git-stripspace a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,</a><a data-author="Lukas Sandström" data-commit="e690e84315de1bb806eb2292f8a87cbee30b75ab" data-file="git.c" href="https://github.com/git/git/commit/e690e84315de1bb806eb2292f8a87cbee30b75ab" target="blank" title="Make git-mailsplit a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "mailsplit", cmd_mailsplit</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Lukas Sandström" data-commit="e690e84315de1bb806eb2292f8a87cbee30b75ab" data-file="git.c" href="https://github.com/git/git/commit/e690e84315de1bb806eb2292f8a87cbee30b75ab" target="blank" title="Make git-mailsplit a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström"> }</a><a data-author="Lukas Sandström" data-commit="34488e3c375d159506d5d98e012f3b36e7cd9fe7" data-file="git.c" href="https://github.com/git/git/commit/34488e3c375d159506d5d98e012f3b36e7cd9fe7" target="blank" title="Make git-mailinfo a builtin

[jc: with a bit of constness tightening]

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">
	{ "</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna">merge</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">",</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna"> cmd_merge</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">,</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna"> RUN</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">_</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna">SETUP | NEED</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">_</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna">WORK</a><a data-author="Junio C Hamano" data-commit="fcab40a389e99786a8276108cdbc1cda8caf502f" data-file="git.c" href="https://github.com/git/git/commit/fcab40a389e99786a8276108cdbc1cda8caf502f" target="blank" title="Merge branch 'mv/merge-in-c'

* mv/merge-in-c:
  reduce_heads(): protect from duplicate input
  reduce_heads(): thinkofix
  Add a new test for git-merge-resolve
  t6021: add a new test for git-merge-resolve
  Teach merge.log to "git-merge" again
  Build in merge
  Fix t7601-merge-pull-config.sh on AIX
  git-commit-tree: make it usable from other builtins
  Add new test case to ensure git-merge prepends the custom merge message
  Add new test case to ensure git-merge reduces octopus parents when possible
  Introduce reduce_heads()
  Introduce get_merge_bases_many()
  Add new test to ensure git-
 - Junio C Hamano">_</a><a data-author="Miklos Vajna" data-commit="1c7b76be7d620bbaf2e6b8417f04012326bbb9df" data-file="git.c" href="https://github.com/git/git/commit/1c7b76be7d620bbaf2e6b8417f04012326bbb9df" target="blank" title="Build in merge

Mentored-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Miklos Vajna &lt;vmiklos@frugalware.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Miklos Vajna">TREE }</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">,</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "</a><a data-author="Junio C Hamano" data-commit="253e772edeb56092e0fad43ec0640658671313c5" data-file="git.c" href="https://github.com/git/git/commit/253e772edeb56092e0fad43ec0640658671313c5" target="blank" title="Merge branch 'maint'

* maint:
  Unset NO_C99_FORMAT on Cygwin.
  Fix a "pointer type missmatch" warning.
  Fix some "comparison is always true/false" warnings.
  Fix an "implicit function definition" warning.
  Fix a "label defined but unreferenced" warning.
  Document the config variable format.suffix
  git-merge: fail correctly when we cannot fast forward.
  builtin-archive: use RUN_SETUP
  Fix git-gc usage note

 - Junio C Hamano">merge</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">-</a><a data-author="Junio C Hamano" data-commit="253e772edeb56092e0fad43ec0640658671313c5" data-file="git.c" href="https://github.com/git/git/commit/253e772edeb56092e0fad43ec0640658671313c5" target="blank" title="Merge branch 'maint'

* maint:
  Unset NO_C99_FORMAT on Cygwin.
  Fix a "pointer type missmatch" warning.
  Fix some "comparison is always true/false" warnings.
  Fix an "implicit function definition" warning.
  Fix a "label defined but unreferenced" warning.
  Document the config variable format.suffix
  git-merge: fail correctly when we cannot fast forward.
  builtin-archive: use RUN_SETUP
  Fix git-gc usage note

 - Junio C Hamano">base</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">", cmd_</a><a data-author="Junio C Hamano" data-commit="253e772edeb56092e0fad43ec0640658671313c5" data-file="git.c" href="https://github.com/git/git/commit/253e772edeb56092e0fad43ec0640658671313c5" target="blank" title="Merge branch 'maint'

* maint:
  Unset NO_C99_FORMAT on Cygwin.
  Fix a "pointer type missmatch" warning.
  Fix some "comparison is always true/false" warnings.
  Fix an "implicit function definition" warning.
  Fix a "label defined but unreferenced" warning.
  Document the config variable format.suffix
  git-merge: fail correctly when we cannot fast forward.
  builtin-archive: use RUN_SETUP
  Fix git-gc usage note

 - Junio C Hamano">merge</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">_</a><a data-author="Junio C Hamano" data-commit="253e772edeb56092e0fad43ec0640658671313c5" data-file="git.c" href="https://github.com/git/git/commit/253e772edeb56092e0fad43ec0640658671313c5" target="blank" title="Merge branch 'maint'

* maint:
  Unset NO_C99_FORMAT on Cygwin.
  Fix a "pointer type missmatch" warning.
  Fix some "comparison is always true/false" warnings.
  Fix an "implicit function definition" warning.
  Fix a "label defined but unreferenced" warning.
  Document the config variable format.suffix
  git-merge: fail correctly when we cannot fast forward.
  builtin-archive: use RUN_SETUP
  Fix git-gc usage note

 - Junio C Hamano">base</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> },</a><a data-author="Johannes Schindelin" data-commit="ba1f5f353775ddbf97bc0d543888783630693023" data-file="git.c" href="https://github.com/git/git/commit/ba1f5f353775ddbf97bc0d543888783630693023" target="blank" title="Add builtin merge-file, a minimal replacement for RCS merge

merge-file has the same syntax as RCS merge, but supports only the
"-L" option.

For good measure, a test is added, which is quite minimal, though.

[jc: further fix for compliation errors included.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	{ "merge-file", cmd_merge_file</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="3668d4238314dc5db98de3034058f68ff57a6b1e" data-file="git.c" href="https://github.com/git/git/commit/3668d4238314dc5db98de3034058f68ff57a6b1e" target="blank" title="merge-file: run setup_git_directory_gently() sooner

Part of a campaign to make repository-local configuration
available early (simplifying the startup sequence for
built-in commands).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Johannes Schindelin" data-commit="ba1f5f353775ddbf97bc0d543888783630693023" data-file="git.c" href="https://github.com/git/git/commit/ba1f5f353775ddbf97bc0d543888783630693023" target="blank" title="Add builtin merge-file, a minimal replacement for RCS merge

merge-file has the same syntax as RCS merge, but supports only the
"-L" option.

For good measure, a test is added, which is quite minimal, though.

[jc: further fix for compliation errors included.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> },</a><a data-author="Linus Torvalds" data-commit="0ecace728f8e48b87f81433b053d7f277f22e674" data-file="git.c" href="https://github.com/git/git/commit/0ecace728f8e48b87f81433b053d7f277f22e674" target="blank" title="make "merge-index" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "merge-index", cmd_merge_index, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="0ecace728f8e48b87f81433b053d7f277f22e674" data-file="git.c" href="https://github.com/git/git/commit/0ecace728f8e48b87f81433b053d7f277f22e674" target="blank" title="make "merge-index" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Junio C Hamano" data-commit="6c6ea3800d1eace51994d90fbeb19ffe918e63b0" data-file="git.c" href="https://github.com/git/git/commit/6c6ea3800d1eace51994d90fbeb19ffe918e63b0" target="blank" title="Merge branch 'sb/clean'

* sb/clean:
  Teach git clean to use setup_standard_excludes()
  git-clean: Fix error message if clean.requireForce is not set.
  Make git-clean a builtin

 - Junio C Hamano">
	{ "</a><a data-author="Thomas Harning" data-commit="a00a42ae33708caa742d9e9fbf10692cfa42f032" data-file="git.c" href="https://github.com/git/git/commit/a00a42ae33708caa742d9e9fbf10692cfa42f032" target="blank" title="git-merge-ours: make it a builtin.

Except that this fixes a longstanding corner case bug by
tightening the way underlying diff-index command is run, it is
functionally equivalent to the scripted version.

Signed-off-by: Thomas Harning Jr &lt;harningt@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thomas Harning">merge-ours</a><a data-author="Junio C Hamano" data-commit="6c6ea3800d1eace51994d90fbeb19ffe918e63b0" data-file="git.c" href="https://github.com/git/git/commit/6c6ea3800d1eace51994d90fbeb19ffe918e63b0" target="blank" title="Merge branch 'sb/clean'

* sb/clean:
  Teach git clean to use setup_standard_excludes()
  git-clean: Fix error message if clean.requireForce is not set.
  Make git-clean a builtin

 - Junio C Hamano">", cmd_</a><a data-author="Thomas Harning" data-commit="a00a42ae33708caa742d9e9fbf10692cfa42f032" data-file="git.c" href="https://github.com/git/git/commit/a00a42ae33708caa742d9e9fbf10692cfa42f032" target="blank" title="git-merge-ours: make it a builtin.

Except that this fixes a longstanding corner case bug by
tightening the way underlying diff-index command is run, it is
functionally equivalent to the scripted version.

Signed-off-by: Thomas Harning Jr &lt;harningt@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Thomas Harning">merge_ours</a><a data-author="Junio C Hamano" data-commit="6c6ea3800d1eace51994d90fbeb19ffe918e63b0" data-file="git.c" href="https://github.com/git/git/commit/6c6ea3800d1eace51994d90fbeb19ffe918e63b0" target="blank" title="Merge branch 'sb/clean'

* sb/clean:
  Teach git clean to use setup_standard_excludes()
  git-clean: Fix error message if clean.requireForce is not set.
  Make git-clean a builtin

 - Junio C Hamano">, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="6c6ea3800d1eace51994d90fbeb19ffe918e63b0" data-file="git.c" href="https://github.com/git/git/commit/6c6ea3800d1eace51994d90fbeb19ffe918e63b0" target="blank" title="Merge branch 'sb/clean'

* sb/clean:
  Teach git clean to use setup_standard_excludes()
  git-clean: Fix error message if clean.requireForce is not set.
  Make git-clean a builtin

 - Junio C Hamano"> },</a><a data-author="Daniel Barkalow" data-commit="e1b3a2cad79a8138d18593c6eb3c46906ad2ee42" data-file="git.c" href="https://github.com/git/git/commit/e1b3a2cad79a8138d18593c6eb3c46906ad2ee42" target="blank" title="Build-in merge-recursive

This makes write_tree_from_memory(), which writes the active cache as
a tree and returns the struct tree for it, available to other code. It
also makes available merge_trees(), which does the internal merge of
two trees with a known base, and merge_recursive(), which does the
recursive internal merge of two commits with a list of common
ancestors.

The first two of these will be used by checkout -m, and the third is
presumably useful in general, although the implementation of checkout
-m which entirely matches the behavior of the shell version does not
use it (since i
 - Daniel Barkalow">
	{ "merge-recursive", cmd_merge_recursive, RUN_SETUP | NEED_WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Daniel Barkalow" data-commit="e1b3a2cad79a8138d18593c6eb3c46906ad2ee42" data-file="git.c" href="https://github.com/git/git/commit/e1b3a2cad79a8138d18593c6eb3c46906ad2ee42" target="blank" title="Build-in merge-recursive

This makes write_tree_from_memory(), which writes the active cache as
a tree and returns the struct tree for it, available to other code. It
also makes available merge_trees(), which does the internal merge of
two trees with a known base, and merge_recursive(), which does the
recursive internal merge of two commits with a list of common
ancestors.

The first two of these will be used by checkout -m, and the third is
presumably useful in general, although the implementation of checkout
-m which entirely matches the behavior of the shell version does not
use it (since i
 - Daniel Barkalow"> },</a><a data-author="Avery Pennarun" data-commit="8cc5b29065e19267cbc08b39c34674b02c2e3d59" data-file="git.c" href="https://github.com/git/git/commit/8cc5b29065e19267cbc08b39c34674b02c2e3d59" target="blank" title="git merge -X&lt;option&gt;

Teach "-X &lt;option&gt;" command line argument to "git merge" that is passed to
strategy implementations.  "ours" and "theirs" autoresolution introduced
by the previous commit can be asked to the recursive strategy.

Signed-off-by: Avery Pennarun &lt;apenwarr@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Avery Pennarun">
	{ "merge-recursive-ours", cmd_merge_recursive, RUN_SETUP | NEED_WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Avery Pennarun" data-commit="8cc5b29065e19267cbc08b39c34674b02c2e3d59" data-file="git.c" href="https://github.com/git/git/commit/8cc5b29065e19267cbc08b39c34674b02c2e3d59" target="blank" title="git merge -X&lt;option&gt;

Teach "-X &lt;option&gt;" command line argument to "git merge" that is passed to
strategy implementations.  "ours" and "theirs" autoresolution introduced
by the previous commit can be asked to the recursive strategy.

Signed-off-by: Avery Pennarun &lt;apenwarr@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Avery Pennarun"> },
	{ "merge-recursive-theirs", cmd_merge_recursive, RUN_SETUP | NEED_WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Avery Pennarun" data-commit="8cc5b29065e19267cbc08b39c34674b02c2e3d59" data-file="git.c" href="https://github.com/git/git/commit/8cc5b29065e19267cbc08b39c34674b02c2e3d59" target="blank" title="git merge -X&lt;option&gt;

Teach "-X &lt;option&gt;" command line argument to "git merge" that is passed to
strategy implementations.  "ours" and "theirs" autoresolution introduced
by the previous commit can be asked to the recursive strategy.

Signed-off-by: Avery Pennarun &lt;apenwarr@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Avery Pennarun"> },</a><a data-author="Junio C Hamano" data-commit="1736855c9b59ac787af979a44840a58361cbaf66" data-file="git.c" href="https://github.com/git/git/commit/1736855c9b59ac787af979a44840a58361cbaf66" target="blank" title="Add merge-subtree back

An earlier commit e1b3a2c (Build-in merge-recursive) made the
subtree merge strategy backend unavailable.  This resurrects
it.

A new test t6029 currently only tests the strategy is available,
but it should be enhanced to check the real "subtree" case.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	{ "merge-subtree", cmd_merge_recursive, RUN_SETUP | NEED_WORK_TREE</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">PARSEOPT }</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">
	{ "</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">merge</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">-</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">tree</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">", cmd</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">merge</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">tree</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">, RUN_</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Linus Torvalds" data-commit="112dd5146589ecb76d52bf349bd51dbe2936e936" data-file="git.c" href="https://github.com/git/git/commit/112dd5146589ecb76d52bf349bd51dbe2936e936" target="blank" title="make "mktag" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "mktag", cmd_mktag, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="112dd5146589ecb76d52bf349bd51dbe2936e936" data-file="git.c" href="https://github.com/git/git/commit/112dd5146589ecb76d52bf349bd51dbe2936e936" target="blank" title="make "mktag" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Junio C Hamano" data-commit="633e3556ccbcc7e443f5e9194c4a830181696ef0" data-file="git.c" href="https://github.com/git/git/commit/633e3556ccbcc7e443f5e9194c4a830181696ef0" target="blank" title="build-in git-mktree

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	{ "mktree", cmd_mktree, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="c00ba2233ef7dcfa478068c75bc4b25a7ac2a0a8" data-file="git.c" href="https://github.com/git/git/commit/c00ba2233ef7dcfa478068c75bc4b25a7ac2a0a8" target="blank" title="Sync 'ds/multi-pack-index' to v2.19.0-rc0

* ds/multi-pack-index: (23 commits)
  midx: clear midx on repack
  packfile: skip loading index if in multi-pack-index
  midx: prevent duplicate packfile loads
  midx: use midx in approximate_object_count
  midx: use existing midx when writing new one
  midx: use midx in abbreviation calculations
  midx: read objects from multi-pack-index
  config: create core.multiPackIndex setting
  midx: write object offsets
  midx: write object id fanout chunk
  midx: write object ids in a chunk
  midx: sort and deduplicate objects from packfiles
  midx: read pack
 - Junio C Hamano">
	{ "multi-pack-index", cmd_multi_pack_index, RUN_SETUP_GENTLY },</a><a data-author="Junio C Hamano" data-commit="7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" data-file="git.c" href="https://github.com/git/git/commit/7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" target="blank" title="Merge branch 'lt/setup' into __/setup-n-mv

This merges the new built-in calling convention code into Johannes's
builtin-mv topic in order to resolve their conflicts early on.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "mv", cmd_mv,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Junio C Hamano" data-commit="7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" data-file="git.c" href="https://github.com/git/git/commit/7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" target="blank" title="Merge branch 'lt/setup' into __/setup-n-mv

This merges the new built-in calling convention code into Johannes's
builtin-mv topic in order to resolve their conflicts early on.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce"> |</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer"> NEED</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">WORK_TREE</a><a data-author="Junio C Hamano" data-commit="7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" data-file="git.c" href="https://github.com/git/git/commit/7061cf0f205e86613c3a3306fdfedf2a5dcc8a65" target="blank" title="Merge branch 'lt/setup' into __/setup-n-mv

This merges the new built-in calling convention code into Johannes's
builtin-mv topic in order to resolve their conflicts early on.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> },</a><a data-author="Matthias Kestenholz" data-commit="d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" data-file="git.c" href="https://github.com/git/git/commit/d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" target="blank" title="Make git-name-rev a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">
	{ "name-rev", cmd_name_rev,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Matthias Kestenholz" data-commit="d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" data-file="git.c" href="https://github.com/git/git/commit/d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" target="blank" title="Make git-name-rev a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Matthias Kestenholz" data-commit="d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" data-file="git.c" href="https://github.com/git/git/commit/d6b64ed0f3549f56c4d948dc2c0f12abc52fd6c9" target="blank" title="Make git-name-rev a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz"> },</a><a data-author="Johan Herland" data-commit="cd067d3bf4ea3f89969cd143be3e281e1c5ac58a" data-file="git.c" href="https://github.com/git/git/commit/cd067d3bf4ea3f89969cd143be3e281e1c5ac58a" target="blank" title="Builtin-ify git-notes

The builtin-ification includes some minor behavioural changes to the
command-line interface: It is no longer allowed to mix the -m and -F
arguments, and it is not allowed to use multiple -F options.

As part of the builtin-ification, we add the commit_notes() function
to the builtin API. This function (together with the notes.h API) can
be easily used from other builtins to manipulate the notes tree.

Also includes needed changes to t3301.

This patch has been improved by the following contributions:
- Stephen Boyd: Use die() instead of fprintf(stderr, ...) followed by e
 - Johan Herland">
	{ "notes", cmd_notes, RUN_SETUP },</a><a data-author="Matthias Kestenholz" data-commit="5d4a60033543e063bc9d77ca957de0187fb58fb3" data-file="git.c" href="https://github.com/git/git/commit/5d4a60033543e063bc9d77ca957de0187fb58fb3" target="blank" title="Make git-pack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">
	{ "pack-objects", cmd_pack_objects,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Matthias Kestenholz" data-commit="5d4a60033543e063bc9d77ca957de0187fb58fb3" data-file="git.c" href="https://github.com/git/git/commit/5d4a60033543e063bc9d77ca957de0187fb58fb3" target="blank" title="Make git-pack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Matthias Kestenholz" data-commit="5d4a60033543e063bc9d77ca957de0187fb58fb3" data-file="git.c" href="https://github.com/git/git/commit/5d4a60033543e063bc9d77ca957de0187fb58fb3" target="blank" title="Make git-pack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz"> },</a><a data-author="Linus Torvalds" data-commit="377d0276ca7446ce9fb2f6987b1e6b4ba9e7cf29" data-file="git.c" href="https://github.com/git/git/commit/377d0276ca7446ce9fb2f6987b1e6b4ba9e7cf29" target="blank" title="make "git pack-redundant" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "pack-redundant", cmd_pack_redundant, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="377d0276ca7446ce9fb2f6987b1e6b4ba9e7cf29" data-file="git.c" href="https://github.com/git/git/commit/377d0276ca7446ce9fb2f6987b1e6b4ba9e7cf29" target="blank" title="make "git pack-redundant" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Linus Torvalds" data-commit="e1e22e37f47e3f4d741d28920e1d27e3775c31ad" data-file="git.c" href="https://github.com/git/git/commit/e1e22e37f47e3f4d741d28920e1d27e3775c31ad" target="blank" title="Start handling references internally as a sorted in-memory list

This also adds some very rudimentary support for the notion of packed
refs.  HOWEVER! At this point it isn't used to actually look up a ref
yet, only for listing them (ie "for_each_ref()" and friends see the
packed refs, but none of the other single-ref lookup routines).

Note how we keep two separate lists: one for the loose refs, and one for
the packed refs we read. That's so that we can easily keep the two apart,
and read only one set or the other (and still always make sure that the
loose refs take precedence).

[ From this, 
 - Linus Torvalds">
	{ "pack-refs", cmd_pack_refs, RUN_SETUP },</a><a data-author="Linus Torvalds" data-commit="dedc0ec5d778214528dae3bddf60d77cfcde4bd4" data-file="git.c" href="https://github.com/git/git/commit/dedc0ec5d778214528dae3bddf60d77cfcde4bd4" target="blank" title="make "git patch-id" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "patch-id", cmd_patch_id</a><a data-author="Junio C Hamano" data-commit="1c2b1f7018ba7d5f6a5d949e29e4eaeeef3261e2" data-file="git.c" href="https://github.com/git/git/commit/1c2b1f7018ba7d5f6a5d949e29e4eaeeef3261e2" target="blank" title="Merge branch 'bw/ls-files-recurse-submodules'

"git ls-files" learned "--recurse-submodules" option that can be
used to get a listing of tracked files across submodules (i.e. this
only works with "--cached" option, not for listing untracked or
ignored files).  This would be a useful tool to sit on the upstream
side of a pipe that is read with xargs to work on all working tree
files from the top-level superproject.

* bw/ls-files-recurse-submodules:
  ls-files: add pathspec matching for submodules
  ls-files: pass through safe options for --recurse-submodules
  ls-files: optionally recurse into
 - Junio C Hamano">, RUN_SETUP_GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="dedc0ec5d778214528dae3bddf60d77cfcde4bd4" data-file="git.c" href="https://github.com/git/git/commit/dedc0ec5d778214528dae3bddf60d77cfcde4bd4" target="blank" title="make "git patch-id" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Junio C Hamano" data-commit="acca687fa9db8eaa380b65d63c3f0d4364892acf" data-file="git.c" href="https://github.com/git/git/commit/acca687fa9db8eaa380b65d63c3f0d4364892acf" target="blank" title="git-pickaxe: retire pickaxe

Just make it take over blame's place.  Documentation and command
have all stopped mentioning "git-pickaxe".  The built-in synonym
is left in the command table, so you can still say "git pickaxe",
but it probably is a good idea to retire it as well.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "pickaxe", cmd_blame, RUN_SETUP },</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	{</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano"> "</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">prune</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">",</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> cmd</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">_</a><a data-author="Linus Torvalds" data-commit="ba84a797e76c27932e0b317c7ce54925e81093f7" data-file="git.c" href="https://github.com/git/git/commit/ba84a797e76c27932e0b317c7ce54925e81093f7" target="blank" title="builtin "git prune"

This actually removes the objects to be pruned, unless you specify "-n"
(at which point it will just tell you which files it would prune).

This doesn't do the pack-file pruning that the shell-script used to do,
but if somebody really wants to, they could add it easily enough. I wonder
how useful it is, though, considering that "git repack -a -d" is just a
lot more efficient and generates a better end result.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">prune</a><a data-author="Junio C Hamano" data-commit="d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" data-file="git.c" href="https://github.com/git/git/commit/d3ba675aae3c6c5722ad15cd9d0f3b7634e976ce" target="blank" title="Merge branch 'ml/trace'

* ml/trace:
  test-lib: unset GIT_TRACE
  GIT_TRACE: fix a mixed declarations and code warning
  GIT_TRACE: show which built-in/external commands are executed

 - Junio C Hamano">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds"> },</a><a data-author="Matthias Kestenholz" data-commit="53bb2c002a53cdd0746444defbf5323ea21eb8d5" data-file="git.c" href="https://github.com/git/git/commit/53bb2c002a53cdd0746444defbf5323ea21eb8d5" target="blank" title="Make git-prune-packed a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">
	{ "prune-packed", cmd_prune_packed,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Matthias Kestenholz" data-commit="53bb2c002a53cdd0746444defbf5323ea21eb8d5" data-file="git.c" href="https://github.com/git/git/commit/53bb2c002a53cdd0746444defbf5323ea21eb8d5" target="blank" title="Make git-prune-packed a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Matthias Kestenholz" data-commit="53bb2c002a53cdd0746444defbf5323ea21eb8d5" data-file="git.c" href="https://github.com/git/git/commit/53bb2c002a53cdd0746444defbf5323ea21eb8d5" target="blank" title="Make git-prune-packed a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz"> },</a><a data-author="Paul Tan" data-commit="1e1ea69fa4e5fb20baefe9e5422527e971d56a86" data-file="git.c" href="https://github.com/git/git/commit/1e1ea69fa4e5fb20baefe9e5422527e971d56a86" target="blank" title="pull: implement skeletal builtin pull

For the purpose of rewriting git-pull.sh into a C builtin, implement a
skeletal builtin/pull.c that redirects to $GIT_EXEC_PATH/git-pull.sh if
the environment variable _GIT_USE_BUILTIN_PULL is not defined. This
allows us to fall back on the functional git-pull.sh when running the
test suite for tests that depend on a working git-pull implementation.

This redirection should be removed when all the features of git-pull.sh
have been re-implemented in builtin/pull.c.

Helped-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Paul Tan &lt;pyokagan@gmail.com&gt;

 - Paul Tan">
	{ "pull", cmd_pull, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	{ "</a><a data-author="René Scharfe" data-commit="89d07f750a3f878c42b3de96ee93dc571b42b230" data-file="git.c" href="https://github.com/git/git/commit/89d07f750a3f878c42b3de96ee93dc571b42b230" target="blank" title="diff: don't run pager if user asked for a diff style exit code

As Wincent Colaiuta found out, it's a bit unexpected for git diff to
start a pager even when the --quiet option is specified.  The problem
is that the pager hides the return code -- which is the only output
we're interested in in this case.

Push pager setup down into builtin-diff.c and don't start the pager
if --exit-code or --quiet (which implies --exit-code) was specified.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe">push</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">", cmd_</a><a data-author="Linus Torvalds" data-commit="755225de6ce4c7b39137afefb35208d0dbc14d9d" data-file="git.c" href="https://github.com/git/git/commit/755225de6ce4c7b39137afefb35208d0dbc14d9d" target="blank" title="git builtin "push"

This adds a builtin "push" command, which is largely just a C'ification of
the "git-push.sh" script.

Now, the reason I did it as a built-in is partly because it's yet another
step on relying less on shell, but it's actually mostly because I've
wanted to be able to push to _multiple_ repositories, and the most obvious
and simplest interface for that would seem be to just have a "remotes"
file that has multiple URL entries.

(For "pull", having multiple entries should either just select the first
one, or you could fall back on the others on failure - your choice).

And quite
 - Linus Torvalds">push</a><a data-author="Jeff King" data-commit="6c8d06aff107aa2132648d682a278111c1d08565" data-file="git.c" href="https://github.com/git/git/commit/6c8d06aff107aa2132648d682a278111c1d08565" target="blank" title="git-push: allow pushing from subdirectories

The semantics are equivalent to pushing from the root; we just try harder to
find the .git directory.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Jeff King">,</a><a data-author="Junio C Hamano" data-commit="102cb08521df5f33b30c0ef41a1078a61e593943" data-file="git.c" href="https://github.com/git/git/commit/102cb08521df5f33b30c0ef41a1078a61e593943" target="blank" title="Merge branch 'master' into mk/rename

 - Junio C Hamano"> RUN</a><a data-author="Jeff King" data-commit="6c8d06aff107aa2132648d682a278111c1d08565" data-file="git.c" href="https://github.com/git/git/commit/6c8d06aff107aa2132648d682a278111c1d08565" target="blank" title="git-push: allow pushing from subdirectories

The semantics are equivalent to pushing from the root; we just try harder to
find the .git directory.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Jeff King">_</a><a data-author="Junio C Hamano" data-commit="102cb08521df5f33b30c0ef41a1078a61e593943" data-file="git.c" href="https://github.com/git/git/commit/102cb08521df5f33b30c0ef41a1078a61e593943" target="blank" title="Merge branch 'master' into mk/rename

 - Junio C Hamano">SETUP</a><a data-author="René Scharfe" data-commit="89d07f750a3f878c42b3de96ee93dc571b42b230" data-file="git.c" href="https://github.com/git/git/commit/89d07f750a3f878c42b3de96ee93dc571b42b230" target="blank" title="diff: don't run pager if user asked for a diff style exit code

As Wincent Colaiuta found out, it's a bit unexpected for git diff to
start a pager even when the --quiet option is specified.  The problem
is that the pager hides the return code -- which is the only output
we're interested in in this case.

Push pager setup down into builtin-diff.c and don't start the pager
if --exit-code or --quiet (which implies --exit-code) was specified.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe"> },</a><a data-author="Johannes Schindelin" data-commit="348ae56cb2266d3294611112ae0368386124d720" data-file="git.c" href="https://github.com/git/git/commit/348ae56cb2266d3294611112ae0368386124d720" target="blank" title="Introduce `range-diff` to compare iterations of a topic branch

This command does not do a whole lot so far, apart from showing a usage
that is oddly similar to that of `git tbdiff`. And for a good reason:
the next commits will turn `range-branch` into a full-blown replacement
for `tbdiff`.

At this point, we ignore tbdiff's color options, as they will all be
implemented later using diff_options.

Since f318d739159 (generate-cmds.sh: export all commands to
command-list.h, 2018-05-10), every new command *requires* a man page to
build right away, so let's also add a blank man page, too.

Signed-
 - Johannes Schindelin">
	{ "range-diff"</a><a data-author="Pratik Karki" data-commit="55071ea248ef8040e4b29575376273e4dd061683" data-file="git.c" href="https://github.com/git/git/commit/55071ea248ef8040e4b29575376273e4dd061683" target="blank" title="rebase: start implementing it as a builtin

This commit imitates the strategy that was used to convert the
difftool to a builtin. We start by renaming the shell script
`git-rebase.sh` to `git-legacy-rebase.sh` and introduce a
`builtin/rebase.c` that simply executes the shell script version,
unless the config setting `rebase.useBuiltin` is set to `true`.

The motivation behind this is to rewrite all the functionality of the
shell script version in the aforementioned `rebase.c`, one by one and
be able to conveniently test new features by configuring
`rebase.useBuiltin`.

In the original difftool
 - Pratik Karki">,</a><a data-author="Johannes Schindelin" data-commit="348ae56cb2266d3294611112ae0368386124d720" data-file="git.c" href="https://github.com/git/git/commit/348ae56cb2266d3294611112ae0368386124d720" target="blank" title="Introduce `range-diff` to compare iterations of a topic branch

This command does not do a whole lot so far, apart from showing a usage
that is oddly similar to that of `git tbdiff`. And for a good reason:
the next commits will turn `range-branch` into a full-blown replacement
for `tbdiff`.

At this point, we ignore tbdiff's color options, as they will all be
implemented later using diff_options.

Since f318d739159 (generate-cmds.sh: export all commands to
command-list.h, 2018-05-10), every new command *requires* a man page to
build right away, so let's also add a blank man page, too.

Signed-
 - Johannes Schindelin"> cmd_range_diff,</a><a data-author="Paul Tan" data-commit="73c2779f421fe1eaead6f1c07a0e134a9c17d6db" data-file="git.c" href="https://github.com/git/git/commit/73c2779f421fe1eaead6f1c07a0e134a9c17d6db" target="blank" title="builtin-am: implement skeletal builtin am

For the purpose of rewriting git-am.sh into a C builtin, implement a
skeletal builtin/am.c that redirects to $GIT_EXEC_PATH/git-am if the
environment variable _GIT_USE_BUILTIN_AM is not defined. Since in the
Makefile git-am.sh takes precedence over builtin/am.c,
$GIT_EXEC_PATH/git-am will contain the shell script git-am.sh, and thus
this allows us to fall back on the functional git-am.sh when running the
test suite for tests that depend on a working git-am implementation.

Since git-am.sh cannot handle any environment modifications by
setup_git_direct
 - Paul Tan"> RUN_SETUP |</a><a data-author="Johannes Schindelin" data-commit="348ae56cb2266d3294611112ae0368386124d720" data-file="git.c" href="https://github.com/git/git/commit/348ae56cb2266d3294611112ae0368386124d720" target="blank" title="Introduce `range-diff` to compare iterations of a topic branch

This command does not do a whole lot so far, apart from showing a usage
that is oddly similar to that of `git tbdiff`. And for a good reason:
the next commits will turn `range-branch` into a full-blown replacement
for `tbdiff`.

At this point, we ignore tbdiff's color options, as they will all be
implemented later using diff_options.

Since f318d739159 (generate-cmds.sh: export all commands to
command-list.h, 2018-05-10), every new command *requires* a man page to
build right away, so let's also add a blank man page, too.

Signed-
 - Johannes Schindelin"> USE</a><a data-author="Paul Tan" data-commit="73c2779f421fe1eaead6f1c07a0e134a9c17d6db" data-file="git.c" href="https://github.com/git/git/commit/73c2779f421fe1eaead6f1c07a0e134a9c17d6db" target="blank" title="builtin-am: implement skeletal builtin am

For the purpose of rewriting git-am.sh into a C builtin, implement a
skeletal builtin/am.c that redirects to $GIT_EXEC_PATH/git-am if the
environment variable _GIT_USE_BUILTIN_AM is not defined. Since in the
Makefile git-am.sh takes precedence over builtin/am.c,
$GIT_EXEC_PATH/git-am will contain the shell script git-am.sh, and thus
this allows us to fall back on the functional git-am.sh when running the
test suite for tests that depend on a working git-am implementation.

Since git-am.sh cannot handle any environment modifications by
setup_git_direct
 - Paul Tan">_</a><a data-author="Johannes Schindelin" data-commit="348ae56cb2266d3294611112ae0368386124d720" data-file="git.c" href="https://github.com/git/git/commit/348ae56cb2266d3294611112ae0368386124d720" target="blank" title="Introduce `range-diff` to compare iterations of a topic branch

This command does not do a whole lot so far, apart from showing a usage
that is oddly similar to that of `git tbdiff`. And for a good reason:
the next commits will turn `range-branch` into a full-blown replacement
for `tbdiff`.

At this point, we ignore tbdiff's color options, as they will all be
implemented later using diff_options.

Since f318d739159 (generate-cmds.sh: export all commands to
command-list.h, 2018-05-10), every new command *requires* a man page to
build right away, so let's also add a blank man page, too.

Signed-
 - Johannes Schindelin">PAGER</a><a data-author="Pratik Karki" data-commit="55071ea248ef8040e4b29575376273e4dd061683" data-file="git.c" href="https://github.com/git/git/commit/55071ea248ef8040e4b29575376273e4dd061683" target="blank" title="rebase: start implementing it as a builtin

This commit imitates the strategy that was used to convert the
difftool to a builtin. We start by renaming the shell script
`git-rebase.sh` to `git-legacy-rebase.sh` and introduce a
`builtin/rebase.c` that simply executes the shell script version,
unless the config setting `rebase.useBuiltin` is set to `true`.

The motivation behind this is to rewrite all the functionality of the
shell script version in the aforementioned `rebase.c`, one by one and
be able to conveniently test new features by configuring
`rebase.useBuiltin`.

In the original difftool
 - Pratik Karki"> },</a><a data-author="Peter Eriksen" data-commit="d147e501f37a596e73a430ce46f125f83e06aa07" data-file="git.c" href="https://github.com/git/git/commit/d147e501f37a596e73a430ce46f125f83e06aa07" target="blank" title="Builtin git-read-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "read-tree", cmd_read_tree</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Junio C Hamano" data-commit="2243d229f75be41318db8798fc90399dd6dedb42" data-file="git.c" href="https://github.com/git/git/commit/2243d229f75be41318db8798fc90399dd6dedb42" target="blank" title="Merge branch 'sb/unpack-trees-super-prefix'

"git read-tree" and its underlying unpack_trees() machinery learned
to report problematic paths prefixed with the --super-prefix option.

* sb/unpack-trees-super-prefix:
  unpack-trees: support super-prefix option
  t1001: modernize style
  t1000: modernize style
  read-tree: use OPT_BOOL instead of OPT_SET_INT

 - Junio C Hamano"> | SUPPORT_SUPER_PREFIX</a><a data-author="Peter Eriksen" data-commit="d147e501f37a596e73a430ce46f125f83e06aa07" data-file="git.c" href="https://github.com/git/git/commit/d147e501f37a596e73a430ce46f125f83e06aa07" target="blank" title="Builtin git-read-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">}</a><a data-author="Peter Eriksen" data-commit="6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" data-file="git.c" href="https://github.com/git/git/commit/6d96ac18e52aca19ff1087ffa64e2d616cc75c6f" target="blank" title="Builtin git-commit-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	/</a><a data-author="Junio C Hamano" data-commit="bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" data-file="git.c" href="https://github.com/git/git/commit/bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" target="blank" title="Merge branch 'j6t/mingw'

* j6t/mingw: (38 commits)
  compat/pread.c: Add a forward declaration to fix a warning
  Windows: Fix ntohl() related warnings about printf formatting
  Windows: TMP and TEMP environment variables specify a temporary directory.
  Windows: Make 'git help -a' work.
  Windows: Work around an oddity when a pipe with no reader is written to.
  Windows: Make the pager work.
  When installing, be prepared that template_dir may be relative.
  Windows: Use a relative default template_dir and ETC_GITCONFIG
  Windows: Compute the fallback for exec_path from the program invocatio
 - Junio C Hamano">*</a><a data-author="Johannes Schindelin" data-commit="be8a90e59ce4c7603207a8255284fdbbffff1a2e" data-file="git.c" href="https://github.com/git/git/commit/be8a90e59ce4c7603207a8255284fdbbffff1a2e" target="blank" title="difftool: add a skeleton for the upcoming builtin

This adds a builtin difftool that still falls back to the legacy Perl
version, which has been renamed to `legacy-difftool`.

The idea is that the new, experimental, builtin difftool immediately hands
off to the legacy difftool for now, unless the config variable
difftool.useBuiltin is set to true.

This feature flag will be used in the upcoming Git for Windows v2.11.0
release, to allow early testers to opt-in to use the builtin difftool and
flesh out any bugs.

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Juni
 - Johannes Schindelin">
	 * NEEDSWORK:</a><a data-author="Pratik Karki" data-commit="55071ea248ef8040e4b29575376273e4dd061683" data-file="git.c" href="https://github.com/git/git/commit/55071ea248ef8040e4b29575376273e4dd061683" target="blank" title="rebase: start implementing it as a builtin

This commit imitates the strategy that was used to convert the
difftool to a builtin. We start by renaming the shell script
`git-rebase.sh` to `git-legacy-rebase.sh` and introduce a
`builtin/rebase.c` that simply executes the shell script version,
unless the config setting `rebase.useBuiltin` is set to `true`.

The motivation behind this is to rewrite all the functionality of the
shell script version in the aforementioned `rebase.c`, one by one and
be able to conveniently test new features by configuring
`rebase.useBuiltin`.

In the original difftool
 - Pratik Karki"> Until the rebase is independent and needs no redirection</a><a data-author="Junio C Hamano" data-commit="5ae50845d8a30d7db32e139ce04b712f9deb99cd" data-file="git.c" href="https://github.com/git/git/commit/5ae50845d8a30d7db32e139ce04b712f9deb99cd" target="blank" title="Merge branch 'pk/rebase-in-c'

Rewrite of the "rebase" machinery in C.

* pk/rebase-in-c:
  builtin/rebase: support running "git rebase &lt;upstream&gt;"
  rebase: refactor common shell functions into their own file
  rebase: start implementing it as a builtin

 - Junio C Hamano">
	 * to rebase shell script this is kept as is, then should be changed to
	 * RUN_SETUP | NEED_WORK_TREE</a><a data-author="Andreas Ericsson" data-commit="97fc6c5fbacc2181319bbd7e2faa8ac04476f862" data-file="git.c" href="https://github.com/git/git/commit/97fc6c5fbacc2181319bbd7e2faa8ac04476f862" target="blank" title="git --help COMMAND brings up the git-COMMAND man-page.

It's by design a bit stupid (matching ^git rather than ^git-), so as
to work with 'gitk' and 'git' as well.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
	 */</a><a data-author="Junio C Hamano" data-commit="5ae50845d8a30d7db32e139ce04b712f9deb99cd" data-file="git.c" href="https://github.com/git/git/commit/5ae50845d8a30d7db32e139ce04b712f9deb99cd" target="blank" title="Merge branch 'pk/rebase-in-c'

Rewrite of the "rebase" machinery in C.

* pk/rebase-in-c:
  builtin/rebase: support running "git rebase &lt;upstream&gt;"
  rebase: refactor common shell functions into their own file
  rebase: start implementing it as a builtin

 - Junio C Hamano">
	{ "rebase", cmd_rebase },</a><a data-author="Johannes Schindelin" data-commit="4557f1add261b70887136498084e7491a3f9535f" data-file="git.c" href="https://github.com/git/git/commit/4557f1add261b70887136498084e7491a3f9535f" target="blank" title="rebase--helper: add a builtin helper for interactive rebases

Git's interactive rebase is still implemented as a shell script, despite
its complexity. This implies that it suffers from the portability point
of view, from lack of expressibility, and of course also from
performance. The latter issue is particularly serious on Windows, where
we pay a hefty price for relying so much on POSIX.

Unfortunately, being such a huge shell script also means that we missed
the train when it would have been relatively easy to port it to C, and
instead piled feature upon feature onto that poor script that or
 - Johannes Schindelin">
	{ "rebase--</a><a data-author="Junio C Hamano" data-commit="b49ef560ed66449d24a3fdfe25972c390bb44951" data-file="git.c" href="https://github.com/git/git/commit/b49ef560ed66449d24a3fdfe25972c390bb44951" target="blank" title="Merge branch 'ag/rebase-i-in-c'

Rewrite of the remaining "rebase -i" machinery in C.

* ag/rebase-i-in-c:
  rebase -i: move rebase--helper modes to rebase--interactive
  rebase -i: remove git-rebase--interactive.sh
  rebase--interactive2: rewrite the submodes of interactive rebase in C
  rebase -i: implement the main part of interactive rebase as a builtin
  rebase -i: rewrite init_basic_state() in C
  rebase -i: rewrite write_basic_state() in C
  rebase -i: rewrite the rest of init_revisions_and_shortrevisions() in C
  rebase -i: implement the logic to initialize $revisions in C
  rebase -i:
 - Junio C Hamano">interactive</a><a data-author="Johannes Schindelin" data-commit="4557f1add261b70887136498084e7491a3f9535f" data-file="git.c" href="https://github.com/git/git/commit/4557f1add261b70887136498084e7491a3f9535f" target="blank" title="rebase--helper: add a builtin helper for interactive rebases

Git's interactive rebase is still implemented as a shell script, despite
its complexity. This implies that it suffers from the portability point
of view, from lack of expressibility, and of course also from
performance. The latter issue is particularly serious on Windows, where
we pay a hefty price for relying so much on POSIX.

Unfortunately, being such a huge shell script also means that we missed
the train when it would have been relatively easy to port it to C, and
instead piled feature upon feature onto that poor script that or
 - Johannes Schindelin">", cmd_rebase__</a><a data-author="Junio C Hamano" data-commit="b49ef560ed66449d24a3fdfe25972c390bb44951" data-file="git.c" href="https://github.com/git/git/commit/b49ef560ed66449d24a3fdfe25972c390bb44951" target="blank" title="Merge branch 'ag/rebase-i-in-c'

Rewrite of the remaining "rebase -i" machinery in C.

* ag/rebase-i-in-c:
  rebase -i: move rebase--helper modes to rebase--interactive
  rebase -i: remove git-rebase--interactive.sh
  rebase--interactive2: rewrite the submodes of interactive rebase in C
  rebase -i: implement the main part of interactive rebase as a builtin
  rebase -i: rewrite init_basic_state() in C
  rebase -i: rewrite write_basic_state() in C
  rebase -i: rewrite the rest of init_revisions_and_shortrevisions() in C
  rebase -i: implement the logic to initialize $revisions in C
  rebase -i:
 - Junio C Hamano">interactive</a><a data-author="Johannes Schindelin" data-commit="4557f1add261b70887136498084e7491a3f9535f" data-file="git.c" href="https://github.com/git/git/commit/4557f1add261b70887136498084e7491a3f9535f" target="blank" title="rebase--helper: add a builtin helper for interactive rebases

Git's interactive rebase is still implemented as a shell script, despite
its complexity. This implies that it suffers from the portability point
of view, from lack of expressibility, and of course also from
performance. The latter issue is particularly serious on Windows, where
we pay a hefty price for relying so much on POSIX.

Unfortunately, being such a huge shell script also means that we missed
the train when it would have been relatively easy to port it to C, and
instead piled feature upon feature onto that poor script that or
 - Johannes Schindelin">, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Junio C Hamano" data-commit="be5908aed35d1c129f1ea38913b230ee1927361b" data-file="git.c" href="https://github.com/git/git/commit/be5908aed35d1c129f1ea38913b230ee1927361b" target="blank" title="receive-pack: make it a builtin

It is a good thing to do in general, but more importantly, transport
routines can only be used by built-ins, which is what I'll be adding next.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	{ "receive-pack", cmd_receive_pack },</a><a data-author="Junio C Hamano" data-commit="e8b4029f990907e24fac0e7772ee19ee6dd55c1c" data-file="git.c" href="https://github.com/git/git/commit/e8b4029f990907e24fac0e7772ee19ee6dd55c1c" target="blank" title="Merge branch 'jc/fsck-reflog'

* jc/fsck-reflog:
  Add git-reflog to .gitignore
  reflog expire: do not punt on tags that point at non commits.
  reflog expire: prune commits that are not incomplete
  Don't crash during repack of a reflog with pruned commits.
  git reflog expire
  Move in_merge_bases() to commit.c
  reflog: fix warning message.
  Teach git-repack to preserve objects referred to by reflog entries.
  Protect commits recorded in reflog from pruning.
  add for_each_reflog_ent() iterator

 - Junio C Hamano">
	{ "reflog", cmd_reflog, RUN_SETUP },</a><a data-author="Johannes Schindelin" data-commit="211c89682eeef310f39022b91e88d07cd5784953" data-file="git.c" href="https://github.com/git/git/commit/211c89682eeef310f39022b91e88d07cd5784953" target="blank" title="Make git-remote a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Johannes Schindelin">
	{ "remote", cmd_remote, RUN_SETUP },</a><a data-author="Ilari Liusvaara" data-commit="7f3ecebfcda9b32252a4791dc716c1e3d88c9f70" data-file="git.c" href="https://github.com/git/git/commit/7f3ecebfcda9b32252a4791dc716c1e3d88c9f70" target="blank" title="git-remote-ext

This remote helper invokes external command and passes raw smart transport
stream through it. This is useful for instance for invoking ssh with
one-off odd options, connecting to git services in unix domain
sockets, in abstract namespace, using TLS or other secure protocols,
etc...

Signed-off-by: Ilari Liusvaara &lt;ilari.liusvaara@elisanet.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ilari Liusvaara">
	{ "remote-ext", cmd_remote_ext</a><a data-author="Junio C Hamano" data-commit="b10edb2df55241b2e042b3d5473537904d09d193" data-file="git.c" href="https://github.com/git/git/commit/b10edb2df55241b2e042b3d5473537904d09d193" target="blank" title="Merge branch 'ds/commit-graph'

Precompute and store information necessary for ancestry traversal
in a separate file to optimize graph walking.

* ds/commit-graph:
  commit-graph: implement "--append" option
  commit-graph: build graph from starting commits
  commit-graph: read only from specific pack-indexes
  commit: integrate commit graph with commit parsing
  commit-graph: close under reachability
  commit-graph: add core.commitGraph setting
  commit-graph: implement git commit-graph read
  commit-graph: implement git-commit-graph write
  commit-graph: implement write_commit_graph()
  comm
 - Junio C Hamano">,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> NO_PARSEOPT</a><a data-author="Ilari Liusvaara" data-commit="7f3ecebfcda9b32252a4791dc716c1e3d88c9f70" data-file="git.c" href="https://github.com/git/git/commit/7f3ecebfcda9b32252a4791dc716c1e3d88c9f70" target="blank" title="git-remote-ext

This remote helper invokes external command and passes raw smart transport
stream through it. This is useful for instance for invoking ssh with
one-off odd options, connecting to git services in unix domain
sockets, in abstract namespace, using TLS or other secure protocols,
etc...

Signed-off-by: Ilari Liusvaara &lt;ilari.liusvaara@elisanet.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ilari Liusvaara"> },</a><a data-author="Ilari Liusvaara" data-commit="3a9ed4bdee5032ecb9328aea51a752d69a2d966e" data-file="git.c" href="https://github.com/git/git/commit/3a9ed4bdee5032ecb9328aea51a752d69a2d966e" target="blank" title="git-remote-fd

This remote helper reflects raw smart remote transport stream back to the
calling program. This is useful for example if some UI wants to handle
ssh itself and not use hacks via GIT_SSH.

Signed-off-by: Ilari Liusvaara &lt;ilari.liusvaara@elisanet.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ilari Liusvaara">
	{ "remote-fd", cmd_remote_fd</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Ilari Liusvaara" data-commit="3a9ed4bdee5032ecb9328aea51a752d69a2d966e" data-file="git.c" href="https://github.com/git/git/commit/3a9ed4bdee5032ecb9328aea51a752d69a2d966e" target="blank" title="git-remote-fd

This remote helper reflects raw smart remote transport stream back to the
calling program. This is useful for example if some UI wants to handle
ssh itself and not use hacks via GIT_SSH.

Signed-off-by: Ilari Liusvaara &lt;ilari.liusvaara@elisanet.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ilari Liusvaara"> },</a><a data-author="Junio C Hamano" data-commit="dec034a34e3887beaea9a7a390fd950346806c1e" data-file="git.c" href="https://github.com/git/git/commit/dec034a34e3887beaea9a7a390fd950346806c1e" target="blank" title="Merge branch 'sb/repack-in-c'

Rewrite "git repack" in C.

* sb/repack-in-c:
  repack: improve warnings about failure of renaming and removing files
  repack: retain the return value of pack-objects
  repack: rewrite the shell script in C

 - Junio C Hamano">
	{ "repack", cmd_repack, RUN_SETUP },</a><a data-author="Christian Couder" data-commit="54b0c1e041e50cc08b1520b7d557770916d0b7ab" data-file="git.c" href="https://github.com/git/git/commit/54b0c1e041e50cc08b1520b7d557770916d0b7ab" target="blank" title="Add new "git replace" command

This command can only be used now to list replace refs in
"refs/replace/" and to delete them.

The option to list replace refs is "-l".
The option to delete replace refs is "-d".

The behavior should be consistent with how "git tag" and "git branch"
are working.

The code has been copied from "builtin-tag.c" by Kristian Høgsberg
&lt;krh@redhat.com&gt; and Carlos Rica &lt;jasampler@gmail.com&gt; that was itself
based on git-tag.sh and mktag.c by Linus Torvalds.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder">
	{ "replace", cmd_replace, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="9def2138a17325c68961c3b1e6c967d33f28a4f1" data-file="git.c" href="https://github.com/git/git/commit/9def2138a17325c68961c3b1e6c967d33f28a4f1" target="blank" title="Merge branch 'js/rerere'

* js/rerere:
  Make git-rerere a builtin
  Add a test for git-rerere
  move read_mmfile() into xdiff-interface

 - Junio C Hamano">
	{ "rerere", cmd_rerere, RUN_SETUP },</a><a data-author="Carlos Rica" data-commit="0e5a7faa3a903cf7a0a66c81e20a76b91f17faab" data-file="git.c" href="https://github.com/git/git/commit/0e5a7faa3a903cf7a0a66c81e20a76b91f17faab" target="blank" title="Make "git reset" a builtin.

This replaces the script "git-reset.sh" with "builtin-reset.c".

A few git commands used in the script are called from the builtin also:
"ls-files" to check for unmerged files, "read-tree" for resetting
the index file in "mixed" and "hard" resets, and "update-index" to
refresh at the end in the "mixed" reset and also for the option that
gets selected paths into the index.

The reset option with paths was implemented by Johannes Schindelin.

Since the option that gets selected paths into the index is not
a "reset" like the others because it does not change the HEAD 
 - Carlos Rica">
	{ "reset", cmd_reset, RUN_SETUP },</a><a data-author="Junio C Hamano" data-commit="376bb3a352d6512a318706c2fba5737ffd7cc92b" data-file="git.c" href="https://github.com/git/git/commit/376bb3a352d6512a318706c2fba5737ffd7cc92b" target="blank" title="Merge branch 'lt/dirwalk'

This makes 'git add' and 'git rm' built-ins.

* lt/dirwalk:
  Add builtin "git rm" command
  Move pathspec matching from builtin-add.c into dir.c
  Prevent bogus paths from being added to the index.
  builtin-add: fix unmatched pathspec warnings.
  Remove old "git-add.sh" remnants
  builtin-add: warn on unmatched pathspecs
  Do "git add" as a builtin
  Clean up git-ls-file directory walking library interface
  libify git-ls-files directory traversal

 - Junio C Hamano">
	{ "</a><a data-author="Linus Torvalds" data-commit="5fb61b8dcfdf7bcec0793c071813e255d1803859" data-file="git.c" href="https://github.com/git/git/commit/5fb61b8dcfdf7bcec0793c071813e255d1803859" target="blank" title="Make "git rev-list" be a builtin

This was surprisingly easy. The diff is truly minimal: rename "main()" to
"cmd_rev_list()" in rev-list.c, and rename the whole file to reflect its
new built-in status.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">rev-list</a><a data-author="Peter Eriksen" data-commit="56d1398ad305498faf57d6e433f97ad393d7909e" data-file="git.c" href="https://github.com/git/git/commit/56d1398ad305498faf57d6e433f97ad393d7909e" target="blank" title="Builtin git-tar-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">", cmd_</a><a data-author="Junio C Hamano" data-commit="376bb3a352d6512a318706c2fba5737ffd7cc92b" data-file="git.c" href="https://github.com/git/git/commit/376bb3a352d6512a318706c2fba5737ffd7cc92b" target="blank" title="Merge branch 'lt/dirwalk'

This makes 'git add' and 'git rm' built-ins.

* lt/dirwalk:
  Add builtin "git rm" command
  Move pathspec matching from builtin-add.c into dir.c
  Prevent bogus paths from being added to the index.
  builtin-add: fix unmatched pathspec warnings.
  Remove old "git-add.sh" remnants
  builtin-add: warn on unmatched pathspecs
  Do "git add" as a builtin
  Clean up git-ls-file directory walking library interface
  libify git-ls-files directory traversal

 - Junio C Hamano">rev</a><a data-author="Peter Eriksen" data-commit="56d1398ad305498faf57d6e433f97ad393d7909e" data-file="git.c" href="https://github.com/git/git/commit/56d1398ad305498faf57d6e433f97ad393d7909e" target="blank" title="Builtin git-tar-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">_</a><a data-author="Junio C Hamano" data-commit="376bb3a352d6512a318706c2fba5737ffd7cc92b" data-file="git.c" href="https://github.com/git/git/commit/376bb3a352d6512a318706c2fba5737ffd7cc92b" target="blank" title="Merge branch 'lt/dirwalk'

This makes 'git add' and 'git rm' built-ins.

* lt/dirwalk:
  Add builtin "git rm" command
  Move pathspec matching from builtin-add.c into dir.c
  Prevent bogus paths from being added to the index.
  builtin-add: fix unmatched pathspec warnings.
  Remove old "git-add.sh" remnants
  builtin-add: warn on unmatched pathspecs
  Do "git add" as a builtin
  Clean up git-ls-file directory walking library interface
  libify git-ls-files directory traversal

 - Junio C Hamano">list</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Peter Eriksen" data-commit="56d1398ad305498faf57d6e433f97ad393d7909e" data-file="git.c" href="https://github.com/git/git/commit/56d1398ad305498faf57d6e433f97ad393d7909e" target="blank" title="Builtin git-tar-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="d147e501f37a596e73a430ce46f125f83e06aa07" data-file="git.c" href="https://github.com/git/git/commit/d147e501f37a596e73a430ce46f125f83e06aa07" target="blank" title="Builtin git-read-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Christian Couder" data-commit="895f10c3b596ef955c7f252717e5b4668530c569" data-file="git.c" href="https://github.com/git/git/commit/895f10c3b596ef955c7f252717e5b4668530c569" target="blank" title="Builtin git-rev-parse.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Christian Couder">
	{ "rev-parse", cmd_rev_parse</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Christian Couder" data-commit="895f10c3b596ef955c7f252717e5b4668530c569" data-file="git.c" href="https://github.com/git/git/commit/895f10c3b596ef955c7f252717e5b4668530c569" target="blank" title="Builtin git-rev-parse.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Christian Couder"> }</a><a data-author="Lukas Sandström" data-commit="8ed05fb5e90f8ad2051ff7071b7425a53c594892" data-file="git.c" href="https://github.com/git/git/commit/8ed05fb5e90f8ad2051ff7071b7425a53c594892" target="blank" title="Make git-write-tree a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	{ "revert", cmd_revert, RUN_SETUP |</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer"> NEED</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">_</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">WORK_TREE</a><a data-author="Johannes Schindelin" data-commit="9509af686bffdbd7c3f17faf3c07d2034d480ffc" data-file="git.c" href="https://github.com/git/git/commit/9509af686bffdbd7c3f17faf3c07d2034d480ffc" target="blank" title="Make git-revert &amp; git-cherry-pick a builtin

Signed-off-by: Johannes Schindelin &lt;johannes.schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> },</a><a data-author="Junio C Hamano" data-commit="217542640ed219c980fff2b3c307c4520120f20f" data-file="git.c" href="https://github.com/git/git/commit/217542640ed219c980fff2b3c307c4520120f20f" target="blank" title="built-in tar-tree and remote tar-tree

This makes tar-tree a built-in.  As an added bonus, you can now
say:

	git tar-tree --remote=remote-repository &lt;ent&gt; [&lt;base&gt;]

This does not work with git-daemon yet, but should work with
localhost and git over ssh transports.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy">rm</a><a data-author="Junio C Hamano" data-commit="217542640ed219c980fff2b3c307c4520120f20f" data-file="git.c" href="https://github.com/git/git/commit/217542640ed219c980fff2b3c307c4520120f20f" target="blank" title="built-in tar-tree and remote tar-tree

This makes tar-tree a built-in.  As an added bonus, you can now
say:

	git tar-tree --remote=remote-repository &lt;ent&gt; [&lt;base&gt;]

This does not work with git-daemon yet, but should work with
localhost and git over ssh transports.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">", cmd_</a><a data-author="Linus Torvalds" data-commit="d9b814cc97f16daac06566a5340121c446136d22" data-file="git.c" href="https://github.com/git/git/commit/d9b814cc97f16daac06566a5340121c446136d22" target="blank" title="Add builtin "git rm" command

This changes semantics very subtly, because it adds a new atomicity
guarantee.

In particular, if you "git rm" several files, it will now do all or
nothing. The old shell-script really looped over the removed files one by
one, and would basically randomly fail in the middle if "-f" was used and
one of the files didn't exist in the working directory.

This C builtin one will not re-write the index after each remove, but
instead remove all files at once. However, that means that if "-f" is used
(to also force removal of the file from the working directory), and some
 - Linus Torvalds">rm</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy"> },</a><a data-author="Daniel Barkalow" data-commit="96249c04c07f00485a3ed1052ff10b27ab147fc5" data-file="git.c" href="https://github.com/git/git/commit/96249c04c07f00485a3ed1052ff10b27ab147fc5" target="blank" title="Build-in send-pack, with an API for other programs to call.

Also marks some more things as const, as needed.

Signed-off-by: Daniel Barkalow &lt;barkalow@iabervon.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Daniel Barkalow">
	{ "send-pack", cmd_send_pack, RUN_SETUP },</a><a data-author="Brandon Williams" data-commit="ed10cb952d315ae47d2f7f6f29333a9ee227bf6b" data-file="git.c" href="https://github.com/git/git/commit/ed10cb952d315ae47d2f7f6f29333a9ee227bf6b" target="blank" title="serve: introduce git-serve

Introduce git-serve, the base server for protocol version 2.

Protocol version 2 is intended to be a replacement for Git's current
wire protocol.  The intention is that it will be a simpler, less
wasteful protocol which can evolve over time.

Protocol version 2 improves upon version 1 by eliminating the initial
ref advertisement.  In its place a server will export a list of
capabilities and commands which it supports in a capability
advertisement.  A client can then request that a particular command be
executed by providing a number of capabilities and command speci
 - Brandon Williams">
	{ "serve", cmd_serve, RUN_SETUP },</a><a data-author="Johannes Schindelin" data-commit="b8ec59234ba2c1833e29eece9ed87f7a471cbae2" data-file="git.c" href="https://github.com/git/git/commit/b8ec59234ba2c1833e29eece9ed87f7a471cbae2" target="blank" title="Build in shortlog

[jc: with minimum squelching of compiler warning under "-pedantic"
 compilation options.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	{ "shortlog", cmd_shortlog,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="773b69bf7189f5babb26b899b4c35f604cd993c7" data-file="git.c" href="https://github.com/git/git/commit/773b69bf7189f5babb26b899b4c35f604cd993c7" target="blank" title="shortlog: run setup_git_directory_gently() sooner

shortlog already runs a repository search unconditionally;
running such a search earlier is not very risky.

Without this change, the “[pager] shortlog” configuration
is not respected at all: “git shortlog” unconditionally paginates.

The tests are a bit slow.  Running the full battery like this
for all built-in commands would be counterproductive; the intent is
rather to test shortlog as a representative example command using
..._gently().

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.co
 - Nguyễn Thái Ngọc Duy"> RUN_SETUP_GENTLY |</a><a data-author="Johannes Schindelin" data-commit="1d541c120b4de5c70e73f8a20e1d961324cc55fe" data-file="git.c" href="https://github.com/git/git/commit/1d541c120b4de5c70e73f8a20e1d961324cc55fe" target="blank" title="shortlog: use pager

On request of the kingpenguin, shortlog now uses the pager if output
goes to a tty.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> USE_PAGER</a><a data-author="Johannes Schindelin" data-commit="b8ec59234ba2c1833e29eece9ed87f7a471cbae2" data-file="git.c" href="https://github.com/git/git/commit/b8ec59234ba2c1833e29eece9ed87f7a471cbae2" target="blank" title="Build in shortlog

[jc: with minimum squelching of compiler warning under "-pedantic"
 compilation options.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> },</a><a data-author="Linus Torvalds" data-commit="ba1d45051e050cbcf68ccccacea86a4b6ecde731" data-file="git.c" href="https://github.com/git/git/commit/ba1d45051e050cbcf68ccccacea86a4b6ecde731" target="blank" title="Tentative built-in "git show"

This uses the "--no-walk" flag that I never actually implemented (but I'm
sure I mentioned it) to make "git show" be essentially the same thing as
"git whatchanged --no-walk".

It just refuses to add more interesting parents to the revision walking
history, so you don't actually get any history, you just get the commit
you asked for.

I was going to add "--no-walk" as a real argument flag to git-rev-list
too, but I'm not sure anybody actually needs it. Although it might be
useful for porcelain, so I left the door open.

[jc: ported to the unified option structure
 - Linus Torvalds">
	{ "show", cmd_show</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Linus Torvalds" data-commit="ba1d45051e050cbcf68ccccacea86a4b6ecde731" data-file="git.c" href="https://github.com/git/git/commit/ba1d45051e050cbcf68ccccacea86a4b6ecde731" target="blank" title="Tentative built-in "git show"

This uses the "--no-walk" flag that I never actually implemented (but I'm
sure I mentioned it) to make "git show" be essentially the same thing as
"git whatchanged --no-walk".

It just refuses to add more interesting parents to the revision walking
history, so you don't actually get any history, you just get the commit
you asked for.

I was going to add "--no-walk" as a real argument flag to git-rev-list
too, but I'm not sure anybody actually needs it. Although it might be
useful for porcelain, so I left the door open.

[jc: ported to the unified option structure
 - Linus Torvalds"> },</a><a data-author="Peter Eriksen" data-commit="51ce34b9923d9b119ac53414584f80e05520abea" data-file="git.c" href="https://github.com/git/git/commit/51ce34b9923d9b119ac53414584f80e05520abea" target="blank" title="Builtin git-show-branch.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">
	{ "show-branch", cmd_show_branch</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Peter Eriksen" data-commit="51ce34b9923d9b119ac53414584f80e05520abea" data-file="git.c" href="https://github.com/git/git/commit/51ce34b9923d9b119ac53414584f80e05520abea" target="blank" title="Builtin git-show-branch.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen"> }</a><a data-author="Peter Eriksen" data-commit="e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" data-file="git.c" href="https://github.com/git/git/commit/e8cc9cd98e2ecd7fd8bb03e725d470405c8e2b94" target="blank" title="Builtin git-diff-files, git-diff-index, git-diff-stages, and git-diff-tree.

Signed-off-by: Peter Eriksen &lt;s022018@student.dtu.dk&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Peter Eriksen">,</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano">
	{ "</a><a data-author="Junio C Hamano" data-commit="ae533c4a92aef6ab180441dbb76ef83521fc87d6" data-file="git.c" href="https://github.com/git/git/commit/ae533c4a92aef6ab180441dbb76ef83521fc87d6" target="blank" title="Merge branch 'jm/cache-entry-from-mem-pool'

For a large tree, the index needs to hold many cache entries
allocated on heap.  These cache entries are now allocated out of a
dedicated memory pool to amortize malloc(3) overhead.

* jm/cache-entry-from-mem-pool:
  block alloc: add validations around cache_entry lifecyle
  block alloc: allocate cache entries from mem_pool
  mem-pool: fill out functionality
  mem-pool: add life cycle management functions
  mem-pool: only search head block for available space
  block alloc: add lifecycle APIs for cache_entry structs
  read-cache: teach make_cache_en
 - Junio C Hamano">show</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano">-index", cmd</a><a data-author="Derrick Stolee" data-commit="6a257f03ba9b86c744064d08df98db1847cf1722" data-file="git.c" href="https://github.com/git/git/commit/6a257f03ba9b86c744064d08df98db1847cf1722" target="blank" title="multi-pack-index: add builtin

This new 'git multi-pack-index' builtin will be the plumbing access
for writing, reading, and checking multi-pack-index files. The
initial implementation is a no-op.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">_</a><a data-author="Junio C Hamano" data-commit="ae533c4a92aef6ab180441dbb76ef83521fc87d6" data-file="git.c" href="https://github.com/git/git/commit/ae533c4a92aef6ab180441dbb76ef83521fc87d6" target="blank" title="Merge branch 'jm/cache-entry-from-mem-pool'

For a large tree, the index needs to hold many cache entries
allocated on heap.  These cache entries are now allocated out of a
dedicated memory pool to amortize malloc(3) overhead.

* jm/cache-entry-from-mem-pool:
  block alloc: add validations around cache_entry lifecyle
  block alloc: allocate cache entries from mem_pool
  mem-pool: fill out functionality
  mem-pool: add life cycle management functions
  mem-pool: only search head block for available space
  block alloc: add lifecycle APIs for cache_entry structs
  read-cache: teach make_cache_en
 - Junio C Hamano">show</a><a data-author="Derrick Stolee" data-commit="6a257f03ba9b86c744064d08df98db1847cf1722" data-file="git.c" href="https://github.com/git/git/commit/6a257f03ba9b86c744064d08df98db1847cf1722" target="blank" title="multi-pack-index: add builtin

This new 'git multi-pack-index' builtin will be the plumbing access
for writing, reading, and checking multi-pack-index files. The
initial implementation is a no-op.

Signed-off-by: Derrick Stolee &lt;dstolee@microsoft.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Derrick Stolee">_</a><a data-author="Junio C Hamano" data-commit="ae533c4a92aef6ab180441dbb76ef83521fc87d6" data-file="git.c" href="https://github.com/git/git/commit/ae533c4a92aef6ab180441dbb76ef83521fc87d6" target="blank" title="Merge branch 'jm/cache-entry-from-mem-pool'

For a large tree, the index needs to hold many cache entries
allocated on heap.  These cache entries are now allocated out of a
dedicated memory pool to amortize malloc(3) overhead.

* jm/cache-entry-from-mem-pool:
  block alloc: add validations around cache_entry lifecyle
  block alloc: allocate cache entries from mem_pool
  mem-pool: fill out functionality
  mem-pool: add life cycle management functions
  mem-pool: only search head block for available space
  block alloc: add lifecycle APIs for cache_entry structs
  read-cache: teach make_cache_en
 - Junio C Hamano">index</a><a data-author="Junio C Hamano" data-commit="fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" data-file="git.c" href="https://github.com/git/git/commit/fa82bb70d9ef3acb6a47cddfb38a7b0ca40ac362" target="blank" title="Merge branch 'jk/show-index'

Modernize a less often used command.

* jk/show-index:
  show-index: update documentation for index v2
  make show-index a builtin

 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="e9800b28c24465377dc2b8e26b322d362912647c" data-file="git.c" href="https://github.com/git/git/commit/e9800b28c24465377dc2b8e26b322d362912647c" target="blank" title="Merge branch 'jc/lt-ref2-with-lt-refs' into jc/ref-locking

* jc/lt-ref2-with-lt-refs:
  Fix show-ref usage for --dereference.
  Document git-show-ref [-s|--hash] option.
  Add man page for git-show-ref
  gitignore: git-show-ref is a generated file.
  Use Linus' show ref in "git-branch.sh".
  Add [-s|--hash] option to Linus' show-ref.
  Teach "git checkout" to use git-show-ref
  Add "git show-ref" builtin command

 - Junio C Hamano">
	{ "show-ref", cmd_show_ref, RUN_SETUP },</a><a data-author="Scott Chacon" data-commit="11920d28da1ac1b65eb4041c1b7355924e5d1366" data-file="git.c" href="https://github.com/git/git/commit/11920d28da1ac1b65eb4041c1b7355924e5d1366" target="blank" title="Add a built-in alias for 'stage' to the 'add' command

This comes from conversation at the GitTogether where we thought it would
be helpful to be able to teach people to 'stage' files because it tends
to cause confusion when told that they have to keep 'add'ing them.

This continues the movement to start referring to the index as a
staging area (eg: the --staged alias to 'git diff'). Also adds a
doc file for 'git stage' that basically points to the docs for
'git add'.

Signed-off-by: Scott Chacon &lt;schacon@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott Chacon">
	{ "stage", cmd_add, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Junio C Hamano" data-commit="131f0315c46c30d5a9e6743354808230cf4908c0" data-file="git.c" href="https://github.com/git/git/commit/131f0315c46c30d5a9e6743354808230cf4908c0" target="blank" title="Merge branch 'pr/use-default-sigpipe-setting'

We used to get confused when a process called us with SIGPIPE
ignored; we do want to die with SIGPIPE when the output is not
read by default, and do ignore the signal when appropriate.

* pr/use-default-sigpipe-setting:
  mingw.h: add dummy functions for sigset_t operations
  unblock and unignore SIGPIPE

 - Junio C Hamano">
	/*</a><a data-author="Johannes Schindelin" data-commit="90a462725ef3932a2408e78a47e3dfc1b8d445cf" data-file="git.c" href="https://github.com/git/git/commit/90a462725ef3932a2408e78a47e3dfc1b8d445cf" target="blank" title="stash: optionally use the scripted version again

We recently converted the `git stash` command from Unix shell scripts
to builtins.

Let's end users a way out when they discover a bug in the
builtin command: `stash.useBuiltin`.

As the file name `git-stash` is already in use, let's rename the
scripted backend to `git-legacy-stash`.

To make the test suite pass with `stash.useBuiltin=false`, this commit
also backports rudimentary support for `-q` (but only *just* enough
to appease the test suite), and adds a super-ugly hack to force exit
code 129 for `git stash -h`.

Signed-off-by: Johannes Sc
 - Johannes Schindelin">
	 * NEEDSWORK: Until the builtin</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb"> stash</a><a data-author="Johannes Schindelin" data-commit="90a462725ef3932a2408e78a47e3dfc1b8d445cf" data-file="git.c" href="https://github.com/git/git/commit/90a462725ef3932a2408e78a47e3dfc1b8d445cf" target="blank" title="stash: optionally use the scripted version again

We recently converted the `git stash` command from Unix shell scripts
to builtins.

Let's end users a way out when they discover a bug in the
builtin command: `stash.useBuiltin`.

As the file name `git-stash` is already in use, let's rename the
scripted backend to `git-legacy-stash`.

To make the test suite pass with `stash.useBuiltin=false`, this commit
also backports rudimentary support for `-q` (but only *just* enough
to appease the test suite), and adds a super-ugly hack to force exit
code 129 for `git stash -h`.

Signed-off-by: Johannes Sc
 - Johannes Schindelin"> is thoroughly robust and no
	 * longer needs redirection to the stash shell script this is kept as
	 * is</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb">,</a><a data-author="Johannes Schindelin" data-commit="90a462725ef3932a2408e78a47e3dfc1b8d445cf" data-file="git.c" href="https://github.com/git/git/commit/90a462725ef3932a2408e78a47e3dfc1b8d445cf" target="blank" title="stash: optionally use the scripted version again

We recently converted the `git stash` command from Unix shell scripts
to builtins.

Let's end users a way out when they discover a bug in the
builtin command: `stash.useBuiltin`.

As the file name `git-stash` is already in use, let's rename the
scripted backend to `git-legacy-stash`.

To make the test suite pass with `stash.useBuiltin=false`, this commit
also backports rudimentary support for `-q` (but only *just* enough
to appease the test suite), and adds a super-ugly hack to force exit
code 129 for `git stash -h`.

Signed-off-by: Johannes Sc
 - Johannes Schindelin"> then should be changed to</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler"> RUN_</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb">SETUP | NEED</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">_</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb">WORK</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">_</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb">TREE</a><a data-author="Junio C Hamano" data-commit="bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" data-file="git.c" href="https://github.com/git/git/commit/bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" target="blank" title="Merge branch 'j6t/mingw'

* j6t/mingw: (38 commits)
  compat/pread.c: Add a forward declaration to fix a warning
  Windows: Fix ntohl() related warnings about printf formatting
  Windows: TMP and TEMP environment variables specify a temporary directory.
  Windows: Make 'git help -a' work.
  Windows: Work around an oddity when a pipe with no reader is written to.
  Windows: Make the pager work.
  When installing, be prepared that template_dir may be relative.
  Windows: Use a relative default template_dir and ETC_GITCONFIG
  Windows: Compute the fallback for exec_path from the program invocatio
 - Junio C Hamano">
	 */</a><a data-author="Johannes Schindelin" data-commit="90a462725ef3932a2408e78a47e3dfc1b8d445cf" data-file="git.c" href="https://github.com/git/git/commit/90a462725ef3932a2408e78a47e3dfc1b8d445cf" target="blank" title="stash: optionally use the scripted version again

We recently converted the `git stash` command from Unix shell scripts
to builtins.

Let's end users a way out when they discover a bug in the
builtin command: `stash.useBuiltin`.

As the file name `git-stash` is already in use, let's rename the
scripted backend to `git-legacy-stash`.

To make the test suite pass with `stash.useBuiltin=false`, this commit
also backports rudimentary support for `-q` (but only *just* enough
to appease the test suite), and adds a super-ugly hack to force exit
code 129 for `git stash -h`.

Signed-off-by: Johannes Sc
 - Johannes Schindelin">
	{ "stash", cmd_stash</a><a data-author="Joel Teichroeb" data-commit="8a0fc8d19dff0c0ed09ce6656e353daf06c21892" data-file="git.c" href="https://github.com/git/git/commit/8a0fc8d19dff0c0ed09ce6656e353daf06c21892" target="blank" title="stash: convert apply to builtin

Add a builtin helper for performing stash commands. Converting
all at once proved hard to review, so starting with just apply
lets conversion get started without the other commands being
finished.

The helper is being implemented as a drop in replacement for
stash so that when it is complete it can simply be renamed and
the shell script deleted.

Delete the contents of the apply_stash shell function and replace
it with a call to stash--helper apply until pop is also
converted.

Signed-off-by: Joel Teichroeb &lt;joel@teichroeb.net&gt;
Signed-off-by: Paul-Sebastian Ung
 - Joel Teichroeb"> }</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">,</a><a data-author="Kristian Høgsberg" data-commit="f5bbc3225c4b073a7ff3218164a0c820299bc9c6" data-file="git.c" href="https://github.com/git/git/commit/f5bbc3225c4b073a7ff3218164a0c820299bc9c6" target="blank" title="Port git commit to C.

This makes git commit a builtin and moves git-commit.sh to
contrib/examples.  This also removes the git-runstatus
helper, which was mostly just a git-status.sh implementation detail.

Signed-off-by: Kristian Høgsberg &lt;krh@redhat.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kristian Høgsberg">
	{ "status", cmd_status, RUN_SETUP | NEED_WORK_TREE },</a><a data-author="Lukas Sandström" data-commit="7499c996156ea99702fe13e203b97ae60d8868ad" data-file="git.c" href="https://github.com/git/git/commit/7499c996156ea99702fe13e203b97ae60d8868ad" target="blank" title="Make git-stripspace a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "stripspace", cmd_stripspace }</a><a data-author="Lukas Sandström" data-commit="fefe81c9964a12394d6ea81ce474ff402f0eb070" data-file="git.c" href="https://github.com/git/git/commit/fefe81c9964a12394d6ea81ce474ff402f0eb070" target="blank" title="Make git-update-index a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,</a><a data-author="Junio C Hamano" data-commit="65e1449614d3af34a022007cd335d0e563dea721" data-file="git.c" href="https://github.com/git/git/commit/65e1449614d3af34a022007cd335d0e563dea721" target="blank" title="Merge branch 'sb/submodule-helper'

The infrastructure to rewrite "git submodule" in C is being built
incrementally.  Let's polish these early parts well enough and make
them graduate to 'next' and 'master', so that the more involved
follow-up can start cooking on a solid ground.

* sb/submodule-helper:
  submodule: rewrite `module_clone` shell function in C
  submodule: rewrite `module_name` shell function in C
  submodule: rewrite `module_list` shell function in C

 - Junio C Hamano">
	{ "submodule--helper", cmd_submodule__helper, RUN_SETUP</a><a data-author="Junio C Hamano" data-commit="55d128ae06b7b82f867961b677984620612a201c" data-file="git.c" href="https://github.com/git/git/commit/55d128ae06b7b82f867961b677984620612a201c" target="blank" title="Merge branch 'bw/grep-recurse-submodules'

"git grep" has been taught to optionally recurse into submodules.

* bw/grep-recurse-submodules:
  grep: search history of moved submodules
  grep: enable recurse-submodules to work on &lt;tree&gt; objects
  grep: optionally recurse into submodules
  grep: add submodules as a grep source type
  submodules: load gitmodules file from commit sha1
  submodules: add helper to determine if a submodule is initialized
  submodules: add helper to determine if a submodule is populated
  real_path: canonicalize directory separators in root parts
  real_path: have call
 - Junio C Hamano"> | SUPPORT_SUPER_PREFIX</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="65e1449614d3af34a022007cd335d0e563dea721" data-file="git.c" href="https://github.com/git/git/commit/65e1449614d3af34a022007cd335d0e563dea721" target="blank" title="Merge branch 'sb/submodule-helper'

The infrastructure to rewrite "git submodule" in C is being built
incrementally.  Let's polish these early parts well enough and make
them graduate to 'next' and 'master', so that the more involved
follow-up can start cooking on a solid ground.

* sb/submodule-helper:
  submodule: rewrite `module_clone` shell function in C
  submodule: rewrite `module_name` shell function in C
  submodule: rewrite `module_list` shell function in C

 - Junio C Hamano"> },</a><a data-author="Matthias Kestenholz" data-commit="640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" data-file="git.c" href="https://github.com/git/git/commit/640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" target="blank" title="Make git-symbolic-ref a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">
	{ "symbolic-ref", cmd_symbolic_ref,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Matthias Kestenholz" data-commit="640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" data-file="git.c" href="https://github.com/git/git/commit/640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" target="blank" title="Make git-symbolic-ref a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Matthias Kestenholz" data-commit="640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" data-file="git.c" href="https://github.com/git/git/commit/640ce1052bbd6a8f1dd4d58beaa521d7592a0f02" target="blank" title="Make git-symbolic-ref a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz"> },</a><a data-author="Junio C Hamano" data-commit="55d1932bce99d83fa0d891331fe3f3562d33af2e" data-file="git.c" href="https://github.com/git/git/commit/55d1932bce99d83fa0d891331fe3f3562d33af2e" target="blank" title="Merge branch 'cr/tag'

* cr/tag:
  Teach "git stripspace" the --strip-comments option
  Make verify-tag a builtin.
  builtin-tag.c: Fix two memory leaks and minor notation changes.
  launch_editor(): Heed GIT_EDITOR and core.editor settings
  Make git tag a builtin.

 - Junio C Hamano">
	{ "tag", cmd_tag, RUN_SETUP</a><a data-author="Martin Ågren" data-commit="de121ffe57fd14334c24f0ac51dbc6828a3bc315" data-file="git.c" href="https://github.com/git/git/commit/de121ffe57fd14334c24f0ac51dbc6828a3bc315" target="blank" title="tag: respect `pager.tag` in list-mode only

Using, e.g., `git -c pager.tag tag -a new-tag` results in errors such as
"Vim: Warning: Output is not to a terminal" and a garbled terminal.
Someone who makes use of both `git tag -a` and `git tag -l` will
probably not set `pager.tag`, so that `git tag -a` will actually work,
at the cost of not paging output of `git tag -l`.

Use the mechanisms introduced in two earlier patches to ignore
`pager.tag` in git.c and let the `git tag` builtin handle it on its own.
Only respect `pager.tag` when running in list-mode.

There is a window between where the pag
 - Martin Ågren"> | DELAY_PAGER_CONFIG</a><a data-author="Junio C Hamano" data-commit="55d1932bce99d83fa0d891331fe3f3562d33af2e" data-file="git.c" href="https://github.com/git/git/commit/55d1932bce99d83fa0d891331fe3f3562d33af2e" target="blank" title="Merge branch 'cr/tag'

* cr/tag:
  Teach "git stripspace" the --strip-comments option
  Make verify-tag a builtin.
  builtin-tag.c: Fix two memory leaks and minor notation changes.
  launch_editor(): Heed GIT_EDITOR and core.editor settings
  Make git tag a builtin.

 - Junio C Hamano"> },</a><a data-author="Linus Torvalds" data-commit="b53258182bf90b4fb922a20d164a02e6f0e9afd1" data-file="git.c" href="https://github.com/git/git/commit/b53258182bf90b4fb922a20d164a02e6f0e9afd1" target="blank" title="make "git unpack-file" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "unpack-file", cmd_unpack_file, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="b53258182bf90b4fb922a20d164a02e6f0e9afd1" data-file="git.c" href="https://github.com/git/git/commit/b53258182bf90b4fb922a20d164a02e6f0e9afd1" target="blank" title="make "git unpack-file" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Matthias Kestenholz" data-commit="6441363079d85cf17aee21b8925e9745c8abda16" data-file="git.c" href="https://github.com/git/git/commit/6441363079d85cf17aee21b8925e9745c8abda16" target="blank" title="Make git-unpack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">
	{ "unpack-objects", cmd_unpack_objects,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Matthias Kestenholz" data-commit="6441363079d85cf17aee21b8925e9745c8abda16" data-file="git.c" href="https://github.com/git/git/commit/6441363079d85cf17aee21b8925e9745c8abda16" target="blank" title="Make git-unpack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Matthias Kestenholz" data-commit="6441363079d85cf17aee21b8925e9745c8abda16" data-file="git.c" href="https://github.com/git/git/commit/6441363079d85cf17aee21b8925e9745c8abda16" target="blank" title="Make git-unpack-objects a builtin

Signed-off-by: Matthias Kestenholz &lt;matthias@spinlock.ch&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Matthias Kestenholz"> },</a><a data-author="Lukas Sandström" data-commit="fefe81c9964a12394d6ea81ce474ff402f0eb070" data-file="git.c" href="https://github.com/git/git/commit/fefe81c9964a12394d6ea81ce474ff402f0eb070" target="blank" title="Make git-update-index a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "update-index", cmd_update_index</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Lukas Sandström" data-commit="fefe81c9964a12394d6ea81ce474ff402f0eb070" data-file="git.c" href="https://github.com/git/git/commit/fefe81c9964a12394d6ea81ce474ff402f0eb070" target="blank" title="Make git-update-index a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström"> }</a><a data-author="Lukas Sandström" data-commit="854b4629f97fb216a91805706cd61b33beb49172" data-file="git.c" href="https://github.com/git/git/commit/854b4629f97fb216a91805706cd61b33beb49172" target="blank" title="Make git-update-ref a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,
	{ "update-ref", cmd_update_ref</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Lukas Sandström" data-commit="854b4629f97fb216a91805706cd61b33beb49172" data-file="git.c" href="https://github.com/git/git/commit/854b4629f97fb216a91805706cd61b33beb49172" target="blank" title="Make git-update-ref a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström"> }</a><a data-author="Johannes Schindelin" data-commit="00449f992b629f7f7884fb2cf46ff411a2a4f381" data-file="git.c" href="https://github.com/git/git/commit/00449f992b629f7f7884fb2cf46ff411a2a4f381" target="blank" title="Make git-fmt-merge-msg a builtin

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">,</a><a data-author="René Scharfe" data-commit="53a1116c611e9e717d90e1406b29d97648460773" data-file="git.c" href="https://github.com/git/git/commit/53a1116c611e9e717d90e1406b29d97648460773" target="blank" title="update-server-info: make builtin, use parseopt

Convert git update-server-info to a built-in command and use parseopt.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - René Scharfe">
	{ "update-server-info", cmd_update_server_info, RUN_SETUP },</a><a data-author="Franck Bui-Huu" data-commit="39345a216ff37bda9fb7cec85f6de44069f5205d" data-file="git.c" href="https://github.com/git/git/commit/39345a216ff37bda9fb7cec85f6de44069f5205d" target="blank" title="Add git-upload-archive

This command implements the git archive protocol on the server
side. This command is not intended to be used by the end user.
Underlying git-archive command line options are sent over the
protocol from "git-archive --remote=...", just like upload-tar
currently does with "git-tar-tree=...".

As for "git-archive" command implementation, this new command
does not execute any existing "git-{tar,zip}-tree" but rely
on the archive API defined by "git-archive" patch. Hence we
get 2 good points:

 - "git-archive" and "git-upload-archive" share all option
   parsing code.

 - Al
 - Franck Bui-Huu">
	{ "upload-archive", cmd_upload_archive</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Franck Bui-Huu" data-commit="39345a216ff37bda9fb7cec85f6de44069f5205d" data-file="git.c" href="https://github.com/git/git/commit/39345a216ff37bda9fb7cec85f6de44069f5205d" target="blank" title="Add git-upload-archive

This command implements the git archive protocol on the server
side. This command is not intended to be used by the end user.
Underlying git-archive command line options are sent over the
protocol from "git-archive --remote=...", just like upload-tar
currently does with "git-tar-tree=...".

As for "git-archive" command implementation, this new command
does not execute any existing "git-{tar,zip}-tree" but rely
on the archive API defined by "git-archive" patch. Hence we
get 2 good points:

 - "git-archive" and "git-upload-archive" share all option
   parsing code.

 - Al
 - Franck Bui-Huu"> },</a><a data-author="Jeff King" data-commit="1bc01efed17c751e98fd6c5f9889759bfa9a8e9b" data-file="git.c" href="https://github.com/git/git/commit/1bc01efed17c751e98fd6c5f9889759bfa9a8e9b" target="blank" title="upload-archive: use start_command instead of fork

The POSIX-function fork is not supported on Windows. Use our
start_command API instead, respawning ourselves in a special
"writer" mode to follow the alternate code path.

Remove the NOT_MINGW-prereq for t5000, as git-archive --remote
now works.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
	{ "upload-archive--writer", cmd_upload_archive_writer</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, NO_PARSEOPT</a><a data-author="Jeff King" data-commit="1bc01efed17c751e98fd6c5f9889759bfa9a8e9b" data-file="git.c" href="https://github.com/git/git/commit/1bc01efed17c751e98fd6c5f9889759bfa9a8e9b" target="blank" title="upload-archive: use start_command instead of fork

The POSIX-function fork is not supported on Windows. Use our
start_command API instead, respawning ourselves in a special
"writer" mode to follow the alternate code path.

Remove the NOT_MINGW-prereq for t5000, as git-archive --remote
now works.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King"> },</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "</a><a data-author="Junio C Hamano" data-commit="9bfa0f9be3e718f701200a242ea04259a4dc4dfc" data-file="git.c" href="https://github.com/git/git/commit/9bfa0f9be3e718f701200a242ea04259a4dc4dfc" target="blank" title="Merge branch 'bw/protocol-v2'

The beginning of the next-gen transfer protocol.

* bw/protocol-v2: (35 commits)
  remote-curl: don't request v2 when pushing
  remote-curl: implement stateless-connect command
  http: eliminate "# service" line when using protocol v2
  http: don't always add Git-Protocol header
  http: allow providing extra headers for http requests
  remote-curl: store the protocol version the server responded with
  remote-curl: create copy of the service name
  pkt-line: add packet_buf_write_len function
  transport-helper: introduce stateless-connect
  transport-helper: refa
 - Junio C Hamano">upload</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">-</a><a data-author="Junio C Hamano" data-commit="9bfa0f9be3e718f701200a242ea04259a4dc4dfc" data-file="git.c" href="https://github.com/git/git/commit/9bfa0f9be3e718f701200a242ea04259a4dc4dfc" target="blank" title="Merge branch 'bw/protocol-v2'

The beginning of the next-gen transfer protocol.

* bw/protocol-v2: (35 commits)
  remote-curl: don't request v2 when pushing
  remote-curl: implement stateless-connect command
  http: eliminate "# service" line when using protocol v2
  http: don't always add Git-Protocol header
  http: allow providing extra headers for http requests
  remote-curl: store the protocol version the server responded with
  remote-curl: create copy of the service name
  pkt-line: add packet_buf_write_len function
  transport-helper: introduce stateless-connect
  transport-helper: refa
 - Junio C Hamano">pack</a><a data-author="Linus Torvalds" data-commit="907a7cb51c6c44d25f4c734a46d5174363190a84" data-file="git.c" href="https://github.com/git/git/commit/907a7cb51c6c44d25f4c734a46d5174363190a84" target="blank" title="make "git merge-tree" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">", cmd_</a><a data-author="Junio C Hamano" data-commit="9bfa0f9be3e718f701200a242ea04259a4dc4dfc" data-file="git.c" href="https://github.com/git/git/commit/9bfa0f9be3e718f701200a242ea04259a4dc4dfc" target="blank" title="Merge branch 'bw/protocol-v2'

The beginning of the next-gen transfer protocol.

* bw/protocol-v2: (35 commits)
  remote-curl: don't request v2 when pushing
  remote-curl: implement stateless-connect command
  http: eliminate "# service" line when using protocol v2
  http: don't always add Git-Protocol header
  http: allow providing extra headers for http requests
  remote-curl: store the protocol version the server responded with
  remote-curl: create copy of the service name
  pkt-line: add packet_buf_write_len function
  transport-helper: introduce stateless-connect
  transport-helper: refa
 - Junio C Hamano">upload_pack }</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">,</a><a data-author="Linus Torvalds" data-commit="55b6745d633b9501576eb02183da0b0fb1cee964" data-file="git.c" href="https://github.com/git/git/commit/55b6745d633b9501576eb02183da0b0fb1cee964" target="blank" title="make "git var" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
	{ "var", cmd_var</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="2bc8c1a8a6b1cdffc19badc7272f552302b79d3e" data-file="git.c" href="https://github.com/git/git/commit/2bc8c1a8a6b1cdffc19badc7272f552302b79d3e" target="blank" title="var: run setup_git_directory_gently() sooner

Part of a campaign to make repository-local configuration
available early (simplifying the startup sequence for
built-in commands).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;
Signed-off-by: Jonathan Nieder &lt;jrnieder@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, RUN_SETUP_GENTLY</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Linus Torvalds" data-commit="55b6745d633b9501576eb02183da0b0fb1cee964" data-file="git.c" href="https://github.com/git/git/commit/55b6745d633b9501576eb02183da0b0fb1cee964" target="blank" title="make "git var" a built-in

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds"> },</a><a data-author="Junio C Hamano" data-commit="39177c7f184b4c07a1f53f99f59c920c3fb6222d" data-file="git.c" href="https://github.com/git/git/commit/39177c7f184b4c07a1f53f99f59c920c3fb6222d" target="blank" title="Merge branch 'mg/verify-commit'

Add 'verify-commit' to be used in a way similar to 'verify-tag' is
used.  Further work on verifying the mergetags might be needed.

* mg/verify-commit:
  t7510: test verify-commit
  t7510: exit for loop with test result
  verify-commit: scriptable commit signature verification
  gpg-interface: provide access to the payload
  gpg-interface: provide clear helper for struct signature_check

 - Junio C Hamano">
	{ "verify-commit", cmd_verify_commit, RUN_SETUP },</a><a data-author="Rene Scharfe" data-commit="2e3ed670eb09feffe847af55db38da3dcecc2a88" data-file="git.c" href="https://github.com/git/git/commit/2e3ed670eb09feffe847af55db38da3dcecc2a88" target="blank" title="git-verify-pack: make builtin

Convert git-verify-pack to a builtin command.  Also rename ac to argc
and av to argv for consistancy.

Signed-off-by: Rene Scharfe &lt;rene.scharfe@lsrfire.ath.cx&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Rene Scharfe">
	{ "verify-pack", cmd_verify_pack },</a><a data-author="Junio C Hamano" data-commit="55d1932bce99d83fa0d891331fe3f3562d33af2e" data-file="git.c" href="https://github.com/git/git/commit/55d1932bce99d83fa0d891331fe3f3562d33af2e" target="blank" title="Merge branch 'cr/tag'

* cr/tag:
  Teach "git stripspace" the --strip-comments option
  Make verify-tag a builtin.
  builtin-tag.c: Fix two memory leaks and minor notation changes.
  launch_editor(): Heed GIT_EDITOR and core.editor settings
  Make git tag a builtin.

 - Junio C Hamano">
	{ "verify-tag", cmd_verify_tag, RUN_SETUP },</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	{ "version", cmd_version },</a><a data-author="Junio C Hamano" data-commit="5b84f4d87a1bd58c7540e9ea82ee3673ecddbad5" data-file="git.c" href="https://github.com/git/git/commit/5b84f4d87a1bd58c7540e9ea82ee3673ecddbad5" target="blank" title="Built-in git-whatchanged.

Split internal "git log" into reusable piece and add "git
whatchanged".  This is based on the option parsing unification
work Linus did.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	{ "whatchanged", cmd_</a><a data-author="Linus Torvalds" data-commit="70827b15bfb11f7aea52c6995956be9d149233e1" data-file="git.c" href="https://github.com/git/git/commit/70827b15bfb11f7aea52c6995956be9d149233e1" target="blank" title="Split up builtin commands into separate files from git.c

Right now it split it into "builtin-log.c" for log-related commands
("log", "show" and "whatchanged"), and "builtin-help.c" for the
informational commands (usage printing and "help" and "version").

This just makes things easier to read, I find.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">whatchanged</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Junio C Hamano" data-commit="5b84f4d87a1bd58c7540e9ea82ee3673ecddbad5" data-file="git.c" href="https://github.com/git/git/commit/5b84f4d87a1bd58c7540e9ea82ee3673ecddbad5" target="blank" title="Built-in git-whatchanged.

Split internal "git log" into reusable piece and add "git
whatchanged".  This is based on the option parsing unification
work Linus did.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> },</a><a data-author="Junio C Hamano" data-commit="5f02274e4c4506b923b510a24da7991656f4db14" data-file="git.c" href="https://github.com/git/git/commit/5f02274e4c4506b923b510a24da7991656f4db14" target="blank" title="Merge branch 'pt/pull-builtin'

Reimplement 'git pull' in C.

* pt/pull-builtin:
  pull: remove redirection to git-pull.sh
  pull --rebase: error on no merge candidate cases
  pull --rebase: exit early when the working directory is dirty
  pull: configure --rebase via branch.&lt;name&gt;.rebase or pull.rebase
  pull: teach git pull about --rebase
  pull: set reflog message
  pull: implement pulling into an unborn branch
  pull: fast-forward working tree if head is updated
  pull: check if in unresolved merge state
  pull: support pull.ff config
  pull: error on no merge candidates
  pull: pass git-f
 - Junio C Hamano">
	{ "</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="df0b6cfbda88144714541664fb501146d6465a82" data-file="git.c" href="https://github.com/git/git/commit/df0b6cfbda88144714541664fb501146d6465a82" target="blank" title="worktree: new place for "git prune --worktrees"

Commit 23af91d (prune: strategies for linked checkouts - 2014-11-30)
adds "--worktrees" to "git prune" without realizing that "git prune" is
for object database only. This patch moves the same functionality to a
new command "git worktree".

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;

 - Nguyễn Thái Ngọc Duy">worktree</a><a data-author="Junio C Hamano" data-commit="5f02274e4c4506b923b510a24da7991656f4db14" data-file="git.c" href="https://github.com/git/git/commit/5f02274e4c4506b923b510a24da7991656f4db14" target="blank" title="Merge branch 'pt/pull-builtin'

Reimplement 'git pull' in C.

* pt/pull-builtin:
  pull: remove redirection to git-pull.sh
  pull --rebase: error on no merge candidate cases
  pull --rebase: exit early when the working directory is dirty
  pull: configure --rebase via branch.&lt;name&gt;.rebase or pull.rebase
  pull: teach git pull about --rebase
  pull: set reflog message
  pull: implement pulling into an unborn branch
  pull: fast-forward working tree if head is updated
  pull: check if in unresolved merge state
  pull: support pull.ff config
  pull: error on no merge candidates
  pull: pass git-f
 - Junio C Hamano">", cmd_</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="df0b6cfbda88144714541664fb501146d6465a82" data-file="git.c" href="https://github.com/git/git/commit/df0b6cfbda88144714541664fb501146d6465a82" target="blank" title="worktree: new place for "git prune --worktrees"

Commit 23af91d (prune: strategies for linked checkouts - 2014-11-30)
adds "--worktrees" to "git prune" without realizing that "git prune" is
for object database only. This patch moves the same functionality to a
new command "git worktree".

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;

 - Nguyễn Thái Ngọc Duy">worktree</a><a data-author="Junio C Hamano" data-commit="5f02274e4c4506b923b510a24da7991656f4db14" data-file="git.c" href="https://github.com/git/git/commit/5f02274e4c4506b923b510a24da7991656f4db14" target="blank" title="Merge branch 'pt/pull-builtin'

Reimplement 'git pull' in C.

* pt/pull-builtin:
  pull: remove redirection to git-pull.sh
  pull --rebase: error on no merge candidate cases
  pull --rebase: exit early when the working directory is dirty
  pull: configure --rebase via branch.&lt;name&gt;.rebase or pull.rebase
  pull: teach git pull about --rebase
  pull: set reflog message
  pull: implement pulling into an unborn branch
  pull: fast-forward working tree if head is updated
  pull: check if in unresolved merge state
  pull: support pull.ff config
  pull: error on no merge candidates
  pull: pass git-f
 - Junio C Hamano">, RUN_SETUP</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> | NO_PARSEOPT</a><a data-author="Junio C Hamano" data-commit="5f02274e4c4506b923b510a24da7991656f4db14" data-file="git.c" href="https://github.com/git/git/commit/5f02274e4c4506b923b510a24da7991656f4db14" target="blank" title="Merge branch 'pt/pull-builtin'

Reimplement 'git pull' in C.

* pt/pull-builtin:
  pull: remove redirection to git-pull.sh
  pull --rebase: error on no merge candidate cases
  pull --rebase: exit early when the working directory is dirty
  pull: configure --rebase via branch.&lt;name&gt;.rebase or pull.rebase
  pull: teach git pull about --rebase
  pull: set reflog message
  pull: implement pulling into an unborn branch
  pull: fast-forward working tree if head is updated
  pull: check if in unresolved merge state
  pull: support pull.ff config
  pull: error on no merge candidates
  pull: pass git-f
 - Junio C Hamano"> },</a><a data-author="Lukas Sandström" data-commit="8ed05fb5e90f8ad2051ff7071b7425a53c594892" data-file="git.c" href="https://github.com/git/git/commit/8ed05fb5e90f8ad2051ff7071b7425a53c594892" target="blank" title="Make git-write-tree a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">
	{ "write-tree", cmd_write_tree</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">,</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> RUN</a><a data-author="Linus Torvalds" data-commit="a633fca0c056aa221d23493c276d3713191621b3" data-file="git.c" href="https://github.com/git/git/commit/a633fca0c056aa221d23493c276d3713191621b3" target="blank" title="Call setup_git_directory() much earlier

This changes the calling convention of built-in commands and
passes the "prefix" (i.e. pathname of $PWD relative to the
project root level) down to them.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">_</a><a data-author="Junio C Hamano" data-commit="efffea033457eedb90ad63596687564f797f12de" data-file="git.c" href="https://github.com/git/git/commit/efffea033457eedb90ad63596687564f797f12de" target="blank" title="git.c: Rename NEEDS_PREFIX to RUN_SETUP

As Matthias Kestenholz noted, the flag does not quite mean
"needs prefix" -- it is more like "run setup_git_directory()
before running this command", so rename it to avoid future
confusion.

While we are at it, rewrite the definition of options to make it
obvious that we are talking about flag bits by using standard (1&lt;&lt;n)
notation.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">SETUP</a><a data-author="Lukas Sandström" data-commit="8ed05fb5e90f8ad2051ff7071b7425a53c594892" data-file="git.c" href="https://github.com/git/git/commit/8ed05fb5e90f8ad2051ff7071b7425a53c594892" target="blank" title="Make git-write-tree a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström"> }</a><a data-author="Lukas Sandström" data-commit="e690e84315de1bb806eb2292f8a87cbee30b75ab" data-file="git.c" href="https://github.com/git/git/commit/e690e84315de1bb806eb2292f8a87cbee30b75ab" target="blank" title="Make git-mailsplit a builtin

Signed-off-by: Lukas Sandström &lt;lukass@etek.chalmers.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Lukas Sandström">,</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
};</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">

static</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> struct cmd_struct *</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">get_builtin(const char *s)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	int i;
	for (i = 0;</a><a data-author="Sebastian Schuberth" data-commit="c6127fa3e25551e969d775b0332d37dc84db1969" data-file="git.c" href="https://github.com/git/git/commit/c6127fa3e25551e969d775b0332d37dc84db1969" target="blank" title="builtin/help.c: speed up is_git_command() by checking for builtin commands first

Since 2dce956 is_git_command() is a bit slow as it does file I/O in
the call to list_commands_in_dir(). Avoid the file I/O by adding an
early check for the builtin commands.

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth"> i &lt; ARRAY_SIZE(commands);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson"> i++) {</a><a data-author="Sebastian Schuberth" data-commit="c6127fa3e25551e969d775b0332d37dc84db1969" data-file="git.c" href="https://github.com/git/git/commit/c6127fa3e25551e969d775b0332d37dc84db1969" target="blank" title="builtin/help.c: speed up is_git_command() by checking for builtin commands first

Since 2dce956 is_git_command() is a bit slow as it does file I/O in
the call to list_commands_in_dir(). Avoid the file I/O by adding an
early check for the builtin commands.

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">
		struct cmd_struct *p = commands + i;
		if (!strcmp(s, p-&gt;cmd))</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">
			return</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> p</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	}</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">
	return NULL;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Sebastian Schuberth" data-commit="c6127fa3e25551e969d775b0332d37dc84db1969" data-file="git.c" href="https://github.com/git/git/commit/c6127fa3e25551e969d775b0332d37dc84db1969" target="blank" title="builtin/help.c: speed up is_git_command() by checking for builtin commands first

Since 2dce956 is_git_command() is a bit slow as it does file I/O in
the call to list_commands_in_dir(). Avoid the file I/O by adding an
early check for the builtin commands.

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">

int is_builtin(const char *s)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">
	return !!get_builtin(s);</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">
}</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">

static void list_builtins(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">struct string_list *out,</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy"> unsigned int exclude_option</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
{</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">
	int i;</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">
	for (i = 0;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> i &lt; ARRAY_SIZE(commands);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson"> i++) {</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		if</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King"> (</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">exclude_option &amp;&amp;
		    (</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">commands[i].</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">option &amp; exclude_option))</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			continue;</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">
		string_list_append</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e5d7a61953c236fbc468bc1bb01383766d2cb55b" data-file="git.c" href="https://github.com/git/git/commit/e5d7a61953c236fbc468bc1bb01383766d2cb55b" target="blank" title="git --list-cmds: collect command list in a string_list

Instead of printing the command directly one by one, keep them in a
list and print at the end. This allows more modification before we
print out (e.g. sorting, removing duplicates or even excluding some
items).

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">out</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="e9547947795472c07453d0551b0cabb4ae378b5f" data-file="git.c" href="https://github.com/git/git/commit/e9547947795472c07453d0551b0cabb4ae378b5f" target="blank" title="git.c: add hidden option --list-parseopt-builtins

This is another step to help automate git-completion.bash. This option
gives a list of all builtin commands that do use parse_options(),
which supports another hidden option --git-completion-helper. The
output is prepared for easy consumption by git-completion.bash and
separates items by spaces instead of \n

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">, commands[i].</a><a data-author="Jeff King" data-commit="8893fd95b66cbd6566136a289dd05fcf4e547281" data-file="git.c" href="https://github.com/git/git/commit/8893fd95b66cbd6566136a289dd05fcf4e547281" target="blank" title="git: add hidden --list-builtins option

It can be useful in the test suite to be able to iterate
over the list of builtins. We could do this with some
Makefile magic. But since the authoritative list is in the
commands array inside git.c, and since this could also be
handy for debugging, let's add a hidden command-line option
to dump that list.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">cmd);</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
	}</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Alexander Kuleshov" data-commit="63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" data-file="git.c" href="https://github.com/git/git/commit/63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" target="blank" title="git.c: simplify stripping extension of a file in handle_builtin()

The handle_builtin() starts from stripping of command extension if
STRIP_EXTENSION is enabled. Actually STRIP_EXTENSION does not used
anywhere else.

This patch introduces strip_extension() helper to strip STRIP_EXTENSION
extension from argv[0] with the strip_suffix() instead of manually
stripping.

Signed-off-by: Alexander Kuleshov &lt;kuleshovmail@gmail.com&gt;
Helped-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Kuleshov">

#ifdef STRIP_EXTENSION</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">
static</a><a data-author="Junio C Hamano" data-commit="dede29612a723a7da9f489fecbdf02500a018430" data-file="git.c" href="https://github.com/git/git/commit/dede29612a723a7da9f489fecbdf02500a018430" target="blank" title="Merge branch 'ak/git-strip-extension-from-dashed-command'

Code simplification.

* ak/git-strip-extension-from-dashed-command:
  git.c: simplify stripping extension of a file in handle_builtin()

 - Junio C Hamano"> void strip</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">_</a><a data-author="Junio C Hamano" data-commit="dede29612a723a7da9f489fecbdf02500a018430" data-file="git.c" href="https://github.com/git/git/commit/dede29612a723a7da9f489fecbdf02500a018430" target="blank" title="Merge branch 'ak/git-strip-extension-from-dashed-command'

Code simplification.

* ak/git-strip-extension-from-dashed-command:
  git.c: simplify stripping extension of a file in handle_builtin()

 - Junio C Hamano">extension</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">(</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">const char *</a><a data-author="Junio C Hamano" data-commit="dede29612a723a7da9f489fecbdf02500a018430" data-file="git.c" href="https://github.com/git/git/commit/dede29612a723a7da9f489fecbdf02500a018430" target="blank" title="Merge branch 'ak/git-strip-extension-from-dashed-command'

Code simplification.

* ak/git-strip-extension-from-dashed-command:
  git.c: simplify stripping extension of a file in handle_builtin()

 - Junio C Hamano">*argv</a><a data-author="Junio C Hamano" data-commit="11529ecec914d2f0d7575e6d443c2d5a6ff75424" data-file="git.c" href="https://github.com/git/git/commit/11529ecec914d2f0d7575e6d443c2d5a6ff75424" target="blank" title="Merge branch 'jk/tighten-alloc'

Update various codepaths to avoid manually-counted malloc().

* jk/tighten-alloc: (22 commits)
  ewah: convert to REALLOC_ARRAY, etc
  convert ewah/bitmap code to use xmalloc
  diff_populate_gitlink: use a strbuf
  transport_anonymize_url: use xstrfmt
  git-compat-util: drop mempcpy compat code
  sequencer: simplify memory allocation of get_message
  test-path-utils: fix normalize_path_copy output buffer size
  fetch-pack: simplify add_sought_entry
  fast-import: simplify allocation in start_packfile
  write_untracked_extension: use FLEX_ALLOC helper
  prepare_
 - Junio C Hamano">)</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
{</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	size_t len;</a><a data-author="Alexander Kuleshov" data-commit="63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" data-file="git.c" href="https://github.com/git/git/commit/63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" target="blank" title="git.c: simplify stripping extension of a file in handle_builtin()

The handle_builtin() starts from stripping of command extension if
STRIP_EXTENSION is enabled. Actually STRIP_EXTENSION does not used
anywhere else.

This patch introduces strip_extension() helper to strip STRIP_EXTENSION
extension from argv[0] with the strip_suffix() instead of manually
stripping.

Signed-off-by: Alexander Kuleshov &lt;kuleshovmail@gmail.com&gt;
Helped-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Kuleshov">

	if (strip_suffix(argv[0], STRIP_EXTENSION, &amp;len))
		argv[0] = xmemdupz(argv[0], len);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Alexander Kuleshov" data-commit="63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" data-file="git.c" href="https://github.com/git/git/commit/63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" target="blank" title="git.c: simplify stripping extension of a file in handle_builtin()

The handle_builtin() starts from stripping of command extension if
STRIP_EXTENSION is enabled. Actually STRIP_EXTENSION does not used
anywhere else.

This patch introduces strip_extension() helper to strip STRIP_EXTENSION
extension from argv[0] with the strip_suffix() instead of manually
stripping.

Signed-off-by: Alexander Kuleshov &lt;kuleshovmail@gmail.com&gt;
Helped-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Kuleshov">
#else
#define strip_extension(cmd)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
#endif</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

static void handle_</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">(int argc,</a><a data-author="Junio C Hamano" data-commit="9201c707426b3dc0c894775416f576c25c008d46" data-file="git.c" href="https://github.com/git/git/commit/9201c707426b3dc0c894775416f576c25c008d46" target="blank" title="Const tightening.

Mark Wooding noticed there was a type mismatch warning in git.c; this
patch does things slightly differently (mostly tightening const) and
was what I was holding onto, waiting for the setup-revisions change
to be merged into the master branch.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> const</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> char **argv)
{</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow">
	struct argv_array args = ARGV_ARRAY_INIT;</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
	const char *cmd;</a><a data-author="Junio C Hamano" data-commit="68a2e6a2c80303144807c8c91a087427e3c8e727" data-file="git.c" href="https://github.com/git/git/commit/68a2e6a2c80303144807c8c91a087427e3c8e727" target="blank" title="Merge branch 'nd/multiple-work-trees'

A replacement for contrib/workdir/git-new-workdir that does not
rely on symbolic links and make sharing of objects and refs safer
by making the borrowee and borrowers aware of each other.

* nd/multiple-work-trees: (41 commits)
  prune --worktrees: fix expire vs worktree existence condition
  t1501: fix test with split index
  t2026: fix broken &amp;&amp;-chain
  t2026 needs procondition SANITY
  git-checkout.txt: a note about multiple checkout support for submodules
  checkout: add --ignore-other-wortrees
  checkout: pass whole struct to parse_branchname_arg ins
 - Junio C Hamano">
	struct</a><a data-author="Christian Couder" data-commit="6634f05454662b62e1f34766d3684b99fb53ad66" data-file="git.c" href="https://github.com/git/git/commit/6634f05454662b62e1f34766d3684b99fb53ad66" target="blank" title="trailer: add interpret-trailers command

This patch adds the "git interpret-trailers" command.
This command uses the previously added process_trailers()
function in trailer.c.

Signed-off-by: Christian Couder &lt;chriscool@tuxfamily.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Christian Couder"> cmd_</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">struct *builtin;</a><a data-author="Alexander Kuleshov" data-commit="63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" data-file="git.c" href="https://github.com/git/git/commit/63ca1c099c36e61b0e9cd7fa0b912c0b9d89b628" target="blank" title="git.c: simplify stripping extension of a file in handle_builtin()

The handle_builtin() starts from stripping of command extension if
STRIP_EXTENSION is enabled. Actually STRIP_EXTENSION does not used
anywhere else.

This patch introduces strip_extension() helper to strip STRIP_EXTENSION
extension from argv[0] with the strip_suffix() instead of manually
stripping.

Signed-off-by: Alexander Kuleshov &lt;kuleshovmail@gmail.com&gt;
Helped-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Kuleshov">

	strip_extension(argv);</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	cmd = argv[0];</a><a data-author="Linus Torvalds" data-commit="1cd95087c331e17c44a8b62f0614d55e621dcfd4" data-file="git.c" href="https://github.com/git/git/commit/1cd95087c331e17c44a8b62f0614d55e621dcfd4" target="blank" title="Support "git cmd --help" syntax

The "--help" argument is special, in that it is (along with "--version")
in that is taken by the "git" program itself rather than the sub-command,
and thus we've had the syntax "git --help cmd".

However, as anybody who has ever used CVS or some similar devil-spawn
program, it's confusing as h*ll when options before the sub-command act
differently from options after the sub-command, so this quick hack just
makes it acceptable to do "git cmd --help" instead, and get the exact same
result.

It may be hacky, but it's simple and does the trick.

Of course, this doe
 - Linus Torvalds">

	/* Turn "git cmd --help" into "git help</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow"> --exclude-guides</a><a data-author="Linus Torvalds" data-commit="1cd95087c331e17c44a8b62f0614d55e621dcfd4" data-file="git.c" href="https://github.com/git/git/commit/1cd95087c331e17c44a8b62f0614d55e621dcfd4" target="blank" title="Support "git cmd --help" syntax

The "--help" argument is special, in that it is (along with "--version")
in that is taken by the "git" program itself rather than the sub-command,
and thus we've had the syntax "git --help cmd".

However, as anybody who has ever used CVS or some similar devil-spawn
program, it's confusing as h*ll when options before the sub-command act
differently from options after the sub-command, so this quick hack just
makes it acceptable to do "git cmd --help" instead, and get the exact same
result.

It may be hacky, but it's simple and does the trick.

Of course, this doe
 - Linus Torvalds"> cmd" */
	if (argc &gt; 1 &amp;&amp; !strcmp(argv[1], "--help")) {</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		int i;</a><a data-author="Linus Torvalds" data-commit="1cd95087c331e17c44a8b62f0614d55e621dcfd4" data-file="git.c" href="https://github.com/git/git/commit/1cd95087c331e17c44a8b62f0614d55e621dcfd4" target="blank" title="Support "git cmd --help" syntax

The "--help" argument is special, in that it is (along with "--version")
in that is taken by the "git" program itself rather than the sub-command,
and thus we've had the syntax "git --help cmd".

However, as anybody who has ever used CVS or some similar devil-spawn
program, it's confusing as h*ll when options before the sub-command act
differently from options after the sub-command, so this quick hack just
makes it acceptable to do "git cmd --help" instead, and get the exact same
result.

It may be hacky, but it's simple and does the trick.

Of course, this doe
 - Linus Torvalds">

		argv[1] = argv[0];
		argv[0] = cmd = "help";</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">

		for (i = 0;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson"> i &lt; argc;</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen"> i++) {</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow">
			argv</a><a data-author="Jeff King" data-commit="3f2e2297b9c88a6ab5fc4bff02cf2a07ce057589" data-file="git.c" href="https://github.com/git/git/commit/3f2e2297b9c88a6ab5fc4bff02cf2a07ce057589" target="blank" title="add an extra level of indirection to main()

There are certain startup tasks that we expect every git
process to do. In some cases this is just to improve the
quality of the program (e.g., setting up gettext()). In
others it is a requirement for using certain functions in
libgit.a (e.g., system_path() expects that you have called
git_extract_argv0_path()).

Most commands are builtins and are covered by the git.c
version of main(). However, there are still a few external
commands that use their own main(). Each of these has to
remember to include the correct startup sequence, and we are
not alw
 - Jeff King">_</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow">array_push(&amp;args, argv[i]);
			if (!i)
				argv_array_push(&amp;args, "--exclude-guides");</a><a data-author="Linus Torvalds" data-commit="1cd95087c331e17c44a8b62f0614d55e621dcfd4" data-file="git.c" href="https://github.com/git/git/commit/1cd95087c331e17c44a8b62f0614d55e621dcfd4" target="blank" title="Support "git cmd --help" syntax

The "--help" argument is special, in that it is (along with "--version")
in that is taken by the "git" program itself rather than the sub-command,
and thus we've had the syntax "git --help cmd".

However, as anybody who has ever used CVS or some similar devil-spawn
program, it's confusing as h*ll when options before the sub-command act
differently from options after the sub-command, so this quick hack just
makes it acceptable to do "git cmd --help" instead, and get the exact same
result.

It may be hacky, but it's simple and does the trick.

Of course, this doe
 - Linus Torvalds">
		}</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow">

		argc++;
		argv = args.argv;</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
	}</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">

	builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> =</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek"> get</a><a data-author="Junio C Hamano" data-commit="68a2e6a2c80303144807c8c91a087427e3c8e727" data-file="git.c" href="https://github.com/git/git/commit/68a2e6a2c80303144807c8c91a087427e3c8e727" target="blank" title="Merge branch 'nd/multiple-work-trees'

A replacement for contrib/workdir/git-new-workdir that does not
rely on symbolic links and make sharing of objects and refs safer
by making the borrowee and borrowers aware of each other.

* nd/multiple-work-trees: (41 commits)
  prune --worktrees: fix expire vs worktree existence condition
  t1501: fix test with split index
  t2026: fix broken &amp;&amp;-chain
  t2026 needs procondition SANITY
  git-checkout.txt: a note about multiple checkout support for submodules
  checkout: add --ignore-other-wortrees
  checkout: pass whole struct to parse_branchname_arg ins
 - Junio C Hamano">_</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">builtin(cmd)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">;
	if (</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">)</a><a data-author="Linus Torvalds" data-commit="47d0b4ff57f391786ed050f38c0de51462eda97a" data-file="git.c" href="https://github.com/git/git/commit/47d0b4ff57f391786ed050f38c0de51462eda97a" target="blank" title="Clean up internal command handling

This should change no code at all, it just moves the definition of "struct
cmd_struct" out, and then splits out the running of the right command into
the "run_command()" function.

It also removes the long-unused 'envp' pointer passing.

This is just preparation for adding some more error checking.

Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Linus Torvalds">
		exit(run</a><a data-author="Matthias Lederhofer" data-commit="7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" data-file="git.c" href="https://github.com/git/git/commit/7ae3df8c0aa3b7337ae9ac7b6184ac05985bf996" target="blank" title="Use new semantics of is_bare/inside_git_dir/inside_work_tree

Up to now to check for a working tree this was used:
	!is_bare &amp;&amp; !inside_git_dir
(the check for bare is redundant because is_inside_git_dir
returned already 1 for bare repositories).
Now the check is:
	inside_work_tree &amp;&amp; !inside_git_dir

Signed-off-by: Matthias Lederhofer &lt;matled@gmx.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Matthias Lederhofer">_</a><a data-author="Jeff King" data-commit="f172f334fde49ce29d0afa21749bf85463a2db9a" data-file="git.c" href="https://github.com/git/git/commit/f172f334fde49ce29d0afa21749bf85463a2db9a" target="blank" title="git: s/run_command/run_builtin/

There is a static function called run_command which
conflicts with the library function in run-command.c; this
isn't a problem currently, but prevents including
run-command.h in git.c.

This patch just renames the static function to something
more specific and non-conflicting.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">builtin</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">(</a><a data-author="Slavomir Vlcek" data-commit="c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" data-file="git.c" href="https://github.com/git/git/commit/c4f901d1593f3ef097c3e73daa2847ed9ad9efe0" target="blank" title="builtin: move builtin retrieval to get_builtin()

There was a redundant code for a builtin command retrieval in
'handle_builtin()' and 'is_builtin()'.

Introduce a new function 'get_builtin()' and using it from
both of these places to reduce the redundancy.

Signed-off-by: Slavomir Vlcek &lt;svlc@inventati.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Slavomir Vlcek">builtin</a><a data-author="Shawn O. Pearce" data-commit="7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" data-file="git.c" href="https://github.com/git/git/commit/7eff28a9b42cb0d3aad932338b2e645fc6ed8fa9" target="blank" title="Disallow working directory commands in a bare repository.

If the user tries to run a porcelainish command which requires
a working directory in a bare repository they may get unexpected
results which are difficult to predict and may differ from command
to command.

Instead we should detect that the current repository is a bare
repository and refuse to run the command there, as there is no
working directory associated with it.

[jc: updated Shawn's original somewhat -- bugs are mine.]

Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Shawn O. Pearce">,</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> argc, argv));</a><a data-author="Ralf Thielow" data-commit="2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" data-file="git.c" href="https://github.com/git/git/commit/2c6b6d9f7d8a26b6ae6493584cc3d2a3cbae7358" target="blank" title="help: make option --help open man pages only for Git commands

If option --help is passed to a Git command, we try to open
the man page of that command.  However, we do it for both commands
and concepts.  Make sure it is an actual command.

This makes "git &lt;concept&gt; --help" not working anymore, while
"git help &lt;concept&gt;" still works.

Signed-off-by: Ralf Thielow &lt;ralf.thielow@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Ralf Thielow">
	argv_array_clear(&amp;args);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Johannes Sixt" data-commit="23326d14edbd16469453f6c3ecdd98ab90e6efb7" data-file="git.c" href="https://github.com/git/git/commit/23326d14edbd16469453f6c3ecdd98ab90e6efb7" target="blank" title="Windows: Strip ".exe" from the program name.

Before we can successfully parse a builtin command from the program name
we must strip off unneeded parts, that is, the file extension.

Furthermore, we must take Windows style path names into account when we
parse the program name.

Signed-off-by: Johannes Sixt &lt;johannes.sixt@telecom.at&gt;

 - Johannes Sixt">

static</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> void execv_dashed_external(</a><a data-author="Johannes Sixt" data-commit="23326d14edbd16469453f6c3ecdd98ab90e6efb7" data-file="git.c" href="https://github.com/git/git/commit/23326d14edbd16469453f6c3ecdd98ab90e6efb7" target="blank" title="Windows: Strip ".exe" from the program name.

Before we can successfully parse a builtin command from the program name
we must strip off unneeded parts, that is, the file extension.

Furthermore, we must take Windows style path names into account when we
parse the program name.

Signed-off-by: Johannes Sixt &lt;johannes.sixt@telecom.at&gt;

 - Johannes Sixt">const char</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> **argv)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">
	struct child</a><a data-author="Stefan Beller" data-commit="89c8626557621ef000930da3c8a23fa03ad7e01a" data-file="git.c" href="https://github.com/git/git/commit/89c8626557621ef000930da3c8a23fa03ad7e01a" target="blank" title="submodule helper: support super prefix

Just like main commands in Git, the submodule helper needs
access to the superproject prefix. Enable this in the git.c
but have its own fuse in the helper code by having a flag to
turn on the super prefix.

Signed-off-by: Stefan Beller &lt;sbeller@google.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Stefan Beller">_</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">process</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> cmd</a><a data-author="Brandon Casey" data-commit="f285a2d7ed6548666989406de8f0e7233eb84368" data-file="git.c" href="https://github.com/git/git/commit/f285a2d7ed6548666989406de8f0e7233eb84368" target="blank" title="Replace calls to strbuf_init(&amp;foo, 0) with STRBUF_INIT initializer

Many call sites use strbuf_init(&amp;foo, 0) to initialize local
strbuf variable "foo" which has not been accessed since its
declaration. These can be replaced with a static initialization
using the STRBUF_INIT macro which is just as readable, saves a
function call, and takes up fewer lines.

Signed-off-by: Brandon Casey &lt;casey@nrlssc.navy.mil&gt;
Signed-off-by: Shawn O. Pearce &lt;spearce@spearce.org&gt;

 - Brandon Casey"> =</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King"> CHILD_PROCESS</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">_INIT;</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">
	int status;</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">

	if (get_super_prefix())
		die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">("%s doesn't support --super-prefix"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Brandon Williams" data-commit="74866d75793559e8b351a17100679f83b96972ca" data-file="git.c" href="https://github.com/git/git/commit/74866d75793559e8b351a17100679f83b96972ca" target="blank" title="git: make super-prefix option

Add a super-prefix environment variable 'GIT_INTERNAL_SUPER_PREFIX'
which can be used to specify a path from above a repository down to its
root.  When such a super-prefix is specified, the paths reported by Git
are prefixed with it to make them relative to that directory "above".
The paths given by the user on the command line
(e.g. "git subcmd --output-file=path/to/a/file" and pathspecs) are taken
relative to the directory "above" to match.

The immediate use of this option is by commands which have a
--recurse-submodule option in order to give context to submo
 - Brandon Williams">, argv[0]);</a><a data-author="Michael J Gruber" data-commit="7cf16a14f5c070f7b14cf28023769450133172ae" data-file="git.c" href="https://github.com/git/git/commit/7cf16a14f5c070f7b14cf28023769450133172ae" target="blank" title="handle_alias: provide GIT_PREFIX to !alias

Provide an environment variable GIT_PREFIX which contains the subdirectory
from which a !alias was called (i.e. 'git rev-parse --show-prefix') since
these cd to the to level directory before they are executed.

Signed-off-by: Michael J Gruber &lt;git@drmicha.warpmail.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Michael J Gruber">

	if (</a><a data-author="Jeff King" data-commit="92058e4d3e032714da6d2df5fa1fe2cf612979a5" data-file="git.c" href="https://github.com/git/git/commit/92058e4d3e032714da6d2df5fa1fe2cf612979a5" target="blank" title="support pager.* for external commands

Without this patch, any commands that are not builtin would
not respect pager.* config. For example:

  git config pager.stash false
  git stash list

would still use a pager. With this patch, pager.stash now
has an effect. If it is not specified, we will still fall
back to pager.log when we invoke "log" from "stash list".

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">use_pager == -1</a><a data-author="Martin Ågren" data-commit="595d59e2b53a19f8c5c277348e4e1a07bb913ba4" data-file="git.c" href="https://github.com/git/git/commit/595d59e2b53a19f8c5c277348e4e1a07bb913ba4" target="blank" title="git.c: ignore pager.* when launching builtin as dashed external

When running, e.g., `git -c alias.bar=foo bar`, we expand the alias and
execute `git-foo` as a dashed external. This is true even if git foo is
a builtin. That is on purpose, and is motivated in a comment which was
added in commit 441981bc ("git: simplify environment save/restore
logic", 2016-01-26).

Shortly before we launch a dashed external, and unless we have already
found out whether we should use a pager, we check `pager.foo`. This was
added in commit 92058e4d ("support pager.* for external commands",
2011-08-18). If the da
 - Martin Ågren"> &amp;&amp; !is_builtin(argv[0]</a><a data-author="Jeff King" data-commit="92058e4d3e032714da6d2df5fa1fe2cf612979a5" data-file="git.c" href="https://github.com/git/git/commit/92058e4d3e032714da6d2df5fa1fe2cf612979a5" target="blank" title="support pager.* for external commands

Without this patch, any commands that are not builtin would
not respect pager.* config. For example:

  git config pager.stash false
  git stash list

would still use a pager. With this patch, pager.stash now
has an effect. If it is not specified, we will still fall
back to pager.log when we invoke "log" from "stash list".

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Martin Ågren" data-commit="595d59e2b53a19f8c5c277348e4e1a07bb913ba4" data-file="git.c" href="https://github.com/git/git/commit/595d59e2b53a19f8c5c277348e4e1a07bb913ba4" target="blank" title="git.c: ignore pager.* when launching builtin as dashed external

When running, e.g., `git -c alias.bar=foo bar`, we expand the alias and
execute `git-foo` as a dashed external. This is true even if git foo is
a builtin. That is on purpose, and is motivated in a comment which was
added in commit 441981bc ("git: simplify environment save/restore
logic", 2016-01-26).

Shortly before we launch a dashed external, and unless we have already
found out whether we should use a pager, we check `pager.foo`. This was
added in commit 92058e4d ("support pager.* for external commands",
2011-08-18). If the da
 - Martin Ågren">)</a><a data-author="Jeff King" data-commit="92058e4d3e032714da6d2df5fa1fe2cf612979a5" data-file="git.c" href="https://github.com/git/git/commit/92058e4d3e032714da6d2df5fa1fe2cf612979a5" target="blank" title="support pager.* for external commands

Without this patch, any commands that are not builtin would
not respect pager.* config. For example:

  git config pager.stash false
  git stash list

would still use a pager. With this patch, pager.stash now
has an effect. If it is not specified, we will still fall
back to pager.log when we invoke "log" from "stash list".

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
		use_pager = check_pager_config</a><a data-author="Junio C Hamano" data-commit="67c116bb26b4ee31889e5ee15d6a9d3b7e972b7b" data-file="git.c" href="https://github.com/git/git/commit/67c116bb26b4ee31889e5ee15d6a9d3b7e972b7b" target="blank" title="Merge branch 'jk/pager-with-external-command'

* jk/pager-with-external-command:
  support pager.* for external commands

 - Junio C Hamano">(</a><a data-author="Jeff King" data-commit="92058e4d3e032714da6d2df5fa1fe2cf612979a5" data-file="git.c" href="https://github.com/git/git/commit/92058e4d3e032714da6d2df5fa1fe2cf612979a5" target="blank" title="support pager.* for external commands

Without this patch, any commands that are not builtin would
not respect pager.* config. For example:

  git config pager.stash false
  git stash list

would still use a pager. With this patch, pager.stash now
has an effect. If it is not specified, we will still fall
back to pager.log when we invoke "log" from "stash list".

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">argv[0]</a><a data-author="Junio C Hamano" data-commit="67c116bb26b4ee31889e5ee15d6a9d3b7e972b7b" data-file="git.c" href="https://github.com/git/git/commit/67c116bb26b4ee31889e5ee15d6a9d3b7e972b7b" target="blank" title="Merge branch 'jk/pager-with-external-command'

* jk/pager-with-external-command:
  support pager.* for external commands

 - Junio C Hamano">);</a><a data-author="Jonathan Nieder" data-commit="030149a4dcd584f6b47221f5b087d081e582d790" data-file="git.c" href="https://github.com/git/git/commit/030149a4dcd584f6b47221f5b087d081e582d790" target="blank" title="git --paginate: paginate external commands again

73e25e7c (git --paginate: do not commit pager choice too early,
2010-06-26) failed to take some cases into account.

1b. Builtins that do not use RUN_SETUP (like git config) do
    not find GIT_DIR set correctly when the pager is launched
    from run_builtin().  So the core.pager configuration is
    not honored from subdirectories of the toplevel for them.

4a. External git commands (like git request-pull) relied on the
    early pager launch to take care of handling the -p option.
    Ever since 73e25e7c, they do not honor the -p option at a
 - Jonathan Nieder">
	commit_pager_choice();</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">

	argv</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">array_pushf</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">(&amp;cmd</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">.args</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">, "git-%s", argv</a><a data-author="Johannes Sixt" data-commit="23326d14edbd16469453f6c3ecdd98ab90e6efb7" data-file="git.c" href="https://github.com/git/git/commit/23326d14edbd16469453f6c3ecdd98ab90e6efb7" target="blank" title="Windows: Strip ".exe" from the program name.

Before we can successfully parse a builtin command from the program name
we must strip off unneeded parts, that is, the file extension.

Furthermore, we must take Windows style path names into account when we
parse the program name.

Signed-off-by: Johannes Sixt &lt;johannes.sixt@telecom.at&gt;

 - Johannes Sixt">[</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">0</a><a data-author="Johannes Sixt" data-commit="23326d14edbd16469453f6c3ecdd98ab90e6efb7" data-file="git.c" href="https://github.com/git/git/commit/23326d14edbd16469453f6c3ecdd98ab90e6efb7" target="blank" title="Windows: Strip ".exe" from the program name.

Before we can successfully parse a builtin command from the program name
we must strip off unneeded parts, that is, the file extension.

Furthermore, we must take Windows style path names into account when we
parse the program name.

Signed-off-by: Johannes Sixt &lt;johannes.sixt@telecom.at&gt;

 - Johannes Sixt">]</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">);
	argv</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">_</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">array</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">_pushv(&amp;</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">cmd.</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">args, argv + 1);
	cmd.clean_on_exit = 1;</a><a data-author="Jeff King" data-commit="46df6906f3aaf74dafe2026b028c8c5c1a0d5f58" data-file="git.c" href="https://github.com/git/git/commit/46df6906f3aaf74dafe2026b028c8c5c1a0d5f58" target="blank" title="execv_dashed_external: wait for child on signal death

When you hit ^C to interrupt a git command going to a pager,
this usually leaves the pager running. But when a dashed
external is in use, the pager ends up in a funny state and
quits (but only after eating one more character from the
terminal!). This fixes it.

Explaining the reason will require a little background.

When git runs a pager, it's important for the git process to
hang around and wait for the pager to finish, even though it
has no more data to feed it. This is because git spawns the
pager as a child, and thus the git process i
 - Jeff King">
	cmd.wait_after_clean = 1;</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">
	cmd.silent_exec_failure = 1</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">;</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
	cmd.trace2_child_class = "dashed";

	trace2_cmd_name("_run_dashed_");</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">

	/*</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
	 * The code in run_command() logs trace2 child_start/child_exit
	 * events, so we do not need to report exec/exec_result events here.</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	 */
	trace_argv_printf(</a><a data-author="Jeff King" data-commit="2b296c93d49d65303a4ce291225c8755eeab1ff8" data-file="git.c" href="https://github.com/git/git/commit/2b296c93d49d65303a4ce291225c8755eeab1ff8" target="blank" title="execv_dashed_external: use child_process struct

When we run a dashed external, we use the one-liner
run_command_v_opt() to do so. Let's switch to using a
child_process struct, which has two advantages:

  1. We can drop all of the allocation and cleanup code for
     building our custom argv array, and just rely on the
     builtin argv_array (at the minor cost of doing a few
     extra mallocs).

  2. We have access to the complete range of child_process
     options, not just the ones that the "_opt()" form can
     forward.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C H
 - Jeff King">cmd.args.</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">argv, "trace: exec:");</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">

	/*</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">
	 * If we fail because the command is not found, it is
	 * OK to</a><a data-author="Junio C Hamano" data-commit="bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" data-file="git.c" href="https://github.com/git/git/commit/bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" target="blank" title="Merge branch 'j6t/mingw'

* j6t/mingw: (38 commits)
  compat/pread.c: Add a forward declaration to fix a warning
  Windows: Fix ntohl() related warnings about printf formatting
  Windows: TMP and TEMP environment variables specify a temporary directory.
  Windows: Make 'git help -a' work.
  Windows: Work around an oddity when a pipe with no reader is written to.
  Windows: Make the pager work.
  When installing, be prepared that template_dir may be relative.
  Windows: Use a relative default template_dir and ETC_GITCONFIG
  Windows: Compute the fallback for exec_path from the program invocatio
 - Junio C Hamano"> return</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">. Otherwise, we just pass along the status code</a><a data-author="Jeff King" data-commit="246f0edec0b789ccfeebcf7fef85417b7cb04425" data-file="git.c" href="https://github.com/git/git/commit/246f0edec0b789ccfeebcf7fef85417b7cb04425" target="blank" title="execv_dashed_external: stop exiting with negative code

When we try to exec a git sub-command, we pass along the
status code from run_command(). But that may return -1 if we
ran into an error with pipe() or execve(). This tends to
work (and end up as 255 due to twos-complement wraparound
and truncation), but in general it's probably a good idea to
avoid negative exit codes for portability.

We can easily translate to the normal generic "128" code we
get when syscalls cause us to die.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">,
	 * or our usual generic code if we were not even able to exec
	 * the program</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">.</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
	 */</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">
	status = run_command</a><a data-author="Junio C Hamano" data-commit="bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" data-file="git.c" href="https://github.com/git/git/commit/bb1ab2db08f48add4236a5a9c08aa1a6aa4d5d48" target="blank" title="Merge branch 'j6t/mingw'

* j6t/mingw: (38 commits)
  compat/pread.c: Add a forward declaration to fix a warning
  Windows: Fix ntohl() related warnings about printf formatting
  Windows: TMP and TEMP environment variables specify a temporary directory.
  Windows: Make 'git help -a' work.
  Windows: Work around an oddity when a pipe with no reader is written to.
  Windows: Make the pager work.
  When installing, be prepared that template_dir may be relative.
  Windows: Use a relative default template_dir and ETC_GITCONFIG
  Windows: Compute the fallback for exec_path from the program invocatio
 - Junio C Hamano">(&amp;cmd);</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">

	/*
	 * If the child process ran and we are now going to exit, emit a
	 * generic string as our trace2 command verb to indicate that we
	 * launched a dashed command.</a><a data-author="Patrick Reynolds" data-commit="7559a1be8a0afb10df41d25e4cf4c5285a5faef1" data-file="git.c" href="https://github.com/git/git/commit/7559a1be8a0afb10df41d25e4cf4c5285a5faef1" target="blank" title="unblock and unignore SIGPIPE

Blocked and ignored signals -- but not caught signals -- are inherited
across exec.  Some callers with sloppy signal-handling behavior can call
git with SIGPIPE blocked or ignored, even non-deterministically.  When
SIGPIPE is blocked or ignored, several git commands can run indefinitely,
ignoring EPIPE returns from write() calls, even when the process that
called them has gone away.  Our specific case involved a pipe of git
diff-tree output to a script that reads a limited amount of diff data.

In an ideal world, git would never be called with SIGPIPE blocked or
i
 - Patrick Reynolds">
	 */</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">
	if (status</a><a data-author="Johannes Sixt" data-commit="0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" data-file="git.c" href="https://github.com/git/git/commit/0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" target="blank" title="run_command: report system call errors instead of returning error codes

The motivation for this change is that system call failures are serious
errors that should be reported to the user, but only few callers took the
burden to decode the error codes that the functions returned into error
messages.

If at all, then only an unspecific error message was given. A prominent
example is this:

   $ git upload-pack . | :
   fatal: unable to run 'git-upload-pack'

In this example, git-upload-pack, the external command invoked through the
git wrapper, dies due to SIGPIPE, but the git wrapper does not 
 - Johannes Sixt"> &gt;= 0</a><a data-author="Jeff King" data-commit="246f0edec0b789ccfeebcf7fef85417b7cb04425" data-file="git.c" href="https://github.com/git/git/commit/246f0edec0b789ccfeebcf7fef85417b7cb04425" target="blank" title="execv_dashed_external: stop exiting with negative code

When we try to exec a git sub-command, we pass along the
status code from run_command(). But that may return -1 if we
ran into an error with pipe() or execve(). This tends to
work (and end up as 255 due to twos-complement wraparound
and truncation), but in general it's probably a good idea to
avoid negative exit codes for portability.

We can easily translate to the normal generic "128" code we
get when syscalls cause us to die.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Johannes Sixt" data-commit="5709e0363a891b72eb9e9756d7fb121d9bf6a7c7" data-file="git.c" href="https://github.com/git/git/commit/5709e0363a891b72eb9e9756d7fb121d9bf6a7c7" target="blank" title="run_command: return exit code as positive value

As a general guideline, functions in git's code return zero to indicate
success and negative values to indicate failure. The run_command family of
functions followed this guideline. But there are actually two different
kinds of failure:

- failures of system calls;

- non-zero exit code of the program that was run.

Usually, a non-zero exit code of the program is a failure and means a
failure to the caller. Except that sometimes it does not. For example, the
exit code of merge programs (e.g. external merge drivers) conveys
information about how 
 - Johannes Sixt">
		exit</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">(status);</a><a data-author="Jeff King" data-commit="246f0edec0b789ccfeebcf7fef85417b7cb04425" data-file="git.c" href="https://github.com/git/git/commit/246f0edec0b789ccfeebcf7fef85417b7cb04425" target="blank" title="execv_dashed_external: stop exiting with negative code

When we try to exec a git sub-command, we pass along the
status code from run_command(). But that may return -1 if we
ran into an error with pipe() or execve(). This tends to
work (and end up as 255 due to twos-complement wraparound
and truncation), but in general it's probably a good idea to
avoid negative exit codes for portability.

We can easily translate to the normal generic "128" code we
get when syscalls cause us to die.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
	else if (</a><a data-author="Johannes Sixt" data-commit="0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" data-file="git.c" href="https://github.com/git/git/commit/0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" target="blank" title="run_command: report system call errors instead of returning error codes

The motivation for this change is that system call failures are serious
errors that should be reported to the user, but only few callers took the
burden to decode the error codes that the functions returned into error
messages.

If at all, then only an unspecific error message was given. A prominent
example is this:

   $ git upload-pack . | :
   fatal: unable to run 'git-upload-pack'

In this example, git-upload-pack, the external command invoked through the
git wrapper, dies due to SIGPIPE, but the git wrapper does not 
 - Johannes Sixt">errno</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King"> !=</a><a data-author="Johannes Sixt" data-commit="0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" data-file="git.c" href="https://github.com/git/git/commit/0ac77ec3150f43a5c2a6b1e47e9db5aafe53fb72" target="blank" title="run_command: report system call errors instead of returning error codes

The motivation for this change is that system call failures are serious
errors that should be reported to the user, but only few callers took the
burden to decode the error codes that the functions returned into error
messages.

If at all, then only an unspecific error message was given. A prominent
example is this:

   $ git upload-pack . | :
   fatal: unable to run 'git-upload-pack'

In this example, git-upload-pack, the external command invoked through the
git wrapper, dies due to SIGPIPE, but the git wrapper does not 
 - Johannes Sixt"> ENOENT</a><a data-author="Jeff King" data-commit="d8e96fd86d415554a9c2e09ffb929a9e22fdad25" data-file="git.c" href="https://github.com/git/git/commit/d8e96fd86d415554a9c2e09ffb929a9e22fdad25" target="blank" title="git: use run_command() to execute dashed externals

We used to simply try calling execvp(); if it succeeded, then we were done
and the new program was running. If it didn't, then we knew that it wasn't
a valid command.

Unfortunately, this interacted badly with the new pager handling. Now that
git remains the parent process and the pager is spawned, git has to hang
around until the pager is finished. We install an atexit handler to do
this, but that handler never gets called if we successfully run execvp.

You could see this behavior by running any dashed external using a pager
(e.g., "git -p 
 - Jeff King">)</a><a data-author="Jeff King" data-commit="246f0edec0b789ccfeebcf7fef85417b7cb04425" data-file="git.c" href="https://github.com/git/git/commit/246f0edec0b789ccfeebcf7fef85417b7cb04425" target="blank" title="execv_dashed_external: stop exiting with negative code

When we try to exec a git sub-command, we pass along the
status code from run_command(). But that may return -1 if we
ran into an error with pipe() or execve(). This tends to
work (and end up as 255 due to twos-complement wraparound
and truncation), but in general it's probably a good idea to
avoid negative exit codes for portability.

We can easily translate to the normal generic "128" code we
get when syscalls cause us to die.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
		exit(128);</a><a data-author="Andreas Ericsson" data-commit="97fc6c5fbacc2181319bbd7e2faa8ac04476f862" data-file="git.c" href="https://github.com/git/git/commit/97fc6c5fbacc2181319bbd7e2faa8ac04476f862" target="blank" title="git --help COMMAND brings up the git-COMMAND man-page.

It's by design a bit stupid (matching ^git rather than ^git-), so as
to work with 'gitk' and 'git' as well.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
}</a><a data-author="Junio C Hamano" data-commit="5786f4fac7afa881a306e2b771a0307e4ee05384" data-file="git.c" href="https://github.com/git/git/commit/5786f4fac7afa881a306e2b771a0307e4ee05384" target="blank" title="Merge branch 'as/autocorrect-alias'

* as/autocorrect-alias:
  git.c: make autocorrected aliases work

 - Junio C Hamano">

static int run_</a><a data-author="Johannes Schindelin" data-commit="8af84dadb142f7321ff0ce8690385e99da8ede2f" data-file="git.c" href="https://github.com/git/git/commit/8af84dadb142f7321ff0ce8690385e99da8ede2f" target="blank" title="git wrapper: DWIM mistyped commands

This patch introduces a modified Damerau-Levenshtein algorithm into
Git's code base, and uses it with the following penalties to show some
similar commands when an unknown command was encountered:

	swap = 0, insertion = 1, substitution = 2, deletion = 4

A typical output would now look like this:

	$ git sm
	git: 'sm' is not a git-command. See 'git --help'.

	Did you mean one of these?
		am
		rm

The cut-off is at similarity rating 6, which was empirically determined
to give sensible results.

As a convenience, if there is only one candidate, Git continues
 - Johannes Schindelin">argv(</a><a data-author="Junio C Hamano" data-commit="5786f4fac7afa881a306e2b771a0307e4ee05384" data-file="git.c" href="https://github.com/git/git/commit/5786f4fac7afa881a306e2b771a0307e4ee05384" target="blank" title="Merge branch 'as/autocorrect-alias'

* as/autocorrect-alias:
  git.c: make autocorrected aliases work

 - Junio C Hamano">int *argcp</a><a data-author="Johannes Schindelin" data-commit="8af84dadb142f7321ff0ce8690385e99da8ede2f" data-file="git.c" href="https://github.com/git/git/commit/8af84dadb142f7321ff0ce8690385e99da8ede2f" target="blank" title="git wrapper: DWIM mistyped commands

This patch introduces a modified Damerau-Levenshtein algorithm into
Git's code base, and uses it with the following penalties to show some
similar commands when an unknown command was encountered:

	swap = 0, insertion = 1, substitution = 2, deletion = 4

A typical output would now look like this:

	$ git sm
	git: 'sm' is not a git-command. See 'git --help'.

	Did you mean one of these?
		am
		rm

The cut-off is at similarity rating 6, which was empirically determined
to give sensible results.

As a convenience, if there is only one candidate, Git continues
 - Johannes Schindelin">,</a><a data-author="Junio C Hamano" data-commit="5786f4fac7afa881a306e2b771a0307e4ee05384" data-file="git.c" href="https://github.com/git/git/commit/5786f4fac7afa881a306e2b771a0307e4ee05384" target="blank" title="Merge branch 'as/autocorrect-alias'

* as/autocorrect-alias:
  git.c: make autocorrected aliases work

 - Junio C Hamano"> const char ***</a><a data-author="Johannes Schindelin" data-commit="8af84dadb142f7321ff0ce8690385e99da8ede2f" data-file="git.c" href="https://github.com/git/git/commit/8af84dadb142f7321ff0ce8690385e99da8ede2f" target="blank" title="git wrapper: DWIM mistyped commands

This patch introduces a modified Damerau-Levenshtein algorithm into
Git's code base, and uses it with the following penalties to show some
similar commands when an unknown command was encountered:

	swap = 0, insertion = 1, substitution = 2, deletion = 4

A typical output would now look like this:

	$ git sm
	git: 'sm' is not a git-command. See 'git --help'.

	Did you mean one of these?
		am
		rm

The cut-off is at similarity rating 6, which was empirically determined
to give sensible results.

As a convenience, if there is only one candidate, Git continues
 - Johannes Schindelin">argv)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
{</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	int done_alias = 0;</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher">
	struct string_list cmd_list = STRING_LIST_INIT_NODUP;</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">
	struct string_list_item *seen;</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">

	while (1) {</a><a data-author="Paul Tan" data-commit="73c2779f421fe1eaead6f1c07a0e134a9c17d6db" data-file="git.c" href="https://github.com/git/git/commit/73c2779f421fe1eaead6f1c07a0e134a9c17d6db" target="blank" title="builtin-am: implement skeletal builtin am

For the purpose of rewriting git-am.sh into a C builtin, implement a
skeletal builtin/am.c that redirects to $GIT_EXEC_PATH/git-am if the
environment variable _GIT_USE_BUILTIN_AM is not defined. Since in the
Makefile git-am.sh takes precedence over builtin/am.c,
$GIT_EXEC_PATH/git-am will contain the shell script git-am.sh, and thus
this allows us to fall back on the functional git-am.sh when running the
test suite for tests that depend on a working git-am implementation.

Since git-am.sh cannot handle any environment modifications by
setup_git_direct
 - Paul Tan">
		/*</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy">
		 *</a><a data-author="Junio C Hamano" data-commit="441981bc85ea2b648d7ffb2515b371071208e657" data-file="git.c" href="https://github.com/git/git/commit/441981bc85ea2b648d7ffb2515b371071208e657" target="blank" title="git: simplify environment save/restore logic

The only code that cares about the value of the global variable
saved_env_before_alias after the previous fix is handle_builtin()
that turns into a glorified no-op when the variable is true, so the
logic could safely be lifted to its caller, i.e. the caller can
refrain from calling it when the variable is set.

This variable tells us if save_env_before_alias() was called (with
or without matching restore_env()), but the sole caller of the
function, handle_alias(), always calls it as the first thing, so we
can consider that the variable essentially 
 - Junio C Hamano"> If we tried alias and futzed with our environment,
		 * it no longer is safe to invoke builtins directly in
		 * general.  We have to spawn them as dashed externals.
		 *</a><a data-author="Paul Tan" data-commit="73c2779f421fe1eaead6f1c07a0e134a9c17d6db" data-file="git.c" href="https://github.com/git/git/commit/73c2779f421fe1eaead6f1c07a0e134a9c17d6db" target="blank" title="builtin-am: implement skeletal builtin am

For the purpose of rewriting git-am.sh into a C builtin, implement a
skeletal builtin/am.c that redirects to $GIT_EXEC_PATH/git-am if the
environment variable _GIT_USE_BUILTIN_AM is not defined. Since in the
Makefile git-am.sh takes precedence over builtin/am.c,
$GIT_EXEC_PATH/git-am will contain the shell script git-am.sh, and thus
this allows us to fall back on the functional git-am.sh when running the
test suite for tests that depend on a working git-am implementation.

Since git-am.sh cannot handle any environment modifications by
setup_git_direct
 - Paul Tan">
		 * NEEDSWORK:</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> if</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy"> we can figure out cases</a><a data-author="Junio C Hamano" data-commit="441981bc85ea2b648d7ffb2515b371071208e657" data-file="git.c" href="https://github.com/git/git/commit/441981bc85ea2b648d7ffb2515b371071208e657" target="blank" title="git: simplify environment save/restore logic

The only code that cares about the value of the global variable
saved_env_before_alias after the previous fix is handle_builtin()
that turns into a glorified no-op when the variable is true, so the
logic could safely be lifted to its caller, i.e. the caller can
refrain from calling it when the variable is set.

This variable tells us if save_env_before_alias() was called (with
or without matching restore_env()), but the sole caller of the
function, handle_alias(), always calls it as the first thing, so we
can consider that the variable essentially 
 - Junio C Hamano">
		 *</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy"> where it is safe to do, we can avoid spawning a new</a><a data-author="Junio C Hamano" data-commit="441981bc85ea2b648d7ffb2515b371071208e657" data-file="git.c" href="https://github.com/git/git/commit/441981bc85ea2b648d7ffb2515b371071208e657" target="blank" title="git: simplify environment save/restore logic

The only code that cares about the value of the global variable
saved_env_before_alias after the previous fix is handle_builtin()
that turns into a glorified no-op when the variable is true, so the
logic could safely be lifted to its caller, i.e. the caller can
refrain from calling it when the variable is set.

This variable tells us if save_env_before_alias() was called (with
or without matching restore_env()), but the sole caller of the
function, handle_alias(), always calls it as the first thing, so we
can consider that the variable essentially 
 - Junio C Hamano">
		 *</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy"> process.</a><a data-author="Paul Tan" data-commit="73c2779f421fe1eaead6f1c07a0e134a9c17d6db" data-file="git.c" href="https://github.com/git/git/commit/73c2779f421fe1eaead6f1c07a0e134a9c17d6db" target="blank" title="builtin-am: implement skeletal builtin am

For the purpose of rewriting git-am.sh into a C builtin, implement a
skeletal builtin/am.c that redirects to $GIT_EXEC_PATH/git-am if the
environment variable _GIT_USE_BUILTIN_AM is not defined. Since in the
Makefile git-am.sh takes precedence over builtin/am.c,
$GIT_EXEC_PATH/git-am will contain the shell script git-am.sh, and thus
this allows us to fall back on the functional git-am.sh when running the
test suite for tests that depend on a working git-am implementation.

Since git-am.sh cannot handle any environment modifications by
setup_git_direct
 - Paul Tan">
		 */</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy">
		if (!</a><a data-author="Junio C Hamano" data-commit="441981bc85ea2b648d7ffb2515b371071208e657" data-file="git.c" href="https://github.com/git/git/commit/441981bc85ea2b648d7ffb2515b371071208e657" target="blank" title="git: simplify environment save/restore logic

The only code that cares about the value of the global variable
saved_env_before_alias after the previous fix is handle_builtin()
that turns into a glorified no-op when the variable is true, so the
logic could safely be lifted to its caller, i.e. the caller can
refrain from calling it when the variable is set.

This variable tells us if save_env_before_alias() was called (with
or without matching restore_env()), but the sole caller of the
function, handle_alias(), always calls it as the first thing, so we
can consider that the variable essentially 
 - Junio C Hamano">done</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="86d26f240fcb4f287258ad459efc2b5e30e60cfd" data-file="git.c" href="https://github.com/git/git/commit/86d26f240fcb4f287258ad459efc2b5e30e60cfd" target="blank" title="setup.c: re-fix d95138e (setup: set env $GIT_WORK_TREE when ..

Commit d95138e [1] attempted to fix a .git file problem by
setting GIT_WORK_TREE whenever GIT_DIR is set. It sounded harmless
because we handle GIT_DIR and GIT_WORK_TREE side by side for most
commands, with two exceptions: git-init and git-clone.

"git clone" is not happy with d95138e. This command ignores GIT_DIR
but respects GIT_WORK_TREE [2] [3] which means it used to run fine
from a hook, where GIT_DIR was set but GIT_WORK_TREE was not (*).
With d95138e, GIT_WORK_TREE is set all the time and git-clone
interprets that as "I giv
 - Nguyễn Thái Ngọc Duy">_alias</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
			handle_</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">(</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">*argcp</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">,</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó"> *</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">argv</a><a data-author="Andreas Ericsson" data-commit="da6bf70ebf7d485e3643ba3569962a4c08e37906" data-file="git.c" href="https://github.com/git/git/commit/da6bf70ebf7d485e3643ba3569962a4c08e37906" target="blank" title="git: grok 'help' to mean '--help'.

Most other scm's understand it, most users expect it and it's an easy fix.

Signed-off-by: Andreas Ericsson &lt;ae@op5.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">);</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">

#if 0 // TODO In GFW, need to amend a7924b655e940b06cb547c235d6bed9767929673 to include trace2_ and _tr2 lines.
		else if (get_builtin(**argv)) {
			struct argv_array args = ARGV_ARRAY_INIT;
			int i;

			/*
			 * The current process is committed to launching a
			 * child process to run the command named in (**argv)
			 * and exiting.  Log a generic string as the trace2
			 * command verb to indicate this.  Note that the child
			 * process will log the actual verb when it runs.
			 */
			trace2_cmd_name("_run_git_alias_");

			if (get_super_prefix())
				die("%s doesn't support --super-prefix", **argv);

			commit_pager_choice();

			argv_array_push(&amp;args, "git");
			for (i = 0; i &lt; *argcp; i++)
				argv_array_push(&amp;args, (*argv)[i]);

			trace_argv_printf(args.argv, "trace: exec:");</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano">

			/*</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			 * if we fail because the command is not found, it is
			 * OK to return. Otherwise, we just pass along the status code.</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano">
			 */</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
			i = run_command_v_opt_tr2(args.argv,</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano"> RUN_</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">SILENT</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano">_</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">EXEC</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano">_</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">FAILURE |
						  RUN_CLEAN_ON_EXIT</a><a data-author="Junio C Hamano" data-commit="e36adf712251a19bd2ada0016764d340dfcf2ba0" data-file="git.c" href="https://github.com/git/git/commit/e36adf712251a19bd2ada0016764d340dfcf2ba0" target="blank" title="Merge branch 'ps/stash-in-c'

"git stash" rewritten in C.

* ps/stash-in-c: (28 commits)
  tests: add a special setup where stash.useBuiltin is off
  stash: optionally use the scripted version again
  stash: add back the original, scripted `git stash`
  stash: convert `stash--helper.c` into `stash.c`
  stash: replace all `write-tree` child processes with API calls
  stash: optimize `get_untracked_files()` and `check_changes()`
  stash: convert save to builtin
  stash: make push -q quiet
  stash: convert push to builtin
  stash: convert create to builtin
  stash: convert store to builtin
  stas
 - Junio C Hamano">,</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler"> "git_alias");
			if (i &gt;= 0 || errno != ENOENT)
				exit(i);
			die("could not execute builtin %s", **argv);</a><a data-author="Junio C Hamano" data-commit="477f2b41310c4b1040a9e7f72720b9c39d82caf9" data-file="git.c" href="https://github.com/git/git/commit/477f2b41310c4b1040a9e7f72720b9c39d82caf9" target="blank" title="git log --full-diff

Without this flag, "git log -p paths..." shows commits that
touch the specified paths, and diffs about the same specified
paths.  With this, the full diff is shown for commits that touch
the specified paths.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		}</a><a data-author="Jeff Hostetler" data-commit="ee4512ed481a126dadd33334186e0e759d7f2f47" data-file="git.c" href="https://github.com/git/git/commit/ee4512ed481a126dadd33334186e0e759d7f2f47" target="blank" title="trace2: create new combined trace facility

Create a new unified tracing facility for git.  The eventual intent is to
replace the current trace_printf* and trace_performance* routines with a
unified set of git_trace2* routines.

In addition to the usual printf-style API, trace2 provides higer-level
event verbs with fixed-fields allowing structured data to be written.
This makes post-processing and analysis easier for external tools.

Trace2 defines 3 output targets.  These are set using the environment
variables "GIT_TR2", "GIT_TR2_PERF", and "GIT_TR2_EVENT".  These may be
set to "1" or to an 
 - Jeff Hostetler">
#endif // a7924b655e940b06cb547c235d6bed9767929673</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

		/</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">*</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> .. then try the external ones */</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">
		execv_</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">dashed</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">_</a><a data-author="Junio C Hamano" data-commit="7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" data-file="git.c" href="https://github.com/git/git/commit/7550be0a2bbf47aaa63c806bb5d7fcb8ab197cf8" target="blank" title="Prepare execv_git_cmd() for removal of builtins from the filesystem

Currently, execv_git_cmd() always try running the dashed form, which
means we cannot easily remove the git-foo hardlinks for built-in
commands.  This updates the function to always exec "git foo" form, and
makes sure "git" potty does not infinitely recurse to itself.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">external</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">(</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">*</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">argv</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">);</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">

		seen =</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher"> unsorted_string_list_</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">lookup</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher">(&amp;cmd_list, *argv[0])</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">;</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">
		if (</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano">seen) {</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">
			int i;
			struct strbuf sb = STRBUF_INIT;
			for (i = 0; i &lt; cmd_list.nr;</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen"> i++) {</a><a data-author="Tim Schumacher" data-commit="82f71d9a5a9df718553bf257ad8610e2ef1e1179" data-file="git.c" href="https://github.com/git/git/commit/82f71d9a5a9df718553bf257ad8610e2ef1e1179" target="blank" title="alias: show the call history when an alias is looping

Just printing the command that the user entered is not particularly
helpful when trying to find the alias that causes the loop.

Print the history of substituted commands to help the user find the
offending alias. Mark the entrypoint of the loop with "&lt;==" and the
last command (which looped back to the entrypoint) with "==&gt;".

Signed-off-by: Tim Schumacher &lt;timschumi@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Tim Schumacher">
				struct string_list_item *item = &amp;cmd_list.items[i];

				strbuf_addf(&amp;sb, "\n  %s", item-&gt;string);
				if (item == seen)
					strbuf_addstr(&amp;sb, " &lt;==");
				else if (i == cmd_list.nr - 1)
					strbuf_addstr(&amp;sb, " ==&gt;");</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
			}</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano">
			die</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">(_("</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano">alias loop detected: expansion of</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano"> '%s'</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano"> does"
			      " not terminate:</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">%s"),</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano"> cmd</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">_</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano">list.items[0].string</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">,</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano"> sb.buf</a><a data-author="Junio C Hamano" data-commit="7752999cd6bbe1aff4e34f83ed078ffffc232667" data-file="git.c" href="https://github.com/git/git/commit/7752999cd6bbe1aff4e34f83ed078ffffc232667" target="blank" title="Merge branch 'rv/alias-help'

"git cmd --help" when "cmd" is aliased used to only say "cmd is
aliased to ...".  Now it shows that to the standard error stream
and runs "git $cmd --help" where $cmd is the first word of the
alias expansion.

This could be misleading for those who alias a command with options
(e.g. with "[alias] cpn = cherry-pick -n", "git cpn --help" would
show the manual of "cherry-pick", and the reader would not be told
to pay close attention to the part that describes the "--no-commit"
option until closing the pager that showed the contents of the
manual, if the pager is conf
 - Junio C Hamano">);</a><a data-author="Junio C Hamano" data-commit="52b70d56bd23811003a72866cc23a0a44b9da1b7" data-file="git.c" href="https://github.com/git/git/commit/52b70d56bd23811003a72866cc23a0a44b9da1b7" target="blank" title="git log [diff-tree options]...

And this makes "git log" to take common diff-tree options, so
that it can be used as "git whatchanged".

The recent revision walker updates by Linus to make path
limiting low-latency helps this quite a bit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		}</a><a data-author="Junio C Hamano" data-commit="506ee60d222f94a1598769feaba3b3621bd9fa1a" data-file="git.c" href="https://github.com/git/git/commit/506ee60d222f94a1598769feaba3b3621bd9fa1a" target="blank" title="Merge branch 'ts/alias-of-alias'

An alias that expands to another alias has so far been forbidden,
but now it is allowed to create such an alias.

* ts/alias-of-alias:
  t0014: introduce an alias testing suite
  alias: show the call history when an alias is looping
  alias: add support for aliases of an alias

 - Junio C Hamano">

		string_list_append(&amp;cmd_list, *argv[0]);</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

		/*</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		 * It could be an alias -- this works around the insanity
		 * of overriding "git log" with "git show" by having
		 * alias.log = show</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
		 */</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">
		if (</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">!</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">handle_alias(</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">argcp, argv))</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">
			break;</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
		done</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">_alias</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> = 1</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Junio C Hamano" data-commit="52b70d56bd23811003a72866cc23a0a44b9da1b7" data-file="git.c" href="https://github.com/git/git/commit/52b70d56bd23811003a72866cc23a0a44b9da1b7" target="blank" title="git log [diff-tree options]...

And this makes "git log" to take common diff-tree options, so
that it can be used as "git whatchanged".

The recent revision walker updates by Linus to make path
limiting low-latency helps this quite a bit.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	}</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher">

	string_list_clear</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">(</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher">&amp;cmd</a><a data-author="Junio C Hamano" data-commit="a025463bc0ec2c894a88f2dfb44cf88ba71bb712" data-file="git.c" href="https://github.com/git/git/commit/a025463bc0ec2c894a88f2dfb44cf88ba71bb712" target="blank" title="git alias: try alias last.

This disables alias "foo" from being used for git-foo, and when
we do use alias we check the built-in and then existing command
names first and then alias as the fallback.  This avoids the
problem of common commands used in scripts getting clobbered by
user specific aliases.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">_</a><a data-author="Tim Schumacher" data-commit="c6d75bc17a045af8cadd2dce982f5737a5ca38bb" data-file="git.c" href="https://github.com/git/git/commit/c6d75bc17a045af8cadd2dce982f5737a5ca38bb" target="blank" title="alias: add support for aliases of an alias

Aliases can only contain non-alias git commands and their arguments,
not other user-defined aliases.  Resolving further (nested) aliases
is prevented by breaking the loop after the first alias was
processed.  Git then fails with a command-not-found error.

Allow resolving nested aliases by not breaking the loop in
run_argv() after the first alias was processed.  Instead, continue
the loop until `handle_alias()` fails, which means that there are no
further aliases that can be processed.  Prevent looping aliases by
storing substituted commands in `cmd_
 - Tim Schumacher">list, 0</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="c0562611c525bb3c564b79c345fc7e4f9e799e54" data-file="git.c" href="https://github.com/git/git/commit/c0562611c525bb3c564b79c345fc7e4f9e799e54" target="blank" title="git potty: restore environments after alias expansion

Commit 4ad8332 (t0001: test git init when run via an alias -
2010-11-26) noted breakages when running init via alias. The problem
is for alias to be used, $GIT_DIR must be searched, but 'init' and
'clone' are not happy with that. So we start a new process like an
external command, with clean environment in this case. Env variables
that are set by command line (e.g. "git --git-dir=.. ") are kept.

This should also fix autocorrecting a command typo to "init" because
it's the same problem: aliases are read, then "init" is unhappy with
$GIT_DI
 - Nguyễn Thái Ngọc Duy">);</a><a data-author="Junio C Hamano" data-commit="5786f4fac7afa881a306e2b771a0307e4ee05384" data-file="git.c" href="https://github.com/git/git/commit/5786f4fac7afa881a306e2b771a0307e4ee05384" target="blank" title="Merge branch 'as/autocorrect-alias'

* as/autocorrect-alias:
  git.c: make autocorrected aliases work

 - Junio C Hamano">

	return done_alias</a><a data-author="Johannes Schindelin" data-commit="8af84dadb142f7321ff0ce8690385e99da8ede2f" data-file="git.c" href="https://github.com/git/git/commit/8af84dadb142f7321ff0ce8690385e99da8ede2f" target="blank" title="git wrapper: DWIM mistyped commands

This patch introduces a modified Damerau-Levenshtein algorithm into
Git's code base, and uses it with the following penalties to show some
similar commands when an unknown command was encountered:

	swap = 0, insertion = 1, substitution = 2, deletion = 4

A typical output would now look like this:

	$ git sm
	git: 'sm' is not a git-command. See 'git --help'.

	Did you mean one of these?
		am
		rm

The cut-off is at similarity rating 6, which was empirically determined
to give sensible results.

As a convenience, if there is only one candidate, Git continues
 - Johannes Schindelin">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
}</a><a data-author="Junio C Hamano" data-commit="d7ed183a918bf6330d9036ca2d710d771b4b6198" data-file="git.c" href="https://github.com/git/git/commit/d7ed183a918bf6330d9036ca2d710d771b4b6198" target="blank" title="Merge branch 'rt/help-unknown'

"git nosuchcommand --help" said "No manual entry for gitnosuchcommand",
which was not intuitive, given that "git nosuchcommand" said "git:
'nosuchcommand' is not a git command".

* rt/help-unknown:
  help: make option --help open man pages only for Git commands
  help: introduce option --exclude-guides

 - Junio C Hamano">

int cmd</a><a data-author="Junio C Hamano" data-commit="9d04401ffe18138138e8f765c2bb31420f3efe25" data-file="git.c" href="https://github.com/git/git/commit/9d04401ffe18138138e8f765c2bb31420f3efe25" target="blank" title="Merge branch 'cc/interpret-trailers'

A new filter to programatically edit the tail end of the commit log
messages.

* cc/interpret-trailers:
  Documentation: add documentation for 'git interpret-trailers'
  trailer: add tests for commands in config file
  trailer: execute command from 'trailer.&lt;name&gt;.command'
  trailer: add tests for "git interpret-trailers"
  trailer: add interpret-trailers command
  trailer: put all the processing together and print
  trailer: parse trailers from file or stdin
  trailer: process command line trailer arguments
  trailer: read and process config information
 
 - Junio C Hamano">_</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">main(int argc,</a><a data-author="Junio C Hamano" data-commit="9201c707426b3dc0c894775416f576c25c008d46" data-file="git.c" href="https://github.com/git/git/commit/9201c707426b3dc0c894775416f576c25c008d46" target="blank" title="Const tightening.

Mark Wooding noticed there was a type mismatch warning in git.c; this
patch does things slightly differently (mostly tightening const) and
was what I was holding onto, waiting for the setup-revisions change
to be merged into the master branch.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano"> const</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson"> char **argv)</a><a data-author="Linus Torvalds" data-commit="ea77e675e564211513ebedb4f5bdcda482d7fd30" data-file="git.c" href="https://github.com/git/git/commit/ea77e675e564211513ebedb4f5bdcda482d7fd30" target="blank" title="Make "git help" react to window size correctly

Currently the git "show commands" function will react to the environment
variable COLUMNS, or just default to a width of 80 characters.

That's just soo eighties. Nobody sane sets COLUMNS any more, unless they
need to support some stone-age software from before the age of steam
engines, SIGWINCH and TIOCGWINSZ.

So get with the new century, and use TIOCGWINSZ to get the terminal size.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
{</a><a data-author="Junio C Hamano" data-commit="9201c707426b3dc0c894775416f576c25c008d46" data-file="git.c" href="https://github.com/git/git/commit/9201c707426b3dc0c894775416f576c25c008d46" target="blank" title="Const tightening.

Mark Wooding noticed there was a type mismatch warning in git.c; this
patch does things slightly differently (mostly tightening const) and
was what I was holding onto, waiting for the setup-revisions change
to be merged into the master branch.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	const</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> char *cmd</a><a data-author="Steve Haslam" data-commit="4dd47c3b867f51211d0dc4474dab0fee5ca614da" data-file="git.c" href="https://github.com/git/git/commit/4dd47c3b867f51211d0dc4474dab0fee5ca614da" target="blank" title="Refactor git_set_argv0_path() to git_extract_argv0_path()

This commit moves the code that computes the dirname of argv[0]
from git.c's main() to git_set_argv0_path() and renames the function
to git_extract_argv0_path().  This makes the code in git.c's main
less cluttered, and we can use the dirname computation from other
main() functions too.

[ spr:
 - split Steve's original commit and wrote new commit message.
 - Integrated Johannes Schindelin's
   cca1704897e7fdb182f68d4c48a437c5d7bc5203 while rebasing onto master.
]

Signed-off-by: Steve Haslam &lt;shaslam@lastminute.com&gt;
Signed-off-by: Stef
 - Steve Haslam">;</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">
	int done_help = 0;</a><a data-author="Steve Haslam" data-commit="4dd47c3b867f51211d0dc4474dab0fee5ca614da" data-file="git.c" href="https://github.com/git/git/commit/4dd47c3b867f51211d0dc4474dab0fee5ca614da" target="blank" title="Refactor git_set_argv0_path() to git_extract_argv0_path()

This commit moves the code that computes the dirname of argv[0]
from git.c's main() to git_set_argv0_path() and renames the function
to git_extract_argv0_path().  This makes the code in git.c's main
less cluttered, and we can use the dirname computation from other
main() functions too.

[ spr:
 - split Steve's original commit and wrote new commit message.
 - Integrated Johannes Schindelin's
   cca1704897e7fdb182f68d4c48a437c5d7bc5203 while rebasing onto master.
]

Signed-off-by: Steve Haslam &lt;shaslam@lastminute.com&gt;
Signed-off-by: Stef
 - Steve Haslam">

	cmd =</a><a data-author="Dmitry V. Levin" data-commit="5b6df8e45f31c7eb26c30536448cffe1b715e1ce" data-file="git.c" href="https://github.com/git/git/commit/5b6df8e45f31c7eb26c30536448cffe1b715e1ce" target="blank" title="Handle invalid argc gently

describe, git: Handle argc==0 case the same way as argc==1.
merge-tree: Refuse excessive arguments.

Signed-off-by: Dmitry V. Levin &lt;ldv@altlinux.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Dmitry V. Levin"> argv[0]</a><a data-author="Steve Haslam" data-commit="4dd47c3b867f51211d0dc4474dab0fee5ca614da" data-file="git.c" href="https://github.com/git/git/commit/4dd47c3b867f51211d0dc4474dab0fee5ca614da" target="blank" title="Refactor git_set_argv0_path() to git_extract_argv0_path()

This commit moves the code that computes the dirname of argv[0]
from git.c's main() to git_set_argv0_path() and renames the function
to git_extract_argv0_path().  This makes the code in git.c's main
less cluttered, and we can use the dirname computation from other
main() functions too.

[ spr:
 - split Steve's original commit and wrote new commit message.
 - Integrated Johannes Schindelin's
   cca1704897e7fdb182f68d4c48a437c5d7bc5203 while rebasing onto master.
]

Signed-off-by: Steve Haslam &lt;shaslam@lastminute.com&gt;
Signed-off-by: Stef
 - Steve Haslam">;
	if (</a><a data-author="Steffen Prohaska" data-commit="2cd72b0b290e40fb4d6a925ce26603503f01aa09" data-file="git.c" href="https://github.com/git/git/commit/2cd72b0b290e40fb4d6a925ce26603503f01aa09" target="blank" title="git_extract_argv0_path(): Move check for valid argv0 from caller to callee

This simplifies the calling code.

Signed-off-by: Steffen Prohaska &lt;prohaska@zib.de&gt;
Acked-by: Johannes Sixt &lt;j6t@kdbg.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Steffen Prohaska">!cmd</a><a data-author="Steve Haslam" data-commit="4dd47c3b867f51211d0dc4474dab0fee5ca614da" data-file="git.c" href="https://github.com/git/git/commit/4dd47c3b867f51211d0dc4474dab0fee5ca614da" target="blank" title="Refactor git_set_argv0_path() to git_extract_argv0_path()

This commit moves the code that computes the dirname of argv[0]
from git.c's main() to git_set_argv0_path() and renames the function
to git_extract_argv0_path().  This makes the code in git.c's main
less cluttered, and we can use the dirname computation from other
main() functions too.

[ spr:
 - split Steve's original commit and wrote new commit message.
 - Integrated Johannes Schindelin's
   cca1704897e7fdb182f68d4c48a437c5d7bc5203 while rebasing onto master.
]

Signed-off-by: Steve Haslam &lt;shaslam@lastminute.com&gt;
Signed-off-by: Stef
 - Steve Haslam">)
		cmd =</a><a data-author="Dmitry V. Levin" data-commit="5b6df8e45f31c7eb26c30536448cffe1b715e1ce" data-file="git.c" href="https://github.com/git/git/commit/5b6df8e45f31c7eb26c30536448cffe1b715e1ce" target="blank" title="Handle invalid argc gently

describe, git: Handle argc==0 case the same way as argc==1.
merge-tree: Refuse excessive arguments.

Signed-off-by: Dmitry V. Levin &lt;ldv@altlinux.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Dmitry V. Levin"> "git-help"</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	else {</a><a data-author="Jeff King" data-commit="6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" data-file="git.c" href="https://github.com/git/git/commit/6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" target="blank" title="common-main: stop munging argv[0] path

Since 650c44925 (common-main: call git_extract_argv0_path(),
2016-07-01), the argv[0] that is seen in cmd_main() of
individual programs is always the basename of the
executable, as common-main strips off the full path. This
can produce confusing results for git-daemon, which wants to
re-exec itself.

For instance, if the program was originally run as
"/usr/lib/git/git-daemon", it will try just re-execing
"git-daemon", which will find the first instance in $PATH.
If git's exec-path has not been prepended to $PATH, we may
find the git-daemon from a differe
 - Jeff King">
		const char *slash = find</a><a data-author="Junio C Hamano" data-commit="95c2b13a5fc06db6556def93843653e948e71e4b" data-file="git.c" href="https://github.com/git/git/commit/95c2b13a5fc06db6556def93843653e948e71e4b" target="blank" title="Merge branch 'jk/common-main'

Fix for a small regression in a topic already in 'master'.

* jk/common-main:
  common-main: stop munging argv[0] path

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" data-file="git.c" href="https://github.com/git/git/commit/6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" target="blank" title="common-main: stop munging argv[0] path

Since 650c44925 (common-main: call git_extract_argv0_path(),
2016-07-01), the argv[0] that is seen in cmd_main() of
individual programs is always the basename of the
executable, as common-main strips off the full path. This
can produce confusing results for git-daemon, which wants to
re-exec itself.

For instance, if the program was originally run as
"/usr/lib/git/git-daemon", it will try just re-execing
"git-daemon", which will find the first instance in $PATH.
If git's exec-path has not been prepended to $PATH, we may
find the git-daemon from a differe
 - Jeff King">last</a><a data-author="Junio C Hamano" data-commit="95c2b13a5fc06db6556def93843653e948e71e4b" data-file="git.c" href="https://github.com/git/git/commit/95c2b13a5fc06db6556def93843653e948e71e4b" target="blank" title="Merge branch 'jk/common-main'

Fix for a small regression in a topic already in 'master'.

* jk/common-main:
  common-main: stop munging argv[0] path

 - Junio C Hamano">_</a><a data-author="Jeff King" data-commit="6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" data-file="git.c" href="https://github.com/git/git/commit/6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" target="blank" title="common-main: stop munging argv[0] path

Since 650c44925 (common-main: call git_extract_argv0_path(),
2016-07-01), the argv[0] that is seen in cmd_main() of
individual programs is always the basename of the
executable, as common-main strips off the full path. This
can produce confusing results for git-daemon, which wants to
re-exec itself.

For instance, if the program was originally run as
"/usr/lib/git/git-daemon", it will try just re-execing
"git-daemon", which will find the first instance in $PATH.
If git's exec-path has not been prepended to $PATH, we may
find the git-daemon from a differe
 - Jeff King">dir_sep</a><a data-author="Junio C Hamano" data-commit="95c2b13a5fc06db6556def93843653e948e71e4b" data-file="git.c" href="https://github.com/git/git/commit/95c2b13a5fc06db6556def93843653e948e71e4b" target="blank" title="Merge branch 'jk/common-main'

Fix for a small regression in a topic already in 'master'.

* jk/common-main:
  common-main: stop munging argv[0] path

 - Junio C Hamano">(cmd);
		if (</a><a data-author="Jeff King" data-commit="6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" data-file="git.c" href="https://github.com/git/git/commit/6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" target="blank" title="common-main: stop munging argv[0] path

Since 650c44925 (common-main: call git_extract_argv0_path(),
2016-07-01), the argv[0] that is seen in cmd_main() of
individual programs is always the basename of the
executable, as common-main strips off the full path. This
can produce confusing results for git-daemon, which wants to
re-exec itself.

For instance, if the program was originally run as
"/usr/lib/git/git-daemon", it will try just re-execing
"git-daemon", which will find the first instance in $PATH.
If git's exec-path has not been prepended to $PATH, we may
find the git-daemon from a differe
 - Jeff King">slash</a><a data-author="Junio C Hamano" data-commit="95c2b13a5fc06db6556def93843653e948e71e4b" data-file="git.c" href="https://github.com/git/git/commit/95c2b13a5fc06db6556def93843653e948e71e4b" target="blank" title="Merge branch 'jk/common-main'

Fix for a small regression in a topic already in 'master'.

* jk/common-main:
  common-main: stop munging argv[0] path

 - Junio C Hamano">)</a><a data-author="Jeff King" data-commit="6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" data-file="git.c" href="https://github.com/git/git/commit/6854a8f5c9ecf32f5bd85020e77d48d3ffdf48fc" target="blank" title="common-main: stop munging argv[0] path

Since 650c44925 (common-main: call git_extract_argv0_path(),
2016-07-01), the argv[0] that is seen in cmd_main() of
individual programs is always the basename of the
executable, as common-main strips off the full path. This
can produce confusing results for git-daemon, which wants to
re-exec itself.

For instance, if the program was originally run as
"/usr/lib/git/git-daemon", it will try just re-execing
"git-daemon", which will find the first instance in $PATH.
If git's exec-path has not been prepended to $PATH, we may
find the git-daemon from a differe
 - Jeff King">
			cmd = slash + 1</a><a data-author="Junio C Hamano" data-commit="95c2b13a5fc06db6556def93843653e948e71e4b" data-file="git.c" href="https://github.com/git/git/commit/95c2b13a5fc06db6556def93843653e948e71e4b" target="blank" title="Merge branch 'jk/common-main'

Fix for a small regression in a topic already in 'master'.

* jk/common-main:
  common-main: stop munging argv[0] path

 - Junio C Hamano">;</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
	}</a><a data-author="Junio C Hamano" data-commit="9f2de9c121c60cba9e55db5263a7bceffcd8fe2d" data-file="git.c" href="https://github.com/git/git/commit/9f2de9c121c60cba9e55db5263a7bceffcd8fe2d" target="blank" title="Merge branch 'kb/perf-trace'

* kb/perf-trace:
  api-trace.txt: add trace API documentation
  progress: simplify performance measurement by using getnanotime()
  wt-status: simplify performance measurement by using getnanotime()
  git: add performance tracing for git's main() function to debug scripts
  trace: add trace_performance facility to debug performance issues
  trace: add high resolution timer function to debug performance issues
  trace: add 'file:line' to all trace output
  trace: move code around, in preparation to file:line output
  trace: add current timestamp to all trace output
 - Junio C Hamano">

	trace_command_performance(argv)</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

	/*
	 * "git-xxxx" is the same as "git xxxx", but we obviously:
	 *
	 *  - cannot take flags in between the "git" and the "xxxx".
	 *  - cannot execute it externally (since it would just do
	 *    the same thing over again)
	 *
	 * So we just directly call the</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth"> builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> handler, and die if</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">
	 *</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> that one cannot handle it.
	 */
	if (</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">prefix</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">(cmd, "git-"</a><a data-author="Junio C Hamano" data-commit="e91ae32a01ffe294b8510c1d8cd7138493a0712f" data-file="git.c" href="https://github.com/git/git/commit/e91ae32a01ffe294b8510c1d8cd7138493a0712f" target="blank" title="Merge branch 'jk/skip-prefix'

* jk/skip-prefix:
  http-push: refactor parsing of remote object names
  imap-send: use skip_prefix instead of using magic numbers
  use skip_prefix to avoid repeated calculations
  git: avoid magic number with skip_prefix
  fetch-pack: refactor parsing in get_ack
  fast-import: refactor parsing of spaces
  stat_opt: check extra strlen call
  daemon: use skip_prefix to avoid magic numbers
  fast-import: use skip_prefix for parsing input
  use skip_prefix to avoid repeating strings
  use skip_prefix to avoid magic numbers
  transport-helper: avoid reading past end
 - Junio C Hamano">, &amp;cmd</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">)) {
		argv[0] = cmd;
		handle_</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth">builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">(argc, argv);
		die</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">("cannot handle %s</a><a data-author="Sebastian Schuberth" data-commit="3f784a4dcbe270a1f48b23177917a1832a777d1c" data-file="git.c" href="https://github.com/git/git/commit/3f784a4dcbe270a1f48b23177917a1832a777d1c" target="blank" title="git.c: consistently use the term "builtin" instead of "internal command"

Signed-off-by: Sebastian Schuberth &lt;sschuberth@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Sebastian Schuberth"> as a builtin</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">, cmd);</a><a data-author="Junio C Hamano" data-commit="7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" data-file="git.c" href="https://github.com/git/git/commit/7dbc2c0402d728a206d4f1bc59729bf3a5cc4455" target="blank" title="git wrapper: basic fixes.

Updates to fix the nits found during the list discussion.

 - Lose PATH_TO_MAN; just rely on execlp() to find whereever the
   "man" command is installed.

 - Do not randomly chdir(), but concatenate to the current
   working directory only if the given path is not absolute.

 - Lose use of glob(); read from exec_path and do sorting
   ourselves -- it is not that much more work.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">
	}</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

	/* Look for flags.. */</a><a data-author="Junio C Hamano" data-commit="7ae0b0cb65f069b657155abcb6aa6780b93ce881" data-file="git.c" href="https://github.com/git/git/commit/7ae0b0cb65f069b657155abcb6aa6780b93ce881" target="blank" title="git-log (internal): more options.

This ports the following options from rev-list based git-log
implementation:

 * -&lt;n&gt;, -n&lt;n&gt;, and -n &lt;n&gt;.  I am still wondering if we want
    this natively supported by setup_revisions(), which already
    takes --max-count.  We may want to move them in the next
    round.  Also I am not sure if we can get away with not
    setting revs-&gt;limited when we set max-count.  The latest
    rev-list.c and revision.c in this series do not, so I left
    them as they are.

 * --pretty and --pretty=&lt;fmt&gt;.

 * --abbrev=&lt;n&gt; and --no-abbrev.

The previous commit already 
 - Junio C Hamano">
	argv++;</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	argc--;</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	handle_options(&amp;argv, &amp;argc</a><a data-author="Matthias Lederhofer" data-commit="4394efecfa9f94ad14fe49bc9f499c5806aa83af" data-file="git.c" href="https://github.com/git/git/commit/4394efecfa9f94ad14fe49bc9f499c5806aa83af" target="blank" title="make git barf when an alias changes environment variables

Aliases changing environment variables (GIT_DIR or
GIT_WORK_TREE) can cause problems:
git has to use GIT_DIR to read the aliases from the config.
After running handle_options for the alias the options of the
alias may have changed environment variables.  Depending on
the implementation of setenv the memory location obtained
through getenv earlier may contain the old value or the new
value (or even be used for something else?).  To avoid these
problems git errors out if an alias uses any option which
changes environment variables.

Sign
 - Matthias Lederhofer">, NULL</a><a data-author="Johannes Schindelin" data-commit="4ab243a944a6013d9e862adadd6fe6152c842401" data-file="git.c" href="https://github.com/git/git/commit/4ab243a944a6013d9e862adadd6fe6152c842401" target="blank" title="Allow an alias to start with "-p"

Now, something like

	[alias]
		pd = -p diff

works as expected.

[jc: a follow-up fix from Jeff King folded in.]

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">)</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	if</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> (argc &gt;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin"> 0</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">) {</a><a data-author="Jeff King" data-commit="6d87780399e1196932cd5ea72f84aa90224e7402" data-file="git.c" href="https://github.com/git/git/commit/6d87780399e1196932cd5ea72f84aa90224e7402" target="blank" title="git: avoid magic number with skip_prefix

After handling options, any leftover arguments should be
commands. However, we pass through "--help" and "--version",
so that we convert them into "git help" and "git version"
respectively.

This is a straightforward use of skip_prefix to avoid a
magic number, but while we are there, it is worth adding a
comment to explain this otherwise confusing behavior.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">
		/* translate --help and --version into commands */
		skip</a><a data-author="Christian Couder" data-commit="59556548230e617b837343c2c07e357e688e2ca4" data-file="git.c" href="https://github.com/git/git/commit/59556548230e617b837343c2c07e357e688e2ca4" target="blank" title="replace {pre,suf}fixcmp() with {starts,ends}_with()

Leaving only the function definitions and declarations so that any
new topic in flight can still make use of the old functions, replace
existing uses of the prefixcmp() and suffixcmp() with new API
functions.

The change can be recreated by mechanically applying this:

    $ git grep -l -e prefixcmp -e suffixcmp -- \*.c |
      grep -v strbuf\\.c |
      xargs perl -pi -e '
        s|!prefixcmp\(|starts_with\(|g;
        s|prefixcmp\(|!starts_with\(|g;
        s|!suffixcmp\(|ends_with\(|g;
        s|suffixcmp\(|!ends_with\(|g;
      '

on th
 - Christian Couder">_</a><a data-author="Jeff King" data-commit="6d87780399e1196932cd5ea72f84aa90224e7402" data-file="git.c" href="https://github.com/git/git/commit/6d87780399e1196932cd5ea72f84aa90224e7402" target="blank" title="git: avoid magic number with skip_prefix

After handling options, any leftover arguments should be
commands. However, we pass through "--help" and "--version",
so that we convert them into "git help" and "git version"
respectively.

This is a straightforward use of skip_prefix to avoid a
magic number, but while we are there, it is worth adding a
comment to explain this otherwise confusing behavior.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">prefix</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">(</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">argv[0]</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">, "--"</a><a data-author="Jeff King" data-commit="6d87780399e1196932cd5ea72f84aa90224e7402" data-file="git.c" href="https://github.com/git/git/commit/6d87780399e1196932cd5ea72f84aa90224e7402" target="blank" title="git: avoid magic number with skip_prefix

After handling options, any leftover arguments should be
commands. However, we pass through "--help" and "--version",
so that we convert them into "git help" and "git version"
respectively.

This is a straightforward use of skip_prefix to avoid a
magic number, but while we are there, it is worth adding a
comment to explain this otherwise confusing behavior.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">, &amp;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">argv[0]</a><a data-author="Jeff King" data-commit="6d87780399e1196932cd5ea72f84aa90224e7402" data-file="git.c" href="https://github.com/git/git/commit/6d87780399e1196932cd5ea72f84aa90224e7402" target="blank" title="git: avoid magic number with skip_prefix

After handling options, any leftover arguments should be
commands. However, we pass through "--help" and "--version",
so that we convert them into "git help" and "git version"
respectively.

This is a straightforward use of skip_prefix to avoid a
magic number, but while we are there, it is worth adding a
comment to explain this otherwise confusing behavior.

Signed-off-by: Jeff King &lt;peff@peff.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Jeff King">)</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">;</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	} else {</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
		/*</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> The user didn't specify a</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> command</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">; give them</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> help */</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">
		commit_pager_choice</a><a data-author="Junio C Hamano" data-commit="9590b041ea464c46d5a6811df5bce83c5dd4d457" data-file="git.c" href="https://github.com/git/git/commit/9590b041ea464c46d5a6811df5bce83c5dd4d457" target="blank" title="Builtins: control the use of pager from the command table.

This moves the built-in "always-use-pager" logic for log family
to the command dispatch table of git wrapper.  This makes it
easier to change the default use of pager, and has an added
benefit that we fork and exec the pager early before packs are
mmapped.

Pointed out by Juergen Ruehle &lt;j.ruehle@bmiag.de&gt;.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Junio C Hamano">();</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">
		printf</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">(_</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">(</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">"</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">usage: %s\n\n</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">"</a><a data-author="Nguyễn Thái Ngọc Duy" data-commit="8aa8c1409774ba4fd718bfa9f7f667170aa3089b" data-file="git.c" href="https://github.com/git/git/commit/8aa8c1409774ba4fd718bfa9f7f667170aa3089b" target="blank" title="git.c: mark more strings for translation

One string is slightly updated to keep consistency with the rest:
die() should begin with lowercase.

Signed-off-by: Nguyễn Thái Ngọc Duy &lt;pclouds@gmail.com&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Nguyễn Thái Ngọc Duy">)</a><a data-author="Scott R Parish" data-commit="3d7e2d857a570b1d6368285f95b67994fc95629e" data-file="git.c" href="https://github.com/git/git/commit/3d7e2d857a570b1d6368285f95b67994fc95629e" target="blank" title=""git" returns 1; "git help" and "git help -a" return 0

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">, git_usage_string)</a><a data-author="Jeff King" data-commit="4e10738a9392ad285aca7d3a19e6775d6b7b513e" data-file="git.c" href="https://github.com/git/git/commit/4e10738a9392ad285aca7d3a19e6775d6b7b513e" target="blank" title="Allow per-command pager config

There is great debate over whether some commands should set
up a pager automatically. This patch allows individuals to
set their own pager preferences for each command, overriding
the default. For example, to disable the pager for git
status:

  git config pager.status false

If "--pager" or "--no-pager" is specified on the command
line, it takes precedence over the config option.

There are two caveats:

  - you can turn on the pager for plumbing commands.
    Combined with "core.pager = always", this will probably
    break a lot of things. Don't do it.

  - T
 - Jeff King">;</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">
		list_common_cmds</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">_</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">help</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">(</a><a data-author="Fredrik Kuivinen" data-commit="a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" data-file="git.c" href="https://github.com/git/git/commit/a87cd02ce02e97083eb76eb8b9bfeb2e46800fd7" target="blank" title="Nicer output from 'git'

[jc: with suggestions by Jan-Benedict Glaw]

Signed-off-by: Fredrik Kuivinen &lt;freku045@student.liu.se&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Fredrik Kuivinen">);</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">
		printf("\n%s\n",</a><a data-author="Kevin Bracey" data-commit="421a97694590c2be58f3ccebf301c7239289aa00" data-file="git.c" href="https://github.com/git/git/commit/421a97694590c2be58f3ccebf301c7239289aa00" target="blank" title="Translate git_more_info_string consistently

"git help" translated the "See 'git help &lt;command&gt;' for more
information..." message, but "git" didn't.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey"> _(</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">git_more_info_string)</a><a data-author="Kevin Bracey" data-commit="421a97694590c2be58f3ccebf301c7239289aa00" data-file="git.c" href="https://github.com/git/git/commit/421a97694590c2be58f3ccebf301c7239289aa00" target="blank" title="Translate git_more_info_string consistently

"git help" translated the "See 'git help &lt;command&gt;' for more
information..." message, but "git" didn't.

Signed-off-by: Kevin Bracey &lt;kevin@bracey.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Kevin Bracey">)</a><a data-author="Teemu Likonen" data-commit="b7d9681974e61959f10c7b2c1063b7781c5b904e" data-file="git.c" href="https://github.com/git/git/commit/b7d9681974e61959f10c7b2c1063b7781c5b904e" target="blank" title="Print info about "git help COMMAND" on git's main usage pages

Git's main usage pages did not show "git help" as a way to get more
information on a specific subcommand. This patch adds an info line after
the list of git commands currently printed by "git", "git help", "git
--help" and "git help --all".

Signed-off-by: Teemu Likonen &lt;tlikonen@iki.fi&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Teemu Likonen">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
		exit(1);</a><a data-author="Linus Torvalds" data-commit="70b006b9712b57741ec1320b15aef2f8b1d6a905" data-file="git.c" href="https://github.com/git/git/commit/70b006b9712b57741ec1320b15aef2f8b1d6a905" target="blank" title="Tie it all together: "git log"

This is what the previous diffs all built up to.

We can do "git log" as a trivial small helper function inside git.c,
because the infrastructure is all there for us to use as a library.

Signed-off-by: Linus Torvalds &lt;torvalds@osdl.org&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Linus Torvalds">
	}</a><a data-author="Johannes Schindelin" data-commit="6acbcb927f8e34857fa8f68fcb4f9076941b24ff" data-file="git.c" href="https://github.com/git/git/commit/6acbcb927f8e34857fa8f68fcb4f9076941b24ff" target="blank" title="git wrapper: add --git-dir=&lt;path&gt; and --bare options

With this, you can say

	git --bare repack -a -d

inside a bare repository, and it will actually work. While at it,
also move the --version, --help and --exec-path options to the
handle_options() function.

While at documenting the new options, also document the --paginate
option.

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">
	cmd = argv[0];</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">

	/</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">*</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	 * We</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> use PATH to find</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> git</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> commands</a><a data-author="Carlos Rica" data-commit="2ae68fcb785a617793813abcea19893e13e436b0" data-file="git.c" href="https://github.com/git/git/commit/2ae68fcb785a617793813abcea19893e13e436b0" target="blank" title="Make verify-tag a builtin.

This replaces "git-verify-tag.sh" with "builtin-verify-tag.c".

Testing relies on the "git tag -v" tests calling this command.

A temporary file is needed when calling to gpg, because git is
already creating detached signatures (gpg option -b) to sign tags
(instead of leaving gpg to add the signature to the file by itself),
and those signatures need to be supplied in a separate file to be
verified by gpg.

The program uses git_mkstemp to create that temporary file needed by
gpg, instead of the previously used "$GIT_DIR/.tmp-vtag", in order to
allow the command to be
 - Carlos Rica">,</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> but we prepend some higher</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	 *</a><a data-author="Mike Ralphson" data-commit="3ea3c215c02dc4a4e7d0881c25b2223540960797" data-file="git.c" href="https://github.com/git/git/commit/3ea3c215c02dc4a4e7d0881c25b2223540960797" target="blank" title="Fix typos / spelling in comments

Signed-off-by: Mike Ralphson &lt;mike@abacus.co.uk&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Mike Ralphson"> precedence</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> paths: the</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> "</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">-</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">-exec-path" option,</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> the</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds"> GIT_EXEC_PATH</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">
	 * environment, and</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> the</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> $</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">(</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">gitexecdir</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">)</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> from the</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano"> Makefile</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> at build</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	 *</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish"> time</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">.</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">
	 */</a><a data-author="Scott R Parish" data-commit="511707d42b3b3e57d9623493092590546ffeae80" data-file="git.c" href="https://github.com/git/git/commit/511707d42b3b3e57d9623493092590546ffeae80" target="blank" title="use only the $PATH for exec'ing git commands

We need to correctly set up $PATH for non-c based git commands.
Since we already do this, we can just use that $PATH and execvp,
instead of looping over the paths with execve.

This patch adds a setup_path() function to exec_cmd.c, which sets
the $PATH order correctly for our search order. execv_git_cmd() is
stripped down to setting up argv and calling execvp(). git.c's
main() only only needs to call setup_path().

Signed-off-by: Scott R Parish &lt;srp@srparish.net&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Scott R Parish">
	setup</a><a data-author="Junio C Hamano" data-commit="cf32190aa6966dea519e77cdcc80b87026beb3b4" data-file="git.c" href="https://github.com/git/git/commit/cf32190aa6966dea519e77cdcc80b87026beb3b4" target="blank" title="git.c: execution path

The comment before executing git subcommands were stale and confusing.
Noticed by Jeff King.

Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Junio C Hamano">_path</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">()</a><a data-author="Michal Ostrowski" data-commit="77cb17e940c806a4cc811bfd66187277b729a1e7" data-file="git.c" href="https://github.com/git/git/commit/77cb17e940c806a4cc811bfd66187277b729a1e7" target="blank" title="Exec git programs without using PATH.

The git suite may not be in PATH (and thus programs such as
git-send-pack could not exec git-rev-list).  Thus there is a need for
logic that will locate these programs.  Modifying PATH is not
desirable as it result in behavior differing from the user's
intentions, as we may end up prepending "/usr/bin" to PATH.

- git C programs will use exec*_git_cmd() APIs to exec sub-commands.
- exec*_git_cmd() will execute a git program by searching for it in
  the following directories:
	1. --exec-path (as used by "git")
	2. The GIT_EXEC_PATH environment variable.
	3
 - Michal Ostrowski">;</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">

	while (1) {
		int was_alias = run_argv(</a><a data-author="Johannes Schindelin" data-commit="2b11e3170e919866c7f5554dd4089289a1bb6726" data-file="git.c" href="https://github.com/git/git/commit/2b11e3170e919866c7f5554dd4089289a1bb6726" target="blank" title="If you have a config containing something like this:

	[alias]
		l = "log --stat -M ORIG_HEAD.."

you can call

	git l

and it will do the same as

	git log --stat -M ORIG_HEAD..

Signed-off-by: Johannes Schindelin &lt;Johannes.Schindelin@gmx.de&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Johannes Schindelin">&amp;argc, &amp;argv)</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
		if (</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">errno</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó"> !</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">= ENOENT</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">)
			break;
		if (was_alias</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">)</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o"> {
			fprintf(stderr,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">"expansion of alias '%s' failed; "
					  "'%s' is not a git command\n"</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">,
				cmd, argv[0]);</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
			exit(1);
		}</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">
		if (</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">!</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">done_</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">help</a><a data-author="Theodore Ts'o" data-commit="f3dd015c9147e3116fc1941d96f4dad38386b1db" data-file="git.c" href="https://github.com/git/git/commit/f3dd015c9147e3116fc1941d96f4dad38386b1db" target="blank" title="Print a sane error message if an alias expands to an invalid git command

Signed-off-by: "Theodore Ts'o" &lt;tytso@mit.edu&gt;
Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Theodore Ts'o">) {</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">
			cmd =</a><a data-author="Shawn O. Pearce" data-commit="c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" data-file="git.c" href="https://github.com/git/git/commit/c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" target="blank" title="Merge branch 'maint'

* maint:
  Update release notes for 1.6.0.3
  checkout: Do not show local changes when in quiet mode
  for-each-ref: Fix --format=%(subject) for log message without newlines
  git-stash.sh: don't default to refs/stash if invalid ref supplied
  maint: check return of split_cmdline to avoid bad config strings

 - Shawn O. Pearce"> argv[0] =</a><a data-author="Ramsay Allan Jones" data-commit="822a7d507151e1d6310f52d5b05234d65db11a88" data-file="git.c" href="https://github.com/git/git/commit/822a7d507151e1d6310f52d5b05234d65db11a88" target="blank" title="Remove cmd_usage() routine and re-organize the help/usage code.

The cmd_usage() routine was causing warning messages due to a NULL
format parameter being passed in three out of four calls. This is a
problem if you want to compile with -Werror. A simple solution is to
simply remove the GNU __attribute__ format pragma from the cmd_usage()
declaration in the header file. The function interface was somewhat
muddled anyway, so re-write the code to finesse the problem.

[jc: this incidentally revealed that t9100 test assumed that the output
 from "git help" to be fixed in stone, but this patch lowe
 - Ramsay Allan Jones"> help_unknown_cmd(</a><a data-author="Linus Torvalds" data-commit="231af8322ac5313243bc1e8beac8dfd9ff95051d" data-file="git.c" href="https://github.com/git/git/commit/231af8322ac5313243bc1e8beac8dfd9ff95051d" target="blank" title="Teach the "git" command to handle some commands internally

This is another patch in the "prepare to do more in C" series, where the
git wrapper command is taught about the notion of handling some
functionality internally.

Right now, the only internal commands are "version" and "help", but the
point being that we can now easily extend it to handle some of the trivial
scripts internally. Things like "git log" and "git diff" wouldn't need
separate external scripts any more.

This also implies that to support the old "git-log" and "git-diff" syntax,
the "git" wrapper now automatically looks at t
 - Linus Torvalds">cmd</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">);</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">
			done</a><a data-author="Shawn O. Pearce" data-commit="c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" data-file="git.c" href="https://github.com/git/git/commit/c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" target="blank" title="Merge branch 'maint'

* maint:
  Update release notes for 1.6.0.3
  checkout: Do not show local changes when in quiet mode
  for-each-ref: Fix --format=%(subject) for log message without newlines
  git-stash.sh: don't default to refs/stash if invalid ref supplied
  maint: check return of split_cmdline to avoid bad config strings

 - Shawn O. Pearce">_</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">help = 1</a><a data-author="Shawn O. Pearce" data-commit="c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" data-file="git.c" href="https://github.com/git/git/commit/c9c6cc8d7db312b9e8502f8d55422b8309cde2f3" target="blank" title="Merge branch 'maint'

* maint:
  Update release notes for 1.6.0.3
  checkout: Do not show local changes when in quiet mode
  for-each-ref: Fix --format=%(subject) for log message without newlines
  git-stash.sh: don't default to refs/stash if invalid ref supplied
  maint: check return of split_cmdline to avoid bad config strings

 - Shawn O. Pearce">;</a><a data-author="Adeodato Simó" data-commit="a907e1b6ec3038306df68dc1275edad7457bba4b" data-file="git.c" href="https://github.com/git/git/commit/a907e1b6ec3038306df68dc1275edad7457bba4b" target="blank" title="git.c: make autocorrected aliases work

help_unknown_cmd() is able to autocorrect a command to an alias, and not
only to internal or external commands. However, main() was not passing the
autocorrected command through handle_alias(), hence it failed if it was an
alias.

This commit makes the autocorrected command go through handle_alias(), once
handle_internal_command() and execv_dashed_external() have been tried. Since
this is done twice in main() now, moved that logic to a new run_argv()
function.

Also, print the same "Expansion of alias 'x' failed" message when the alias
was autocorrected,
 - Adeodato Simó">
		} else
			break</a><a data-author="Johannes Schindelin" data-commit="8af84dadb142f7321ff0ce8690385e99da8ede2f" data-file="git.c" href="https://github.com/git/git/commit/8af84dadb142f7321ff0ce8690385e99da8ede2f" target="blank" title="git wrapper: DWIM mistyped commands

This patch introduces a modified Damerau-Levenshtein algorithm into
Git's code base, and uses it with the following penalties to show some
similar commands when an unknown command was encountered:

	swap = 0, insertion = 1, substitution = 2, deletion = 4

A typical output would now look like this:

	$ git sm
	git: 'sm' is not a git-command. See 'git --help'.

	Did you mean one of these?
		am
		rm

The cut-off is at similarity rating 6, which was empirically determined
to give sensible results.

As a convenience, if there is only one candidate, Git continues
 - Johannes Schindelin">;</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">
	}</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">

	fprintf</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">(</a><a data-author="Alex Riesen" data-commit="10b15b86f545e081aebba8783ad9e9acf6bf0d98" data-file="git.c" href="https://github.com/git/git/commit/10b15b86f545e081aebba8783ad9e9acf6bf0d98" target="blank" title="git wrapper: more careful argument stuffing

 - Use stderr for error output
 - Build git_command more careful
 - ENOENT is good enough for check of failed exec to show usage, no
   access() check needed

[jc: Originally from Alex Riesen with inputs from Sven
 Verdoolaege mixed in.]

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Alex Riesen">stderr</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">,</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov"> _(</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">"failed to run command '%s': %s\n"</a><a data-author="Alexander Shopov" data-commit="fc045fe7d4fa220f19274715c936636fe0516ea3" data-file="git.c" href="https://github.com/git/git/commit/fc045fe7d4fa220f19274715c936636fe0516ea3" target="blank" title="Mark messages for translations

Small changes in messages to fit the style and typography of rest.
Reuse already translated messages if possible.
Do not translate messages aimed at developers of git.
Fix unit tests depending on the original string.
Use `test_i18ngrep` for tests with translatable strings.
Change and verify rest of tests via `make GETTEXT_POISON=1 test`.

Signed-off-by: Alexander Shopov &lt;ash@kambanaria.org&gt;
Signed-off-by: Junio C Hamano &lt;gitster@pobox.com&gt;

 - Alexander Shopov">)</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">,</a><a data-author="Andreas Ericsson" data-commit="33ebb8717f15a85615f712df125c37737062e1b2" data-file="git.c" href="https://github.com/git/git/commit/33ebb8717f15a85615f712df125c37737062e1b2" target="blank" title="git wrapper: fix command name in an error message.

When the command execution by execv_git_cmd() fails with an errno
other than ENOENT, we used an uninitialized variable instead of
the string that holds the command name to report what failed.

Signed-off-by: Junio C Hamano &lt;junkio@cox.net&gt;

 - Andreas Ericsson">
		cmd</a><a data-author="Andreas Ericsson" data-commit="8e49d50388211a0f3e7286f6ee600bf7736f4814" data-file="git.c" href="https://github.com/git/git/commit/8e49d50388211a0f3e7286f6ee600bf7736f4814" target="blank" title="C implementation of the 'git' program, take two.

This patch provides a C implementation of the 'git' program and
introduces support for putting the git-* commands in a directory
of their own. It also saves some time on executing those commands
in a tight loop and it prints the currently available git commands
in a nicely formatted list.

The location of the GIT_EXEC_PATH (name discussion's closed, thank gods)
can be obtained by running

	git --exec-path

which will hopefully give porcelainistas ample time to adapt their
heavy-duty loops to call the core programs directly and thus save
the ext
 - Andreas Ericsson">, strerror(errno));

	return 1;
}</a></pre><script>
                    var select_by = "commit";
                    document.querySelectorAll('pre > a').forEach(a => {
                        a.onmouseenter = () => {
                          document.querySelectorAll('pre > a').forEach(x => x.className = '');
                          document.querySelectorAll('a[data-' + select_by + '="' + a.attributes['data-' + select_by].value + '"]').forEach(x => x.className = "hovered");
                        };
                    });
                </script></body>