<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>MT10</title>
  
  <script type="text/javascript" src="http://code.jquery.com/jquery-git2.js"></script>
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css">
  <style type="text/css">
  </style>

<script type="text/javascript">//<![CDATA[ 

function smoofitude(x){
    return Math.max.apply(Math,primeFactorList(x));
}
function supersmoofitude(x){
    var arr = toFactorPowerList(primeFactorList(x))
    var max = 0;
    for(var i = 0;i < arr.length;i++){
        max = Math.max(max,Math.pow(arr[i][0],arr[i][1]));
    }
    return max;
}

function simple_smooth_calcul() {
    var x = parseInt($("#smooth .x").val());
    var s = x + "=" + primeFactorList(x).join("*")+"<br/>";
    $("#smooth .result").html(s+x+" est "+smoofitude(x)+"-smooth et "+supersmoofitude(x)+"-supersmooth");
}
function smoothtable(maxx){
	var res = {}
    for(var i = 2;i <= maxx;i++){
        var r = smoofitude(i);
        if( res[r] == undefined){
			res[r] = [i];
		}else{
			res[r].push(i);
		}
    }
    return res;
}
function supersmoothtable(maxx){
	var res = {}
    for(var i = 2;i <= maxx;i++){
        var r = supersmoofitude(i);
        if( res[r] == undefined){
			res[r] = [i];
		}else{
			res[r].push(i);
		}
    }
    return res;
}

function generate_smooth_table() {
    var maxx = parseInt($("#smooth-table .x").val());
    var maxB = parseInt($("#smooth-table .B").val());
    var sm = smoothtable(maxx);
    var ssm = supersmoothtable(maxx);
    $("#smooth-table tbody").html("");
    if(maxB == undefined){
    	return;
    }
    for(var i = 2;i <= maxB;i++){
		var r = i == 2 ? "": "Id";
		if (sm[i] != undefined){
			r += i == 2 ? "": " + ";
			r += sm[i];
		}
		var r2 = i == 2 ? "": "Id";
		if (ssm[i] != undefined){
			r2 += i == 2 ? "": " + ";
			r2 += ssm[i];
		}
        $("#smooth-table tbody").append($("<tr><th>"+i+"</th><th>"+r+"</th><th>"+r2+"</th></tr>"));
    }
}

function primeFactorList(n) {
	if (n < 1)
		throw "Argument error";
	
	var result = [];
	while (n != 1) {
		var factor = smallestFactor(n);
		result.push(factor);
		n /= factor;
	}
	return result;
}

function smallestFactor(n) {
	if (n < 2)
		throw "Argument error";
	
	if (n % 2 == 0)
		return 2;
	var end = Math.floor(Math.sqrt(n));
	for (var i = 3; i <= end; i += 2) {
		if (n % i == 0)
			return i;
	}
	return n;
}

function toFactorPowerList(factors) {
	var result = [];
	var factor = factors[0];
	var count = 1;
	for (var i = 1; i < factors.length; i++) {
		if (factors[i] == factor) {
			count++;
		} else {
			result.push([factor, count]);
			factor = factors[i];
			count = 1;
		}
	}
	result.push([factor, count]);
	return result;
}

function goRabin(){
	var p = parseInt($("#rabin .p").val());
	var a = parseInt($("#rabin .a").val());
	if(a == undefined || p == undefined){
    	return;
    }
    $("#rabin .result").html(rabinMiller(p,a))
}

function rapidExpo(a,p,n){ //a^p mod n
	var prod = 1;
	while(p > 0){
		prod = (prod*a) % n;
		p -= 1;
	}
	return prod;
}

function rabinMiller(p,a){
	var b = 0;
	var a2 = a;
	while(a2 % 2 != 0){
		a2 /= 2;
		b += 1;
	}
	var m = (p-1)/Math.pow(2,b);
	z = rapidExpo(a,m,p);
	if(z == 1 || z == p-1){
		return "Probablement premier";
	}
	for(var j = 1;j < b;j++){
		z = (z*z) % p;
		if(z = p-1){
			return "Probablement premier";
		}
		if(z = 1){
			return "Non premier";
		}
	}
	return "Non premier";
}

function goPollard(){
	$("#pollard .result").html("");
	var N = parseInt($("#pollard .N").val());
	var a = parseInt($("#pollard .a").val());
	if( a == undefined || N == undefined){
    	return;
    }
    $("#pollard .result").html(pollard(N,a));
}

function pollard(N,a){
	for(var B = 2;B < N-1;B++){
		D = gcd(a,N);
		if(D != 1){
			return "D = "+D+" , B = "+B;
		}
		for(var p=2;p < B;p++){
			if(isPrime(p)){
				ep = Math.floor(Math.log(B)/Math.log(p));
				a = rapidExpo(a,Math.pow(p,ep),N);
			}
		}
		if(a-1 == 0) return "Changer a";
		D = gcd(a-1,N);
		if(D != 1){
			return "D = "+D+" , B = "+B;
		}
	}
	return "Echec de la factorisation";
}

function gcd(x, y) {
	while (y != 0) {
		var z = x % y;
		x = y;
		y = z;
	}
	return x;
}

function isPrime(n) {
	if (isNaN(n) || !isFinite(n) || n%1 || n<2) return false; 
	if (n%2==0) return (n==2);
	if (n%3==0) return (n==3);
	var m=Math.sqrt(n);
	for (var i=5;i<=m;i+=6) {
		if (n%i==0)     return false;
		if (n%(i+2)==0) return false;
	}
	return true;
} 

function goCarmichael(){
	$("#carmichael .result").html("");
	var N = parseInt($("#carmichael .N").val());
	if( N == undefined){
    	return;
    }
    $("#carmichael .result").html(carmichael(N).join(", "));
}

function goCarmichaelTest(){
	$("#carmichael-test .result").html("");
	var N = parseInt($("#carmichael-test .N").val());
	if( N == undefined){
    	return;
    }
    $("#carmichael-test .result").html(carmichaelTest(N));
}

function isPrimeFactorListUnique(n) {
	var result = [];
	while (n != 1) {
		var factor = smallestFactor(n);
		if(result.indexOf(factor) != -1){
			return false;
		}
		result.push(factor);
		n /= factor;
	}
	return result;
}

function carmichaelTest(n) {
	if(n%2 == 0){
		return "Nombre pair donc pas de carmichael";
	}
	if(!isPrime(n)){
		factors = isPrimeFactorListUnique(n);
		if(factors != false){
			for(var i=0;i < factors.length;i++){
				if( ((n-1) % (factors[i]-1)) != 0){
					return "Ce n'est pas un nombre de carmichael :"+(n-1)+" % "+(factors[i]-1) +" == " + (n-1 % factors[i]-1 ) + "( != 0)";
				}
			}
			return "C'est un nombre de carmichael";
		}
		return "Le nombre à plusieurs même facteurs premier donc ce n'est pas un nombre de carmichael: facteurs:"+primeFactorList(n);
	}else{
		return "Nombre premier donc pas de carmichael";
	}
}

function carmichaelTestClear(n) {
	if(n%2 == 0){
		return false;
	}
	if(!isPrime(n)){
		factors = isPrimeFactorListUnique(n);
		if(factors != false){
			for(var i=0;i < factors.length;i++){
				if( ((n-1) % (factors[i]-1)) != 0){
					return false;
				}
			}
			return true;
		}
		return false;
	}else{
		return false;
	}
}

function carmichael(maxx) {
	var arr = [];
	for(var n=1;n <= maxx;n += 2){
		if(carmichaelTestClear(n)){
			arr.push(n);
		}
	}
	return arr;
}

function goLogTable() {
	$("#logtable .result table").html("");
	var mx = $("#logtable .mx").val();
    var base = $("#logtable .base").val();
	var N = parseInt($("#logtable .N").val());
	if( N == undefined){
    	return;
    }
    var r = exponentsTable(base.split("").reverse(),mx.split("").reverse(),Math.pow(2,N));
    $("#logtable .result .exponents").html(expTable(r,Math.pow(2,N)));
    $("#logtable .result .log").html(logTable(r,Math.pow(2,N)));
}

function replacearr(arr,a,b){
	return arr.map(function(item) { return item == a ? b : item; });
}

function add_to_pol(pol,coeff,i){ // mod 2
	if(coeff == "0"){
		return;
	}
	//coeff == 1
	if( pol[i] == undefined){
		pol[i] = coeff;
	}else{
		if(pol[i] == "1"){
			pol[i] = "0";
		}else{
			pol[i] = "1";
		}
	}
	return pol;
}

function degree(p){
	return p.lastIndexOf("1"); // p non null
}

function add_pols(p1,p2){//modify p1
	for(var i=0;i < p2.length;i++){
		if(p1[i] == undefined){
			p1[i] = "0";
		}
		if(p2[i] == undefined){
			p2[i] = "0";
		}
		add_to_pol(p1,p2[i],i);
	}
	return p1;
}

function dividePol(p,mx,maxx){ // divide the pol by mx: this is really awesome too
	while (degree(p) >= degree(mx)){
		var mx_dec = mx.slice();
		for(var i=0;i < degree(p)-degree(mx);i++){
			mx_dec = mx_dec.slice(0,0,"0"); //mul pol by x
		}
		p = add_pols(p,mx_dec); //p = p - mx*x^(deg(p)-deg(mx))
	}
}

function pol2num(pol){
	return parseInt(pol.reverse().join(""),2);
}

//The hearth of the log table: the awesome happens here
function mul_pols(p1,p2,mx,do_mod){
	if(typeof(do_mod)==='undefined') do_mod = true;
	var r = replacearr(mx,"1","0");
	for(var i=0;i < p1.length;i++){//for each el of pol1 add pol1[i]*pol2
		for(var j=0;j < p2.length;j++){
			if(p1[i] == undefined){
				p1[i] = "0";
			}
			if(p2[j] == undefined){
				p2[j] = "0";
			}
			//mul p1[i] && p2[j]
			if( p1[i] == "0" && p2[j] == "0" ){
				break;
			}
			if( p1[i] == "1" && p2[j] == "0" ){
				add_to_pol(r,"1",i);
			}
			if( p1[i] == "0" && p2[j] == "1" ){
				add_to_pol(r,"1",j);
			}
			if( p1[i] == "1" && p2[j] == "1" ){
				add_to_pol(r,"1",i+j);
			}
		}
	}

	//refill with 0
	for(var i=0;i < r.length;i++){//for each el of pol1
		if( r[i] == undefined){
			r[i] == "0";
		}
	}

	//TODO div by m(x) && reduce the 0 fill
	if(do_mod){
		dividePol(r,mx);
	}
	return r;
}

function exponentsTable(base,mx,maxx) {
	var arr = [];
	arr.push(["1"]);
	for(var i=1;i < maxx;i++) {
		arr.push(mul_pols(arr[i-1],base,mx));
	}
	return arr;
}

function logTable(arr,maxx) {

	//to a nice table
	var r = "<thead><tr><th></th>";
	for(var i=0;i < maxx;i+=16){
		r += "<th>"+i.toString(16).toUpperCase()+"</th>";
	}
	r += "</tr></thead><tbody>";
	for(var i=0;i < 16;i++){
		r += "<tr><th>"+i.toString(16).toUpperCase()+"</th>";
		for(var j=0;j < maxx;j+=16){
			r += "<th>"+arr[(j+i)%maxx]+"</th>";
		}
		r += "</tr>"
	}
	r += "</tbody>";
	return r;
}

function expTable(arr,maxx) {
	//to hex
	for(var i=0;i < maxx;i++) {
		arr[i] = pol2num(arr[i]).toString(16).toUpperCase();
	}

	//to a nice table
	var r = "<thead><tr><th></th>";
	for(var i=0;i < maxx;i+=10){
		r += "<th>"+i+"</th>";
	}
	r += "</tr></thead><tbody>";
	for(var i=0;i < 10;i++){
		r += "<tr><th>"+i+"</th>";
		for(var j=0;j < maxx;j+=10){
			r += "<th>"+arr[(j+i)%maxx]+"</th>";
		}
		r += "</tr>"
	}
	r += "</tbody>";
	return r;
}

//]]>  

</script>


<style type="text/css"></style></head>
<body class="claro" style="">
  <div class="container-fluid">
    <div class="rrow-fluid clearfix">
        <div class="span12">
            	<div class="page-header">
			    	<h1>MT10</h1>
					<div class="navbar">
					  <div class="navbar-inner">
				    	<ul class="nav">
							  <li><a href="#smooth">Smooth & Supersmooth</a></li>
							  <li><a href="#smooth-table">Tableau des B-Smooth</a></li>
							  <li><a href="#rabin">Test de primalité de Rabin-Miller</a></li>
							  <li><a href="#pollard">Algorithme p-1 de Pollard</a></li>
							  <li><a href="#carmichael-test">Test: Nombre de carmichael ?</a></li>
							  <li><a href="#carmichael">Liste des nombres de carmichael</a></li>
							  <li><a href="#logtable">Tables d'exponentiation et de logarithme dans un corps</a></li>
						</ul>
					  </div>
					</div>
					<a href="https://github.com/MDamien/mdamien.github.io/blob/master/mt10/index.html">Code source</a>
    			</div>
            	<div id="smooth">
					<h4># Smooth & Supersmooth</h4>
					<input class="x" type="text" placeholder="x" value="12"><br>
					<button type="button" class="btn" onclick="simple_smooth_calcul()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
				<br>
            	<div id="smooth-table">
					<h4># Tableau des B-Smooth</h4>
					<label>X max:</label> <input class="x" type="text" placeholder="x max" value="70"><br>
					<label>B max:</label> <input class="B" type="text" placeholder="B max" value="10"><br>
					<button type="button" class="btn" onclick="generate_smooth_table()">Calculer</button>
					<table class="table">
						<thead>
							<tr>
								<th>B</th>
								<th>B-Smooth</th>
								<th>B-Supersmooth</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
					</div></b>
            	<div id="rabin">
					<h4># Test de primalité de Rabin-Miller</h4>
					<label>a</label> <input class="a" type="text" placeholder="a" value="2"><br>
					<label>p</label> <input class="p" type="text" placeholder="p" value="5"><br>
					<button type="button" class="btn" onclick="goRabin()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div id="pollard">
					<h4># Algorithme p-1 de Pollard</h4>
					<label>N</label> <input class="N" type="text" placeholder="N" value="654544554677"><br>
					<label>a</label> <input class="a" type="text" placeholder="a" value="453456546456777"><br>
					<button type="button" class="btn" onclick="goPollard()">Factoriser</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div id="carmichael-test">
					<h4># Test: Nombre de carmichael ?</h4>
					<label>n</label> <input class="N" type="text" placeholder="n" value="561"><br>
					<button type="button" class="btn" onclick="goCarmichaelTest()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div id="carmichael">
					<h4># Liste des nombres de carmichael</h4>
					<label>Max n</label> <input class="N" type="text" placeholder="n" value="567"><br>
					<button type="button" class="btn" onclick="goCarmichael()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div id="logtable">
					<h4># Tables d'exponentiation et de logarithme dans un corps</h4>
					<h5>(polynomes en binaire , F(2**N))</h5>
					<label>m(x)</label> <input class="mx" type="text" placeholder="m(x)" value="10001111" onkeyup=""><span class="mx-preview"><br>
					<label>base</label> <input class="base" type="text" placeholder="base" value="11" onkeyup=""><span class="base-preview"><br>
					<label>N</label> <input class="N" type="text" placeholder="n" value="8"><br>
					<button type="button" class="btn" onclick="goLogTable()">Calculer</button>
					<div class="result">
						Tables des puissances
						<table class="table exponents">
						</table>
						Tables des logs
						<table class="table log">
						</table>
					</div>
				</div>
				<br/>
				<br/>
				<br/>
				<br/>
				<br/>
				</div>
        </div>
    </div>
</div>
  





</body></html>
