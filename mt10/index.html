<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>MT10</title>
  
  <script type="text/javascript" src="http://code.jquery.com/jquery-git2.js"></script>
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css">
  <style type="text/css">
  </style>

<script type="text/javascript">//<![CDATA[ 

function smoofitude(x){
    return Math.max.apply(Math,primeFactorList(x));
}
function supersmoofitude(x){
    var arr = toFactorPowerList(primeFactorList(x))
    var max = 0;
    for(var i = 0;i < arr.length;i++){
        max = Math.max(max,Math.pow(arr[i][0],arr[i][1]));
    }
    return max;
}

function simple_smooth_calcul() {
    var x = parseInt($("#smooth .x").val());
    var s = x + "=" + primeFactorList(x).join("*")+"<br/>";
    $("#smooth .result").html(s+x+" est "+smoofitude(x)+"-smooth et "+supersmoofitude(x)+"-supersmooth");
}
function smoothtable(maxx){
	var res = {}
    for(var i = 2;i <= maxx;i++){
        var r = smoofitude(i);
        if( res[r] == undefined){
			res[r] = [i];
		}else{
			res[r].push(i);
		}
    }
    return res;
}
function supersmoothtable(maxx){
	var res = {}
    for(var i = 2;i <= maxx;i++){
        var r = supersmoofitude(i);
        if( res[r] == undefined){
			res[r] = [i];
		}else{
			res[r].push(i);
		}
    }
    return res;
}

function generate_smooth_table() {
    var maxx = parseInt($("#smooth-table .x").val());
    var maxB = parseInt($("#smooth-table .B").val());
    var sm = smoothtable(maxx);
    var ssm = supersmoothtable(maxx);
    $("#smooth-table tbody").html("");
    if(maxB == undefined){
    	return;
    }
    for(var i = 2;i <= maxB;i++){
		var r = i == 2 ? "": "Id";
		if (sm[i] != undefined){
			r += i == 2 ? "": " + ";
			r += sm[i];
		}
		var r2 = i == 2 ? "": "Id";
		if (ssm[i] != undefined){
			r2 += i == 2 ? "": " + ";
			r2 += ssm[i];
		}
        $("#smooth-table tbody").append($("<tr><th>"+i+"</th><th>"+r+"</th><th>"+r2+"</th></tr>"));
    }
}

function primeFactorList(n) {
	if (n < 1)
		throw "Argument error";
	
	var result = [];
	while (n != 1) {
		var factor = smallestFactor(n);
		result.push(factor);
		n /= factor;
	}
	return result;
}

function smallestFactor(n) {
	if (n < 2)
		throw "Argument error";
	
	if (n % 2 == 0)
		return 2;
	var end = Math.floor(Math.sqrt(n));
	for (var i = 3; i <= end; i += 2) {
		if (n % i == 0)
			return i;
	}
	return n;
}

function toFactorPowerList(factors) {
	var result = [];
	var factor = factors[0];
	var count = 1;
	for (var i = 1; i < factors.length; i++) {
		if (factors[i] == factor) {
			count++;
		} else {
			result.push([factor, count]);
			factor = factors[i];
			count = 1;
		}
	}
	result.push([factor, count]);
	return result;
}

function goRabin(){
	var p = parseInt($("#rabin .p").val());
	var a = parseInt($("#rabin .a").val());
	if(a == undefined || p == undefined){
    	return;
    }
    $("#rabin .result").html(rabinMiller(p,a))
}

function rapidExpo(a,p,n){ //a^p mod n
	var prod = 1;
	while(p > 0){
		prod = (prod*a) % n;
		p -= 1;
	}
	return prod;
}

function rabinMiller(p,a){
	var b = 0;
	var a2 = a;
	while(a2 % 2 != 0){
		a2 /= 2;
		b += 1;
	}
	var m = (p-1)/Math.pow(2,b);
	z = rapidExpo(a,m,p);
	if(z == 1 || z == p-1){
		return "Probablement premier";
	}
	for(var j = 1;j < b;j++){
		z = (z*z) % p;
		if(z = p-1){
			return "Probablement premier";
		}
		if(z = 1){
			return "Non premier";
		}
	}
	return "Non premier";
}

function goPollard(){
	$("#pollard .result").html("");
	var N = parseInt($("#pollard .N").val());
	var a = parseInt($("#pollard .a").val());
	if( a == undefined || N == undefined){
    	return;
    }
    $("#pollard .result").html(pollard(N,a));
}

function pollard(N,a){
	for(var B = 2;B < N-1;B++){
		D = gcd(a,N);
		if(D != 1){
			return "D = "+D+" , B = "+B;
		}
		for(var p=2;p < B;p++){
			if(isPrime(p)){
				ep = Math.floor(Math.log(B)/Math.log(p));
				a = rapidExpo(a,Math.pow(p,ep),N);
			}
		}
		if(a-1 == 0) return "Changer a";
		D = gcd(a-1,N);
		if(D != 1){
			return "D = "+D+" , B = "+B;
		}
	}
	return "Echec de la factorisation";
}

function gcd(x, y) {
	while (y != 0) {
		var z = x % y;
		x = y;
		y = z;
	}
	return x;
}

function isPrime(n) {
	if (isNaN(n) || !isFinite(n) || n%1 || n<2) return false; 
	if (n%2==0) return (n==2);
	if (n%3==0) return (n==3);
	var m=Math.sqrt(n);
	for (var i=5;i<=m;i+=6) {
		if (n%i==0)     return false;
		if (n%(i+2)==0) return false;
	}
	return true;
} 

function goCarmichael(){
	$("#carmichael .result").html("");
	var N = parseInt($("#carmichael .N").val());
	if( N == undefined){
    	return;
    }
    $("#carmichael .result").html(carmichael(N).join(", "));
}

function isPrimeFactorListUnique(n) {
	var result = [];
	while (n != 1) {
		var factor = smallestFactor(n);
		if(result.indexOf(factor) != -1){
			return false;
		}
		result.push(factor);
		n /= factor;
	}
	return result;
}

function carmichael(maxx) {
/*
Is N prime? If yes, you're done. It's not a Carmichael number.
Otherwise, find the prime factors of N. If there are repeats, you're done. It's not a Carmichael number.
If one of them is 2, you're done. It's not a Carmichael number.
For each of these factors b, is b^(n-1) mod n equal to 1? If not, you're done. It's not a Carmichael number.
Otherwise, yes, it is a Carmichael number.
*/
	var arr = [];
	for(var n=1;n <= maxx;n += 2){
		if(!isPrime(n)){
			factors = isPrimeFactorListUnique(n);
			if(factors != false){
				var carm = true;
				for(var i=0;i < factors.length;i++){
					//if(rapidExpo(factors[i],n-1,n) != 1){
					if(factors[i]-1 % n-1 != 0){
						carm = false; //counter-example : factors[i]**(n-1) != 1
						if(n == 561){alert(factors[i]);}
						break;
					}
				}
				if(carm){
					arr.push(n);
				}
			}
		}
	}
	return arr;
}

//]]>  

</script>


<style type="text/css"></style></head>
<body class="claro" style="">
  <div class="container-fluid">
    <div class="rrow-fluid clearfix">
        <div class="span12">
            	<div class="page-header">
    	<h1>MT10</h1>
    	<a href="https://github.com/MDamien/mdamien.github.io/blob/master/mt10/index.html">Code source</a>
    </div>
            	<div id="smooth">
					<h4># Smooth & Supersmooth</h4>
					<input class="x" type="text" placeholder="x" value="12"><br>
					<button type="button" class="btn" onclick="simple_smooth_calcul()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
				<br>
            	<div id="smooth-table">
					<h4># Tableau des B-Smooth</h4>
					<label>X max:</label> <input class="x" type="text" placeholder="x max" value="70"><br>
					<label>B max:</label> <input class="B" type="text" placeholder="B max" value="10"><br>
					<button type="button" class="btn" onclick="generate_smooth_table()">Calculer</button>
					<table class="table">
						<thead>
							<tr>
								<th>B</th>
								<th>B-Smooth</th>
								<th>B-Supersmooth</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
					</div></b>
            	<div id="rabin">
					<h4># Test de primalité de Rabin-Miller</h4>
					<label>a</label> <input class="a" type="text" placeholder="a" value="2"><br>
					<label>p</label> <input class="p" type="text" placeholder="p" value="5"><br>
					<button type="button" class="btn" onclick="goRabin()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div id="pollard">
					<h4># Algorithme p-1 de Pollard</h4>
					<label>N</label> <input class="N" type="text" placeholder="N" value="654544554677"><br>
					<label>a</label> <input class="a" type="text" placeholder="a" value="453456546456777"><br>
					<button type="button" class="btn" onclick="goPollard()">Factoriser</button>
					<b><div class="result">
					</div></b>
				</div>
            	<div style="display: none;" id="carmichael">
					<h4># Liste des nombres de carmichael</h4>
					<label>Max n</label> <input class="N" type="text" placeholder="n" value="1000"><br>
					<button type="button" class="btn" onclick="goCarmichael()">Calculer</button>
					<b><div class="result">
					</div></b>
				</div>
				<br/>
				<br/>
				<br/>
				<br/>
				<br/>
				</div>
        </div>
    </div>
</div>
  





</body></html>
